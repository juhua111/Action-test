!function(){var e={d:function(t,i){for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};!function(){"use strict";function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}e.r(t),e.d(t,{AudioPlayer:function(){return El},AudioSource:function(){return Kn},BasePlayer:function(){return yo},BaseSource:function(){return Hn},HlsPlayer:function(){return To},HlsSource:function(){return Vn},Mp4Video:function(){return Eo},PLAYER_BUS_EVENTS:function(){return On},PLAYER_EVENTS:function(){return kn},Player:function(){return Gn},STATUS_VIDEO_FINISH:function(){return In},VideoPlayer:function(){return yl}});var s,r,n,a,o,l={exports:{}};s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,l.exports=o={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var s=o.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");return s.path=o.normalizePath(s.path),o.buildURLFromParts(s)}var n=o.parseURL(t);if(!n)throw new Error("Error trying to parse relative URL.");if(n.scheme)return i.alwaysNormalize?(n.path=o.normalizePath(n.path),o.buildURLFromParts(n)):t;var a=o.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var l=r.exec(a.path);a.netLoc=l[1],a.path=l[2]}a.netLoc&&!a.path&&(a.path="/");var c={scheme:a.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment};if(!n.netLoc&&(c.netLoc=a.netLoc,"/"!==n.path[0]))if(n.path){var d=a.path,h=d.substring(0,d.lastIndexOf("/")+1)+n.path;c.path=o.normalizePath(h)}else c.path=a.path,n.params||(c.params=a.params,n.query||(c.query=a.query));return null===c.path&&(c.path=i.alwaysNormalize?o.normalizePath(n.path):n.path),o.buildURLFromParts(c)},parseURL:function(e){var t=s.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(n,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};var c=l.exports;function d(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function h(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?d(Object(i),!0).forEach((function(t){u(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):d(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function u(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function f(){return f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},f.apply(this,arguments)}const p=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)};let g=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e}({}),m=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),v=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown",e}({});const y=function(){},T={trace:y,debug:y,log:y,warn:y,info:y,error:y};let E=T;function b(e,...t){t.forEach((function(t){E[t]=e[t]?e[t].bind(e):function(e){const t=self.console[e];return t?t.bind(self.console,`[${e}] >`):y}(t)}))}const S=E,L=/^(\d+)x(\d+)$/,_=/(.+?)=(".*?"|.*?)(?:,|$)/g;class w{constructor(e){"string"==typeof e&&(e=w.parseAttrList(e));for(const t in e)e.hasOwnProperty(t)&&("X-"===t.substring(0,2)&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(t)),this[t]=e[t])}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const i=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)i[e]=parseInt(t.slice(2*e,2*e+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}bool(e){return"YES"===this[e]}decimalResolution(e){const t=L.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const i={};for(_.lastIndex=0;null!==(t=_.exec(e));){let e=t[2];0===e.indexOf('"')&&e.lastIndexOf('"')===e.length-1&&(e=e.slice(1,-1));i[t[1].trim()]=e}return i}}function A(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e}class R{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const i=t.attr;for(const t in i)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==i[t]){S.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=f(new w({}),i,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=new Date(this.attr["END-DATE"]);p(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(p(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&p(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class C{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var P="audio",k="video",D="audiovideo";class I{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[P]:null,[k]:null,[D]:null},this.baseurl=e}setByteRange(e,t){const i=e.split("@",2),s=[];1===i.length?s[0]=t?t.byteRangeEndOffset:0:s[0]=parseInt(i[1]),s[1]=parseInt(i[0])+s[0],this._byteRange=s}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=c.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class M extends I{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new C,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const e=Object.keys(this.levelkeys);if(1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;if(!p(this.programDateTime))return null;const e=p(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),t=e.length;if(t>1||1===t&&this.levelkeys[e[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,i,s,r,n=!1){const{elementaryStreams:a}=this,o=a[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,i),o.startDTS=Math.min(o.startDTS,s),o.endDTS=Math.max(o.endDTS,r)):a[e]={startPTS:t,endPTS:i,startDTS:s,endDTS:r,partial:n}}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[P]=null,e[k]=null,e[D]=null}}class O extends I{constructor(e,t,i,s,r){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new C,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const n=e.enumeratedString("BYTERANGE");n&&this.setByteRange(n,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}class x{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t,this.advanced=this.endSN>e.endSN||t>0||0===t&&i>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return!!this.fragments.length&&p(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;if(e>0){return 1e3*(this.driftEnd-this.driftStart)/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function F(e){return Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))}function B(e){const t=e.split(":");let i=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),s=e[e.length-1].split(",");if(2===s.length){const t="base64"===s[0],r=s[1];t?(e.splice(-1,1),i=F(r)):i=function(e){const t=N(e).subarray(0,16),i=new Uint8Array(16);return i.set(t,16-t.length),i}(r)}}return i}function N(e){return Uint8Array.from(unescape(encodeURIComponent(e)),(e=>e.charCodeAt(0)))}var U={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},$="org.w3.clearkey",G="com.apple.streamingkeydelivery",H="com.microsoft.playready",V="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function K(e){switch(e){case G:return U.FAIRPLAY;case H:return U.PLAYREADY;case V:return U.WIDEVINE;case $:return U.CLEARKEY}}var q="edef8ba979d64acea3c827dcd51d21ed";function j(e){switch(e){case U.FAIRPLAY:return G;case U.PLAYREADY:return H;case U.WIDEVINE:return V;case U.CLEARKEY:return $}}function W(e){const{drmSystems:t,widevineLicenseUrl:i}=e,s=t?[U.FAIRPLAY,U.WIDEVINE,U.PLAYREADY,U.CLEARKEY].filter((e=>!!t[e])):[];return!s[U.WIDEVINE]&&i&&s.push(U.WIDEVINE),s}const Y="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function z(e,t,i){return Uint8Array.prototype.slice?e.slice(t,i):new Uint8Array(Array.prototype.slice.call(e,t,i))}const X=(e,t)=>t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,Z=(e,t)=>t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,Q=(e,t)=>{const i=t;let s=0;for(;X(e,t);){s+=10;s+=J(e,t+6),Z(e,t+10)&&(s+=10),t+=s}if(s>0)return e.subarray(i,i+s)},J=(e,t)=>{let i=0;return i=(127&e[t])<<21,i|=(127&e[t+1])<<14,i|=(127&e[t+2])<<7,i|=127&e[t+3],i},ee=(e,t)=>X(e,t)&&J(e,t+6)+10<=e.length-t,te=e=>e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info,ie=e=>{const t=String.fromCharCode(e[0],e[1],e[2],e[3]),i=J(e,4);return{type:t,size:i,data:e.subarray(10,10+i)}},se=e=>{let t=0;const i=[];for(;X(e,t);){const s=J(e,t+6);t+=10;const r=t+s;for(;t+8<r;){const s=ie(e.subarray(t)),r=re(s);r&&i.push(r),t+=s.size+10}Z(e,t)&&(t+=10)}return i},re=e=>"PRIV"===e.type?ne(e):"W"===e.type[0]?oe(e):ae(e),ne=e=>{if(e.size<2)return;const t=ce(e.data,!0),i=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:i.buffer}},ae=e=>{if(e.size<2)return;if("TXXX"===e.type){let t=1;const i=ce(e.data.subarray(t),!0);t+=i.length+1;const s=ce(e.data.subarray(t));return{key:e.type,info:i,data:s}}const t=ce(e.data.subarray(1));return{key:e.type,data:t}},oe=e=>{if("WXXX"===e.type){if(e.size<2)return;let t=1;const i=ce(e.data.subarray(t),!0);t+=i.length+1;const s=ce(e.data.subarray(t));return{key:e.type,info:i,data:s}}const t=ce(e.data);return{key:e.type,data:t}},le=e=>{if(8===e.data.byteLength){const t=new Uint8Array(e.data),i=1&t[3];let s=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return s/=45,i&&(s+=47721858.84),Math.round(s)}},ce=(e,t=!1)=>{const i=he();if(i){const s=i.decode(e);if(t){const e=s.indexOf("\0");return-1!==e?s.substring(0,e):s}return s.replace(/\0/g,"")}const s=e.length;let r,n,a,o="",l=0;for(;l<s;){if(r=e[l++],0===r&&t)return o;if(0!==r&&3!==r)switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(r);break;case 12:case 13:n=e[l++],o+=String.fromCharCode((31&r)<<6|63&n);break;case 14:n=e[l++],a=e[l++],o+=String.fromCharCode((15&r)<<12|(63&n)<<6|(63&a)<<0)}}return o};let de;function he(){return de||void 0===self.TextDecoder||(de=new self.TextDecoder("utf-8")),de}const ue=function(e){let t="";for(let i=0;i<e.length;i++){let s=e[i].toString(16);s.length<2&&(s="0"+s),t+=s}return t},fe=Math.pow(2,32)-1,pe=[].push,ge={video:1,audio:2,id3:3,text:4};function me(e){return String.fromCharCode.apply(null,e)}function ve(e,t){const i=e[t]<<8|e[t+1];return i<0?65536+i:i}function ye(e,t){const i=Te(e,t);return i<0?4294967296+i:i}function Te(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function Ee(e,t,i){e[t]=i>>24,e[t+1]=i>>16&255,e[t+2]=i>>8&255,e[t+3]=255&i}function be(e,t){const i=[];if(!t.length)return i;const s=e.byteLength;for(let r=0;r<s;){const n=ye(e,r),a=n>1?r+n:s;if(me(e.subarray(r+4,r+8))===t[0])if(1===t.length)i.push(e.subarray(r+8,a));else{const s=be(e.subarray(r+8,a),t.slice(1));s.length&&pe.apply(i,s)}r=a}return i}function Se(e){const t=[],i=e[0];let s=8;const r=ye(e,s);s+=4;s+=0===i?8:16,s+=2;let n=e.length+0;const a=ve(e,s);s+=2;for(let o=0;o<a;o++){let i=s;const a=ye(e,i);i+=4;const o=2147483647&a;if(1===(2147483648&a)>>>31)return S.warn("SIDX has hierarchical references (not supported)"),null;const l=ye(e,i);i+=4,t.push({referenceSize:o,subsegmentDuration:l,info:{duration:l/r,start:n,end:n+o-1}}),n+=o,i+=4,s=i}return{earliestPresentationTime:0,timescale:r,version:i,referencesCount:a,references:t}}function Le(e){const t=[],i=be(e,["moov","trak"]);for(let s=0;s<i.length;s++){const e=i[s],r=be(e,["tkhd"])[0];if(r){let i=r[0],s=0===i?12:20;const n=ye(r,s),a=be(e,["mdia","mdhd"])[0];if(a){i=a[0],s=0===i?12:20;const r=ye(a,s),o=be(e,["mdia","hdlr"])[0];if(o){const i=me(o.subarray(8,12)),s={soun:P,vide:k}[i];if(s){const i=be(e,["mdia","minf","stbl","stsd"])[0];let a;i&&(a=me(i.subarray(12,16))),t[n]={timescale:r,type:s},t[s]={timescale:r,id:n,codec:a}}}}}}return be(e,["moov","mvex","trex"]).forEach((e=>{const i=ye(e,4),s=t[i];s&&(s.default={duration:ye(e,12),flags:ye(e,20)})})),t}function _e(e){const t=be(e,["schm"])[0];if(t){const i=me(t.subarray(4,8));if("cbcs"===i||"cenc"===i)return be(e,["schi","tenc"])[0]}return S.error("[eme] missing 'schm' box"),null}function we(e){const t=ye(e,0);let i=8;1&t&&(i+=4),4&t&&(i+=4);let s=0;const r=ye(e,4);for(let n=0;n<r;n++){if(256&t){s+=ye(e,i),i+=4}512&t&&(i+=4),1024&t&&(i+=4),2048&t&&(i+=4)}return s}function Ae(e,t){const i=new Uint8Array(e.length+t.length);return i.set(e),i.set(t,e.length),i}function Re(e,t){const i=[],s=t.samples,r=t.timescale,n=t.id;let a=!1;return be(s,["moof"]).map((o=>{const l=o.byteOffset-8;be(o,["traf"]).map((o=>{const c=be(o,["tfdt"]).map((e=>{const t=e[0];let i=ye(e,4);return 1===t&&(i*=Math.pow(2,32),i+=ye(e,8)),i/r}))[0];return void 0!==c&&(e=c),be(o,["tfhd"]).map((c=>{const d=ye(c,4),h=16777215&ye(c,0);let u=0;const f=0!=(16&h);let p=0;const g=0!=(32&h);let m=8;d===n&&(0!=(1&h)&&(m+=8),0!=(2&h)&&(m+=4),0!=(8&h)&&(u=ye(c,m),m+=4),f&&(p=ye(c,m),m+=4),g&&(m+=4),"video"===t.type&&(a=function(e){if(!e)return!1;const t=e.indexOf("."),i=t<0?e:e.substring(0,t);return"hvc1"===i||"hev1"===i||"dvh1"===i||"dvhe"===i}(t.codec)),be(o,["trun"]).map((n=>{const o=n[0],c=16777215&ye(n,0),d=0!=(1&c);let h=0;const f=0!=(4&c),g=0!=(256&c);let m=0;const v=0!=(512&c);let y=0;const T=0!=(1024&c),E=0!=(2048&c);let b=0;const S=ye(n,4);let L=8;d&&(h=ye(n,L),L+=4),f&&(L+=4);let _=h+l;for(let l=0;l<S;l++){if(g?(m=ye(n,L),L+=4):m=u,v?(y=ye(n,L),L+=4):y=p,T&&(L+=4),E&&(b=0===o?ye(n,L):Te(n,L),L+=4),t.type===k){let t=0;for(;t<y;){const n=ye(s,_);if(_+=4,Ce(a,s[_])){Pe(s.subarray(_,_+n),a?2:1,e+b/r,i)}_+=n,t+=n+4}}e+=m/r}})))}))}))})),i}function Ce(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6===(31&t)}function Pe(e,t,i,s){const r=ke(e);let n=0;n+=t;let a=0,o=0,l=!1,c=0;for(;n<r.length;){a=0;do{if(n>=r.length)break;c=r[n++],a+=c}while(255===c);o=0;do{if(n>=r.length)break;c=r[n++],o+=c}while(255===c);const e=r.length-n;if(!l&&4===a&&n<r.length){l=!0;if(181===r[n++]){const e=ve(r,n);if(n+=2,49===e){const e=ye(r,n);if(n+=4,1195456820===e){const e=r[n++];if(3===e){const t=r[n++],o=64&t,l=o?2+3*(31&t):0,c=new Uint8Array(l);if(o){c[0]=t;for(let e=1;e<l;e++)c[e]=r[n++]}s.push({type:e,payloadType:a,pts:i,bytes:c})}}}}}else if(5===a&&o<e){if(l=!0,o>16){const e=[];for(let i=0;i<16;i++){const t=r[n++].toString(16);e.push(1==t.length?"0"+t:t),3!==i&&5!==i&&7!==i&&9!==i||e.push("-")}const t=o-16,l=new Uint8Array(t);for(let i=0;i<t;i++)l[i]=r[n++];s.push({payloadType:a,pts:i,uuid:e.join(""),userData:ce(l),userDataBytes:l})}}else if(o<e)n+=o;else if(o>e)break}}function ke(e){const t=e.byteLength,i=[];let s=1;for(;s<t-2;)0===e[s]&&0===e[s+1]&&3===e[s+2]?(i.push(s+2),s+=2):s++;if(0===i.length)return e;const r=t-i.length,n=new Uint8Array(r);let a=0;for(s=0;s<r;a++,s++)a===i[0]&&(a++,i.shift()),n[s]=e[a];return n}function De(e,t,i){if(16!==e.byteLength)throw new RangeError("Invalid system id");let s,r,n;if(t){s=1,r=new Uint8Array(16*t.length);for(let e=0;e<t.length;e++){const i=t[e];if(16!==i.byteLength)throw new RangeError("Invalid key");r.set(i,16*e)}}else s=0,r=new Uint8Array;s>0?(n=new Uint8Array(4),t.length>0&&new DataView(n.buffer).setUint32(0,t.length,!1)):n=new Uint8Array;const a=new Uint8Array(4);return i&&i.byteLength>0&&new DataView(a.buffer).setUint32(0,i.byteLength,!1),function(e,...t){const i=t.length;let s=8,r=i;for(;r--;)s+=t[r].byteLength;const n=new Uint8Array(s);for(n[0]=s>>24&255,n[1]=s>>16&255,n[2]=s>>8&255,n[3]=255&s,n.set(e,4),r=0,s=8;r<i;r++)n.set(t[r],s),s+=t[r].byteLength;return n}([112,115,115,104],new Uint8Array([s,0,0,0]),e,n,r,a,i||new Uint8Array)}let Ie={};class Me{static clearKeyUriToKeyIdMap(){Ie={}}constructor(e,t,i,s=[1],r=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=s,this.iv=r,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}isSupported(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case G:case V:case H:case $:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof e&&("AES-128"!==this.method||this.iv||S.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const t=function(e){const t=new Uint8Array(16);for(let i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t}(e);return new Me(this.method,this.uri,"identity",this.keyFormatVersions,t)}const t=B(this.uri);if(t)switch(this.keyFormat){case V:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case H:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=De(e,null,t);const i=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),s=String.fromCharCode.apply(null,Array.from(i)),r=s.substring(s.indexOf("<"),s.length),n=(new DOMParser).parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(n){const e=n.childNodes[0]?n.childNodes[0].nodeValue:n.getAttribute("VALUE");if(e){const t=F(e).subarray(0,16);!function(e){const t=function(e,t,i){const s=e[t];e[t]=e[i],e[i]=s};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}(t),this.keyId=t}}break}default:{let e=t.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e=Ie[this.uri];if(!e){const t=Object.keys(Ie).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16);new DataView(e.buffer,12,4).setUint32(0,t),Ie[this.uri]=e}this.keyId=e}return this}}const Oe=/\{\$([a-zA-Z0-9-_]+)\}/g;function xe(e){return Oe.test(e)}function Fe(e,t,i){if(null!==e.variableList||e.hasVariableRefs)for(let s=i.length;s--;){const r=i[s],n=t[r];n&&(t[r]=Be(e,n))}}function Be(e,t){if(null!==e.variableList||e.hasVariableRefs){const i=e.variableList;return t.replace(Oe,(t=>{const s=t.substring(2,t.length-1),r=null==i?void 0:i[s];return void 0===r?(e.playlistParsingError||(e.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),t):r}))}return t}function Ne(e,t,i){let s,r,n=e.variableList;if(n||(e.variableList=n={}),"QUERYPARAM"in t){s=t.QUERYPARAM;try{const e=new self.URL(i).searchParams;if(!e.has(s))throw new Error(`"${s}" does not match any query parameter in URI: "${i}"`);r=e.get(s)}catch(a){e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else s=t.NAME,r=t.VALUE;s in n?e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):n[s]=r||""}function Ue(e,t,i){const s=t.IMPORT;if(i&&s in i){let t=e.variableList;t||(e.variableList=t={}),t[s]=i[s]}else e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}function $e(){if("undefined"!=typeof self)return self.MediaSource||self.WebKitMediaSource}const Ge={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},He=$e();function Ve(e,t){var i;return null!=(i=null==He?void 0:He.isTypeSupported(`${t||"video"}/mp4;codecs="${e}"`))&&i}const Ke=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,qe=/#EXT-X-MEDIA:(.*)/g,je=/^#EXT(?:INF|-X-TARGETDURATION):/m,We=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Ye=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class ze{static findGroup(e,t){for(let i=0;i<e.length;i++){const s=e[i];if(s.id===t)return s}}static convertAVC1ToAVCOTI(e){const t=e.split(".");if(t.length>2){let e=t.shift()+".";return e+=parseInt(t.shift()).toString(16),e+=("000"+parseInt(t.shift()).toString(16)).slice(-4),e}return e}static resolve(e,t){return c.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return je.test(e)}static parseMasterPlaylist(e,t){const i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:xe(e)},s=[];let r;for(Ke.lastIndex=0;null!=(r=Ke.exec(e));)if(r[1]){var n;const e=new w(r[1]);Fe(i,e,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const a=Be(i,r[2]),o={attrs:e,bitrate:e.decimalInteger("AVERAGE-BANDWIDTH")||e.decimalInteger("BANDWIDTH"),name:e.NAME,url:ze.resolve(a,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),Qe((e.CODECS||"").split(/[ ,]+/).filter((e=>e)),o),o.videoCodec&&-1!==o.videoCodec.indexOf("avc1")&&(o.videoCodec=ze.convertAVC1ToAVCOTI(o.videoCodec)),null!=(n=o.unknownCodecs)&&n.length||s.push(o),i.levels.push(o)}else if(r[3]){const e=r[3],s=r[4];switch(e){case"SESSION-DATA":{const e=new w(s);Fe(i,e,["DATA-ID","LANGUAGE","VALUE","URI"]);const t=e["DATA-ID"];t&&(null===i.sessionData&&(i.sessionData={}),i.sessionData[t]=e);break}case"SESSION-KEY":{const e=Xe(s,t,i);e.encrypted&&e.isSupported()?(null===i.sessionKeys&&(i.sessionKeys=[]),i.sessionKeys.push(e)):S.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${s}"`);break}case"DEFINE":{const e=new w(s);Fe(i,e,["NAME","VALUE","QUERYPARAM"]),Ne(i,e,t)}break;case"CONTENT-STEERING":{const e=new w(s);Fe(i,e,["SERVER-URI","PATHWAY-ID"]),i.contentSteering={uri:ze.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":i.startTimeOffset=Ze(s)}}const a=s.length>0&&s.length<i.levels.length;return i.levels=a?s:i.levels,0===i.levels.length&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,i){let s;const r={},n=i.levels,a={AUDIO:n.map((e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec}))),SUBTITLES:n.map((e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec}))),"CLOSED-CAPTIONS":[]};let o=0;for(qe.lastIndex=0;null!==(s=qe.exec(e));){const e=new w(s[1]),n=e.TYPE;if(n){const s=a[n],l=r[n]||[];r[n]=l,Fe(i,e,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const c={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",instreamId:e["INSTREAM-ID"],name:e.NAME||e.LANGUAGE||"",type:n,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:e.LANGUAGE,url:e.URI?ze.resolve(e.URI,t):""};if(null!=s&&s.length){const e=ze.findGroup(s,c.groupId)||s[0];Je(c,e,"audioCodec"),Je(c,e,"textCodec")}l.push(c)}}return r}static parseLevelPlaylist(e,t,i,s,r,n){const a=new x(t),o=a.fragments;let l,c,d,h=null,u=0,g=0,m=0,v=0,y=null,T=new M(s,t),E=-1,b=!1;for(We.lastIndex=0,a.m3u8=e,a.hasVariableRefs=xe(e);null!==(l=We.exec(e));){b&&(b=!1,T=new M(s,t),T.start=m,T.sn=u,T.cc=v,T.level=i,h&&(T.initSegment=h,T.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null));const e=l[1];if(e){T.duration=parseFloat(e);const t=(" "+l[2]).slice(1);T.title=t||null,T.tagList.push(t?["INF",e,t]:["INF",e])}else if(l[3]){if(p(T.duration)){T.start=m,d&&it(T,d,a),T.sn=u,T.level=i,T.cc=v,T.urlId=r,o.push(T);const e=(" "+l[3]).slice(1);T.relurl=Be(a,e),et(T,y),y=T,m+=T.duration,u++,g=0,b=!0}}else if(l[4]){const e=(" "+l[4]).slice(1);y?T.setByteRange(e,y):T.setByteRange(e)}else if(l[5])T.rawProgramDateTime=(" "+l[5]).slice(1),T.tagList.push(["PROGRAM-DATE-TIME",T.rawProgramDateTime]),-1===E&&(E=o.length);else{if(l=l[0].match(Ye),!l){S.warn("No matches on slow regex match for level playlist!");continue}for(c=1;c<l.length&&void 0===l[c];c++);const e=(" "+l[c]).slice(1),r=(" "+l[c+1]).slice(1),m=l[c+2]?(" "+l[c+2]).slice(1):"";switch(e){case"PLAYLIST-TYPE":a.type=r.toUpperCase();break;case"MEDIA-SEQUENCE":u=a.startSN=parseInt(r);break;case"SKIP":{const e=new w(r);Fe(a,e,["RECENTLY-REMOVED-DATERANGES"]);const t=e.decimalInteger("SKIPPED-SEGMENTS");if(p(t)){a.skippedSegments=t;for(let e=t;e--;)o.unshift(null);u+=t}const i=e.enumeratedString("RECENTLY-REMOVED-DATERANGES");i&&(a.recentlyRemovedDateranges=i.split("\t"));break}case"TARGETDURATION":a.targetduration=Math.max(parseInt(r),1);break;case"VERSION":a.version=parseInt(r);break;case"EXTM3U":break;case"ENDLIST":a.live=!1;break;case"#":(r||m)&&T.tagList.push(m?[r,m]:[r]);break;case"DISCONTINUITY":v++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([e]);break;case"BITRATE":T.tagList.push([e,r]);break;case"DATERANGE":{const e=new w(r);Fe(a,e,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),Fe(a,e,e.clientAttrs);const t=new R(e,a.dateRanges[e.ID]);t.isValid||a.skippedSegments?a.dateRanges[t.id]=t:S.warn(`Ignoring invalid DATERANGE tag: "${r}"`),T.tagList.push(["EXT-X-DATERANGE",r]);break}case"DEFINE":{const e=new w(r);Fe(a,e,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in e?Ue(a,e,n):Ne(a,e,t)}break;case"DISCONTINUITY-SEQUENCE":v=parseInt(r);break;case"KEY":{const e=Xe(r,t,a);if(e.isSupported()){if("NONE"===e.method){d=void 0;break}d||(d={}),d[e.keyFormat]&&(d=f({},d)),d[e.keyFormat]=e}else S.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${r}"`);break}case"START":a.startTimeOffset=Ze(r);break;case"MAP":{const e=new w(r);if(Fe(a,e,["BYTERANGE","URI"]),T.duration){const r=new M(s,t);tt(r,e,i,d),h=r,T.initSegment=h,h.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=h.rawProgramDateTime)}else tt(T,e,i,d),h=T,b=!0;break}case"SERVER-CONTROL":{const e=new w(r);a.canBlockReload=e.bool("CAN-BLOCK-RELOAD"),a.canSkipUntil=e.optionalFloat("CAN-SKIP-UNTIL",0),a.canSkipDateRanges=a.canSkipUntil>0&&e.bool("CAN-SKIP-DATERANGES"),a.partHoldBack=e.optionalFloat("PART-HOLD-BACK",0),a.holdBack=e.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const e=new w(r);a.partTarget=e.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=a.partList;e||(e=a.partList=[]);const i=g>0?e[e.length-1]:void 0,s=g++,n=new w(r);Fe(a,n,["BYTERANGE","URI"]);const o=new O(n,T,t,s,i);e.push(o),T.duration+=o.duration;break}case"PRELOAD-HINT":{const e=new w(r);Fe(a,e,["URI"]),a.preloadHint=e;break}case"RENDITION-REPORT":{const e=new w(r);Fe(a,e,["URI"]),a.renditionReports=a.renditionReports||[],a.renditionReports.push(e);break}default:S.warn(`line parsed but not handled: ${l}`)}}}y&&!y.relurl?(o.pop(),m-=y.duration,a.partList&&(a.fragmentHint=y)):a.partList&&(et(T,y),T.cc=v,a.fragmentHint=T,d&&it(T,d,a));const L=o.length,_=o[0],A=o[L-1];if(m+=a.skippedSegments*a.targetduration,m>0&&L&&A){a.averagetargetduration=m/L;const e=A.sn;a.endSN="initSegment"!==e?e:0,a.live||(A.endList=!0),_&&(a.startCC=_.cc)}else a.endSN=0,a.startCC=0;return a.fragmentHint&&(m+=a.fragmentHint.duration),a.totalduration=m,a.endCC=v,E>0&&function(e,t){let i=e[t];for(let s=t;s--;){const t=e[s];if(!t)return;t.programDateTime=i.programDateTime-1e3*t.duration,i=t}}(o,E),a}}function Xe(e,t,i){var s,r;const n=new w(e);Fe(i,n,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const a=null!=(s=n.METHOD)?s:"",o=n.URI,l=n.hexadecimalInteger("IV"),c=n.KEYFORMATVERSIONS,d=null!=(r=n.KEYFORMAT)?r:"identity";o&&n.IV&&!l&&S.error(`Invalid IV: ${n.IV}`);const h=o?ze.resolve(o,t):"",u=(c||"1").split("/").map(Number).filter(Number.isFinite);return new Me(a,h,d,u,l)}function Ze(e){const t=new w(e).decimalFloatingPoint("TIME-OFFSET");return p(t)?t:null}function Qe(e,t){["video","audio","text"].forEach((i=>{const s=e.filter((e=>function(e,t){const i=Ge[t];return!!i&&!0===i[e.slice(0,4)]}(e,i)));if(s.length){const r=s.filter((e=>0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)));t[`${i}Codec`]=r.length>0?r[0]:s[0],e=e.filter((e=>-1===s.indexOf(e)))}})),t.unknownCodecs=e}function Je(e,t,i){const s=t[i];s&&(e[i]=s)}function et(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),p(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function tt(e,t,i,s){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=i,e.sn="initSegment",s&&(e.levelkeys=s),e.initSegment=null}function it(e,t,i){e.levelkeys=t;const{encryptedFragments:s}=i;s.length&&s[s.length-1].levelkeys===t||!Object.keys(t).some((e=>t[e].isCommonEncryption))||s.push(e)}var st="manifest",rt="level",nt="audioTrack",at="subtitleTrack",ot="main",lt="audio",ct="subtitle";function dt(e){const{type:t}=e;switch(t){case nt:return lt;case at:return ct;default:return ot}}function ht(e,t){let i=e.url;return void 0!==i&&0!==i.indexOf("data:")||(i=t.url),i}class ut{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.LEVEL_LOADING,this.onLevelLoading,this),e.on(g.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(g.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.LEVEL_LOADING,this.onLevelLoading,this),e.off(g.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(g.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,s=t.loader,r=new(i||s)(t);return this.loaders[e.type]=r,r}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:st,url:i,deliveryDirectives:null})}onLevelLoading(e,t){const{id:i,level:s,url:r,deliveryDirectives:n}=t;this.load({id:i,level:s,responseType:"text",type:rt,url:r,deliveryDirectives:n})}onAudioTrackLoading(e,t){const{id:i,groupId:s,url:r,deliveryDirectives:n}=t;this.load({id:i,groupId:s,level:null,responseType:"text",type:nt,url:r,deliveryDirectives:n})}onSubtitleTrackLoading(e,t){const{id:i,groupId:s,url:r,deliveryDirectives:n}=t;this.load({id:i,groupId:s,level:null,responseType:"text",type:at,url:r,deliveryDirectives:n})}load(e){var t;const i=this.hls.config;let s,r=this.getInternalLoader(e);if(r){const t=r.context;if(t&&t.url===e.url)return void S.trace("[playlist-loader]: playlist request ongoing");S.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}if(s=e.type===st?i.manifestLoadPolicy.default:f({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),null!=(t=e.deliveryDirectives)&&t.part){let t;if(e.type===rt&&null!==e.level?t=this.hls.levels[e.level].details:e.type===nt&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===at&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,i=t.targetduration;if(e&&i){const t=1e3*Math.max(3*e,.8*i);s=f({},s,{maxTimeToFirstByteMs:Math.min(t,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,s.maxTimeToFirstByteMs)})}}}const n=s.errorRetry||s.timeoutRetry||{},a={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:n.maxNumRetry||0,retryDelay:n.retryDelayMs||0,maxRetryDelay:n.maxRetryDelayMs||0},o={onSuccess:(e,t,i,s)=>{const r=this.getInternalLoader(i);this.resetInternalLoader(i.type);const n=e.data;0===n.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),ze.isMediaPlaylist(n)?this.handleTrackOrLevelPlaylist(e,t,i,s||null,r):this.handleMasterPlaylist(e,t,i,s)):this.handleManifestParsingError(e,i,new Error("no EXTM3U delimiter"),s||null,t)},onError:(e,t,i,s)=>{this.handleNetworkError(t,i,!1,e,s)},onTimeout:(e,t,i)=>{this.handleNetworkError(t,i,!0,void 0,e)}};r.load(e,a,o)}handleMasterPlaylist(e,t,i,s){const r=this.hls,n=e.data,a=ht(e,i),o=ze.parseMasterPlaylist(n,a);if(o.playlistParsingError)return void this.handleManifestParsingError(e,i,o.playlistParsingError,s,t);const{contentSteering:l,levels:c,sessionData:d,sessionKeys:h,startTimeOffset:u,variableList:f}=o;this.variableList=f;const{AUDIO:p=[],SUBTITLES:m,"CLOSED-CAPTIONS":v}=ze.parseMasterPlaylistMedia(n,a,o);if(p.length){p.some((e=>!e.url))||!c[0].audioCodec||c[0].attrs.AUDIO||(S.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new w({}),bitrate:0,url:""}))}r.trigger(g.MANIFEST_LOADED,{levels:c,audioTracks:p,subtitles:m,captions:v,contentSteering:l,url:a,stats:t,networkDetails:s,sessionData:d,sessionKeys:h,startTimeOffset:u,variableList:f})}handleTrackOrLevelPlaylist(e,t,i,s,r){const n=this.hls,{id:a,level:o,type:l}=i,c=ht(e,i),d=p(a)?a:0,h=p(o)?o:d,u=dt(i),f=ze.parseLevelPlaylist(e.data,c,h,u,d,this.variableList);if(l===st){const e={attrs:new w({}),bitrate:0,details:f,name:"",url:c};n.trigger(g.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:c,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=f,this.handlePlaylistLoaded(f,e,t,i,s,r)}handleManifestParsingError(e,t,i,s,r){this.hls.trigger(g.ERROR,{type:m.NETWORK_ERROR,details:v.MANIFEST_PARSING_ERROR,fatal:t.type===st,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:s,stats:r})}handleNetworkError(e,t,i=!1,s,r){let n=`A network ${i?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===rt?n+=`: ${e.level} id: ${e.id}`:e.type!==nt&&e.type!==at||(n+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(n);S.warn(`[playlist-loader]: ${n}`);let o=v.UNKNOWN,l=!1;const c=this.getInternalLoader(e);switch(e.type){case st:o=i?v.MANIFEST_LOAD_TIMEOUT:v.MANIFEST_LOAD_ERROR,l=!0;break;case rt:o=i?v.LEVEL_LOAD_TIMEOUT:v.LEVEL_LOAD_ERROR,l=!1;break;case nt:o=i?v.AUDIO_TRACK_LOAD_TIMEOUT:v.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case at:o=i?v.SUBTITLE_TRACK_LOAD_TIMEOUT:v.SUBTITLE_LOAD_ERROR,l=!1}c&&this.resetInternalLoader(e.type);const d={type:m.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:c,context:e,error:a,networkDetails:t,stats:r};if(s){const i=(null==t?void 0:t.url)||e.url;d.response=h({url:i,data:void 0},s)}this.hls.trigger(g.ERROR,d)}handlePlaylistLoaded(e,t,i,s,r,n){const a=this.hls,{type:o,level:l,id:c,groupId:d,deliveryDirectives:h}=s,u=ht(t,s),f=dt(s),p="number"==typeof s.level&&f===ot?l:void 0;if(!e.fragments.length){const e=new Error("No Segments found in Playlist");return void a.trigger(g.ERROR,{type:m.NETWORK_ERROR,details:v.LEVEL_EMPTY_ERROR,fatal:!1,url:u,error:e,reason:e.message,response:t,context:s,level:p,parent:f,networkDetails:r,stats:i})}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const y=e.playlistParsingError;if(y)a.trigger(g.ERROR,{type:m.NETWORK_ERROR,details:v.LEVEL_PARSING_ERROR,fatal:!1,url:u,error:y,reason:y.message,response:t,context:s,level:p,parent:f,networkDetails:r,stats:i});else switch(e.live&&n&&(n.getCacheAge&&(e.ageHeader=n.getCacheAge()||0),n.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case st:case rt:a.trigger(g.LEVEL_LOADED,{details:e,level:p||0,id:c||0,stats:i,networkDetails:r,deliveryDirectives:h});break;case nt:a.trigger(g.AUDIO_TRACK_LOADED,{details:e,id:c||0,groupId:d||"",stats:i,networkDetails:r,deliveryDirectives:h});break;case at:a.trigger(g.SUBTITLE_TRACK_LOADED,{details:e,id:c||0,groupId:d||"",stats:i,networkDetails:r,deliveryDirectives:h})}}}function ft(e,t){let i;try{i=new Event("addtrack")}catch(s){i=document.createEvent("Event"),i.initEvent("addtrack",!1,!1)}i.track=e,t.dispatchEvent(i)}function pt(e,t){const i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(s){S.debug(`[texttrack-utils]: ${s}`);try{const i=new self.TextTrackCue(t.startTime,t.endTime,t.text);i.id=t.id,e.addCue(i)}catch(r){S.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}"disabled"===i&&(e.mode=i)}function gt(e){const t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(let i=e.cues.length;i--;)e.removeCue(e.cues[i]);"disabled"===t&&(e.mode=t)}function mt(e,t,i,s){const r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&e.cues.length>0){const r=function(e,t,i){const s=[],r=function(e,t){if(t<e[0].startTime)return 0;const i=e.length-1;if(t>e[i].endTime)return-1;let s=0,r=i;for(;s<=r;){const n=Math.floor((r+s)/2);if(t<e[n].startTime)r=n-1;else{if(!(t>e[n].startTime&&s<i))return n;s=n+1}}return e[s].startTime-t<t-e[r].startTime?s:r}(e,t);if(r>-1)for(let n=r,a=e.length;n<a;n++){const r=e[n];if(r.startTime>=t&&r.endTime<=i)s.push(r);else if(r.startTime>i)return s}return s}(e.cues,t,i);for(let t=0;t<r.length;t++)s&&!s(r[t])||e.removeCue(r[t])}"disabled"===r&&(e.mode=r)}var vt="org.id3",yt="com.apple.quicktime.HLS",Tt="https://aomedia.org/emsg/ID3";function Et(){if("undefined"!=typeof self)return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}const bt=(()=>{const e=Et();try{new e(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function St(e,t){return e.getTime()/1e3-t}class Lt{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(g.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(g.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(gt(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if("metadata"===i.kind&&"id3"===i.label)return ft(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:s}}}=this;if(!i&&!s)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const n=Et();for(let a=0;a<r.length;a++){const e=r[a].type;if(e===Tt&&!i||!s)continue;const t=se(r[a].data);if(t){const i=r[a].pts;let s=i+r[a].duration;s>bt&&(s=bt);s-i<=0&&(s=i+.25);for(let r=0;r<t.length;r++){const a=t[r];if(!te(a)){this.updateId3CueEnds(i,e);const t=new n(i,s,"");t.value=a,e&&(t.type=e),this.id3Track.addCue(t)}}}}}updateId3CueEnds(e,t){var i;const s=null==(i=this.id3Track)?void 0:i.cues;if(s)for(let r=s.length;r--;){const i=s[r];i.type===t&&i.startTime<e&&i.endTime===bt&&(i.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:s}){const{id3Track:r,hls:n}=this;if(!n)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:o}}=n;if(r&&(a||o)){let e;e="audio"===s?e=>e.type===vt&&o:"video"===s?e=>e.type===Tt&&a:e=>e.type===vt&&o||e.type===Tt&&a,mt(r,t,i,e)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:i,id3Track:s}=this,{dateRanges:r}=t,n=Object.keys(r);if(s){const e=Object.keys(i).filter((e=>!n.includes(e)));for(let t=e.length;t--;){const r=e[t];Object.keys(i[r].cues).forEach((e=>{s.removeCue(i[r].cues[e])})),delete i[r]}}const a=t.fragments[t.fragments.length-1];if(0===n.length||!p(null==a?void 0:a.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=a.programDateTime/1e3-a.start,l=Et();for(let h=0;h<n.length;h++){const e=n[h],t=r[e],s=i[e],a=(null==s?void 0:s.cues)||{};let u=(null==s?void 0:s.durationKnown)||!1;const f=St(t.startDate,o);let p=bt;const g=t.endDate;if(g)p=St(g,o),u=!0;else if(t.endOnNext&&!u){const e=n.reduce(((e,i)=>{const s=r[i];return s.class===t.class&&s.id!==i&&s.startDate>t.startDate&&e.push(s),e}),[]).sort(((e,t)=>e.startDate.getTime()-t.startDate.getTime()))[0];e&&(p=St(e.startDate,o),u=!0)}const m=Object.keys(t.attr);for(let i=0;i<m.length;i++){const r=m[i];if("ID"===(d=r)||"CLASS"===d||"START-DATE"===d||"DURATION"===d||"END-DATE"===d||"END-ON-NEXT"===d)continue;let n=a[r];if(n)u&&!s.durationKnown&&(n.endTime=p);else{let i=t.attr[r];n=new l(f,p,""),A(r)&&(c=i,i=Uint8Array.from(c.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),n.value={key:r,data:i},n.type=yt,n.id=e,this.id3Track.addCue(n),a[r]=n}}i[e]={cues:a,dateRange:t,durationKnown:u}}var c,d}}class _t{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(null===e)return null;const{holdBack:t,partHoldBack:i,targetduration:s}=e,{liveSyncDuration:r,liveSyncDurationCount:n,lowLatencyMode:a}=this.config,o=this.hls.userConfig;let l=a&&i||t;(o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==r?r:n*s);const c=s;return l+Math.min(1*this.stallCount,c)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,i=this.levelDetails;if(null===e||null===t||null===i)return null;const s=i.edge,r=e-t-this.edgeStalled,n=s-i.totalduration,a=s-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(n,r),a)}get drift(){const{levelDetails:e}=this;return null===e?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(g.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(g.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(g.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(g.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(g.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(g.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var i;t.details===v.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(i=this.levelDetails)&&i.live&&S.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const i=this.computeLatency();if(null===i)return;this._latency=i;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:r}=this.config;if(!s||1===r)return;const n=this.targetLatency;if(null===n)return;const a=i-n,o=a<Math.min(this.maxLatency,n+t.targetduration);if(t.live&&o&&a>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,r)),i=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;e.playbackRate=Math.min(t,Math.max(1,i))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}const wt=["NONE","TYPE-0","TYPE-1",null];var At="",Rt="YES",Ct="v2";class Pt{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class kt{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter((e=>e)).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(e){const t=e%this.url.length;this._urlId!==t&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=t)}get audioGroupId(){var e;return null==(e=this.audioGroupIds)?void 0:e[this.urlId]}get textGroupId(){var e;return null==(e=this.textGroupIds)?void 0:e[this.urlId]}addFallback(e){this.url.push(e.url),this._attrs.push(e.attrs)}}function Dt(e,t){const i=t.startPTS;if(p(i)){let s,r=0;t.sn>e.sn?(r=i-e.start,s=e):(r=e.start-i,s=t),s.duration!==r&&(s.duration=r)}else if(t.sn>e.sn){e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration}else t.start=Math.max(e.start-t.duration,0)}function It(e,t,i,s,r,n){s-i<=0&&(S.warn("Fragment should have a positive duration",t),s=i+t.duration,n=r+t.duration);let a=i,o=s;const l=t.startPTS,c=t.endPTS;if(p(l)){const e=Math.abs(l-i);p(t.deltaPTS)?t.deltaPTS=Math.max(e,t.deltaPTS):t.deltaPTS=e,a=Math.max(i,l),i=Math.min(i,l),r=Math.min(r,t.startDTS),o=Math.min(s,c),s=Math.max(s,c),n=Math.max(n,t.endDTS)}const d=i-t.start;0!==t.start&&(t.start=i),t.duration=s-t.start,t.startPTS=i,t.maxStartPTS=a,t.startDTS=r,t.endPTS=s,t.minEndPTS=o,t.endDTS=n;const h=t.sn;if(!e||h<e.startSN||h>e.endSN)return 0;let u;const f=h-e.startSN,g=e.fragments;for(g[f]=t,u=f;u>0;u--)Dt(g[u],g[u-1]);for(u=f;u<g.length-1;u++)Dt(g[u],g[u+1]);return e.fragmentHint&&Dt(g[g.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,d}function Mt(e,t){let i=null;const s=e.fragments;for(let l=s.length-1;l>=0;l--){const e=s[l].initSegment;if(e){i=e;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;let r,n=0;if(function(e,t,i){const s=t.skippedSegments,r=Math.max(e.startSN,t.startSN)-t.startSN,n=(e.fragmentHint?1:0)+(s?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,a=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let c=r;c<=n;c++){const e=l[a+c];let r=o[c];s&&!r&&c<s&&(r=t.fragments[c]=e),e&&r&&i(e,r)}}(e,t,((e,s)=>{e.relurl&&(n=e.cc-s.cc),p(e.startPTS)&&p(e.endPTS)&&(s.start=s.startPTS=e.startPTS,s.startDTS=e.startDTS,s.maxStartPTS=e.maxStartPTS,s.endPTS=e.endPTS,s.endDTS=e.endDTS,s.minEndPTS=e.minEndPTS,s.duration=e.endPTS-e.startPTS,s.duration&&(r=s),t.PTSKnown=t.alignedSliding=!0),s.elementaryStreams=e.elementaryStreams,s.loader=e.loader,s.stats=e.stats,s.urlId=e.urlId,e.initSegment&&(s.initSegment=e.initSegment,i=e.initSegment)})),i){(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach((e=>{var t;e.initSegment&&e.initSegment.relurl!==(null==(t=i)?void 0:t.relurl)||(e.initSegment=i)}))}if(t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some((e=>!e)),t.deltaUpdateFailed){S.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=function(e,t,i){const s=f({},e);i&&i.forEach((e=>{delete s[e]}));return Object.keys(t).forEach((e=>{const i=new R(t[e].attr,s[e]);i.isValid?s[e]=i:S.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(t[e].attr)}"`)})),s}(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));const a=t.fragments;if(n){S.warn("discontinuity sliding from playlist, take drift into account");for(let e=0;e<a.length;e++)a[e].cc+=n}t.skippedSegments&&(t.startCC=t.fragments[0].cc),function(e,t,i){if(e&&t){let s=0;for(let r=0,n=e.length;r<=n;r++){const n=e[r],a=t[r+s];n&&a&&n.index===a.index&&n.fragment.sn===a.fragment.sn?i(n,a):s--}}}(e.partList,t.partList,((e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),r?It(t,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):Ot(e,t),a.length&&(t.totalduration=t.edge-a[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const o=t.advancedDateTime;if(t.advanced&&o){const e=t.edge;t.driftStart||(t.driftStartTime=o,t.driftStart=e),t.driftEndTime=o,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function Ot(e,t){const i=t.startSN+t.skippedSegments-e.startSN,s=e.fragments;i<0||i>=s.length||xt(t,s[i].start)}function xt(e,t){if(t){const i=e.fragments;for(let s=e.skippedSegments;s<i.length;s++)i[s].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function Ft(e,t,i){var s;return null!=e&&e.details?Bt(null==(s=e.details)?void 0:s.partList,t,i):null}function Bt(e,t,i){if(e)for(let s=e.length;s--;){const r=e[s];if(r.index===i&&r.fragment.sn===t)return r}return null}function Nt(e){switch(e.details){case v.FRAG_LOAD_TIMEOUT:case v.KEY_LOAD_TIMEOUT:case v.LEVEL_LOAD_TIMEOUT:case v.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Ut(e,t){const i=Nt(t);return e.default[(i?"timeout":"error")+"Retry"]}function $t(e,t){const i="linear"===e.backoff?1:Math.pow(2,t);return Math.min(i*e.retryDelayMs,e.maxRetryDelayMs)}function Gt(e){return h(h({},e),{errorRetry:null,timeoutRetry:null})}function Ht(e,t,i,s){return!!e&&t<e.maxNumRetry&&(function(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}(s)||!!i)}const Vt={search:function(e,t){let i=0,s=e.length-1,r=null,n=null;for(;i<=s;){r=(i+s)/2|0,n=e[r];const a=t(n);if(a>0)i=r+1;else{if(!(a<0))return n;s=r-1}}return null}};function Kt(e,t,i=0,s=0){let r=null;if(e?r=t[e.sn-t[0].sn+1]||null:0===i&&0===t[0].start&&(r=t[0]),r&&0===qt(i,s,r))return r;const n=Vt.search(t,qt.bind(null,i,s));return!n||n===e&&r?r:n}function qt(e=0,t=0,i){if(i.start<=e&&i.start+i.duration>e)return 0;const s=Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-s<=e?1:i.start-s>e&&i.start?-1:0}function jt(e,t,i){const s=1e3*Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return(i.endProgramDateTime||0)-s>e}var Wt=0,Yt=2,zt=5,Xt=0,Zt=1,Qt=2;function Jt(e,t,i){if(performance.now()-e.lastErrorPerfMs>3e5)return!0;const s=e.details;if(t.details===v.FRAG_GAP&&s&&t.frag){const e=t.frag.start,i=Kt(null,s.fragments,e);if(i&&!i.gap)return!0}if(i&&e.errors.length<i.errors.length){const i=e.errors[e.errors.length-1];if(s&&i.frag&&t.frag&&Math.abs(i.frag.start-t.frag.start)>3*s.targetduration)return!0}return!1}class ei{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=S.log.bind(S,`${t}:`),this.warn=S.warn.bind(S,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t){const i=null==t?void 0:t.renditionReports;if(i){let r=-1;for(let n=0;n<i.length;n++){const a=i[n];let o;try{o=new self.URL(a.URI,t.url).href}catch(s){S.warn(`Could not construct new URL for Rendition Report: ${s}`),o=a.URI||""}if(o===e){r=n;break}o===e.substring(0,o.length)&&(r=n)}if(-1!==r){const e=i[r],s=parseInt(e["LAST-MSN"])||(null==t?void 0:t.lastPartSn);let n=parseInt(e["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);n>=0&&e>t.partTarget&&(n+=1)}return new Pt(s,n>=0?n:void 0,At)}}}loadPlaylist(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,i){const{details:s,stats:r}=t,n=self.performance.now(),a=r.loading.first?Math.max(0,n-r.loading.first):0;if(s.advancedDateTime=Date.now()-a,s.live||null!=i&&i.live){if(s.reloaded(i),i&&this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:"MISSED"}`),i&&s.fragments.length>0&&Mt(i,s),!this.canLoad||!s.live)return;let a,o,l;if(s.canBlockReload&&s.endSN&&s.advanced){const e=this.hls.config.lowLatencyMode,r=s.lastPartSn,n=s.endSN,c=s.lastPartIndex,d=r===n;-1!==c?(o=d?n+1:r,l=d?e?0:c:c+1):o=n+1;const h=s.age,u=h+s.ageHeader;let f=Math.min(u-s.partTarget,1.5*s.targetduration);if(f>0){if(i&&f>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${f} with playlist age: ${s.age}`),f=0;else{const e=Math.floor(f/s.targetduration);if(o+=e,void 0!==l){l+=Math.round(f%s.targetduration/s.partTarget)}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${h.toFixed(2)}s goal: ${f} skip sn ${e} to part ${l}`)}s.tuneInGoal=f}if(a=this.getDeliveryDirectives(s,t.deliveryDirectives,o,l),e||!d)return void this.loadPlaylist(a)}else s.canBlockReload&&(a=this.getDeliveryDirectives(s,t.deliveryDirectives,o,l));const c=this.hls.mainForwardBufferInfo,d=c?c.end-c.len:0,h=function(e,t=1/0){let i=1e3*e.targetduration;if(e.updated){const s=e.fragments,r=4;if(s.length&&i*r>t){const e=1e3*s[s.length-1].duration;e<i&&(i=e)}}else i/=2;return Math.round(i)}(s,1e3*(s.edge-d));s.updated&&n>this.requestScheduled+h&&(this.requestScheduled=r.loading.start),void 0!==o&&s.canBlockReload?this.requestScheduled=r.loading.first+h-(1e3*s.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+h<n?this.requestScheduled=n:this.requestScheduled-n<=0&&(this.requestScheduled+=h);let u=this.requestScheduled-n;u=Math.max(0,u),this.log(`reload live playlist ${e} in ${Math.round(u)} ms`),this.timer=self.setTimeout((()=>this.loadPlaylist(a)),u)}else this.clearTimer()}getDeliveryDirectives(e,t,i,s){let r=function(e,t){const{canSkipUntil:i,canSkipDateRanges:s,endSN:r}=e;return i&&(void 0!==t?t-r:0)<i?s?Ct:Rt:At}(e,i);return null!=t&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,s=t.part,r=At),new Pt(i,s,r)}checkRetry(e){const t=e.details,i=Nt(e),s=e.errorAction,{action:r,retryCount:n=0,retryConfig:a}=s||{},o=!!s&&!!a&&(r===zt||!s.resolved&&r===Yt);if(o){var l;if(this.requestScheduled=-1,n>=a.maxNumRetry)return!1;if(i&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${n+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const e=$t(a,n);this.timer=self.setTimeout((()=>this.loadPlaylist()),e),this.warn(`Retrying playlist loading ${n+1}/${a.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,s.resolved=!0}return o}}let ti;class ii extends ei{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(g.LEVEL_LOADED,this.onLevelLoaded,this),e.on(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(g.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(g.FRAG_LOADED,this.onFragLoaded,this),e.on(g.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(g.LEVEL_LOADED,this.onLevelLoaded,this),e.off(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(g.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(g.FRAG_LOADED,this.onFragLoaded,this),e.off(g.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach((e=>{e.loadError=0,e.fragmentError=0})),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=[],s={};let r;t.levels.forEach((e=>{var t;const n=e.attrs;-1!==(null==(t=e.audioCodec)?void 0:t.indexOf("mp4a.40.34"))&&(ti||(ti=/chrome|firefox/i.test(navigator.userAgent)),ti&&(e.audioCodec=void 0));const{AUDIO:a,CODECS:o,"FRAME-RATE":l,"PATHWAY-ID":c,RESOLUTION:d,SUBTITLES:h}=n,u=`${`${c||"."}-`}${e.bitrate}-${d}-${l}-${o}`;r=s[u],r?r.addFallback(e):(r=new kt(e),s[u]=r,i.push(r)),si(r,"audio",a),si(r,"text",h)})),this.filterAndSortMediaOptions(i,t)}filterAndSortMediaOptions(e,t){let i=[],s=[],r=!1,n=!1,a=!1,o=e.filter((({audioCodec:e,videoCodec:t,width:i,height:s,unknownCodecs:o})=>(r||(r=!(!i||!s)),n||(n=!!t),a||(a=!!e),!(null!=o&&o.length)&&(!e||Ve(e,"audio"))&&(!t||Ve(t,"video")))));if((r||n)&&a&&(o=o.filter((({videoCodec:e,width:t,height:i})=>!!e||!(!t||!i)))),0===o.length)return void Promise.resolve().then((()=>{if(this.hls){const e=new Error("no level with compatible codecs found in manifest");this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:e,reason:e.message})}}));t.audioTracks&&(i=t.audioTracks.filter((e=>!e.audioCodec||Ve(e.audioCodec,"audio"))),ri(i)),t.subtitles&&(s=t.subtitles,ri(s));const l=o.slice(0);o.sort(((e,t)=>e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"]?(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1:e.bitrate!==t.bitrate?e.bitrate-t.bitrate:e.attrs["FRAME-RATE"]!==t.attrs["FRAME-RATE"]?e.attrs.decimalFloatingPoint("FRAME-RATE")-t.attrs.decimalFloatingPoint("FRAME-RATE"):e.attrs.SCORE!==t.attrs.SCORE?e.attrs.decimalFloatingPoint("SCORE")-t.attrs.decimalFloatingPoint("SCORE"):r&&e.height!==t.height?e.height-t.height:0));let c=l[0];if(this.steering&&(o=this.steering.filterParsedLevels(o),o.length!==l.length))for(let u=0;u<l.length;u++)if(l[u].pathwayId===o[0].pathwayId){c=l[u];break}this._levels=o;for(let u=0;u<o.length;u++)if(o[u]===c){this._firstLevel=u,this.log(`manifest loaded, ${o.length} level(s) found, first bitrate: ${c.bitrate}`);break}const d=a&&!n,h={levels:o,audioTracks:i,subtitleTracks:s,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:a,video:n,altAudio:!d&&i.some((e=>!!e.url))};this.hls.trigger(g.MANIFEST_PARSED,h),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return 0===this._levels.length?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const i=new Error("invalid level idx"),s=e<0;if(this.hls.trigger(g.ERROR,{type:m.OTHER_ERROR,details:v.LEVEL_SWITCH_ERROR,level:e,fatal:s,error:i,reason:i.message}),s)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,s=this.currentLevel,r=s?s.attrs["PATHWAY-ID"]:void 0,n=t[e],a=n.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=n,i===e&&n.details&&s&&r===a)return;this.log(`Switching to level ${e}${a?" with Pathway "+a:""} from level ${i}${r?" with Pathway "+r:""}`);const o=f({},n,{level:e,maxBitrate:n.maxBitrate,attrs:n.attrs,uri:n.uri,urlId:n.urlId});delete o._attrs,delete o._urlId,this.hls.trigger(g.LEVEL_SWITCHING,o);const l=n.details;if(!l||l.live){const e=this.switchParams(n.uri,null==s?void 0:s.details);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){!t.fatal&&t.context&&t.context.type===rt&&t.context.level===this.level&&this.checkRetry(t)}onFragLoaded(e,{frag:t}){if(void 0!==t&&t.type===ot){const e=this._levels[t.level];void 0!==e&&(e.loadError=0)}}onLevelLoaded(e,t){var i;const{level:s,details:r}=t,n=this._levels[s];var a;if(!n)return this.warn(`Invalid level index ${s}`),void(null!=(a=t.deliveryDirectives)&&a.skip&&(r.deltaUpdateFailed=!0));s===this.currentLevelIndex?(0===n.fragmentError&&(n.loadError=0),this.playlistLoaded(s,t,n.details)):null!=(i=t.deliveryDirectives)&&i.skip&&(r.deltaUpdateFailed=!0)}onAudioTrackSwitched(e,t){const i=this.currentLevel;if(!i)return;const s=this.hls.audioTracks[t.id].groupId;if(i.audioGroupIds&&i.audioGroupId!==s){let e=-1;for(let t=0;t<i.audioGroupIds.length;t++)if(i.audioGroupIds[t]===s){e=t;break}-1!==e&&e!==i.urlId&&(i.urlId=e,this.canLoad&&this.startLoad())}}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){const r=i.urlId;let n=i.uri;if(e)try{n=e.addDirectives(n)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}const a=i.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:""} with${a?" Pathway "+a:""} URI ${r+1}/${i.url.length} ${n}`),this.clearTimer(),this.hls.trigger(g.LEVEL_LOADING,{url:n,level:t,id:r,deliveryDirectives:e||null})}}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e,t){const i=(e,i)=>i!==t,s=this._levels.filter(((s,r)=>r!==e||(s.url.length>1&&void 0!==t?(s.url=s.url.filter(i),s.audioGroupIds&&(s.audioGroupIds=s.audioGroupIds.filter(i)),s.textGroupIds&&(s.textGroupIds=s.textGroupIds.filter(i)),s.urlId=0,!0):(this.steering&&this.steering.removeLevel(s),!1))));this.hls.trigger(g.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){t.forEach(((e,t)=>{const{details:i}=e;null!=i&&i.fragments&&i.fragments.forEach((e=>{e.level=t}))})),this._levels=t}}function si(e,t,i){i&&("audio"===t?(e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds[e.url.length-1]=i):"text"===t&&(e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds[e.url.length-1]=i))}function ri(e){const t={};e.forEach((e=>{const i=e.groupId||"";e.id=t[i]=t[i]||0,t[i]++}))}var ni="NOT_LOADED",ai="APPENDING",oi="PARTIAL",li="OK";class ci{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(g.BUFFER_APPENDED,this.onBufferAppended,this),e.on(g.FRAG_BUFFERED,this.onFragBuffered,this),e.on(g.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(g.BUFFER_APPENDED,this.onBufferAppended,this),e.off(g.FRAG_BUFFERED,this.onFragBuffered,this),e.off(g.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let s=i.length;s--;){const t=i[s];if(!t)break;const r=t.end;if(t.start<=e&&null!==r&&e<=r)return t}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:i}=this,s=Object.keys(i);for(let r=s.length;r--;){const n=i[s[r]];if((null==n?void 0:n.body.type)===t&&n.buffered){const t=n.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,i,s){this.timeRanges&&(this.timeRanges[e]=t);const r=(null==s?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach((s=>{const n=this.fragments[s];if(!n)return;if(r>=n.body.sn)return;if(!n.buffered&&!n.loaded)return void(n.body.type===i&&this.removeFragment(n.body));const a=n.range[e];a&&a.time.some((e=>{const i=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return i&&this.removeFragment(n.body),i}))}))}detectPartialFragments(e){const t=this.timeRanges,{frag:i,part:s}=e;if(!t||"initSegment"===i.sn)return;const r=hi(i),n=this.fragments[r];if(!n||n.buffered&&i.gap)return;const a=!i.relurl;Object.keys(t).forEach((e=>{const r=i.elementaryStreams[e];if(!r)return;const o=t[e],l=a||!0===r.partial;n.range[e]=this.getBufferedTimes(i,s,l,o)})),n.loaded=null,Object.keys(n.range).length?(n.buffered=!0,n.body.endList&&(this.endListFragments[n.body.type]=n),di(n)||this.removeParts(i.sn-1,i.type)):this.removeFragment(n.body)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=i.filter((t=>t.fragment.sn>=e)))}fragBuffered(e,t){const i=hi(e);let s=this.fragments[i];!s&&t&&(s=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(e,t,i,s){const r={time:[],partial:i},n=e.start,a=e.end,o=e.minEndPTS||a,l=e.maxStartPTS||n;for(let c=0;c<s.length;c++){const e=s.start(c)-this.bufferPadding,t=s.end(c)+this.bufferPadding;if(l>=e&&o<=t){r.time.push({startPTS:Math.max(n,s.start(c)),endPTS:Math.min(a,s.end(c))});break}if(n<t&&a>e)r.partial=!0,r.time.push({startPTS:Math.max(n,s.start(c)),endPTS:Math.min(a,s.end(c))});else if(a<=e)break}return r}getPartialFragment(e){let t,i,s,r=null,n=0;const{bufferPadding:a,fragments:o}=this;return Object.keys(o).forEach((l=>{const c=o[l];c&&di(c)&&(i=c.body.start-a,s=c.body.end+a,e>=i&&e<=s&&(t=Math.min(e-i,s-e),n<=t&&(r=c.body,n=t)))})),r}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||di(t))}getState(e){const t=hi(e),i=this.fragments[t];return i?i.buffered?di(i)?oi:li:ai:ni}isTimeBuffered(e,t,i){let s,r;for(let n=0;n<i.length;n++){if(s=i.start(n)-this.bufferPadding,r=i.end(n)+this.bufferPadding,e>=s&&t<=r)return!0;if(t<=s)return!1}return!1}onFragLoaded(e,t){const{frag:i,part:s}=t;if("initSegment"===i.sn||i.bitrateTest)return;const r=s?null:t,n=hi(i);this.fragments[n]={body:i,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:s,timeRanges:r}=t;if("initSegment"===i.sn)return;const n=i.type;if(s){let e=this.activePartLists[n];e||(this.activePartLists[n]=e=[]),e.push(s)}this.timeRanges=r,Object.keys(r).forEach((e=>{const t=r[e];this.detectEvictedFragments(e,t,n,s)}))}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=hi(e);return!!this.fragments[t]}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,i,s,r){s&&!this.hasGaps||Object.keys(this.fragments).forEach((n=>{const a=this.fragments[n];if(!a)return;const o=a.body;o.type!==i||s&&!o.gap||o.start<t&&o.end>e&&(a.buffered||r)&&this.removeFragment(o)}))}removeFragment(e){const t=hi(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const t=e.sn;this.activePartLists[e.type]=i.filter((e=>e.fragment.sn!==t))}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function di(e){var t,i,s;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(i=e.range.audio)?void 0:i.partial)||(null==(s=e.range.audiovideo)?void 0:s.partial))}function hi(e){return`${e.type}_${e.level}_${e.urlId}_${e.sn}`}const ui=Math.pow(2,17);class fi{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new mi({type:m.NETWORK_ERROR,details:v.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(i?"part list":"url")),networkDetails:null}));this.abort();const s=this.config,r=s.fLoader,n=s.loader;return new Promise(((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some((e=>"GAP"===e[0])))return void o(gi(e));e.gap=!1}const l=this.loader=e.loader=r?new r(s):new n(s),c=pi(e),d=Gt(s.fragLoadPolicy.default),u={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:ui};e.stats=l.stats,l.load(c,u,{onSuccess:(t,i,s,r)=>{this.resetLoader(e,l);let n=t.data;s.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(n.slice(0,16)),n=n.slice(16)),a({frag:e,part:null,payload:n,networkDetails:r})},onError:(t,s,r,n)=>{this.resetLoader(e,l),o(new mi({type:m.NETWORK_ERROR,details:v.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:h({url:i,data:void 0},t),error:new Error(`HTTP Error ${t.code} ${t.text}`),networkDetails:r,stats:n}))},onAbort:(t,i,s)=>{this.resetLoader(e,l),o(new mi({type:m.NETWORK_ERROR,details:v.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:s,stats:t}))},onTimeout:(t,i,s)=>{this.resetLoader(e,l),o(new mi({type:m.NETWORK_ERROR,details:v.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${u.timeout}ms`),networkDetails:s,stats:t}))},onProgress:(i,s,r,n)=>{t&&t({frag:e,part:null,payload:r,networkDetails:n})}})}))}loadPart(e,t,i){this.abort();const s=this.config,r=s.fLoader,n=s.loader;return new Promise(((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void o(gi(e,t));const l=this.loader=e.loader=r?new r(s):new n(s),c=pi(e,t),d=Gt(s.fragLoadPolicy.default),u={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:ui};t.stats=l.stats,l.load(c,u,{onSuccess:(s,r,n,o)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const c={frag:e,part:t,payload:s.data,networkDetails:o};i(c),a(c)},onError:(i,s,r,n)=>{this.resetLoader(e,l),o(new mi({type:m.NETWORK_ERROR,details:v.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:h({url:c.url,data:void 0},i),error:new Error(`HTTP Error ${i.code} ${i.text}`),networkDetails:r,stats:n}))},onAbort:(i,s,r)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new mi({type:m.NETWORK_ERROR,details:v.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:r,stats:i}))},onTimeout:(i,s,r)=>{this.resetLoader(e,l),o(new mi({type:m.NETWORK_ERROR,details:v.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${u.timeout}ms`),networkDetails:r,stats:i}))}})}))}updateStatsFromPart(e,t){const i=e.stats,s=t.stats,r=s.total;if(i.loaded+=s.loaded,r){const s=Math.round(e.duration/t.duration),n=Math.min(Math.round(i.loaded/r),s),a=(s-n)*Math.round(i.loaded/n);i.total=i.loaded+a}else i.total=Math.max(i.loaded,i.total);const n=i.loading,a=s.loading;n.start?n.first+=a.first-a.start:(n.start=a.start,n.first=a.first),n.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function pi(e,t=null){const i=t||e,s={frag:e,part:t,responseType:"arraybuffer",url:i.url,headers:{},rangeStart:0,rangeEnd:0},r=i.byteRangeStartOffset,n=i.byteRangeEndOffset;if(p(r)&&p(n)){var a;let t=r,i=n;if("initSegment"===e.sn&&"AES-128"===(null==(a=e.decryptdata)?void 0:a.method)){const e=n-r;e%16&&(i=n+(16-e%16)),0!==r&&(s.resetIV=!0,t=r-16)}s.rangeStart=t,s.rangeEnd=i}return s}function gi(e,t){const i=new Error(`GAP ${e.gap?"tag":"attribute"} found`),s={type:m.MEDIA_ERROR,details:v.FRAG_GAP,fatal:!1,frag:e,error:i,networkDetails:null};return t&&(s.part=t),(t||e).stats.aborted=!0,new mi(s)}class mi extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class vi{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const t in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[t].loader;if(i){if(e&&e!==i.context.frag.type)return;i.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=v.KEY_LOAD_ERROR,i,s,r){return new mi({type:m.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:i,networkDetails:s})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:i,cc:s}=e;for(let e=0;e<t.length;e++){const r=t[e];if(s<=r.cc&&("initSegment"===i||"initSegment"===r.sn||i<r.sn)){this.emeController.selectKeySystemFormat(r).then((e=>{r.setKeyFormat(e)}));break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then((t=>this.loadInternal(e,t))):this.loadInternal(e)}loadInternal(e,t){var i,s;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const i=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,v.KEY_LOAD_ERROR,i))}const n=r.uri;if(!n)return Promise.reject(this.createKeyLoadError(e,v.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${n}"`)));let a=this.keyUriToKeyInfo[n];if(null!=(i=a)&&i.decryptdata.key)return r.key=a.decryptdata.key,Promise.resolve({frag:e,keyInfo:a});var o;if(null!=(s=a)&&s.keyLoadPromise)switch(null==(o=a.mediaKeySessionContext)?void 0:o.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then((t=>(r.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:a})))}switch(a=this.keyUriToKeyInfo[n]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===r.keyFormat?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,v.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const t=this.emeController.loadKey(i);if(t)return(e.keyLoadPromise=t.then((t=>(e.mediaKeySessionContext=t,i)))).catch((t=>{throw e.keyLoadPromise=null,t}))}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,s=new(0,i.loader)(i);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise(((r,n)=>{const a={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},o=i.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,i,s)=>{const{frag:a,keyInfo:o,url:l}=i;if(!a.decryptdata||o!==this.keyUriToKeyInfo[l])return n(this.createKeyLoadError(a,v.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),s));o.decryptdata.key=a.decryptdata.key=new Uint8Array(e.data),a.keyLoader=null,o.loader=null,r({frag:a,keyInfo:o})},onError:(e,i,s,r)=>{this.resetLoader(i),n(this.createKeyLoadError(t,v.KEY_LOAD_ERROR,new Error(`HTTP Error ${e.code} loading key ${e.text}`),s,h({url:a.url,data:void 0},e)))},onTimeout:(e,i,s)=>{this.resetLoader(i),n(this.createKeyLoadError(t,v.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),s))},onAbort:(e,i,s)=>{this.resetLoader(i),n(this.createKeyLoadError(t,v.INTERNAL_ABORTED,new Error("key loading aborted"),s))}};s.load(a,l,c)}))}resetLoader(e){const{frag:t,keyInfo:i,url:s}=e,r=i.loader;t.keyLoader===r&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[s],r&&r.destroy()}}class yi{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}const Ti={length:0,start:()=>0,end:()=>0};class Ei{static isBuffered(e,t){try{if(e){const i=Ei.getBuffered(e);for(let e=0;e<i.length;e++)if(t>=i.start(e)&&t<=i.end(e))return!0}}catch(i){}return!1}static bufferInfo(e,t,i){try{if(e){const s=Ei.getBuffered(e),r=[];let n;for(n=0;n<s.length;n++)r.push({start:s.start(n),end:s.end(n)});return this.bufferedInfo(r,t,i)}}catch(s){}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.sort((function(e,t){const i=e.start-t.start;return i||t.end-e.end}));let s=[];if(i)for(let l=0;l<e.length;l++){const t=s.length;if(t){const r=s[t-1].end;e[l].start-r<i?e[l].end>r&&(s[t-1].end=e[l].end):s.push(e[l])}else s.push(e[l])}else s=e;let r,n=0,a=t,o=t;for(let l=0;l<s.length;l++){const e=s[l].start,c=s[l].end;if(t+i>=e&&t<c)a=e,o=c,n=o-t;else if(t+i<e){r=e;break}}return{len:n,start:a||0,end:o||0,nextStart:r}}static getBuffered(e){try{return e.buffered}catch(t){return S.log("failed to get media.buffered",t),Ti}}}class bi{constructor(e,t,i,s=0,r=-1,n=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=i,this.size=s,this.part=r,this.partial=n}}function Si(e,t){let i=null;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(r&&r.cc===t){i=r;break}}return i}function Li(e,t){if(e){const i=e.start+t;e.start=e.startPTS=i,e.endPTS=i+e.duration}}function _i(e,t){const i=t.fragments;for(let s=0,r=i.length;s<r;s++)Li(i[s],e);t.fragmentHint&&Li(t.fragmentHint,e),t.alignedSliding=!0}function wi(e,t,i){t&&(!function(e,t,i){if(function(e,t,i){return!(!t.details||!(i.endCC>i.startCC||e&&e.cc<i.startCC))}(e,i,t)){const e=function(e,t,i=0){const s=e.fragments,r=t.fragments;if(!r.length||!s.length)return void S.log("No fragments to align");const n=Si(s,r[0].cc);if(n&&(!n||n.startPTS))return n;S.log("No frag in previous level to align on")}(i.details,t);e&&p(e.start)&&(S.log(`Adjusting PTS using last level due to CC increase within current level ${t.url}`),_i(e.start,t))}}(e,i,t),!i.alignedSliding&&t.details&&function(e,t){if(!t.fragments.length||!e.hasProgramDateTime||!t.hasProgramDateTime)return;const i=t.fragments[0].programDateTime,s=e.fragments[0].programDateTime,r=(s-i)/1e3+t.fragments[0].start;r&&p(r)&&(S.log(`Adjusting PTS using programDateTime delta ${s-i}ms, sliding:${r.toFixed(3)} ${e.url} `),_i(r,e))}(i,t.details),i.alignedSliding||!t.details||i.skippedSegments||Ot(t.details,i))}function Ai(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const i=e.fragments,s=t.fragments;if(!i.length||!s.length)return;const r=s[Math.round(s.length/2)-1],n=Si(i,r.cc)||i[Math.round(i.length/2)-1],a=r.programDateTime,o=n.programDateTime;if(null===a||null===o)return;_i((o-a)/1e3-(n.start-r.start),e)}class Ri{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class Ci{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}class Pi{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let s=0;s<4;s++)i[s]=t.getUint32(4*s);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,s=i[0],r=i[1],n=i[2],a=i[3],o=this.invSubMix,l=o[0],c=o[1],d=o[2],h=o[3],u=new Uint32Array(256);let f=0,p=0,g=0;for(g=0;g<256;g++)u[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){let i=p^p<<1^p<<2^p<<3^p<<4;i=i>>>8^255&i^99,e[f]=i,t[i]=f;const o=u[f],g=u[o],m=u[g];let v=257*u[i]^16843008*i;s[f]=v<<24|v>>>8,r[f]=v<<16|v>>>16,n[f]=v<<8|v>>>24,a[f]=v,v=16843009*m^65537*g^257*o^16843008*f,l[i]=v<<24|v>>>8,c[i]=v<<16|v>>>16,d[i]=v<<8|v>>>24,h[i]=v,f?(f=o^u[u[u[m^o]]],p^=u[u[p]]):f=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,s=0;for(;s<t.length&&i;)i=t[s]===this.key[s],s++;if(i)return;this.key=t;const r=this.keySize=t.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);const n=this.ksRows=4*(r+6+1);let a,o;const l=this.keySchedule=new Uint32Array(n),c=this.invKeySchedule=new Uint32Array(n),d=this.sBox,h=this.rcon,u=this.invSubMix,f=u[0],p=u[1],g=u[2],m=u[3];let v,y;for(a=0;a<n;a++)a<r?v=l[a]=t[a]:(y=v,a%r==0?(y=y<<8|y>>>24,y=d[y>>>24]<<24|d[y>>>16&255]<<16|d[y>>>8&255]<<8|d[255&y],y^=h[a/r|0]<<24):r>6&&a%r==4&&(y=d[y>>>24]<<24|d[y>>>16&255]<<16|d[y>>>8&255]<<8|d[255&y]),l[a]=v=(l[a-r]^y)>>>0);for(o=0;o<n;o++)a=n-o,y=3&o?l[a]:l[a-4],c[o]=o<4||a<=4?y:f[d[y>>>24]]^p[d[y>>>16&255]]^g[d[y>>>8&255]]^m[d[255&y]],c[o]=c[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,i){const s=this.keySize+6,r=this.invKeySchedule,n=this.invSBox,a=this.invSubMix,o=a[0],l=a[1],c=a[2],d=a[3],h=this.uint8ArrayToUint32Array_(i);let u=h[0],f=h[1],p=h[2],g=h[3];const m=new Int32Array(e),v=new Int32Array(m.length);let y,T,E,b,S,L,_,w,A,R,C,P,k,D;const I=this.networkToHostOrderSwap;for(;t<m.length;){for(A=I(m[t]),R=I(m[t+1]),C=I(m[t+2]),P=I(m[t+3]),S=A^r[0],L=P^r[1],_=C^r[2],w=R^r[3],k=4,D=1;D<s;D++)y=o[S>>>24]^l[L>>16&255]^c[_>>8&255]^d[255&w]^r[k],T=o[L>>>24]^l[_>>16&255]^c[w>>8&255]^d[255&S]^r[k+1],E=o[_>>>24]^l[w>>16&255]^c[S>>8&255]^d[255&L]^r[k+2],b=o[w>>>24]^l[S>>16&255]^c[L>>8&255]^d[255&_]^r[k+3],S=y,L=T,_=E,w=b,k+=4;y=n[S>>>24]<<24^n[L>>16&255]<<16^n[_>>8&255]<<8^n[255&w]^r[k],T=n[L>>>24]<<24^n[_>>16&255]<<16^n[w>>8&255]<<8^n[255&S]^r[k+1],E=n[_>>>24]<<24^n[w>>16&255]<<16^n[S>>8&255]<<8^n[255&L]^r[k+2],b=n[w>>>24]<<24^n[S>>16&255]<<16^n[L>>8&255]<<8^n[255&_]^r[k+3],v[t]=I(y^u),v[t+1]=I(b^f),v[t+2]=I(E^p),v[t+3]=I(T^g),u=A,f=R,p=C,g=P,t+=4}return v.buffer}}class ki{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(i){}null===this.subtle&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,i=t&&new DataView(e.buffer).getUint8(t-1);return i?z(e,0,t-i):e}(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i){return this.useSoftware?new Promise(((s,r)=>{this.softwareDecrypt(new Uint8Array(e),t,i);const n=this.flush();n?s(n.buffer):r(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,i)}softwareDecrypt(e,t,i){const{currentIV:s,currentResult:r,remainderData:n}=this;this.logOnce("JS AES decrypt"),n&&(e=Ae(n,e),this.remainderData=null);const a=this.getValidChunk(e);if(!a.length)return null;s&&(i=s);let o=this.softwareDecrypter;o||(o=this.softwareDecrypter=new Pi),o.expandKey(t);const l=r;return this.currentResult=o.decrypt(a.buffer,0,i),this.currentIV=z(a,-16).buffer,l||null}webCryptoDecrypt(e,t,i){const s=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new Ci(s,t)),this.fastAesKey.expandKey().then((t=>{if(!s)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new Ri(s,new Uint8Array(i)).decrypt(e.buffer,t)})).catch((s=>(S.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,i))))}onWebCryptoError(e,t,i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i);const s=this.flush();if(s)return s.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%16;return i!==e.length&&(t=z(e,0,i),this.remainderData=z(e,i)),t}logOnce(e){this.logEnabled&&(S.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Di=function(e){let t="";const i=e.length;for(let s=0;s<i;s++)t+=`[${e.start(s).toFixed(3)}-${e.end(s).toFixed(3)}]`;return t},Ii="STOPPED",Mi="IDLE",Oi="KEY_LOADING",xi="FRAG_LOADING",Fi="FRAG_LOADING_WAITING_RETRY",Bi="WAITING_TRACK",Ni="PARSING",Ui="PARSED",$i="ENDED",Gi="ERROR",Hi="WAITING_INIT_PTS",Vi="WAITING_LEVEL";class Ki extends yi{constructor(e,t,i,s,r){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Ii,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=r,this.logPrefix=s,this.log=S.log.bind(S,`${s}:`),this.warn=S.warn.bind(S,`${s}:`),this.hls=e,this.fragmentLoader=new fi(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new ki(e.config),e.on(g.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Ii}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const i=t.partList;if(null!=i&&i.length){const e=i[i.length-1];return Ei.isBuffered(this.media,e.start+e.duration/2)}const s=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(s)}getLevelDetails(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levels[this.levelLastLoaded])?void 0:e.details}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);const s=this.config;this.levels&&s.autoStartLoad&&this.state===Ii&&this.startLoad(s.startPosition)}onMediaDetaching(){const e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:i,mediaBuffer:s,state:r}=this,n=i?i.currentTime:0,a=Ei.bufferInfo(s||i,n,e.maxBufferHole);if(this.log(`media seeking to ${p(n)?n.toFixed(3):n}, state: ${r}`),this.state===$i)this.resetLoadingState();else if(t){const i=e.maxFragLookUpTolerance,s=t.start-i,r=t.start+t.duration+i;if(!a.len||r<a.start||s>a.end){const e=n>r;(n<s||e)&&(e&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}i&&(this.fragmentTracker.removeFragmentsInRange(n,1/0,this.playlistType,!0),this.lastCurrentTime=n),this.loadedmetadata||a.len||(this.nextLoadPosition=this.startPosition=n),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state=Ii,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){this._doFragLoad(e,t,i,(t=>{if(this.fragContextChanged(e))return this.warn(`Fragment ${e.sn}${t.part?" p: "+t.part.index:""} of level ${e.level} was dropped during download.`),void this.fragmentTracker.removeFragment(e);e.stats.chunkCount++,this._handleFragmentLoadProgress(t)})).then((t=>{if(!t)return;const i=this.state;this.fragContextChanged(e)?(i===xi||!this.fragCurrent&&i===Ni)&&(this.fragmentTracker.removeFragment(e),this.state=Mi):("payload"in t&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(g.FRAG_LOADED,t)),this._handleFragmentLoadComplete(t))})).catch((t=>{this.state!==Ii&&this.state!==Gi&&(this.warn(t),this.resetFragmentLoading(e))}))}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===ai){const t=e.type,s=this.getFwdBufferInfo(this.mediaBuffer,t),r=Math.max(e.duration,s?s.len:this.config.maxBufferLength);this.reduceMaxBufferLength(r)&&i.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===oi&&i.removeFragment(e))}flushMainBuffer(e,t,i=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:i};this.hls.trigger(g.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then((t=>{if(!t||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return t})).then((t=>{const{hls:i}=this,{payload:s}=t,r=e.decryptdata;if(s&&s.byteLength>0&&r&&r.key&&r.iv&&"AES-128"===r.method){const n=self.performance.now();return this.decrypter.decrypt(new Uint8Array(s),r.key.buffer,r.iv.buffer).catch((t=>{throw i.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t})).then((s=>{const r=self.performance.now();return i.trigger(g.FRAG_DECRYPTED,{frag:e,payload:s,stats:{tstart:n,tdecrypt:r}}),t.payload=s,t}))}return t})).then((i=>{const{fragCurrent:s,hls:r,levels:n}=this;if(!n)throw new Error("init load aborted, missing levels");const a=e.stats;this.state=Mi,t.fragmentError=0,e.data=new Uint8Array(i.payload),a.parsing.start=a.buffering.start=self.performance.now(),a.parsing.end=a.buffering.end=self.performance.now(),i.frag===s&&r.trigger(g.FRAG_BUFFERED,{stats:a,frag:s,part:null,id:e.type}),this.tick()})).catch((t=>{this.state!==Ii&&this.state!==Gi&&(this.warn(t),this.resetFragmentLoading(e))}))}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId}fragBufferedComplete(e,t){var i,s,r,n;const a=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===ot?"level":"track"} ${e.level} (frag:[${(null!=(i=e.startPTS)?i:NaN).toFixed(3)}-${(null!=(s=e.endPTS)?s:NaN).toFixed(3)}] > buffer:${a?Di(Ei.getBuffered(a)):"(detached)"})`),this.state=Mi,a&&(!this.loadedmetadata&&e.type==ot&&a.buffered.length&&(null==(r=this.fragCurrent)?void 0:r.sn)===(null==(n=this.fragPrevious)?void 0:n.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:s,partsLoaded:r}=e,n=!r||0===r.length||r.some((e=>!e)),a=new bi(i.level,i.sn,i.stats.chunkCount+1,0,s?s.index:-1,!n);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,s){var r;const n=null==t?void 0:t.details;if(!this.levels||!n)throw new Error(`frag load aborted, missing level${n?"":" detail"}s`);let a=null;if(!e.encrypted||null!=(r=e.decryptdata)&&r.key?!e.encrypted&&n.encryptedFragments.length&&this.keyLoader.loadClear(e,n.encryptedFragments):(this.log(`Loading key for ${e.sn} of [${n.startSN}-${n.endSN}], ${"[stream-controller]"===this.logPrefix?"level":"track"} ${e.level}`),this.state=Oi,this.fragCurrent=e,a=this.keyLoader.load(e).then((e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(g.KEY_LOADED,e),this.state===Oi&&(this.state=Mi),e})),this.hls.trigger(g.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),i=Math.max(e.start,i||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){const r=n.partList;if(r&&s){i>e.end&&n.fragmentHint&&(e=n.fragmentHint);const o=this.getNextPart(r,e,i);if(o>-1){const l=r[o];let c;return this.log(`Loading part sn: ${e.sn} p: ${l.index} cc: ${e.cc} of playlist [${n.startSN}-${n.endSN}] parts [0-${o}-${r.length-1}] ${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=l.start+l.duration,this.state=xi,c=a?a.then((i=>!i||this.fragContextChanged(i.frag)?null:this.doFragPartsLoad(e,l,t,s))).catch((e=>this.handleFragLoadError(e))):this.doFragPartsLoad(e,l,t,s).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(g.FRAG_LOADING,{frag:e,part:l,targetBufferTime:i}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):c}if(!e.url||this.loadedEndOfParts(r,i))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${n?"of ["+n.startSN+"-"+n.endSN+"] ":""}${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(i.toFixed(3))}`),p(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=xi;const o=this.config.progressive;let l;return l=o&&a?a.then((t=>!t||this.fragContextChanged(null==t?void 0:t.frag)?null:this.fragmentLoader.load(e,s))).catch((e=>this.handleFragLoadError(e))):Promise.all([this.fragmentLoader.load(e,o?s:void 0),a]).then((([e])=>(!o&&e&&s&&s(e),e))).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(g.FRAG_LOADING,{frag:e,targetBufferTime:i}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):l}doFragPartsLoad(e,t,i,s){return new Promise(((r,n)=>{var a;const o=[],l=null==(a=i.details)?void 0:a.partList,c=t=>{this.fragmentLoader.loadPart(e,t,s).then((s=>{o[t.index]=s;const n=s.part;this.hls.trigger(g.FRAG_LOADED,s);const a=Ft(i,e.sn,t.index+1)||Bt(l,e.sn,t.index+1);if(!a)return r({frag:e,part:n,partsLoaded:o});c(a)})).catch(n)};c(t)}))}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===v.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(g.ERROR,t)}else this.hls.trigger(g.ERROR,{type:m.OTHER_ERROR,details:v.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==Ni)return void(this.fragCurrent||this.state===Ii||this.state===Gi||(this.state=Mi));const{frag:i,part:s,level:r}=t,n=self.performance.now();i.stats.parsing.end=n,s&&(s.stats.parsing.end=n),this.updateLevelTiming(i,s,r,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:s,sn:r,part:n}=e;if(null==t||!t[s])return this.warn(`Levels object was unset while buffering fragment ${r} of level ${s}. The current chunk will not be buffered.`),null;const a=t[s],o=n>-1?Ft(a,r,n):null,l=o?o.fragment:function(e,t,i){if(null==e||!e.details)return null;const s=e.details;let r=s.fragments[t-s.startSN];return r||(r=s.fragmentHint,r&&r.sn===t?r:t<s.startSN&&i&&i.sn===t?i:null)}(a,r,i);return l?(i&&i!==l&&(l.stats=i.stats),{frag:l,part:o,level:a}):null}bufferFragmentData(e,t,i,s,r){var n;if(!e||this.state!==Ni)return;const{data1:a,data2:o}=e;let l=a;if(a&&o&&(l=Ae(a,o)),null==(n=l)||!n.length)return;const c={type:e.type,frag:t,part:i,chunkMeta:s,parent:t.type,data:l};if(this.hls.trigger(g.BUFFER_APPENDING,c),e.dropped&&e.independent&&!i){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Ei.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const i=t.currentTime,s=Ei.bufferInfo(t,i,0),r=e.duration,n=Math.min(2*this.config.maxFragLookUpTolerance,.25*r),a=Math.max(Math.min(e.start-n,s.end-n),i+n);e.start-a>n&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){const i=this.getLoadPosition();return p(i)?this.getFwdBufferInfoAtPos(e,i,t):null}getFwdBufferInfoAtPos(e,t,i){const{config:{maxBufferHole:s}}=this,r=Ei.bufferInfo(e,t,s);if(0===r.len&&void 0!==r.nextStart){const n=this.fragmentTracker.getBufferedFrag(t,i);if(n&&r.nextStart<n.end)return Ei.bufferInfo(e,t,Math.max(r.nextStart,s))}return r}getMaxBufferLength(e){const{config:t}=this;let i;return i=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e){const t=this.config,i=e||t.maxBufferLength;return t.maxMaxBufferLength>=i&&(t.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${t.maxMaxBufferLength}s`),!0)}getAppendedFrag(e,t=ot){const i=this.fragmentTracker.getAppendedFrag(e,ot);return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const i=t.fragments,s=i.length;if(!s)return null;const{config:r}=this,n=i[0].start;let a;if(t.live){const n=r.initialLiveManifestSize;if(s<n)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${n})`),null;t.PTSKnown||this.startFragRequested||-1!==this.startPosition||(a=this.getInitialLiveFragment(t,i),this.startPosition=a?this.hls.liveSyncPosition||a.start:e)}else e<=n&&(a=i[0]);if(!a){const i=r.lowLatencyMode?t.partEnd:t.fragmentEnd;a=this.getFragmentAtPosition(e,i,t)}return this.mapToInitFragWhenRequired(a)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===li||i===oi&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,s,r){const n=e.gap,a=this.getNextFragment(this.nextLoadPosition,t);if(null===a)return a;if(e=a,n&&e&&!e.gap&&i.nextStart){const t=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,s);if(null!==t&&i.len+t.len>=r)return this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,i){let s=-1,r=!1,n=!0;for(let a=0,o=e.length;a<o;a++){const o=e[a];if(n=n&&!o.independent,s>-1&&i<o.start)break;const l=o.loaded;l?s=-1:(r||o.independent||n)&&o.fragment===t&&(s=a),r=l}return s}loadedEndOfParts(e,t){const i=e[e.length-1];return i&&t>i.start&&i.loaded}getInitialLiveFragment(e,t){const i=this.fragPrevious;let s=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),s=function(e,t,i){if(null===t||!Array.isArray(e)||!e.length||!p(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;i=i||0;for(let s=0;s<e.length;++s){const r=e[s];if(jt(t,i,r))return r}return null}(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const r=i.sn+1;if(r>=e.startSN&&r<=e.endSN){const n=t[r-e.startSN];i.cc===n.cc&&(s=n,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=function(e,t){return Vt.search(e,(e=>e.cc<t?1:e.cc>t?-1:0))}(t,i.cc),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const t=this.hls.liveSyncPosition;null!==t&&(s=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,i){const{config:s}=this;let{fragPrevious:r}=this,{fragments:n,endSN:a}=i;const{fragmentHint:o}=i,l=s.maxFragLookUpTolerance,c=i.partList,d=!!(s.lowLatencyMode&&null!=c&&c.length&&o);let h;if(d&&o&&!this.bitrateTest&&(n=n.concat(o),a=o.sn),e<t){h=Kt(r,n,e,e>t-l?0:l)}else h=n[n.length-1];if(h){const e=h.sn-i.startSN,t=this.fragmentTracker.getState(h);if((t===li||t===oi&&h.gap)&&(r=h),r&&h.sn===r.sn&&(!d||c[0].fragment.sn>h.sn)){if(r&&h.level===r.level){const t=n[e+1];h=h.sn<a&&this.fragmentTracker.getState(t)!==li?t:null}}}return h}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const s=this.hls.liveSyncPosition,r=i.currentTime,n=e.fragments[0].start,a=e.edge,o=r>=n-t.maxFragLookUpTolerance&&r<=a;if(null!==s&&i.duration>s&&(r<s||!o)){const n=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&i.readyState<4||r<a-n)&&(this.loadedmetadata||(this.nextLoadPosition=s),i.readyState&&(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${s.toFixed(3)}`),i.currentTime=s))}}alignPlaylists(e,t){const{levels:i,levelLastLoaded:s,fragPrevious:r}=this,n=null!==s?i[s]:null,a=e.fragments.length;if(!a)return this.warn("No fragments in live playlist"),0;const o=e.fragments[0].start,l=!t,c=e.alignedSliding&&p(o);if(l||!c&&!o){wi(r,n,e);const i=e.fragments[0].start;return this.log(`Live playlist sliding: ${i.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${r?r.sn:"na"} fragments: ${a}`),i}return o}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let i=this.startPosition;if(i<t&&(i=-1),-1===i||-1===this.lastCurrentTime){const s=null!==this.startTimeOffset,r=s?this.startTimeOffset:e.startTimeOffset;null!==r&&p(r)?(i=t+r,r<0&&(i+=e.totalduration),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Start time offset ${r} found in ${s?"multivariant":"media"} playlist, adjust startPosition to ${i}`),this.startPosition=i):e.live?i=this.hls.liveSyncPosition||t:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===Fi)||(this.state=Mi)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;var s;if(this.fragContextChanged(i))return void this.warn(`Frag load error must match current frag to retry ${i.url} > ${null==(s=this.fragCurrent)?void 0:s.url}`);const r=t.details===v.FRAG_GAP;r&&this.fragmentTracker.fragBuffered(i,!0);const n=t.errorAction,{action:a,retryCount:o=0,retryConfig:l}=n||{};if(n&&a===zt&&l){var c;this.resetStartWhenNotLoaded(null!=(c=this.levelLastLoaded)?c:i.level);const s=$t(l,o);this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${o+1}/${l.maxNumRetry} in ${s}ms`),n.resolved=!0,this.retryDate=self.performance.now()+s,this.state=Fi}else l&&n?(this.resetFragmentErrors(e),o<l.maxNumRetry?r||(n.resolved=!0):S.warn(`${t.details} reached or exceeded max retry (${o})`)):(null==n?void 0:n.action)===Yt?this.state=Vi:this.state=Gi;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===Ni||this.state===Ui){const t=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,t),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len);const r=!s;return r&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),r}return!1}resetFragmentErrors(e){e===lt&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==Ii&&(this.state=Mi)}afterBufferFlushed(e,t,i){if(!e)return;const s=Ei.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,i),this.state===$i&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Mi}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=this.levels?this.levels[e].details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){var t;this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(null!=(t=this.levelLastLoaded)?t:e.level),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,s){var r;const n=i.details;if(!n)return void this.warn("level.details undefined");if(Object.keys(e.elementaryStreams).reduce(((t,r)=>{const a=e.elementaryStreams[r];if(a){const o=a.endPTS-a.startPTS;if(o<=0)return this.warn(`Could not parse fragment ${e.sn} ${r} duration reliably (${o})`),t||!1;const l=s?0:It(n,e,a.startPTS,a.endPTS,a.startDTS,a.endDTS);return this.hls.trigger(g.LEVEL_PTS_UPDATED,{details:n,level:i,drift:l,type:r,frag:e,start:a.startPTS,end:a.endPTS}),!0}return t}),!1))i.fragmentError=0;else if(null===(null==(r=this.transmuxer)?void 0:r.error)){const t=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(0===i.fragmentError&&(i.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(t.message),this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:`Found no media in msn ${e.sn} of level "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=Ui,this.hls.trigger(g.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){var t,i,s;"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(null!=(t=null!=(i=this.levelLastLoaded)?i:null==(s=this.fragCurrent)?void 0:s.level)?t:0),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function qi(){return self.SourceBuffer||self.WebKitSourceBuffer}function ji(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class Wi{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=Ae(this.cachedData,e),this.cachedData=null);let i,s=Q(e,0),r=s?s.length:0;const n=this._audioTrack,a=this._id3Track,o=s?(e=>{const t=se(e);for(let i=0;i<t.length;i++){const e=t[i];if(te(e))return le(e)}})(s):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&p(o))&&(this.basePTS=Yi(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),s&&s.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:vt,duration:Number.POSITIVE_INFINITY});r<l;){if(this.canParse(e,r)){const t=this.appendFrame(n,e,r);t?(this.frameIndex++,this.lastPTS=t.sample.pts,r+=t.length,i=r):r=l}else ee(e,r)?(s=Q(e,r),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:vt,duration:Number.POSITIVE_INFINITY}),r+=s.length,i=r):r++;if(r===l&&i!==l){const t=z(e,i);this.cachedData?this.cachedData=Ae(this.cachedData,t):this.cachedData=t}}return{audioTrack:n,videoTrack:ji(),id3Track:a,textTrack:ji()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:ji(),id3Track:this._id3Track,textTrack:ji()}}destroy(){}}const Yi=(e,t,i)=>{if(p(e))return 90*e;return 9e4*t+(i?9e4*i.baseTime/i.timescale:0)};function zi(e,t){return 255===e[t]&&240==(246&e[t+1])}function Xi(e,t){return 1&e[t+1]?7:9}function Zi(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function Qi(e,t){return t+1<e.length&&zi(e,t)}function Ji(e,t){if(Qi(e,t)){const i=Xi(e,t);if(t+i>=e.length)return!1;const s=Zi(e,t);if(s<=i)return!1;const r=t+s;return r===e.length||Qi(e,r)}return!1}function es(e,t,i,s,r){if(!e.samplerate){const n=function(e,t,i,s){let r,n,a,o;const l=navigator.userAgent.toLowerCase(),c=s,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=1+((192&t[i+2])>>>6);const h=(60&t[i+2])>>>2;if(!(h>d.length-1))return a=(1&t[i+2])<<2,a|=(192&t[i+3])>>>6,S.log(`manifest codec:${s}, ADTS type:${r}, samplingIndex:${h}`),/firefox/i.test(l)?h>=6?(r=5,o=new Array(4),n=h-3):(r=2,o=new Array(2),n=h):-1!==l.indexOf("android")?(r=2,o=new Array(2),n=h):(r=5,o=new Array(4),s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&h>=6?n=h-3:((s&&-1!==s.indexOf("mp4a.40.2")&&(h>=6&&1===a||/vivaldi/i.test(l))||!s&&1===a)&&(r=2,o=new Array(2)),n=h)),o[0]=r<<3,o[0]|=(14&h)>>1,o[1]|=(1&h)<<7,o[1]|=a<<3,5===r&&(o[1]|=(14&n)>>1,o[2]=(1&n)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:d[h],channelCount:a,codec:"mp4a.40."+r,manifestCodec:c};e.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${h}`})}(t,i,s,r);if(!n)return;e.config=n.config,e.samplerate=n.samplerate,e.channelCount=n.channelCount,e.codec=n.codec,e.manifestCodec=n.manifestCodec,S.log(`parsed codec:${e.codec}, rate:${n.samplerate}, channels:${n.channelCount}`)}}function ts(e){return 9216e4/e}function is(e,t,i,s,r){const n=s+r*ts(e.samplerate),a=function(e,t){const i=Xi(e,t);if(t+i<=e.length){const s=Zi(e,t)-i;if(s>0)return{headerLength:i,frameLength:s}}}(t,i);let o;if(a){const{frameLength:s,headerLength:r}=a,l=r+s,c=Math.max(0,i+l-t.length);c?(o=new Uint8Array(l-r),o.set(t.subarray(i+r,t.length),0)):o=t.subarray(i+r,i+l);const d={unit:o,pts:n};return c||e.samples.push(d),{sample:d,length:l,missing:c}}const l=t.length-i;o=new Uint8Array(l),o.set(t.subarray(i,t.length),0);return{sample:{unit:o,pts:n},length:l,missing:-1}}const ss=/\/emsg[-/]ID3/i;let rs=null;const ns=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],as=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],os=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],ls=[0,1,1,4];function cs(e,t,i,s,r){if(i+24>t.length)return;const n=ds(t,i);if(n&&i+n.frameLength<=t.length){const a=s+r*(9e4*n.samplesPerFrame/n.sampleRate),o={unit:t.subarray(i,i+n.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=n.channelCount,e.samplerate=n.sampleRate,e.samples.push(o),{sample:o,length:n.frameLength,missing:0}}}function ds(e,t){const i=e[t+1]>>3&3,s=e[t+1]>>1&3,r=e[t+2]>>4&15,n=e[t+2]>>2&3;if(1!==i&&0!==r&&15!==r&&3!==n){const a=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*ns[14*(3===i?3-s:3===s?3:4)+r-1],c=as[3*(3===i?0:2===i?1:2)+n],d=3===o?1:2,h=os[i][s],u=ls[s],f=8*h*u,p=Math.floor(h*l/c+a)*u;if(null===rs){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);rs=e?parseInt(e[1]):0}return!!rs&&rs<=87&&2===s&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:c,channelCount:d,frameLength:p,samplesPerFrame:f}}}function hs(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])}function us(e,t){return t+1<e.length&&hs(e,t)}function fs(e,t){if(t+1<e.length&&hs(e,t)){const i=4,s=ds(e,t);let r=i;null!=s&&s.frameLength&&(r=s.frameLength);const n=t+r;return n===e.length||us(e,n)}return!1}class ps{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,s=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");s.set(e.subarray(i,i+r)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&S.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t,i=8,s=8;for(let r=0;r<e;r++)0!==s&&(t=this.readEG(),s=(i+t+256)%256),i=0===s?i:s}readSPS(){let e,t,i,s=0,r=0,n=0,a=0;const o=this.readUByte.bind(this),l=this.readBits.bind(this),c=this.readUEG.bind(this),d=this.readBoolean.bind(this),h=this.skipBits.bind(this),u=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);o();const g=o();if(l(5),h(3),o(),f(),100===g||110===g||122===g||244===g||44===g||83===g||86===g||118===g||128===g){const e=c();if(3===e&&h(1),f(),f(),h(1),d())for(t=3!==e?8:12,i=0;i<t;i++)d()&&p(i<6?16:64)}f();const m=c();if(0===m)c();else if(1===m)for(h(1),u(),u(),e=c(),i=0;i<e;i++)u();f(),h(1);const v=c(),y=c(),T=l(1);0===T&&h(1),h(1),d()&&(s=c(),r=c(),n=c(),a=c());let E=[1,1];if(d()&&d()){switch(o()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[o()<<8|o(),o()<<8|o()]}}return{width:Math.ceil(16*(v+1)-2*s-2*r),height:(2-T)*(y+1)*16-(T?2:4)*(n+a),pixelRatio:E}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class gs{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new ki(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,i){const s=e[t].unit;if(s.length<=16)return;const r=s.subarray(16,s.length-s.length%16),n=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(n).then((r=>{const n=new Uint8Array(r);s.set(n,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)}))}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length)return void i();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,i=new Int8Array(t);let s=0;for(let r=32;r<e.length-16;r+=160,s+=16)i.set(e.subarray(r,r+16),s);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let s=0;for(let r=32;r<e.length-16;r+=160,s+=16)e.set(i.subarray(s,s+16),r);return e}decryptAvcSample(e,t,i,s,r){const n=ke(r.data),a=this.getAvcEncryptedData(n);this.decryptBuffer(a.buffer).then((a=>{r.data=this.getAvcDecryptedUnit(n,a),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,s)}))}decryptAvcSamples(e,t,i,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length)return void s();const r=e[t].units;for(;!(i>=r.length);i++){const n=r[i];if(!(n.data.length<=48||1!==n.type&&5!==n.type||(this.decryptAvcSample(e,t,i,s,n),this.decrypter.isSync())))return}}}}const ms=188;class vs{constructor(e,t,i){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=i}static probe(e){const t=vs.syncOffset(e);return t>0&&S.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),-1!==t}static syncOffset(e){const t=e.length;let i=Math.min(940,e.length-ms)+1,s=0;for(;s<i;){let r=!1,n=-1,a=0;for(let o=s;o<t;o+=ms){if(71!==e[o]){if(a)return-1;break}if(a++,-1===n&&(n=o,0!==n&&(i=Math.min(n+18612,e.length-ms)+1)),r||(r=0===Ts(e,o)),r&&a>1&&(0===n&&a>2||o+ms>i))return n}s++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:ge[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,i,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=vs.createTrack("video"),this._audioTrack=vs.createTrack("audio",s),this._id3Track=vs.createTrack("id3"),this._txtTrack=vs.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i,this._duration=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_avcTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(e,t,i=!1,s=!1){let r;i||(this.sampleAes=null);const n=this._avcTrack,a=this._audioTrack,o=this._id3Track,l=this._txtTrack;let c=n.pid,d=n.pesData,h=a.pid,u=o.pid,f=a.pesData,p=o.pesData,y=null,T=this.pmtParsed,E=this._pmtId,b=e.length;if(this.remainderData&&(b=(e=Ae(this.remainderData,e)).length,this.remainderData=null),b<ms&&!s)return this.remainderData=e,{audioTrack:a,videoTrack:n,id3Track:o,textTrack:l};const L=Math.max(0,vs.syncOffset(e));b-=(b-L)%ms,b<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,b,e.buffer.byteLength-b));let _=0;for(let g=L;g<b;g+=ms)if(71===e[g]){const t=!!(64&e[g+1]),s=Ts(e,g);let m;if((48&e[g+3])>>4>1){if(m=g+5+e[g+4],m===g+ms)continue}else m=g+4;switch(s){case c:t&&(d&&(r=Ss(d))&&this.parseAVCPES(n,l,r,!1),d={data:[],size:0}),d&&(d.data.push(e.subarray(m,g+ms)),d.size+=g+ms-m);break;case h:if(t){if(f&&(r=Ss(f)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,r);break;case"mp3":this.parseMPEGPES(a,r)}f={data:[],size:0}}f&&(f.data.push(e.subarray(m,g+ms)),f.size+=g+ms-m);break;case u:t&&(p&&(r=Ss(p))&&this.parseID3PES(o,r),p={data:[],size:0}),p&&(p.data.push(e.subarray(m,g+ms)),p.size+=g+ms-m);break;case 0:t&&(m+=e[m]+1),E=this._pmtId=Es(e,m);break;case E:{t&&(m+=e[m]+1);const s=bs(e,m,this.typeSupported,i);c=s.avc,c>0&&(n.pid=c),h=s.audio,h>0&&(a.pid=h,a.segmentCodec=s.segmentCodec),u=s.id3,u>0&&(o.pid=u),null===y||T||(S.warn(`MPEG-TS PMT found at ${g} after unknown PID '${y}'. Backtracking to sync byte @${L} to parse all TS packets.`),y=null,g=L-188),T=this.pmtParsed=!0;break}case 17:case 8191:break;default:y=s}}else _++;if(_>0){const e=new Error(`Found ${_} TS packet/s that do not start with 0x47`);this.observer.emit(g.ERROR,g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message})}n.pesData=d,a.pesData=f,o.pesData=p;const w={audioTrack:a,videoTrack:n,id3Track:o,textTrack:l};return s&&this.extractRemainingSamples(w),w}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:s,textTrack:r}=e,n=i.pesData,a=t.pesData,o=s.pesData;let l;if(n&&(l=Ss(n))?(this.parseAVCPES(i,r,l,!0),i.pesData=null):i.pesData=n,a&&(l=Ss(a))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l)}t.pesData=null}else null!=a&&a.size&&S.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;o&&(l=Ss(o))?(this.parseID3PES(s,l),s.pesData=null):s.pesData=o}demuxSampleAes(e,t,i){const s=this.demux(e,i,!0,!this.config.progressive),r=this.sampleAes=new gs(this.observer,this.config,t);return this.decrypt(s,r)}decrypt(e,t){return new Promise((i=>{const{audioTrack:s,videoTrack:r}=e;s.samples&&"aac"===s.segmentCodec?t.decryptAacSamples(s.samples,0,(()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,(()=>{i(e)})):i(e)})):r.samples&&t.decryptAvcSamples(r.samples,0,0,(()=>{i(e)}))}))}destroy(){this._duration=0}parseAVCPES(e,t,i,s){const r=this.parseAVCNALu(e,i.data);let n,a=this.avcSample,o=!1;i.data=null,a&&r.length&&!e.audFound&&(Ls(a,e),a=this.avcSample=ys(!1,i.pts,i.dts,"")),r.forEach((s=>{var r;switch(s.type){case 1:{let t=!1;n=!0;const r=s.data;if(o&&r.length>4){const e=new ps(r).readSliceType();2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var l;if(t)null!=(l=a)&&l.frame&&!a.key&&(Ls(a,e),a=this.avcSample=null);a||(a=this.avcSample=ys(!0,i.pts,i.dts,"")),a.frame=!0,a.key=t;break}case 5:n=!0,null!=(r=a)&&r.frame&&!a.key&&(Ls(a,e),a=this.avcSample=null),a||(a=this.avcSample=ys(!0,i.pts,i.dts,"")),a.key=!0,a.frame=!0;break;case 6:n=!0,Pe(s.data,1,i.pts,t.samples);break;case 7:if(n=!0,o=!0,!e.sps){const t=s.data,i=new ps(t).readSPS();e.width=i.width,e.height=i.height,e.pixelRatio=i.pixelRatio,e.sps=[t],e.duration=this._duration;const r=t.subarray(1,4);let n="avc1.";for(let e=0;e<3;e++){let t=r[e].toString(16);t.length<2&&(t="0"+t),n+=t}e.codec=n}break;case 8:n=!0,e.pps||(e.pps=[s.data]);break;case 9:n=!1,e.audFound=!0,a&&Ls(a,e),a=this.avcSample=ys(!1,i.pts,i.dts,"");break;case 12:n=!0;break;default:n=!1,a&&(a.debug+="unknown NAL "+s.type+" ")}if(a&&n){a.units.push(s)}})),s&&a&&(Ls(a,e),this.avcSample=null)}getLastNalUnit(e){var t;let i,s=this.avcSample;if(s&&0!==s.units.length||(s=e[e.length-1]),null!=(t=s)&&t.units){const e=s.units;i=e[e.length-1]}return i}parseAVCNALu(e,t){const i=t.byteLength;let s=e.naluState||0;const r=s,n=[];let a,o,l,c=0,d=-1,h=0;for(-1===s&&(d=0,h=31&t[0],s=0,c=1);c<i;)if(a=t[c++],s)if(1!==s)if(a)if(1===a){if(d>=0){const e={data:t.subarray(d,c-s-1),type:h};n.push(e)}else{const i=this.getLastNalUnit(e.samples);if(i&&(r&&c<=4-r&&i.state&&(i.data=i.data.subarray(0,i.data.byteLength-r)),o=c-s-1,o>0)){const e=new Uint8Array(i.data.byteLength+o);e.set(i.data,0),e.set(t.subarray(0,o),i.data.byteLength),i.data=e,i.state=0}}c<i?(l=31&t[c],d=c,h=l,s=0):s=-1}else s=0;else s=3;else s=a?0:2;else s=a?0:1;if(d>=0&&s>=0){const e={data:t.subarray(d,i),type:h,state:s};n.push(e)}if(0===n.length){const i=this.getLastNalUnit(e.samples);if(i){const e=new Uint8Array(i.data.byteLength+t.byteLength);e.set(i.data,0),e.set(t,i.data.byteLength),i.data=e}}return e.naluState=s,n}parseAACPES(e,t){let i=0;const s=this.aacOverFlow;let r,n,a,o=t.data;if(s){this.aacOverFlow=null;const t=s.missing,r=s.sample.unit.byteLength;if(-1===t){const e=new Uint8Array(r+o.byteLength);e.set(s.sample.unit,0),e.set(o,r),o=e}else{const n=r-t;s.sample.unit.set(o.subarray(0,t),n),e.samples.push(s.sample),i=s.missing}}for(r=i,n=o.length;r<n-1&&!Qi(o,r);r++);if(r!==i){let e;const t=r<n-1;e=t?`AAC PES did not start with ADTS header,offset:${r}`:"No ADTS header found in AAC PES";const i=new Error(e);if(S.warn(`parsing error: ${e}`),this.observer.emit(g.ERROR,g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:i,reason:e}),!t)return}if(es(e,this.observer,o,r,this.audioCodec),void 0!==t.pts)a=t.pts;else{if(!s)return void S.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=ts(e.samplerate);a=s.sample.pts+t}}let l,c=0;for(;r<n;){if(l=is(e,o,r,a,c),r+=l.length,l.missing){this.aacOverFlow=l;break}for(c++;r<n-1&&!Qi(o,r);r++);}}parseMPEGPES(e,t){const i=t.data,s=i.length;let r=0,n=0;const a=t.pts;if(void 0!==a)for(;n<s;)if(us(i,n)){const t=cs(e,i,n,a,r);if(!t)break;n+=t.length,r++}else n++;else S.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseID3PES(e,t){if(void 0===t.pts)return void S.warn("[tsdemuxer]: ID3 PES unknown PTS");const i=f({},t,{type:this._avcTrack?Tt:vt,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function ys(e,t,i,s){return{key:e,frame:!1,pts:t,dts:i,units:[],debug:s,length:0}}function Ts(e,t){return((31&e[t+1])<<8)+e[t+2]}function Es(e,t){return(31&e[t+10])<<8|e[t+11]}function bs(e,t,i,s){const r={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},n=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<n;){const n=Ts(e,t);switch(e[t]){case 207:if(!s){S.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===r.audio&&(r.audio=n);break;case 21:-1===r.id3&&(r.id3=n);break;case 219:if(!s){S.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===r.avc&&(r.avc=n);break;case 3:case 4:!0!==i.mpeg&&!0!==i.mp3?S.log("MPEG audio found, not supported in this browser"):-1===r.audio&&(r.audio=n,r.segmentCodec="mp3");break;case 36:S.warn("Unsupported HEVC stream type found")}t+=5+((15&e[t+3])<<8|e[t+4])}return r}function Ss(e){let t,i,s,r,n,a=0;const o=e.data;if(!e||0===e.size)return null;for(;o[0].length<19&&o.length>1;){const e=new Uint8Array(o[0].length+o[1].length);e.set(o[0]),e.set(o[1],o[0].length),o[0]=e,o.splice(1,1)}t=o[0];if(1===(t[0]<<16)+(t[1]<<8)+t[2]){if(i=(t[4]<<8)+t[5],i&&i>e.size-6)return null;const l=t[7];192&l&&(r=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&l?(n=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,r-n>54e5&&(S.warn(`${Math.round((r-n)/9e4)}s delta between PTS and DTS, align them`),r=n)):n=r),s=t[8];let c=s+9;if(e.size<=c)return null;e.size-=c;const d=new Uint8Array(e.size);for(let e=0,i=o.length;e<i;e++){t=o[e];let i=t.byteLength;if(c){if(c>i){c-=i;continue}t=t.subarray(c),i-=c,c=0}d.set(t,a),a+=i}return i&&(i-=s+3),{data:d,pts:r,dts:n,len:i}}return null}function Ls(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const i=t.samples,s=i.length;if(!s)return void t.dropped++;{const t=i[s-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}e.debug.length&&S.log(e.pts+"/"+e.dts+":"+e.debug)}class _s{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const ws=Math.pow(2,32)-1;class As{static init(){let e;for(e in As.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},As.types)As.types.hasOwnProperty(e)&&(As.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);As.HDLR_TYPES={video:t,audio:i};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);As.STTS=As.STSC=As.STCO=r,As.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),As.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),As.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),As.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const n=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);As.FTYP=As.box(As.types.ftyp,n,o,n,a),As.DINF=As.box(As.types.dinf,As.box(As.types.dref,s))}static box(e,...t){let i=8,s=t.length;const r=s;for(;s--;)i+=t[s].byteLength;const n=new Uint8Array(i);for(n[0]=i>>24&255,n[1]=i>>16&255,n[2]=i>>8&255,n[3]=255&i,n.set(e,4),s=0,i=8;s<r;s++)n.set(t[s],i),i+=t[s].byteLength;return n}static hdlr(e){return As.box(As.types.hdlr,As.HDLR_TYPES[e])}static mdat(e){return As.box(As.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(ws+1)),s=Math.floor(t%(ws+1));return As.box(As.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,s>>24,s>>16&255,s>>8&255,255&s,85,196,0,0]))}static mdia(e){return As.box(As.types.mdia,As.mdhd(e.timescale,e.duration),As.hdlr(e.type),As.minf(e))}static mfhd(e){return As.box(As.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?As.box(As.types.minf,As.box(As.types.smhd,As.SMHD),As.DINF,As.stbl(e)):As.box(As.types.minf,As.box(As.types.vmhd,As.VMHD),As.DINF,As.stbl(e))}static moof(e,t,i){return As.box(As.types.moof,As.mfhd(e),As.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=As.trak(e[t]);return As.box.apply(null,[As.types.moov,As.mvhd(e[0].timescale,e[0].duration)].concat(i).concat(As.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=As.trex(e[t]);return As.box.apply(null,[As.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(ws+1)),s=Math.floor(t%(ws+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,s>>24,s>>16&255,s>>8&255,255&s,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return As.box(As.types.mvhd,r)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let s,r;for(s=0;s<t.length;s++)r=t[s].flags,i[s+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return As.box(As.types.sdtp,i)}static stbl(e){return As.box(As.types.stbl,As.stsd(e),As.box(As.types.stts,As.STTS),As.box(As.types.stsc,As.STSC),As.box(As.types.stsz,As.STSZ),As.box(As.types.stco,As.STCO))}static avc1(e){let t,i,s,r=[],n=[];for(t=0;t<e.sps.length;t++)i=e.sps[t],s=i.byteLength,r.push(s>>>8&255),r.push(255&s),r=r.concat(Array.prototype.slice.call(i));for(t=0;t<e.pps.length;t++)i=e.pps[t],s=i.byteLength,n.push(s>>>8&255),n.push(255&s),n=n.concat(Array.prototype.slice.call(i));const a=As.box(As.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|e.sps.length].concat(r).concat([e.pps.length]).concat(n))),o=e.width,l=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return As.box(As.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,As.box(As.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),As.box(As.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static mp4a(e){const t=e.samplerate;return As.box(As.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]),As.box(As.types.esds,As.esds(e)))}static mp3(e){const t=e.samplerate;return As.box(As.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]))}static stsd(e){return"audio"===e.type?"mp3"===e.segmentCodec&&"mp3"===e.codec?As.box(As.types.stsd,As.STSD,As.mp3(e)):As.box(As.types.stsd,As.STSD,As.mp4a(e)):As.box(As.types.stsd,As.STSD,As.avc1(e))}static tkhd(e){const t=e.id,i=e.duration*e.timescale,s=e.width,r=e.height,n=Math.floor(i/(ws+1)),a=Math.floor(i%(ws+1));return As.box(As.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,255&s,0,0,r>>8&255,255&r,0,0]))}static traf(e,t){const i=As.sdtp(e),s=e.id,r=Math.floor(t/(ws+1)),n=Math.floor(t%(ws+1));return As.box(As.types.traf,As.box(As.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s])),As.box(As.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n])),As.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,As.box(As.types.trak,As.tkhd(e),As.mdia(e))}static trex(e){const t=e.id;return As.box(As.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],s=i.length,r=12+16*s,n=new Uint8Array(r);let a,o,l,c,d,h;for(t+=8+r,n.set(["video"===e.type?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,255&s,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),a=0;a<s;a++)o=i[a],l=o.duration,c=o.size,d=o.flags,h=o.cts,n.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,61440&d.degradPrio,15&d.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*a);return As.box(As.types.trun,n)}static initSegment(e){As.types||As.init();const t=As.moov(e),i=new Uint8Array(As.FTYP.byteLength+t.byteLength);return i.set(As.FTYP),i.set(t,As.FTYP.byteLength),i}}As.types=void 0,As.HDLR_TYPES=void 0,As.STTS=void 0,As.STSC=void 0,As.STCO=void 0,As.STSZ=void 0,As.VMHD=void 0,As.SMHD=void 0,As.STSD=void 0,As.FTYP=void 0,As.DINF=void 0;const Rs=9e4;function Cs(e,t,i=1,s=!1){const r=e*t*i;return s?Math.round(r):r}function Ps(e,t=!1){return Cs(e,1e3,1/Rs,t)}let ks,Ds=null,Is=null;class Ms{constructor(e,t,i,s=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,null===Ds){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ds=e?parseInt(e[1]):0}if(null===Is){const e=navigator.userAgent.match(/Safari\/(\d+)/i);Is=e?parseInt(e[1]):0}}destroy(){}resetTimeStamp(e){S.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){S.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){S.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(e){let t=!1;const i=e.reduce(((e,i)=>{const s=i.pts-e;return s<-4294967296?(t=!0,Os(e,i.pts)):s>0?e:i.pts}),e[0].pts);return t&&S.debug("PTS rollover detected"),i}remux(e,t,i,s,r,n,a,o){let l,c,d,h,u,f,p=r,g=r;const m=e.pid>-1,v=t.pid>-1,y=t.samples.length,T=e.samples.length>0,E=a&&y>0||y>1;if((!m||T)&&(!v||E)||this.ISGenerated||a){this.ISGenerated||(d=this.generateIS(e,t,r,n));const i=this.isVideoContiguous;let s,a=-1;if(E&&(a=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!i&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,a>0){S.warn(`[mp4-remuxer]: Dropped ${a} out of ${y} video samples due to a missing keyframe`);const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(a),t.dropped+=a,g+=(t.samples[0].pts-e)/t.inputTimeScale,s=g}else-1===a&&(S.warn(`[mp4-remuxer]: No keyframe found out of ${y} video samples`),f=!1);if(this.ISGenerated){if(T&&E){const i=this.getVideoStartPts(t.samples),s=(Os(e.samples[0].pts,i)-i)/t.inputTimeScale;p+=Math.max(0,s),g+=Math.max(0,-s)}if(T){if(e.samplerate||(S.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(e,t,r,n)),c=this.remuxAudio(e,p,this.isAudioContiguous,n,v||E||o===lt?g:void 0),E){const s=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(S.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(e,t,r,n)),l=this.remuxVideo(t,g,i,s)}}else E&&(l=this.remuxVideo(t,g,i,0));l&&(l.firstKeyFrame=a,l.independent=-1!==a,l.firstKeyFramePTS=s)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(u=xs(i,r,this._initPTS,this._initDTS)),s.samples.length&&(h=Fs(s,r,this._initPTS))),{audio:c,video:l,initSegment:d,independent:f,text:h,id3:u}}generateIS(e,t,i,s){const r=e.samples,n=t.samples,a=this.typeSupported,o={},l=this._initPTS;let c,d,h,u=!l||s,f="audio/mp4";if(u&&(c=d=1/0),e.config&&r.length){if(e.timescale=e.samplerate,"mp3"===e.segmentCodec)a.mpeg?(f="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");o.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&a.mpeg?new Uint8Array(0):As.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(h=e.inputTimeScale,l&&h===l.timescale?u=!1:c=d=r[0].pts-Math.round(h*i))}if(t.sps&&t.pps&&n.length&&(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:As.initSegment([t]),metadata:{width:t.width,height:t.height}},u))if(h=t.inputTimeScale,l&&h===l.timescale)u=!1;else{const e=this.getVideoStartPts(n),t=Math.round(h*i);d=Math.min(d,Os(n[0].dts,e)-t),c=Math.min(c,e-t)}if(Object.keys(o).length)return this.ISGenerated=!0,u?(this._initPTS={baseTime:c,timescale:h},this._initDTS={baseTime:d,timescale:h}):c=h=void 0,{tracks:o,initPTS:c,timescale:h}}remuxVideo(e,t,i,s){const r=e.inputTimeScale,n=e.samples,a=[],o=n.length,l=this._initPTS;let c,d,h=this.nextAvcDts,u=8,p=this.videoSampleDuration,y=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,E=!1;if(!i||null===h){h=t*r-(n[0].pts-Os(n[0].dts,n[0].pts))}const b=l.baseTime*r/l.timescale;for(let f=0;f<o;f++){const e=n[f];e.pts=Os(e.pts-b,h),e.dts=Os(e.dts-b,h),e.dts<n[f>0?f-1:f].dts&&(E=!0)}E&&n.sort((function(e,t){const i=e.dts-t.dts,s=e.pts-t.pts;return i||s})),c=n[0].dts,d=n[n.length-1].dts;const L=d-c,_=L?Math.round(L/(o-1)):p||e.inputTimeScale/30;if(i){const e=c-h,t=e>_,i=e<-1;if((t||i)&&(t?S.warn(`AVC: ${Ps(e,!0)} ms (${e}dts) hole between fragments detected, filling it`):S.warn(`AVC: ${Ps(-e,!0)} ms (${e}dts) overlapping between fragments detected`),!i||h>=n[0].pts)){c=h;const t=n[0].pts-e;n[0].dts=c,n[0].pts=t,S.log(`Video: First PTS/DTS adjusted: ${Ps(t,!0)}/${Ps(c,!0)}, delta: ${Ps(e,!0)} ms`)}}c=Math.max(0,c);let w=0,A=0;for(let f=0;f<o;f++){const e=n[f],t=e.units,i=t.length;let s=0;for(let r=0;r<i;r++)s+=t[r].data.length;A+=s,w+=i,e.length=s,e.dts=Math.max(e.dts,c),y=Math.min(e.pts,y),T=Math.max(e.pts,T)}d=n[o-1].dts;const R=A+4*w+8;let C;try{C=new Uint8Array(R)}catch(F){return void this.observer.emit(g.ERROR,g.ERROR,{type:m.MUX_ERROR,details:v.REMUX_ALLOC_ERROR,fatal:!1,error:F,bytes:R,reason:`fail allocating video mdat ${R}`})}const P=new DataView(C.buffer);P.setUint32(0,R),C.set(As.types.mdat,4);let k=!1,D=Number.POSITIVE_INFINITY,I=Number.POSITIVE_INFINITY,M=Number.NEGATIVE_INFINITY,O=Number.NEGATIVE_INFINITY;for(let f=0;f<o;f++){const e=n[f],t=e.units;let i,l=0;for(let s=0,r=t.length;s<r;s++){const e=t[s],i=e.data,r=e.data.byteLength;P.setUint32(u,r),u+=4,C.set(i,u),u+=r,l+=4+r}if(f<o-1)p=n[f+1].dts-e.dts,i=n[f+1].pts-e.pts;else{const t=this.config,a=f>0?e.dts-n[f-1].dts:_;if(i=f>0?e.pts-n[f-1].pts:_,t.stretchShortVideoTrack&&null!==this.nextAudioPts){const i=Math.floor(t.maxBufferHole*r),n=(s?y+s*r:this.nextAudioPts)-e.pts;n>i?(p=n-a,p<0?p=a:k=!0,S.log(`[mp4-remuxer]: It is approximately ${n/90} ms to the next segment; using duration ${p/90} ms for the last video frame.`)):p=a}else p=a}const c=Math.round(e.pts-e.dts);D=Math.min(D,p),M=Math.max(M,p),I=Math.min(I,i),O=Math.max(O,i),a.push(new Bs(e.key,p,l,c))}if(a.length)if(Ds){if(Ds<70){const e=a[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(Is&&O-I<M-D&&_/M<.025&&0===a[0].cts){S.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=c;for(let t=0,i=a.length;t<i;t++){const s=e+a[t].duration,r=e+a[t].cts;if(t<i-1){const e=s+a[t+1].cts;a[t].duration=e-r}else a[t].duration=t?a[t-1].duration:_;a[t].cts=0,e=s}}p=k||!p?_:p,this.nextAvcDts=h=d+p,this.videoSampleDuration=p,this.isVideoContiguous=!0;const x={data1:As.moof(e.sequenceNumber++,c,f({},e,{samples:a})),data2:C,startPTS:y/r,endPTS:(T+p)/r,startDTS:c/r,endDTS:h/r,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,x}remuxAudio(e,t,i,s,r){const n=e.inputTimeScale,a=n/(e.samplerate?e.samplerate:n),o="aac"===e.segmentCodec?1024:1152,l=o*a,c=this._initPTS,d="mp3"===e.segmentCodec&&this.typeSupported.mpeg,h=[],u=void 0!==r;let p=e.samples,y=d?0:8,T=this.nextAudioPts||-1;const E=t*n,b=c.baseTime*n/c.timescale;if(this.isAudioContiguous=i=i||p.length&&T>0&&(s&&Math.abs(E-T)<9e3||Math.abs(Os(p[0].pts-b,E)-T)<20*l),p.forEach((function(e){e.pts=Os(e.pts-b,E)})),!i||T<0){if(p=p.filter((e=>e.pts>=0)),!p.length)return;T=0===r?0:s&&!u?Math.max(0,E):p[0].pts}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let i=0,s=T;i<p.length;i++){const r=p[i],a=r.pts,o=a-s,c=Math.abs(1e3*o/n);if(o<=-t*l&&u)0===i&&(S.warn(`Audio frame @ ${(a/n).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*o/n)} ms.`),this.nextAudioPts=T=s=a);else if(o>=t*l&&c<1e4&&u){let t=Math.round(o/l);s=a-t*l,s<0&&(t--,s+=l),0===i&&(this.nextAudioPts=T=s),S.warn(`[mp4-remuxer]: Injecting ${t} audio frame @ ${(s/n).toFixed(3)}s due to ${Math.round(1e3*o/n)} ms gap.`);for(let n=0;n<t;n++){const t=Math.max(s,0);let n=_s.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);n||(S.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),n=r.unit.subarray()),p.splice(i,0,{unit:n,pts:t}),s+=l,i++}}r.pts=s,s+=l}}let L,_=null,w=null,A=0,R=p.length;for(;R--;)A+=p[R].unit.byteLength;for(let f=0,S=p.length;f<S;f++){const t=p[f],s=t.unit;let r=t.pts;if(null!==w){h[f-1].duration=Math.round((r-w)/a)}else{if(i&&"aac"===e.segmentCodec&&(r=T),_=r,!(A>0))return;A+=y;try{L=new Uint8Array(A)}catch(O){return void this.observer.emit(g.ERROR,g.ERROR,{type:m.MUX_ERROR,details:v.REMUX_ALLOC_ERROR,fatal:!1,error:O,bytes:A,reason:`fail allocating audio mdat ${A}`})}if(!d){new DataView(L.buffer).setUint32(0,A),L.set(As.types.mdat,4)}}L.set(s,y);const n=s.byteLength;y+=n,h.push(new Bs(!0,o,n,0)),w=r}const C=h.length;if(!C)return;const P=h[h.length-1];this.nextAudioPts=T=w+a*P.duration;const k=d?new Uint8Array(0):As.moof(e.sequenceNumber++,_/a,f({},e,{samples:h}));e.samples=[];const D=_/n,I=T/n,M={data1:k,data2:L,startPTS:D,endPTS:I,startDTS:D,endDTS:I,type:"audio",hasAudio:!0,hasVideo:!1,nb:C};return this.isAudioContiguous=!0,M}remuxEmptyAudio(e,t,i,s){const r=e.inputTimeScale,n=r/(e.samplerate?e.samplerate:r),a=this.nextAudioPts,o=this._initDTS,l=9e4*o.baseTime/o.timescale,c=(null!==a?a:s.startDTS*r)+l,d=s.endDTS*r+l,h=1024*n,u=Math.ceil((d-c)/h),f=_s.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(S.warn("[mp4-remuxer]: remux empty Audio"),!f)return void S.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");const p=[];for(let g=0;g<u;g++){const e=c+g*h;p.push({unit:f,pts:e,dts:e})}return e.samples=p,this.remuxAudio(e,t,i,!1)}}function Os(e,t){let i;if(null===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e}function xs(e,t,i,s){const r=e.samples.length;if(!r)return;const n=e.inputTimeScale;for(let o=0;o<r;o++){const r=e.samples[o];r.pts=Os(r.pts-i.baseTime*n/i.timescale,t*n)/n,r.dts=Os(r.dts-s.baseTime*n/s.timescale,t*n)/n}const a=e.samples;return e.samples=[],{samples:a}}function Fs(e,t,i){const s=e.samples.length;if(!s)return;const r=e.inputTimeScale;for(let a=0;a<s;a++){const s=e.samples[a];s.pts=Os(s.pts-i.baseTime*r/i.timescale,t*r)/r}e.samples.sort(((e,t)=>e.pts-t.pts));const n=e.samples;return e.samples=[],{samples:n}}class Bs{constructor(e,t,i,s){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=i,this.cts=s,this.flags=new Ns(e)}}class Ns{constructor(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}}function Us(e,t){const i=null==e?void 0:e.codec;return i&&i.length>4?i:"hvc1"===i||"hev1"===i?"hvc1.1.6.L120.90":"av01"===i?"av01.0.04M.08":"avc1"===i||t===k?"avc1.42e01e":"mp4a.40.5"}try{ks=self.performance.now.bind(self.performance)}catch(bl){S.debug("Unable to use Performance API on this environment"),ks="undefined"!=typeof self&&self.Date.now}const $s=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,s){const r=this.videoTrack=ji("video",1),n=this.audioTrack=ji("audio",1),a=this.txtTrack=ji("text",1);if(this.id3Track=ji("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=Le(e);if(o.video){const{id:e,timescale:t,codec:i}=o.video;r.id=e,r.timescale=a.timescale=t,r.codec=i}if(o.audio){const{id:e,timescale:t,codec:i}=o.audio;n.id=e,n.timescale=t,n.codec=i}a.id=ge.text,r.sampleDuration=0,r.duration=n.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return be(e=e.length>16384?e.subarray(0,16384):e,["moof"]).length>0}demux(e,t){this.timeOffset=t;let i=e;const s=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=Ae(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},i=be(e,["moof"]);if(!i)return t;if(i.length<2)return t.remainder=e,t;const s=i[i.length-1];return t.valid=z(e,0,s.byteOffset-8),t.remainder=z(e,s.byteOffset-8),t}(i);this.remainderData=t.remainder,s.samples=t.valid||new Uint8Array}else s.samples=i;const n=this.extractID3Track(s,t);return r.samples=Re(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:n,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return i.samples=Re(e,t),{videoTrack:t,audioTrack:ji(),id3Track:s,textTrack:ji()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const s=be(e.samples,["emsg"]);s&&s.forEach((e=>{const s=function(e){const t=e[0];let i="",s="",r=0,n=0,a=0,o=0,l=0,c=0;if(0===t){for(;"\0"!==me(e.subarray(c,c+1));)i+=me(e.subarray(c,c+1)),c+=1;for(i+=me(e.subarray(c,c+1)),c+=1;"\0"!==me(e.subarray(c,c+1));)s+=me(e.subarray(c,c+1)),c+=1;s+=me(e.subarray(c,c+1)),c+=1,r=ye(e,12),n=ye(e,16),o=ye(e,20),l=ye(e,24),c=28}else if(1===t){c+=4,r=ye(e,c),c+=4;const t=ye(e,c);c+=4;const n=ye(e,c);for(c+=4,a=2**32*t+n,Number.isSafeInteger(a)||(a=Number.MAX_SAFE_INTEGER,S.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=ye(e,c),c+=4,l=ye(e,c),c+=4;"\0"!==me(e.subarray(c,c+1));)i+=me(e.subarray(c,c+1)),c+=1;for(i+=me(e.subarray(c,c+1)),c+=1;"\0"!==me(e.subarray(c,c+1));)s+=me(e.subarray(c,c+1)),c+=1;s+=me(e.subarray(c,c+1)),c+=1}return{schemeIdUri:i,value:s,timeScale:r,presentationTime:a,presentationTimeDelta:n,eventDuration:o,id:l,payload:e.subarray(c,e.byteLength)}}(e);if(ss.test(s.schemeIdUri)){const e=p(s.presentationTime)?s.presentationTime/s.timeScale:t+s.presentationTimeDelta/s.timeScale;let r=4294967295===s.eventDuration?Number.POSITIVE_INFINITY:s.eventDuration/s.timeScale;r<=.001&&(r=Number.POSITIVE_INFINITY);const n=s.payload;i.samples.push({data:n,len:n.byteLength,dts:e,pts:e,type:Tt,duration:r})}}))}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}},remux:class{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,i,s){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(function(e,t){if(!e||!t)return e;const i=t.keyId;i&&t.isCommonEncryption&&be(e,["moov","trak"]).forEach((e=>{const t=be(e,["mdia","minf","stbl","stsd"])[0].subarray(8);let s=be(t,["enca"]);const r=s.length>0;r||(s=be(t,["encv"])),s.forEach((e=>{be(r?e.subarray(28):e.subarray(78),["sinf"]).forEach((e=>{const t=_e(e);if(t){const e=t.subarray(8,24);e.some((e=>0!==e))||(S.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${ue(e)} -> ${ue(i)}`),t.set(i,8))}}))}))}));return e}(e,s)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:i}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const s=this.initData=Le(e);t||(t=Us(s.audio,P)),i||(i=Us(s.video,k));const r={};s.audio&&s.video?r.audiovideo={container:"video/mp4",codec:t+","+i,initSegment:e,id:"main"}:s.audio?r.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:s.video?r.video={container:"video/mp4",codec:i,initSegment:e,id:"main"}:S.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=r}remux(e,t,i,s,r,n){var a,o;let{initPTS:l,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:s,id3:i,initSegment:void 0};p(c)||(c=this.lastEndTime=r||0);const h=t.samples;if(null==h||!h.length)return d;const u={initPTS:void 0,timescale:1};let f=this.initData;if(null!=(a=f)&&a.length||(this.generateInitSegment(h),f=this.initData),null==(o=f)||!o.length)return S.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(u.tracks=this.initTracks,this.emitInitSegment=!1);const g=function(e,t){let i=0,s=0,r=0;const n=be(e,["moof","traf"]);for(let a=0;a<n.length;a++){const e=n[a],o=be(e,["tfhd"])[0],l=t[ye(o,4)];if(!l)continue;const c=l.default,d=ye(o,0)|(null==c?void 0:c.flags);let h=null==c?void 0:c.duration;8&d&&(h=ye(o,2&d?12:8));const u=l.timescale||9e4,f=be(e,["trun"]);for(let t=0;t<f.length;t++)i=we(f[t]),!i&&h&&(i=h*ye(f[t],4)),l.type===k?s+=i/u:l.type===P&&(r+=i/u)}if(0===s&&0===r){let t=0;const i=be(e,["sidx"]);for(let e=0;e<i.length;e++){const s=Se(i[e]);null!=s&&s.references&&(t+=s.references.reduce(((e,t)=>e+t.info.duration||0),0))}return t}return s||r}(h,f),m=function(e,t){return be(t,["moof","traf"]).reduce(((t,i)=>{const s=be(i,["tfdt"])[0],r=s[0],n=be(i,["tfhd"]).reduce(((t,i)=>{const n=ye(i,4),a=e[n];if(a){let e=ye(s,4);if(1===r){if(e===fe)return S.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;e*=fe+1,e+=ye(s,8)}const i=e/(a.timescale||9e4);if(isFinite(i)&&(null===t||i<t))return i}return t}),null);return null!==n&&isFinite(n)&&(null===t||n<t)?n:t}),null)}(f,h),v=null===m?r:m;(function(e,t,i,s){if(null===e)return!0;const r=Math.max(s,1),n=t-e.baseTime/e.timescale;return Math.abs(n-i)>r}(l,v,r,g)||u.timescale!==l.timescale&&n)&&(u.initPTS=v-r,l&&1===l.timescale&&S.warn("Adjusting initPTS by "+(u.initPTS-l.baseTime)),this.initPTS=l={baseTime:u.initPTS,timescale:1});const y=e?v-l.baseTime/l.timescale:c,T=y+g;!function(e,t,i){be(t,["moof","traf"]).forEach((t=>{be(t,["tfhd"]).forEach((s=>{const r=ye(s,4),n=e[r];if(!n)return;const a=n.timescale||9e4;be(t,["tfdt"]).forEach((e=>{const t=e[0];let s=ye(e,4);if(0===t)s-=i*a,s=Math.max(s,0),Ee(e,4,s);else{s*=Math.pow(2,32),s+=ye(e,8),s-=i*a,s=Math.max(s,0);const t=Math.floor(s/(fe+1)),r=Math.floor(s%(fe+1));Ee(e,4,t),Ee(e,8,r)}}))}))}))}(f,h,l.baseTime/l.timescale),g>0?this.lastEndTime=T:(S.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const E=!!f.audio,b=!!f.video;let L="";E&&(L+="audio"),b&&(L+="video");const _={data1:h,startPTS:y,startDTS:y,endPTS:T,endDTS:T,type:L,hasAudio:E,hasVideo:b,nb:1,dropped:0};return d.audio="audio"===_.type?_:void 0,d.video="audio"!==_.type?_:void 0,d.initSegment=u,d.id3=xs(i,r,l,l),s.samples.length&&(d.text=Fs(s,r,l)),d}}},{demux:vs,remux:Ms},{demux:class extends Wi{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=(Q(e,0)||[]).length;for(let i=e.length;t<i;t++)if(Ji(e,t))return S.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&zi(e,t)&&Zi(e,t)<=e.length-t}(e,t)}appendFrame(e,t,i){es(e,this.observer,t,i,e.manifestCodec);const s=is(e,t,i,this.basePTS,this.frameIndex);if(s&&0===s.missing)return s}},remux:Ms},{demux:class extends Wi{resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=(Q(e,0)||[]).length;for(let i=e.length;t<i;t++)if(fs(e,t))return S.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return hs(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,i){if(null!==this.basePTS)return cs(e,t,i,this.basePTS,this.frameIndex)}},remux:Ms}];class Gs{constructor(e,t,i,s,r){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.vendor=s,this.id=r}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,s){const r=i.transmuxing;r.executeStart=ks();let n=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:o}=this;s&&(this.currentTransmuxState=s);const{contiguous:l,discontinuity:c,trackSwitch:d,accurateTimeOffset:h,timeOffset:u,initSegmentChange:f}=s||a,{audioCodec:p,videoCodec:y,defaultInitPts:T,duration:E,initSegmentData:b}=o,L=function(e,t){let i=null;e.byteLength>0&&null!=t&&null!=t.key&&null!==t.iv&&null!=t.method&&(i=t);return i}(n,t);if(L&&"AES-128"===L.method){const e=this.getDecrypter();if(!e.isSync())return this.decryptionPromise=e.webCryptoDecrypt(n,L.key.buffer,L.iv.buffer).then((e=>{const t=this.push(e,null,i);return this.decryptionPromise=null,t})),this.decryptionPromise;{let t=e.softwareDecrypt(n,L.key.buffer,L.iv.buffer);if(i.part>-1&&(t=e.flush()),!t)return r.executeEnd=ks(),Hs(i);n=new Uint8Array(t)}}const _=this.needsProbing(c,d);if(_){const e=this.configureTransmuxer(n);if(e)return S.warn(`[transmuxer] ${e.message}`),this.observer.emit(g.ERROR,g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),r.executeEnd=ks(),Hs(i)}(c||d||f||_)&&this.resetInitSegment(b,p,y,E,t),(c||f||_)&&this.resetInitialTimestamp(T),l||this.resetContiguity();const w=this.transmux(n,L,u,h,i),A=this.currentTransmuxState;return A.contiguous=!0,A.discontinuity=!1,A.trackSwitch=!1,r.executeEnd=ks(),w}flush(e){const t=e.transmuxing;t.executeStart=ks();const{decrypter:i,currentTransmuxState:s,decryptionPromise:r}=this;if(r)return r.then((()=>this.flush(e)));const n=[],{timeOffset:a}=s;if(i){const t=i.flush();t&&n.push(this.push(t,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l)return t.executeEnd=ks(),[Hs(e)];const c=o.flush(a);return Vs(c)?c.then((t=>(this.flushRemux(n,t,e),n))):(this.flushRemux(n,c,e),n)}flushRemux(e,t,i){const{audioTrack:s,videoTrack:r,id3Track:n,textTrack:a}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;S.log(`[transmuxer.ts]: Flushed fragment ${i.sn}${i.part>-1?" p: "+i.part:""} of level ${i.level}`);const c=this.remuxer.remux(s,r,n,a,l,o,!0,this.id);e.push({remuxResult:c,chunkMeta:i}),i.transmuxing.executeEnd=ks()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;t&&i&&(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,s,r){const{demuxer:n,remuxer:a}=this;n&&a&&(n.resetInitSegment(e,t,i,s),a.resetInitSegment(e,t,i,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,s,r){let n;return n=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,i,s,r):this.transmuxUnencrypted(e,i,s,r),n}transmuxUnencrypted(e,t,i,s){const{audioTrack:r,videoTrack:n,id3Track:a,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,n,a,o,t,i,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,i,s,r){return this.demuxer.demuxSampleAes(e,t,i).then((e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,i,s,!1,this.id),chunkMeta:r})))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:s,vendor:r}=this;let n;for(let d=0,h=$s.length;d<h;d++)if($s[d].demux.probe(e)){n=$s[d];break}if(!n)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,o=this.remuxer,l=n.remux,c=n.demux;o&&o instanceof l||(this.remuxer=new l(i,t,s,r)),a&&a instanceof c||(this.demuxer=new c(i,t,s),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new ki(this.config)),e}}const Hs=e=>({remuxResult:{},chunkMeta:e});function Vs(e){return"then"in e&&e.then instanceof Function}class Ks{constructor(e,t,i,s,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=s,this.defaultInitPts=r||null}}class qs{constructor(e,t,i,s,r,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=s,this.timeOffset=r,this.initSegmentChange=n}}var js={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,i="~";function s(){}function r(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function n(e,t,s,n,a){if("function"!=typeof s)throw new TypeError("The listener must be a function");var o=new r(s,n||e,a),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function o(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),o.prototype.eventNames=function(){var e,s,r=[];if(0===this._eventsCount)return r;for(s in e=this._events)t.call(e,s)&&r.push(i?s.slice(1):s);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},o.prototype.listeners=function(e){var t=i?i+e:e,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var r=0,n=s.length,a=new Array(n);r<n;r++)a[r]=s[r].fn;return a},o.prototype.listenerCount=function(e){var t=i?i+e:e,s=this._events[t];return s?s.fn?1:s.length:0},o.prototype.emit=function(e,t,s,r,n,a){var o=i?i+e:e;if(!this._events[o])return!1;var l,c,d=this._events[o],h=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),h){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,s),!0;case 4:return d.fn.call(d.context,t,s,r),!0;case 5:return d.fn.call(d.context,t,s,r,n),!0;case 6:return d.fn.call(d.context,t,s,r,n,a),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];d.fn.apply(d.context,l)}else{var u,f=d.length;for(c=0;c<f;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),h){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,t);break;case 3:d[c].fn.call(d[c].context,t,s);break;case 4:d[c].fn.call(d[c].context,t,s,r);break;default:if(!l)for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];d[c].fn.apply(d[c].context,l)}}return!0},o.prototype.on=function(e,t,i){return n(this,e,t,i,!1)},o.prototype.once=function(e,t,i){return n(this,e,t,i,!0)},o.prototype.removeListener=function(e,t,s,r){var n=i?i+e:e;if(!this._events[n])return this;if(!t)return a(this,n),this;var o=this._events[n];if(o.fn)o.fn!==t||r&&!o.once||s&&o.context!==s||a(this,n);else{for(var l=0,c=[],d=o.length;l<d;l++)(o[l].fn!==t||r&&!o[l].once||s&&o[l].context!==s)&&c.push(o[l]);c.length?this._events[n]=1===c.length?c[0]:c:a(this,n)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&a(this,t)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,e.exports=o}(js);var Ws=i(js.exports);const Ys=$e()||{isTypeSupported:()=>!1};class zs{constructor(e,t,i,s){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=i,this.onFlush=s;const n=(e,t)=>{(t=t||{}).frag=this.frag,t.id=this.id,e===g.ERROR&&(this.error=t.error),this.hls.trigger(e,t)};this.observer=new Ws,this.observer.on(g.FRAG_DECRYPTED,n),this.observer.on(g.ERROR,n);const a={mp4:Ys.isTypeSupported("video/mp4"),mpeg:Ys.isTypeSupported("audio/mpeg"),mp3:Ys.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor;if(this.useWorker&&"undefined"!=typeof Worker){if(r.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{r.workerPath?(S.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=function(e){const t=new self.URL(e,self.location.href).href;return{worker:new self.Worker(t),scriptURL:t}}(r.workerPath)):(S.log(`injecting Web Worker for "${t}"`),this.workerContext=function(){const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e);return{worker:new self.Worker(t),objectURL:t}}()),this.onwmsg=e=>this.onWorkerMessage(e);const{worker:e}=this.workerContext;e.addEventListener("message",this.onwmsg),e.onerror=e=>{const i=new Error(`${e.message}  (${e.filename}:${e.lineno})`);r.enableWorker=!1,S.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(g.ERROR,{type:m.OTHER_ERROR,details:v.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:i})},e.postMessage({cmd:"init",typeSupported:a,vendor:o,id:t,config:JSON.stringify(r)})}catch(bl){S.warn(`Error setting up "${t}" Web Worker, fallback to inline`,bl),this.resetWorker(),this.error=null,this.transmuxer=new Gs(this.observer,a,r,o,t)}return}}this.transmuxer=new Gs(this.observer,a,r,o,t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,i,s,r,n,a,o,l,c){var d,h;l.transmuxing.start=self.performance.now();const{transmuxer:u}=this,f=n?n.start:r.start,p=r.decryptdata,g=this.frag,m=!(g&&r.cc===g.cc),v=!(g&&l.level===g.level),y=g?l.sn-g.sn:-1,T=this.part?l.part-this.part.index:-1,E=0===y&&l.id>1&&l.id===(null==g?void 0:g.stats.chunkCount),b=!v&&(1===y||0===y&&(1===T||E&&T<=0)),L=self.performance.now();(v||y||0===r.stats.parsing.start)&&(r.stats.parsing.start=L),!n||!T&&b||(n.stats.parsing.start=L);const _=!(g&&(null==(d=r.initSegment)?void 0:d.url)===(null==(h=g.initSegment)?void 0:h.url)),w=new qs(m,b,o,v,f,_);if(!b||m||_){S.log(`[transmuxer-interface, ${r.type}]: Starting new transmux session for sn: ${l.sn} p: ${l.part} level: ${l.level} id: ${l.id}\n        discontinuity: ${m}\n        trackSwitch: ${v}\n        contiguous: ${b}\n        accurateTimeOffset: ${o}\n        timeOffset: ${f}\n        initSegmentChange: ${_}`);const e=new Ks(i,s,t,a,c);this.configureTransmuxer(e)}if(this.frag=r,this.part=n,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:p,chunkMeta:l,state:w},e instanceof ArrayBuffer?[e]:[]);else if(u){const t=u.push(e,p,l,w);Vs(t)?(u.async=!0,t.then((e=>{this.handleTransmuxComplete(e)})).catch((e=>{this.transmuxerError(e,l,"transmuxer-interface push error")}))):(u.async=!1,this.handleTransmuxComplete(t))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let i=t.flush(e);Vs(i)||t.async?(Vs(i)||(i=Promise.resolve(i)),i.then((t=>{this.handleFlushResult(t,e)})).catch((t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")}))):this.handleFlushResult(i,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach((e=>{this.handleTransmuxComplete(e)})),this.onFlush(t)}onWorkerMessage(e){const t=e.data,i=this.hls;switch(t.event){case"init":{var s;const e=null==(s=this.workerContext)?void 0:s.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":S[t.data.logType]&&S[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data)}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class Xs{constructor(e,t,i,s){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=i,this.hls=s}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:i,media:s,stalled:r}=this;if(null===s)return;const{currentTime:n,seeking:a}=s,o=this.seeking&&!a,l=!this.seeking&&a;if(this.seeking=a,n!==e){if(this.moved=!0,null!==r){if(this.stallReported){const e=self.performance.now()-r;S.warn(`playback not stuck anymore @${n}, after ${Math.round(e)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(l||o)return void(this.stalled=null);if(s.paused&&!a||s.ended||0===s.playbackRate||!Ei.getBuffered(s).length)return;const c=Ei.bufferInfo(s,n,0),d=c.len>0,h=c.nextStart||0;if(!d&&!h)return;if(a){const e=c.len>2,i=!h||t&&t.start<=n||h-n>2&&!this.fragmentTracker.getPartialFragment(n);if(e||i)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var u;const e=Math.max(h,c.start||0)-n,t=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,i=(null==t||null==(u=t.details)?void 0:u.live)?2*t.details.targetduration:2,s=this.fragmentTracker.getPartialFragment(n);if(e>0&&(e<=i||s))return void this._trySkipBufferHole(s)}const f=self.performance.now();if(null===r)return void(this.stalled=f);const p=f-r;if(!a&&p>=250&&(this._reportStall(c),!this.media))return;const g=Ei.bufferInfo(s,n,i.maxBufferHole);this._tryFixBufferStall(g,p)}_tryFixBufferStall(e,t){const{config:i,fragmentTracker:s,media:r}=this;if(null===r)return;const n=r.currentTime,a=s.getPartialFragment(n);if(a){if(this._trySkipBufferHole(a)||!this.media)return}(e.len>i.maxBufferHole||e.nextStart&&e.nextStart-n<i.maxBufferHole)&&t>1e3*i.highBufferWatchdogPeriod&&(S.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:i,stallReported:s}=this;if(!s&&i){this.stallReported=!0;const s=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${JSON.stringify(e)})`);S.warn(s.message),t.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_STALLED_ERROR,fatal:!1,error:s,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:i,media:s}=this;if(null===s)return 0;const r=s.currentTime,n=Ei.bufferInfo(s,r,0),a=r<n.start?n.start:n.nextStart;if(a){const o=n.len<=t.maxBufferHole,l=n.len>0&&n.len<1&&s.readyState<3,c=a-r;if(c>0&&(o||l)){if(c>t.maxBufferHole){const{fragmentTracker:t}=this;let i=!1;if(0===r){const e=t.getAppendedFrag(0,ot);e&&a<e.end&&(i=!0)}if(!i){const i=e||t.getAppendedFrag(r,ot);if(i){let e=!1,s=i.end;for(;s<a;){const i=t.getPartialFragment(s);if(!i){e=!0;break}s+=i.duration}if(e)return 0}}}const n=Math.max(a+.05,r+.1);if(S.warn(`skipping hole, adjusting currentTime from ${r} to ${n}`),this.moved=!0,this.stalled=null,s.currentTime=n,e&&!e.gap){const t=new Error(`fragment loaded with buffer holes, seeking from ${r} to ${n}`);i.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:t,reason:t.message,frag:e})}return n}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:i,nudgeRetry:s}=this;if(null===i)return;const r=i.currentTime;if(this.nudgeRetry++,s<e.nudgeMaxRetry){const n=r+(s+1)*e.nudgeOffset,a=new Error(`Nudging 'currentTime' from ${r} to ${n}`);S.warn(a.message),i.currentTime=n,t.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_NUDGE_ON_STALL,error:a,fatal:!1})}else{const i=new Error(`Playhead still not moving while enough data buffered @${r} after ${e.nudgeMaxRetry} nudges`);S.error(i.message),t.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_STALLED_ERROR,error:i,fatal:!0})}}}class Zs extends Ki{constructor(e,t,i){super(e,t,i,"[stream-controller]",ot),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_PARSED,this.onManifestParsed,this),e.on(g.LEVEL_LOADING,this.onLevelLoading,this),e.on(g.LEVEL_LOADED,this.onLevelLoaded,this),e.on(g.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(g.ERROR,this.onError,this),e.on(g.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(g.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(g.BUFFER_CREATED,this.onBufferCreated,this),e.on(g.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(g.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_PARSED,this.onManifestParsed,this),e.off(g.LEVEL_LOADED,this.onLevelLoaded,this),e.off(g.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(g.ERROR,this.onError,this),e.off(g.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(g.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(g.BUFFER_CREATED,this.onBufferCreated,this),e.off(g.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(g.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:i}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=i.startLevel;-1===e&&(i.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=i.nextAutoLevel),this.level=i.nextLoadLevel=e,this.loadedmetadata=!1}t>0&&-1===e&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=Mi,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=Ii}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Vi:{var e;const{levels:t,level:i}=this,s=null==t||null==(e=t[i])?void 0:e.details;if(s&&(!s.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(s))break;this.state=Mi;break}if(this.hls.nextLoadLevel!==this.level){this.state=Mi;break}break}case Fi:{var t;const e=self.performance.now(),i=this.retryDate;(!i||e>=i||null!=(t=this.media)&&t.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=Mi)}}this.state===Mi&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:s}=this,{config:r,nextLoadLevel:n}=e;if(null===t||!s&&(this.startFragRequested||!r.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;if(null==i||!i[n])return;const a=i[n],o=this.getMainFwdBufferInfo();if(null===o)return;const l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){const e={};return this.altAudio&&(e.type="video"),this.hls.trigger(g.BUFFER_EOS,e),void(this.state=$i)}e.loadLevel!==n&&-1===e.manualLevel&&this.log(`Adapting to level ${n} from level ${this.level}`),this.level=e.nextLoadLevel=n;const c=a.details;if(!c||this.state===Vi||c.live&&this.levelLastLoaded!==n)return this.level=n,void(this.state=Vi);const d=o.len,h=this.getMaxBufferLength(a.maxBitrate);if(d>=h)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const u=this.backtrackFragment?this.backtrackFragment.start:o.end;let f=this.getNextFragment(u,c);if(this.couldBacktrack&&!this.fragPrevious&&f&&"initSegment"!==f.sn&&this.fragmentTracker.getState(f)!==li){var p;const e=(null!=(p=this.backtrackFragment)?p:f).sn-c.startSN,t=c.fragments[e-1];t&&f.cc===t.cc&&(f=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,u)){if(!f.gap){const e=this.audioOnly&&!this.altAudio?P:k,t=(e===k?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,ot)}f=this.getNextFragmentLoopLoading(f,c,o,ot,h)}f&&(!f.initSegment||f.initSegment.data||this.bitrateTest||(f=f.initSegment),this.loadFragment(f,a,u))}loadFragment(e,t,i){const s=this.fragmentTracker.getState(e);this.fragCurrent=e,s===ni||s===oi?"initSegment"===e.sn?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,i)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ot)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let i;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const r=this.getLevelDetails();if(null!=r&&r.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*r.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],s=this.fragLastKbps;i=s&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*s)+1:0}else i=0;const n=this.getBufferedFrag(t.currentTime+i);if(n){const e=this.followingBufferedFrag(n);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,i=e.duration,s=Math.max(n.end,t+Math.min(Math.max(i-this.config.maxFragLookUpTolerance,.5*i),.75*i));this.flushMainBuffer(s,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Oi:case xi:case Fi:case Ni:case Ui:this.state=Mi}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new Xs(this.config,i,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;p(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const i=this.getMainFwdBufferInfo();null!==i&&0!==i.len?this.tick():this.warn(`Main forward buffer length on "seeked" event ${i?i.len:"empty"})`)}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(g.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(e,t){let i,s=!1,r=!1;t.levels.forEach((e=>{i=e.audioCodec,i&&(-1!==i.indexOf("mp4a.40.2")&&(s=!0),-1!==i.indexOf("mp4a.40.5")&&(r=!0))})),this.audioCodecSwitch=s&&r&&!function(){var e;const t=qi();return"function"==typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==Mi)return;const s=i[t.level];(!s.details||s.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(s.details))&&(this.state=Vi)}onLevelLoaded(e,t){var i;const{levels:s}=this,r=t.level,n=t.details,a=n.totalduration;if(!s)return void this.warn(`Levels were reset while loading level ${r}`);this.log(`Level ${r} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""}, cc [${n.startCC}, ${n.endCC}] duration:${a}`);const o=s[r],l=this.fragCurrent;!l||this.state!==xi&&this.state!==Fi||l.level===t.level&&l.urlId===o.urlId||!l.loader||this.abortCurrentFrag();let c=0;if(n.live||null!=(i=o.details)&&i.live){if(n.fragments[0]||(n.deltaUpdateFailed=!0),n.deltaUpdateFailed)return;c=this.alignPlaylists(n,o.details)}if(o.details=n,this.levelLastLoaded=r,this.hls.trigger(g.LEVEL_UPDATED,{details:n,level:r}),this.state===Vi){if(this.waitForCdnTuneIn(n))return;this.state=Mi}this.startFragRequested?n.live&&this.synchronizeToLiveEdge(n):this.setStartPosition(n,c),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:i,part:s,payload:r}=e,{levels:n}=this;if(!n)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);const a=n[i.level],o=a.details;if(!o)return this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),void this.fragmentTracker.removeFragment(i);const l=a.videoCodec,c=o.PTSKnown||!o.live,d=null==(t=i.initSegment)?void 0:t.data,h=this._getAudioCodec(a),u=this.transmuxer=this.transmuxer||new zs(this.hls,ot,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=s?s.index:-1,p=-1!==f,g=new bi(i.level,i.sn,i.stats.chunkCount,r.byteLength,f,p),m=this.initPTS[i.cc];u.push(r,d,h,l,i,s,o.totalduration,c,g,m)}onAudioTrackSwitching(e,t){const i=this.altAudio;if(!!!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const e=this.hls;i&&(e.trigger(g.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),e.trigger(g.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=t.id,s=!!this.hls.audioTracks[i].url;if(s){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=s,this.tick()}onBufferCreated(e,t){const i=t.tracks;let s,r,n=!1;for(const a in i){const e=i[a];if("main"===e.id){if(r=a,s=e,"video"===a){const e=i[a];e&&(this.videoBuffer=e.buffer)}}else n=!0}n&&s?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:s}=t;if(i&&i.type!==ot)return;if(this.fragContextChanged(i))return this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===Ui&&(this.state=Mi));const r=s?s.stats:i.stats;this.fragLastKbps=Math.round(8*r.total/(r.buffering.end-r.loading.first)),"initSegment"!==i.sn&&(this.fragPrevious=i),this.fragBufferedComplete(i,s)}onError(e,t){var i;if(t.fatal)this.state=Gi;else switch(t.details){case v.FRAG_GAP:case v.FRAG_PARSING_ERROR:case v.FRAG_DECRYPT_ERROR:case v.FRAG_LOAD_ERROR:case v.FRAG_LOAD_TIMEOUT:case v.KEY_LOAD_ERROR:case v.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ot,t);break;case v.LEVEL_LOAD_ERROR:case v.LEVEL_LOAD_TIMEOUT:case v.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Vi||(null==(i=t.context)?void 0:i.type)!==rt||(this.state=Mi);break;case v.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case v.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}checkBuffer(){const{media:e,gapController:t}=this;if(e&&t&&e.readyState){if(this.loadedmetadata||!Ei.getBuffered(e).length){const e=this.state!==Mi?this.fragCurrent:null;t.poll(this.lastCurrentTime,e)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=Mi,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==P||this.audioOnly&&!this.altAudio){const e=(t===k?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(e,t,ot)}}onLevelsUpdated(e,t){this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking)return void this.log(`could not seek to ${i}, already seeking at ${t}`);const s=Ei.getBuffered(e),r=(s.length?s.start(0):0)-i;r>0&&(r<this.config.maxBufferHole||r<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${r} to match buffer start`),i+=r,this.startPosition=i),this.log(`seek to target start position ${i} from current time ${t}`),e.currentTime=i}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then((i=>{const{hls:s}=this;if(!i||this.fragContextChanged(e))return;t.fragmentError=0,this.state=Mi,this.startFragRequested=!1,this.bitrateTest=!1;const r=e.stats;r.parsing.start=r.parsing.end=r.buffering.start=r.buffering.end=self.performance.now(),s.trigger(g.FRAG_LOADED,i),e.bitrateTest=!1}))}_handleTransmuxComplete(e){var t;const i="main",{hls:s}=this,{remuxResult:r,chunkMeta:n}=e,a=this.getCurrentContext(n);if(!a)return void this.resetWhenMissingContext(n);const{frag:o,part:l,level:c}=a,{video:d,text:h,id3:u,initSegment:f}=r,{details:m}=c,v=this.altAudio?void 0:r.audio;if(this.fragContextChanged(o))this.fragmentTracker.removeFragment(o);else{if(this.state=Ni,f){if(null!=f&&f.tracks){const e=o.initSegment||o;this._bufferInitSegment(c,f.tracks,e,n),s.trigger(g.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:i,tracks:f.tracks})}const e=f.initPTS,t=f.timescale;p(e)&&(this.initPTS[o.cc]={baseTime:e,timescale:t},s.trigger(g.INIT_PTS_FOUND,{frag:o,id:i,initPTS:e,timescale:t}))}if(d&&m&&"initSegment"!==o.sn){const e=m.fragments[o.sn-1-m.startSN],t=o.sn===m.startSN,i=!e||o.cc>e.cc;if(!1!==r.independent){const{startPTS:e,endPTS:s,startDTS:r,endDTS:a}=d;if(l)l.elementaryStreams[d.type]={startPTS:e,endPTS:s,startDTS:r,endDTS:a};else if(d.firstKeyFrame&&d.independent&&1===n.id&&!i&&(this.couldBacktrack=!0),d.dropped&&d.independent){const r=this.getMainFwdBufferInfo(),n=(r?r.end:this.getLoadPosition())+this.config.maxBufferHole,l=d.firstKeyFramePTS?d.firstKeyFramePTS:e;if(!t&&n<l-this.config.maxBufferHole&&!i)return void this.backtrack(o);i&&(o.gap=!0),o.setElementaryStreamInfo(d.type,o.start,s,o.start,a,!0)}o.setElementaryStreamInfo(d.type,e,s,r,a),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(d,o,l,n,t||i)}else{if(!t&&!i)return void this.backtrack(o);o.gap=!0}}if(v){const{startPTS:e,endPTS:t,startDTS:i,endDTS:s}=v;l&&(l.elementaryStreams[P]={startPTS:e,endPTS:t,startDTS:i,endDTS:s}),o.setElementaryStreamInfo(P,e,t,i,s),this.bufferFragmentData(v,o,l,n)}if(m&&null!=u&&null!=(t=u.samples)&&t.length){const e={id:i,frag:o,details:m,samples:u.samples};s.trigger(g.FRAG_PARSING_METADATA,e)}if(m&&h){const e={id:i,frag:o,details:m,samples:h.samples};s.trigger(g.FRAG_PARSING_USERDATA,e)}}}_bufferInitSegment(e,t,i,s){if(this.state!==Ni)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:r,video:n,audiovideo:a}=t;if(r){let t=e.audioCodec;const i=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==r.metadata.channelCount&&-1===i.indexOf("firefox")&&(t="mp4a.40.5")),-1!==i.indexOf("android")&&"audio/mpeg"!==r.container&&(t="mp4a.40.2",this.log(`Android: force audio codec to ${t}`)),e.audioCodec&&e.audioCodec!==t&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${t}"`),r.levelCodec=t,r.id="main",this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${t||""}/${e.audioCodec||""}/${r.codec}]`)}n&&(n.levelCodec=e.videoCodec,n.id="main",this.log(`Init video buffer, container:${n.container}, codecs[level/parsed]=[${e.videoCodec||""}/${n.codec}]`)),a&&this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.attrs.CODECS||""}/${a.codec}]`),this.hls.trigger(g.BUFFER_CODECS,t),Object.keys(t).forEach((e=>{const r=t[e].initSegment;null!=r&&r.byteLength&&this.hls.trigger(g.BUFFER_APPENDING,{type:e,data:r,frag:i,part:null,chunkMeta:s,parent:i.type})})),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,ot)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Mi}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const i=e.currentTime;if(Ei.isBuffered(e,i)?t=this.getAppendedFrag(i):Ei.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,i=t.level;e&&t.sn===e.sn&&e.level===i&&t.urlId===e.urlId||(this.fragPlaying=t,this.hls.trigger(g.FRAG_CHANGED,{frag:t}),e&&e.level===i||this.hls.trigger(g.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,i=this.currentFrag;if(i&&p(t)&&p(i.programDateTime)){const e=i.programDateTime+1e3*(t-i.start);return new Date(e)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Qs{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Js{constructor(e,t,i,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Qs(e),this.fast_=new Qs(t),this.defaultTTFB_=s,this.ttfb_=new Qs(e)}update(e,t){const{slow_:i,fast_:s,ttfb_:r}=this;i.halfLife!==e&&(this.slow_=new Qs(e,i.getEstimate(),i.getTotalWeight())),s.halfLife!==t&&(this.fast_=new Qs(t,s.getEstimate(),s.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new Qs(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){const i=(e=Math.max(e,this.minDelayMs_))/1e3,s=8*t/i;this.fast_.sample(i,s),this.slow_.sample(i,s)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class er{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;return e.length?(i=1===e.length?e[0]:function(e,t){const i=new Uint8Array(t);let s=0;for(let r=0;r<e.length;r++){const t=e[r];i.set(t,s),s+=t.length}return i}(e,t),this.reset(),i):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}function tr(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!ir(e[i].attrs,t[i].attrs))return!1;return!0}function ir(e,t){const i=e["STABLE-RENDITION-ID"];return i?i===t["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some((i=>e[i]!==t[i]))}class sr{constructor(e){this.buffered=void 0;const t=(t,i,s)=>{if((i>>>=0)>s-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${s})`);return e[i][t]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}}function rr(e){const t=[];for(let i=0;i<e.length;i++){const s=e[i];"subtitles"!==s.kind&&"captions"!==s.kind||!s.label||t.push(e[i])}return t}class nr{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t){const i=this.queues[t];i.push(e),1===i.length&&this.buffers[t]&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const i=new Promise((e=>{t=e})),s={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(s,e),i}executeNext(e){const{buffers:t,queues:i}=this,s=t[e],r=i[e];if(r.length){const t=r[0];try{t.execute()}catch(n){S.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),t.onError(n),null!=s&&s.updating||(r.shift(),this.executeNext(e))}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const ar=$e(),or=/([ha]vc.)(?:\.[^.,]+)+/;const lr={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},cr=function(e){let t=e;return lr.hasOwnProperty(e)&&(t=lr[e]),String.fromCharCode(t)},dr=15,hr=100,ur={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},fr={17:2,18:4,21:6,22:8,23:10,19:13,20:15},pr={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},gr={25:2,26:4,29:6,30:8,31:10,27:13,28:15},mr=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class vr{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i="function"==typeof t?t():t;S.log(`${this.time} [${e}] ${i}`)}}}const yr=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class Tr{constructor(e,t,i,s,r){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=i||!1,this.background=s||"black",this.flash=r||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const s=t[i];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Er{constructor(e,t,i,s,r,n){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new Tr(t,i,s,r,n)}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class br{constructor(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let t=0;t<hr;t++)this.chars.push(new Er);this.logger=e,this.pos=0,this.currPenState=new Tr}equals(e){let t=!0;for(let i=0;i<hr;i++)if(!this.chars[i].equals(e.chars[i])){t=!1;break}return t}copy(e){for(let t=0;t<hr;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<hr;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>hr&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=hr)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=cr(e);this.pos>=hr?this.logger.log(0,(()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!")):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<hr;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<hr;i++){const s=this.chars[i].uchar;" "!==s&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);this.chars[this.pos].setPenState(this.currPenState)}}class Sr{constructor(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let t=0;t<dr;t++)this.rows.push(new br(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let e=0;e<dr;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let i=0;i<dr;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<dr;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<dr;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,(()=>"pacData = "+JSON.stringify(e)));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let t=0;t<dr;t++)this.rows[t].clear();const e=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){const s=i.rows[e].cueStartTime,r=this.logger.time;if(s&&null!==r&&s<r)for(let n=0;n<this.nrRollUpRows;n++)this.rows[t-this.nrRollUpRows+n+1].copy(i.rows[e+n])}}this.currRow=t;const i=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,s=Math.max(t-1,0);i.setCursor(e.indent),e.color=i.chars[s].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,(()=>"bkgData = "+JSON.stringify(e))),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,(()=>this.getDisplayText()));const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",s=-1;for(let r=0;r<dr;r++){const i=this.rows[r].getTextString();i&&(s=r+1,e?t.push("Row "+s+": '"+i+"'"):t.push(i.trim()))}return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join("\n")),i}getTextAndFormat(){return this.rows}}class Lr{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Sr(i),this.nonDisplayedMemory=new Sr(i),this.lastOutputScreen=new Sr(i),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,(()=>"MODE="+e)),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(()=>t+": "+this.writeScreen.getDisplayText(!0))),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0))),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(()=>"DISP: "+this.displayedMemory.getDisplayText()))}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[i]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class _r{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;const s=new vr;this.channels=[null,new Lr(e,t,s),new Lr(e+1,i,s)],this.cmdHistory={a:null,b:null},this.logger=s}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){let i,s,r,n=!1;this.logger.time=e;for(let a=0;a<t.length;a+=2)if(s=127&t[a],r=127&t[a+1],0!==s||0!==r){if(this.logger.log(3,"["+yr([t[a],t[a+1]])+"] -> ("+yr([s,r])+")"),i=this.parseCmd(s,r),i||(i=this.parseMidrow(s,r)),i||(i=this.parsePAC(s,r)),i||(i=this.parseBackgroundAttributes(s,r)),!i&&(n=this.parseChars(s,r),n)){const e=this.currentChannel;if(e&&e>0){this.channels[e].insertChars(n)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}i||n||this.logger.log(2,"Couldn't parse cleaned data "+yr([s,r])+" orig: "+yr([t[a],t[a+1]]))}}parseCmd(e,t){const{cmdHistory:i}=this;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;if(Ar(e,t,i))return wr(null,null,i),this.logger.log(3,"Repeated command ("+yr([e,t])+") is dropped"),!0;const s=20===e||21===e||23===e?1:2,r=this.channels[s];return 20===e||21===e||28===e||29===e?32===t?r.ccRCL():33===t?r.ccBS():34===t?r.ccAOF():35===t?r.ccAON():36===t?r.ccDER():37===t?r.ccRU(2):38===t?r.ccRU(3):39===t?r.ccRU(4):40===t?r.ccFON():41===t?r.ccRDC():42===t?r.ccTR():43===t?r.ccRTD():44===t?r.ccEDM():45===t?r.ccCR():46===t?r.ccENM():47===t&&r.ccEOC():r.ccTO(t-32),wr(e,t,i),this.currentChannel=s,!0}parseMidrow(e,t){let i=0;if((17===e||25===e)&&t>=32&&t<=47){if(i=17===e?1:2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[i];return!!s&&(s.ccMIDROW(t),this.logger.log(3,"MIDROW ("+yr([e,t])+")"),!0)}return!1}parsePAC(e,t){let i;const s=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;if(Ar(e,t,s))return wr(null,null,s),!0;const r=e<=23?1:2;i=t>=64&&t<=95?1===r?ur[e]:pr[e]:1===r?fr[e]:gr[e];const n=this.channels[r];return!!n&&(n.setPAC(this.interpretPAC(i,t)),wr(e,t,s),this.currentChannel=r,!0)}interpretPAC(e,t){let i;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return i=t>95?t-96:t-64,s.underline=1==(1&i),i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=4*Math.floor((i-16)/2),s}parseChars(e,t){let i,s=null,r=null;if(e>=25?(i=2,r=e-8):(i=1,r=e),r>=17&&r<=19){let e;e=17===r?t+80:18===r?t+112:t+144,this.logger.log(2,"Special char '"+cr(e)+"' in channel "+i),s=[e]}else e>=32&&e<=127&&(s=0===t?[e]:[e,t]);if(s){const i=yr(s);this.logger.log(3,"Char codes =  "+i.join(",")),wr(e,t,this.cmdHistory)}return s}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;let i;const s={};16===e||24===e?(i=Math.floor((t-32)/2),s.background=mr[i],t%2==1&&(s.background=s.background+"_semi")):45===t?s.background="transparent":(s.foreground="black",47===t&&(s.underline=!0));const r=e<=23?1:2;return this.channels[r].setBkgData(s),wr(e,t,this.cmdHistory),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function wr(e,t,i){i.a=e,i.b=t}function Ar(e,t,i){return i.a===e&&i.b===t}class Rr{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var Cr=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function i(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;const i=t.toLowerCase();return!!~e.indexOf(i)&&i}function s(e){return i(t,e)}function r(e,...t){let i=1;for(;i<arguments.length;i++){const t=arguments[i];for(const i in t)e[i]=t[i]}return e}function n(t,n,a){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let c="",d=!1,h=t,u=n,f=a,p=null,g="",m=!0,v="auto",y="start",T=50,E="middle",b=50,S="middle";Object.defineProperty(o,"id",r({},l,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(o,"pauseOnExit",r({},l,{get:function(){return d},set:function(e){d=!!e}})),Object.defineProperty(o,"startTime",r({},l,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",r({},l,{get:function(){return u},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");u=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",r({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",r({},l,{get:function(){return p},set:function(e){p=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",r({},l,{get:function(){return g},set:function(t){const s=function(t){return i(e,t)}(t);if(!1===s)throw new SyntaxError("An invalid or illegal string was specified.");g=s,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",r({},l,{get:function(){return m},set:function(e){m=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",r({},l,{get:function(){return v},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",r({},l,{get:function(){return y},set:function(e){const t=s(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",r({},l,{get:function(){return T},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");T=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",r({},l,{get:function(){return E},set:function(e){const t=s(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",r({},l,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",r({},l,{get:function(){return S},set:function(e){const t=s(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");S=t,this.hasBeenReset=!0}})),o.displayState=void 0}return n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},n}();class Pr{decode(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function kr(e){function t(e,t,i,s){return 3600*(0|e)+60*(0|t)+(0|i)+parseFloat(s||0)}const i=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return i?parseFloat(i[2])>59?t(i[2],i[3],0,i[4]):t(i[1],i[2],i[3],i[4]):null}class Dr{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let s=0;s<i.length;++s)if(t===i[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function Ir(e,t,i,s){const r=s?e.split(s):[e];for(const n in r){if("string"!=typeof r[n])continue;const e=r[n].split(i);if(2!==e.length)continue;t(e[0],e[1])}}const Mr=new Cr(0,0,""),Or="middle"===Mr.align?"middle":"center";function xr(e,t,i){const s=e;function r(){const t=kr(e);if(null===t)throw new Error("Malformed timestamp: "+s);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function n(){e=e.replace(/^\s+/,"")}if(n(),t.startTime=r(),n(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+s);e=e.slice(3),n(),t.endTime=r(),n(),function(e,t){const s=new Dr;Ir(e,(function(e,t){let r;switch(e){case"region":for(let r=i.length-1;r>=0;r--)if(i[r].id===t){s.set(e,i[r].region);break}break;case"vertical":s.alt(e,t,["rl","lr"]);break;case"line":r=t.split(","),s.integer(e,r[0]),s.percent(e,r[0])&&s.set("snapToLines",!1),s.alt(e,r[0],["auto"]),2===r.length&&s.alt("lineAlign",r[1],["start",Or,"end"]);break;case"position":r=t.split(","),s.percent(e,r[0]),2===r.length&&s.alt("positionAlign",r[1],["start",Or,"end","line-left","line-right","auto"]);break;case"size":s.percent(e,t);break;case"align":s.alt(e,t,["start",Or,"end","left","right"])}}),/:/,/\s/),t.region=s.get("region",null),t.vertical=s.get("vertical","");let r=s.get("line","auto");"auto"===r&&-1===Mr.line&&(r=-1),t.line=r,t.lineAlign=s.get("lineAlign","start"),t.snapToLines=s.get("snapToLines",!0),t.size=s.get("size",100),t.align=s.get("align",Or);let n=s.get("position","auto");"auto"===n&&50===Mr.position&&(n="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=n}(e,t)}function Fr(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class Br{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Pr,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function i(){let e=t.buffer,i=0;for(e=Fr(e);i<e.length&&"\r"!==e[i]&&"\n"!==e[i];)++i;const s=e.slice(0,i);return"\r"===e[i]&&++i,"\n"===e[i]&&++i,t.buffer=e.slice(i),s}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=i();const s=e.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(null==s||!s[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let r=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:e=i(),t.state){case"HEADER":/:/.test(e)?Ir(e,(function(e,t){}),/:/):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new Cr(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{xr(e,t.cue,t.regionList)}catch(s){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const i=-1!==e.indexOf("--\x3e");if(!e||i&&(r=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(s){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const Nr=/\r\n|\n\r|\n|\r/g,Ur=function(e,t,i=0){return e.slice(i,i+t.length)===t},$r=function(e){let t=5381,i=e.length;for(;i;)t=33*t^e.charCodeAt(--i);return(t>>>0).toString()};function Gr(e,t,i){return $r(e.toString())+$r(t.toString())+$r(i)}function Hr(e,t,i,s,r,n,a){const o=new Br,l=ce(new Uint8Array(e)).trim().replace(Nr,"\n").split("\n"),c=[],d=t?function(e,t=1){return Cs(e,Rs,1/t)}(t.baseTime,t.timescale):0;let h,u="00:00.000",f=0,g=0,m=!0;o.oncue=function(e){const n=i[s];let a=i.ccOffset;const o=(f-d)/9e4;if(null!=n&&n.new&&(void 0!==g?a=i.ccOffset=n.start:function(e,t,i){let s=e[t],r=e[s.prevCC];if(!r||!r.new&&s.new)return e.ccOffset=e.presentationOffset=s.start,void(s.new=!1);for(;null!=(n=r)&&n.new;){var n;e.ccOffset+=s.start-r.start,s.new=!1,s=r,r=e[s.prevCC]}e.presentationOffset=i}(i,s,o)),o){if(!t)return void(h=new Error("Missing initPTS for VTT MPEGTS"));a=o-i.presentationOffset}const l=e.endTime-e.startTime,u=Os(9e4*(e.startTime+a-g),9e4*r)/9e4;e.startTime=Math.max(u,0),e.endTime=Math.max(u+l,0);const p=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(p)),e.id||(e.id=Gr(e.startTime,e.endTime,p)),e.endTime>0&&c.push(e)},o.onparsingerror=function(e){h=e},o.onflush=function(){h?a(h):n(c)},l.forEach((e=>{if(m){if(Ur(e,"X-TIMESTAMP-MAP=")){m=!1,e.slice(16).split(",").forEach((e=>{Ur(e,"LOCAL:")?u=e.slice(6):Ur(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))}));try{g=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(p(t)&&p(i)&&p(s)&&p(r)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=6e4*s,t+=36e5*r,t}(u)/1e3}catch(t){h=t}return}""===e&&(m=!1)}o.parse(e+"\n")})),o.flush()}const Vr="stpp.ttml.im1t",Kr=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,qr=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,jr={left:"start",center:"center",right:"end",start:"start",end:"end"};function Wr(e,t,i,s){const r=be(new Uint8Array(e),["mdat"]);if(0===r.length)return void s(new Error("Could not parse IMSC1 mdat"));const n=r.map((e=>ce(e))),a=function(e,t,i=1,s=!1){return Cs(e,t,1/i,s)}(t.baseTime,1,t.timescale);try{n.forEach((e=>i(function(e,t){const i=(new DOMParser).parseFromString(e,"text/xml"),s=i.getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},n=Object.keys(r).reduce(((e,t)=>(e[t]=s.getAttribute(`ttp:${t}`)||r[t],e)),{}),a="preserve"!==s.getAttribute("xml:space"),o=zr(Yr(s,"styling","style")),l=zr(Yr(s,"layout","region")),c=Yr(s,"body","[begin]");return[].map.call(c,(e=>{const i=Xr(e,a);if(!i||!e.hasAttribute("begin"))return null;const s=Jr(e.getAttribute("begin"),n),r=Jr(e.getAttribute("dur"),n);let c=Jr(e.getAttribute("end"),n);if(null===s)throw Qr(e);if(null===c){if(null===r)throw Qr(e);c=s+r}const d=new Cr(s-t,c-t,i);d.id=Gr(d.startTime,d.endTime,d.text);const h=function(e,t,i){const s="http://www.w3.org/ns/ttml#styling";let r=null;const n=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;a&&i.hasOwnProperty(a)&&(r=i[a]);return n.reduce(((i,n)=>{const a=Zr(t,s,n)||Zr(e,s,n)||Zr(r,s,n);return a&&(i[n]=a),i}),{})}(l[e.getAttribute("region")],o[e.getAttribute("style")],o),{textAlign:u}=h;if(u){const e=jr[u];e&&(d.lineAlign=e),d.align=u}return f(d,h),d})).filter((e=>null!==e))}(e,a))))}catch(o){s(o)}}function Yr(e,t,i){const s=e.getElementsByTagName(t)[0];return s?[].slice.call(s.querySelectorAll(i)):[]}function zr(e){return e.reduce(((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e}),{})}function Xr(e,t){return[].slice.call(e.childNodes).reduce(((e,i,s)=>{var r;return"br"===i.nodeName&&s?e+"\n":null!=(r=i.childNodes)&&r.length?Xr(i,t):t?e+i.textContent.trim().replace(/\s+/g," "):e+i.textContent}),"")}function Zr(e,t,i){return e&&e.hasAttributeNS(t,i)?e.getAttributeNS(t,i):null}function Qr(e){return new Error(`Could not parse ttml timestamp ${e}`)}function Jr(e,t){if(!e)return null;let i=kr(e);return null===i&&(Kr.test(e)?i=function(e,t){const i=Kr.exec(e),s=(0|i[4])+(0|i[5])/t.subFrameRate;return 3600*(0|i[1])+60*(0|i[2])+(0|i[3])+s/t.frameRate}(e,t):qr.test(e)&&(i=function(e,t){const i=qr.exec(e),s=Number(i[1]);switch(i[2]){case"h":return 3600*s;case"m":return 60*s;case"ms":return 1e3*s;case"f":return s/t.frameRate;case"t":return s/t.tickRate}return s}(e,t))),i}function en(e,t){return!!e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}class tn{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(g.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(g.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(g.MANIFEST_PARSED,this.onManifestParsed,this),e.on(g.BUFFER_CODECS,this.onBufferCodecs,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(g.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(g.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(g.MANIFEST_PARSED,this.onManifestParsed,this),e.off(g.BUFFER_CODECS,this.onBufferCodecs,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){const e=this.hls.levels;if(e.length){const t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter(((t,i)=>this.isLevelAllowed(t)&&i<=e));return this.clientRect=null,tn.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,t.width||t.height||(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(t){}return e}isLevelAllowed(e){return!this.restrictedLevels.some((t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height))}static getMaxLevelByMediaSize(e,t,i){if(null==e||!e.length)return-1;let s=e.length-1;for(let a=0;a<e.length;a+=1){const o=e[a];if((o.width>=t||o.height>=i)&&(r=o,!(n=e[a+1])||r.width!==n.width||r.height!==n.height)){s=a;break}}var r,n;return s}}const sn="[eme]";class rn{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=rn.CDMCleanupPromise?[rn.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=S.debug.bind(S,sn),this.log=S.log.bind(S,sn),this.warn=S.warn.bind(S,sn),this.error=S.error.bind(S,sn),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(g.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(g.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(g.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(g.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(g.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(g.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,s=t[e];if(s)return s.licenseUrl;if(e===U.WIDEVINE&&i)return i;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(e,t,i)=>!!e&&i.indexOf(e)===t,s=t.map((e=>e.audioCodec)).filter(i),r=t.map((e=>e.videoCodec)).filter(i);return s.length+r.length===0&&r.push("avc1.42e01e"),new Promise(((t,i)=>{const n=e=>{const a=e.shift();this.getMediaKeysPromise(a,s,r).then((e=>t({keySystem:a,mediaKeys:e}))).catch((t=>{e.length?n(e):i(t instanceof nn?t:new nn({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))}))};n(e)}))}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if("function"!=typeof i){let e=`Configured requestMediaKeySystemAccess is not a function ${i}`;return null===Y&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(e))}return i(e,t)}getMediaKeysPromise(e,t,i){const s=function(e,t,i,s){let r;switch(e){case U.FAIRPLAY:r=["cenc","sinf"];break;case U.WIDEVINE:case U.PLAYREADY:r=["cenc"];break;case U.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${e}`)}return function(e,t,i,s){return[{initDataTypes:e,persistentState:s.persistentState||"not-allowed",distinctiveIdentifier:s.distinctiveIdentifier||"not-allowed",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:t.map((e=>({contentType:`audio/mp4; codecs="${e}"`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null}))),videoCapabilities:i.map((e=>({contentType:`video/mp4; codecs="${e}"`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null})))}]}(r,t,i,s)}(e,t,i,this.config.drmSystemOptions),r=this.keySystemAccessPromises[e];let n=null==r?void 0:r.keySystemAccess;if(!n){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(s)}`),n=this.requestMediaKeySystemAccess(e,s);const t=this.keySystemAccessPromises[e]={keySystemAccess:n};return n.catch((t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)})),n.then((i=>{this.log(`Access for key-system "${i.keySystem}" obtained`);const s=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),t.mediaKeys=i.createMediaKeys().then((t=>(this.log(`Media-keys created for "${e}"`),s.then((i=>i?this.setMediaKeysServerCertificate(t,e,i):t))))),t.mediaKeys.catch((t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)})),t.mediaKeys}))}return n.then((()=>r.mediaKeys))}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${ue(e.keyId||[])}`);const s=i.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),s=this.getKeyIdString(t),r="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(i,r,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return ue(e.keyId)}updateKeySession(e,t){var i;const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyID ${ue((null==(i=e.decryptdata)?void 0:i.keyId)||[])}\n      } (data length: ${t?t.byteLength:t})`),s.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise(((t,i)=>{const s=W(this.config),r=e.map(K).filter((e=>!!e&&-1!==s.indexOf(e)));return this.getKeySystemSelectionPromise(r).then((({keySystem:e})=>{const s=j(e);s?t(s):i(new Error(`Unable to find format for key-system "${e}"`))})).catch(i)}))}loadKey(e){const t=e.keyInfo.decryptdata,i=this.getKeyIdString(t),s=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);let r=this.keyIdToKeySessionPromise[i];return r||(r=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(t).then((({keySystem:i,mediaKeys:r})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(i,r).then((()=>{this.throwIfDestroyed();const e=this.createMediaKeySessionContext({keySystem:i,mediaKeys:r,decryptdata:t});return this.generateRequestWithPreferredKeySession(e,"cenc",t.pssh,"playlist-key")}))))),r.catch((e=>this.handleError(e)))),r}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof nn?this.hls.trigger(g.ERROR,e.data):this.hls.trigger(g.ERROR,{type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){const t=K(e.keyFormat),i=t?[t]:W(this.config);return this.attemptKeySystemAccess(i)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=W(this.config)),0===e.length)throw new nn({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){const{initDataType:t,initData:i}=e;if(this.debug(`"${e.type}" event: init data type: "${t}"`),null===i)return;let s,r;if("sinf"===t&&this.config.drmSystems[U.FAIRPLAY]){const e=me(new Uint8Array(i));try{const t=F(JSON.parse(e).sinf),i=_e(new Uint8Array(t));if(!i)return;s=i.subarray(8,24),r=U.FAIRPLAY}catch(c){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{const e=function(e){if(!(e instanceof ArrayBuffer)||e.byteLength<32)return null;const t={version:0,systemId:"",kids:null,data:null},i=new DataView(e),s=i.getUint32(0);if(e.byteLength!==s&&s>44)return null;if(1886614376!==i.getUint32(4))return null;if(t.version=i.getUint32(8)>>>24,t.version>1)return null;t.systemId=ue(new Uint8Array(e,12,16));const r=i.getUint32(28);if(0===t.version){if(s-32<r)return null;t.data=new Uint8Array(e,32,r)}else if(1===t.version){t.kids=[];for(let i=0;i<r;i++)t.kids.push(new Uint8Array(e,32+16*i,16))}return t}(i);if(null===e)return;0===e.version&&e.systemId===q&&e.data&&(s=e.data.subarray(8,24)),r=function(e){if(e===q)return U.WIDEVINE}(e.systemId)}if(!r||!s)return;const n=ue(s),{keyIdToKeySessionPromise:a,mediaKeySessions:o}=this;let l=a[n];for(let d=0;d<o.length;d++){const e=o[d],r=e.decryptdata;if(r.pssh||!r.keyId)continue;const c=ue(r.keyId);if(n===c||-1!==r.uri.replace(/-/g,"").indexOf(n)){l=a[c],delete a[c],r.pssh=new Uint8Array(i),r.keyId=s,l=a[n]=l.then((()=>this.generateRequestWithPreferredKeySession(e,t,i,"encrypted-event-key-match")));break}}l||(l=a[n]=this.getKeySystemSelectionPromise([r]).then((({keySystem:e,mediaKeys:r})=>{var a;this.throwIfDestroyed();const o=new Me("ISO-23001-7",n,null!=(a=j(e))?a:"");return o.pssh=new Uint8Array(i),o.keyId=s,this.attemptSetMediaKeys(e,r).then((()=>{this.throwIfDestroyed();const s=this.createMediaKeySessionContext({decryptdata:o,keySystem:e,mediaKeys:r});return this.generateRequestWithPreferredKeySession(s,t,i,"encrypted-event-no-match")}))}))),l.catch((e=>this.handleError(e)))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(i).then((()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)}));return this.setMediaKeysQueue.push(s),s.then((()=>{this.log(`Media-keys set for "${e}"`),i.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter((e=>-1===i.indexOf(e)))}))}generateRequestWithPreferredKeySession(e,t,i,s){var r,n;const a=null==(r=this.config.drmSystems)||null==(n=r[e.keySystem])?void 0:n.generateRequest;if(a)try{const s=a.call(this.hls,t,i,e);if(!s)throw new Error("Invalid response from configured generateRequest filter");t=s.initDataType,i=e.decryptdata.pssh=s.initData?new Uint8Array(s.initData):null}catch(h){var o;if(this.warn(h.message),null!=(o=this.hls)&&o.config.debug)throw h}if(null===i)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${s}": ${l} (init data type: ${t} length: ${i?i.byteLength:null})`);const c=new Ws;e.mediaKeysSession.onmessage=t=>{const i=e.mediaKeysSession;if(!i)return void c.emit("error",new Error("invalid state"));const{messageType:s,message:r}=t;this.log(`"${s}" message event for session "${i.sessionId}" message size: ${r.byteLength}`),"license-request"===s||"license-renewal"===s?this.renewLicense(e,r).catch((e=>{this.handleError(e),c.emit("error",e)})):"license-release"===s?e.keySystem===U.FAIRPLAY&&(this.updateKeySession(e,N("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${s}"`)},e.mediaKeysSession.onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void c.emit("error",new Error("invalid state"));this.onKeyStatusChange(e);const i=e.keyStatus;c.emit("keyStatus",i),"expired"===i&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))};const d=new Promise(((e,t)=>{c.on("error",t),c.on("keyStatus",(i=>{i.startsWith("usable")?e():"output-restricted"===i?t(new nn({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===i?t(new nn({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${i}"`)):"expired"===i?t(new Error("key expired while generating request")):this.warn(`unhandled key status change "${i}"`)}))}));return e.mediaKeysSession.generateRequest(t,i).then((()=>{var t;this.log(`Request generated for key-session "${null==(t=e.mediaKeysSession)?void 0:t.sessionId}" keyId: ${l}`)})).catch((e=>{throw new nn({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},`Error generating key-session request: ${e}`)})).then((()=>d)).catch((t=>{throw c.removeAllListeners(),this.removeSession(e),t})).then((()=>(c.removeAllListeners(),e)))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach(((t,i)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${ue("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${ue(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t}))}fetchServerCertificate(e){const t=this.config,i=new(0,t.loader)(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching serverCertificate for "${e}"`),new Promise(((r,n)=>{const a={responseType:"arraybuffer",url:s},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,i,s)=>{r(e.data)},onError:(t,i,r,o)=>{n(new nn({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:h({url:a.url,data:void 0},t)},`"${e}" certificate request failed (${s}). Status: ${t.code} (${t.text})`))},onTimeout:(t,i,r)=>{n(new nn({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:{url:a.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(e,t,i)=>{n(new Error("aborted"))}};i.load(a,l,c)}))):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise(((s,r)=>{e.setServerCertificate(i).then((r=>{this.log(`setServerCertificate ${r?"success":"not supported by CDM"} (${null==i?void 0:i.byteLength}) on "${t}"`),s(e)})).catch((e=>{r(new nn({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))}))}))}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then((t=>this.updateKeySession(e,new Uint8Array(t)).catch((e=>{throw new nn({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))))}setupLicenseXHR(e,t,i,s){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then((()=>{if(!i.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,i,s)})).catch((n=>{if(!i.decryptdata)throw n;return e.open("POST",t,!0),r.call(this.hls,e,t,i,s)})).then((i=>{e.readyState||e.open("POST",t,!0);return{xhr:e,licenseChallenge:i||s}})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise(((s,r)=>{const n=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${n}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(4===a.readyState)if(200===a.status){this._requestLicenseFailureCount=0;let t=a.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);const i=this.config.licenseResponseCallback;if(i)try{t=i.call(this.hls,a,n,e)}catch(o){this.error(o)}s(t)}else{const o=i.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||a.status>=400&&a.status<500)r(new nn({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:n,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${n}). Status: ${a.status} (${a.statusText})`));else{const i=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${i} attempts left`),this.requestLicense(e,t).then(s,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,n,e,t).then((({xhr:e,licenseChallenge:t})=>{e.send(t)}))}))}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Me.clearKeyUriToKeyIdMap();const i=t.length;rn.CDMCleanupPromise=Promise.all(t.map((e=>this.removeSession(e))).concat(null==e?void 0:e.setMediaKeys(null).catch((t=>{this.log(`Could not clear media keys: ${t}. media.src: ${null==e?void 0:e.src}`)})))).then((()=>{i&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)})).catch((t=>{this.log(`Could not close sessions and clear media keys: ${t}. media.src: ${null==e?void 0:e.src}`)}))}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){const e=t.reduce(((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e)),[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),t.onmessage=null,t.onkeystatuseschange=null,i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);return s>-1&&this.mediaKeySessions.splice(s,1),t.remove().catch((e=>{this.log(`Could not remove session: ${e}`)})).then((()=>t.close())).catch((e=>{this.log(`Could not close session: ${e}`)}))}}}rn.CDMCleanupPromise=void 0;class nn extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}var an="m",on="a",ln="v",cn="av",dn="i",hn="tt";class un{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:an,su:!this.initialized})}catch(t){S.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=e=>{try{const t=e.frag,i=this.hls.levels[t.level],s=this.getObjectType(t),r={d:1e3*t.duration,ot:s};s!==ln&&s!==on&&s!=cn||(r.br=i.bitrate/1e3,r.tb=this.getTopBandwidth(s)/1e3,r.bl=this.getBufferLength(s)),this.apply(e,r)}catch(t){S.warn("Could not generate segment CMCD data.",t)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;null!=i&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||un.uuid(),this.cid=i.contentId,this.useHeaders=!0===i.useHeaders,this.registerListeners())}registerListeners(){const e=this.hls;e.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(g.MEDIA_DETACHED,this.onMediaDetached,this),e.on(g.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(g.MEDIA_DETACHED,this.onMediaDetached,this),e.off(g.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,s;this.audioBuffer=null==(i=t.tracks.audio)?void 0:i.buffer,this.videoBuffer=null==(s=t.tracks.video)?void 0:s.buffer}createData(){var e;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){f(t,this.createData());const i=t.ot===dn||t.ot===ln||t.ot===cn;if(this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering),this.useHeaders){const i=un.toHeaders(t);if(!Object.keys(i).length)return;e.headers||(e.headers={}),f(e.headers,i)}else{const i=un.toQuery(t);if(!i)return;e.url=un.appendQueryToUri(e.url,i)}}getObjectType(e){const{type:t}=e;return"subtitle"===t?hn:"initSegment"===e.sn?dn:"audio"===t?on:"main"===t?this.hls.audioTracks.length?ln:cn:void 0}getTopBandwidth(e){let t,i=0;const s=this.hls;if(e===on)t=s.audioTracks;else{const e=s.maxAutoLevel,i=e>-1?e+1:s.levels.length;t=s.levels.slice(0,i)}for(const r of t)r.bitrate>i&&(i=r.bitrate);return i>0?i:NaN}getBufferLength(e){const t=this.hls.media,i=e===on?this.audioBuffer:this.videoBuffer;if(!i||!t)return NaN;return 1e3*Ei.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new i(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,i,s){t(e),this.loader.load(e,i,s)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new i(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,i,s){t(e),this.loader.load(e,i,s)}}}static uuid(){const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}static serialize(e){const t=[],i=e=>!Number.isNaN(e)&&null!=e&&""!==e&&!1!==e,s=e=>Math.round(e),r=e=>100*s(e/100),n={br:s,d:s,bl:r,dl:r,mtp:r,nor:e=>encodeURIComponent(e),rtp:r,tb:s},a=Object.keys(e||{}).sort();for(const o of a){let s=e[o];if(!i(s))continue;if("v"===o&&1===s)continue;if("pr"==o&&1===s)continue;const r=n[o];r&&(s=r(s));const a=typeof s;let l;l="ot"===o||"sf"===o||"st"===o?`${o}=${s}`:"boolean"===a?o:"number"===a?`${o}=${s}`:`${o}=${JSON.stringify(s)}`,t.push(l)}return t.join(",")}static toHeaders(e){const t=Object.keys(e),i={},s=["Object","Request","Session","Status"],r=[{},{},{},{}],n={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(const a of t){r[null!=n[a]?n[a]:1][a]=e[a]}for(let a=0;a<r.length;a++){const e=un.serialize(r[a]);e&&(i[`CMCD-${s[a]}`]=e)}return i}static toQuery(e){return`CMCD=${encodeURIComponent(un.serialize(e))}`}static appendQueryToUri(e,t){if(!t)return e;const i=e.includes("?")?"&":"?";return`${e}${i}${t}`}}function fn(e,t,i,s){e&&Object.keys(t).forEach((r=>{const n=e.filter((e=>e.groupId===r)).map((e=>{const n=f({},e);return n.details=void 0,n.attrs=new w(n.attrs),n.url=n.attrs.URI=pn(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",i),n.groupId=n.attrs["GROUP-ID"]=t[r],n.attrs["PATHWAY-ID"]=s,n}));e.push(...n)}))}function pn(e,t,i,s){const{HOST:r,PARAMS:n,[i]:a}=s;let o;t&&(o=null==a?void 0:a[t],o&&(e=o));const l=new self.URL(e);return r&&!o&&(l.host=r),n&&Object.keys(n).sort().forEach((e=>{e&&l.searchParams.set(e,n[e])})),l.href}const gn=/^age:\s*[\d.]+\s*$/im;class mn{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new C,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e)return;const i=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then((()=>{if(!this.stats.aborted)return r(i,t.url)})).catch((e=>(i.open("GET",t.url,!0),r(i,t.url)))).then((()=>{this.stats.aborted||this.openAndSendXhr(i,t,e)})).catch((e=>{this.callbacks.onError({code:i.status,text:e.message},t,i,s)})):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const s=this.context.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:n}=i.loadPolicy;if(s)for(const a in s)e.setRequestHeader(a,s[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=r&&p(r)?r:n,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const s=t.readyState,r=this.config;if(!i.aborted&&s>=2&&(0===i.loading.first&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),4===s)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const s=t.status,n="text"!==t.responseType;if(s>=200&&s<300&&(n&&t.response||null!==t.responseText)){i.loading.end=Math.max(self.performance.now(),i.loading.first);const r=n?t.response:t.responseText,a="arraybuffer"===t.responseType?r.byteLength:r.length;if(i.loaded=i.total=a,i.bwEstimate=8e3*i.total/(i.loading.end-i.loading.first),!this.callbacks)return;const o=this.callbacks.onProgress;if(o&&o(i,e,r,t),!this.callbacks)return;const l={url:t.responseURL,data:r,code:s};this.callbacks.onSuccess(l,i,e,t)}else{const n=r.loadPolicy.errorRetry;Ht(n,i.retry,!1,s)?this.retry(n):(S.error(`${s} while loading ${e.url}`),this.callbacks.onError({code:s,text:t.statusText},e,t,i))}}}loadtimeout(){var e;const t=null==(e=this.config)?void 0:e.loadPolicy.timeoutRetry;if(Ht(t,this.stats.retry,!0))this.retry(t);else{S.warn(`timeout while loading ${this.context.url}`);const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=$t(e,i.retry),i.retry++,S.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&gn.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const vn=/(\d+)-(\d+)\/(\d+)/;class yn{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Tn,this.controller=new self.AbortController,this.stats=new C}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){const e=this.response;null!=e&&e.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const r=function(e,t){const i={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(f({},e.headers))};e.rangeEnd&&i.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return i}(e,this.controller.signal),n=i.onProgress,a="arraybuffer"===e.responseType,o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=l&&p(l)?l:c,this.requestTimeout=self.setTimeout((()=>{this.abortInternal(),i.onTimeout(s,e,this.response)}),t.timeout),self.fetch(this.request).then((r=>{this.response=this.loader=r;const o=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout((()=>{this.abortInternal(),i.onTimeout(s,e,this.response)}),c-(o-s.loading.start)),!r.ok){const{status:e,statusText:t}=r;throw new En(t||"fetch, bad network response",e,r)}return s.loading.first=o,s.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=vn.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(p(e))return e}const i=e.get("Content-Length");if(i)return parseInt(i)}(r.headers)||s.total,n&&p(t.highWaterMark)?this.loadProgressively(r,s,e,t.highWaterMark,n):a?r.arrayBuffer():"json"===e.responseType?r.json():r.text()})).then((r=>{const{response:a}=this;self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const l=r[o];l&&(s.loaded=s.total=l);const c={url:a.url,data:r,code:a.status};n&&!p(t.highWaterMark)&&n(s,e,r,a),i.onSuccess(c,s,e,a)})).catch((t=>{if(self.clearTimeout(this.requestTimeout),s.aborted)return;const r=t&&t.code||0,n=t?t.message:null;i.onError({code:r,text:n},e,t?t.details:null,s)}))}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,s=0,r){const n=new er,a=e.body.getReader(),o=()=>a.read().then((a=>{if(a.done)return n.dataLength&&r(t,i,n.flush(),e),Promise.resolve(new ArrayBuffer(0));const l=a.value,c=l.length;return t.loaded+=c,c<s||n.dataLength?(n.push(l),n.dataLength>=s&&r(t,i,n.flush(),e)):r(t,i,l,e),o()})).catch((()=>Promise.reject()));return o()}}function Tn(e,t){return new self.Request(e.url,t)}class En extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const bn=/\s/,Sn={newCue(e,t,i,s){const r=[];let n,a,o,l,c;const d=self.VTTCue||self.TextTrackCue;for(let u=0;u<s.rows.length;u++)if(n=s.rows[u],o=!0,l=0,c="",!n.isEmpty()){var h;for(let e=0;e<n.chars.length;e++)bn.test(n.chars[e].uchar)&&o?l++:(c+=n.chars[e].uchar,o=!1);n.cueStartTime=t,t===i&&(i+=1e-4),l>=16?l--:l++;const s=Fr(c.trim()),f=Gr(t,i,s);null!=e&&null!=(h=e.cues)&&h.getCueById(f)||(a=new d(t,i,s),a.id=f,a.line=u+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*l/32)),r.push(a))}return e&&r.length&&(r.sort(((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line)),r.forEach((t=>pt(e,t)))),r}},Ln=h(h({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:mn,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;const t=e.config;this.bwEstimator=new Js(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(g.FRAG_LOADING,this.onFragLoading,this),e.on(g.FRAG_LOADED,this.onFragLoaded,this),e.on(g.FRAG_BUFFERED,this.onFragBuffered,this),e.on(g.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(g.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){const{hls:e}=this;e.off(g.FRAG_LOADING,this.onFragLoading,this),e.off(g.FRAG_LOADED,this.onFragLoaded,this),e.off(g.FRAG_BUFFERED,this.onFragBuffered,this),e.off(g.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(g.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(e,t){var i;const s=t.frag;this.ignoreFragment(s)||(this.fragCurrent=s,this.partCurrent=null!=(i=t.part)?i:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(e,t){this.clearTimer()}getTimeToLoadFrag(e,t,i,s){return e+i/t+(s?this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const i=this.hls.config,{total:s,bwEstimate:r}=t.stats;p(s)&&p(r)&&(this.lastLevelLoadSec=8*s/r),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)}_abandonRulesCheck(){const{fragCurrent:e,partCurrent:t,hls:i}=this,{autoLevelEnabled:s,media:r}=i;if(!e||!r)return;const n=performance.now(),a=t?t.stats:e.stats,o=t?t.duration:e.duration,l=n-a.loading.start;if(a.aborted||a.loaded&&a.loaded===a.total||0===e.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!s||r.paused||!r.playbackRate||!r.readyState)return;const c=i.mainForwardBufferInfo;if(null===c)return;const d=this.bwEstimator.getEstimateTTFB(),h=Math.abs(r.playbackRate);if(l<=Math.max(d,o/(2*h)*1e3))return;const u=c.len/h;if(u>=2*o/h)return;const f=a.loading.first?a.loading.first-a.loading.start:-1,m=a.loaded&&f>-1,v=this.bwEstimator.getEstimate(),{levels:y,minAutoLevel:T}=i,E=y[e.level],b=a.total||Math.max(a.loaded,Math.round(o*E.maxBitrate/8));let L=l-f;L<1&&m&&(L=Math.min(l,8*a.loaded/v));const _=m?1e3*a.loaded/L:0,w=_?(b-a.loaded)/_:8*b/v+d/1e3;if(w<=u)return;const A=_?8*_:v;let R,C=Number.POSITIVE_INFINITY;for(R=e.level-1;R>T;R--){const e=y[R].maxBitrate;if(C=this.getTimeToLoadFrag(d/1e3,A,o*e,!y[R].details),C<u)break}C>=w||C>10*o||(i.nextLoadLevel=R,m?this.bwEstimator.sample(l-Math.min(d,f),a.loaded):this.bwEstimator.sampleTTFB(l),this.clearTimer(),S.warn(`[abr] Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} is loading too slowly;\n      Time to underbuffer: ${u.toFixed(3)} s\n      Estimated load time for current fragment: ${w.toFixed(3)} s\n      Estimated load time for down switch fragment: ${C.toFixed(3)} s\n      TTFB estimate: ${f}\n      Current BW estimate: ${p(v)?(v/1024).toFixed(3):"Unknown"} Kb/s\n      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s\n      Aborting and switching to level ${R}`),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),i.trigger(g.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:a}))}onFragLoaded(e,{frag:t,part:i}){const s=i?i.stats:t.stats;if(t.type===ot&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const e=i?i.duration:t.duration,r=this.hls.levels[t.level],n=(r.loaded?r.loaded.bytes:0)+s.loaded,a=(r.loaded?r.loaded.duration:0)+e;r.loaded={bytes:n,duration:a},r.realBitrate=Math.round(8*n/a)}if(t.bitrateTest){const e={stats:s,frag:t,part:i,id:t.type};this.onFragBuffered(g.FRAG_BUFFERED,e),t.bitrateTest=!1}}}onFragBuffered(e,t){const{frag:i,part:s}=t,r=null!=s&&s.stats.loaded?s.stats:i.stats;if(r.aborted)return;if(this.ignoreFragment(i))return;const n=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(n,r.loaded),r.bwEstimate=this.bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ot||"initSegment"===e.sn}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){const e=this._nextAutoLevel,t=this.bwEstimator;if(-1!==e&&!t.canEstimate())return e;let i=this.getNextABRAutoLevel();if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,i)&&t[e].loadError<=t[i].loadError)return e}return-1!==e&&(i=Math.min(e,i)),i}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this,{maxAutoLevel:s,config:r,minAutoLevel:n,media:a}=i,o=t?t.duration:e?e.duration:0,l=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,c=this.bwEstimator?this.bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,d=i.mainForwardBufferInfo,h=(d?d.len:0)/l;let u=this.findBestLevel(c,n,s,h,r.abrBandWidthFactor,r.abrBandWidthUpFactor);if(u>=0)return u;S.trace(`[abr] ${h?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let f=o?Math.min(o,r.maxStarvationDelay):r.maxStarvationDelay,p=r.abrBandWidthFactor,g=r.abrBandWidthUpFactor;if(!h){const e=this.bitrateTestDelay;if(e){f=(o?Math.min(o,r.maxLoadingDelay):r.maxLoadingDelay)-e,S.trace(`[abr] bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),p=g=1}}return u=this.findBestLevel(c,n,s,h+f,p,g),Math.max(u,0)}findBestLevel(e,t,i,s,r,n){var a;const{fragCurrent:o,partCurrent:l,lastLoadedFragLevel:c}=this,{levels:d}=this.hls,h=d[c],u=!(null==h||null==(a=h.details)||!a.live),f=null==h?void 0:h.codecSet,g=l?l.duration:o?o.duration:0,m=this.bwEstimator.getEstimateTTFB()/1e3;let v=t,y=-1;for(let T=i;T>=t;T--){const t=d[T];if(!t||f&&t.codecSet!==f){t&&(v=Math.min(T,v),y=Math.max(T,y));continue}-1!==y&&S.trace(`[abr] Skipped level(s) ${v}-${y} with CODECS:"${d[y].attrs.CODECS}"; not compatible with "${h.attrs.CODECS}"`);const i=t.details,a=(l?null==i?void 0:i.partTarget:null==i?void 0:i.averagetargetduration)||g;let o;o=T<=c?r*e:n*e;const E=d[T].maxBitrate,b=this.getTimeToLoadFrag(m,o,E*a,void 0===i);if(S.trace(`[abr] level:${T} adjustedbw-bitrate:${Math.round(o-E)} avgDuration:${a.toFixed(1)} maxFetchDuration:${s.toFixed(1)} fetchDuration:${b.toFixed(1)}`),o>E&&(0===b||!p(b)||u&&!this.bitrateTestDelay||b<s))return T}return-1}set nextAutoLevel(e){this._nextAutoLevel=e}},bufferController:class{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{const{media:e,mediaSource:t}=this;S.log("[buffer-controller]: Media source opened"),e&&(e.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(g.MEDIA_ATTACHED,{media:e})),t&&t.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{S.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{S.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{const{media:e,_objectUrl:t}=this;e&&e.src!==t&&S.error(`Media element src was set while attaching MediaSource (${t} > ${e.src})`)},this.hls=e,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){const{hls:e}=this;e.on(g.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_PARSED,this.onManifestParsed,this),e.on(g.BUFFER_RESET,this.onBufferReset,this),e.on(g.BUFFER_APPENDING,this.onBufferAppending,this),e.on(g.BUFFER_CODECS,this.onBufferCodecs,this),e.on(g.BUFFER_EOS,this.onBufferEos,this),e.on(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(g.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(g.FRAG_PARSED,this.onFragParsed,this),e.on(g.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(g.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_PARSED,this.onManifestParsed,this),e.off(g.BUFFER_RESET,this.onBufferReset,this),e.off(g.BUFFER_APPENDING,this.onBufferAppending,this),e.off(g.BUFFER_CODECS,this.onBufferCodecs,this),e.off(g.BUFFER_EOS,this.onBufferEos,this),e.off(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(g.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(g.FRAG_PARSED,this.onFragParsed,this),e.off(g.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new nr(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,S.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const i=this.media=t.media;if(i&&ar){const e=this.mediaSource=new ar;e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(e),this._objectUrl=i.src,i.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:i}=this;if(t){if(S.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(bl){S.warn(`[buffer-controller]: onMediaDetaching: ${bl.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),i&&self.URL.revokeObjectURL(i),e.src===i?(e.removeAttribute("src"),e.load()):S.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(g.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach((e=>{const t=this.sourceBuffer[e];try{t&&(this.removeBufferListeners(e),this.mediaSource&&this.mediaSource.removeSourceBuffer(t),this.sourceBuffer[e]=void 0)}catch(bl){S.warn(`[buffer-controller]: Failed to reset the ${e} buffer`,bl)}})),this._initSourceBuffer()}onBufferCodecs(e,t){const i=this.getSourceBufferTypes().length;Object.keys(t).forEach((e=>{if(i){const i=this.tracks[e];if(i&&"function"==typeof i.buffer.changeType){const{id:s,codec:r,levelCodec:n,container:a,metadata:o}=t[e],l=(i.levelCodec||i.codec).replace(or,"$1"),c=(n||r).replace(or,"$1");if(l!==c){const t=`${a};codecs=${n||r}`;this.appendChangeType(e,t),S.log(`[buffer-controller]: switching codec ${l} to ${c}`),this.tracks[e]={buffer:i.buffer,codec:r,container:a,levelCodec:n,metadata:o,id:s}}}}else this.pendingTracks[e]=t[e]})),i||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())}appendChangeType(e,t){const{operationQueue:i}=this,s={execute:()=>{const s=this.sourceBuffer[e];s&&(S.log(`[buffer-controller]: changing ${e} sourceBuffer type to ${t}`),s.changeType(t)),i.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{S.warn(`[buffer-controller]: Failed to change ${e} SourceBuffer type`,t)}};i.append(s,e)}onBufferAppending(e,t){const{hls:i,operationQueue:s,tracks:r}=this,{data:n,type:a,frag:o,part:l,chunkMeta:c}=t,d=c.buffering[a],h=self.performance.now();d.start=h;const u=o.stats.buffering,f=l?l.stats.buffering:null;0===u.start&&(u.start=h),f&&0===f.start&&(f.start=h);const p=r.audio;let y=!1;"audio"===a&&"audio/mpeg"===(null==p?void 0:p.container)&&(y=!this.lastMpegAudioChunk||1===c.id||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const T=o.start,E={execute:()=>{if(d.executeStart=self.performance.now(),y){const e=this.sourceBuffer[a];if(e){const t=T-e.timestampOffset;Math.abs(t)>=.1&&(S.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${T} (delta: ${t}) sn: ${o.sn})`),e.timestampOffset=T)}}this.appendExecutor(n,a)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();d.executeEnd=d.end=e,0===u.first&&(u.first=e),f&&0===f.first&&(f.first=e);const{sourceBuffer:t}=this,i={};for(const s in t)i[s]=Ei.getBuffered(t[s]);this.appendError=0,this.hls.trigger(g.BUFFER_APPENDED,{type:a,frag:o,part:l,chunkMeta:c,parent:o.type,timeRanges:i})},onError:e=>{S.error(`[buffer-controller]: Error encountered while trying to append to the ${a} SourceBuffer`,e);const t={type:m.MEDIA_ERROR,parent:o.type,details:v.BUFFER_APPEND_ERROR,frag:o,part:l,chunkMeta:c,error:e,err:e,fatal:!1};e.code===DOMException.QUOTA_EXCEEDED_ERR?t.details=v.BUFFER_FULL_ERROR:(this.appendError++,t.details=v.BUFFER_APPEND_ERROR,this.appendError>i.config.appendErrorMaxRetry&&(S.error(`[buffer-controller]: Failed ${i.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),t.fatal=!0)),i.trigger(g.ERROR,t)}};s.append(E,a)}onBufferFlushing(e,t){const{operationQueue:i}=this,s=e=>({execute:this.removeExecutor.bind(this,e,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(g.BUFFER_FLUSHED,{type:e})},onError:t=>{S.warn(`[buffer-controller]: Failed to remove from ${e} SourceBuffer`,t)}});t.type?i.append(s(t.type),t.type):this.getSourceBufferTypes().forEach((e=>{i.append(s(e),e)}))}onFragParsed(e,t){const{frag:i,part:s}=t,r=[],n=s?s.elementaryStreams:i.elementaryStreams;n[D]?r.push("audiovideo"):(n[P]&&r.push("audio"),n[k]&&r.push("video"));0===r.length&&S.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers((()=>{const e=self.performance.now();i.stats.buffering.end=e,s&&(s.stats.buffering.end=e);const t=s?s.stats:i.stats;this.hls.trigger(g.FRAG_BUFFERED,{frag:i,part:s,stats:t,id:i.type})}),r)}onFragChanged(e,t){this.flushBackBuffer()}onBufferEos(e,t){this.getSourceBufferTypes().reduce(((e,i)=>{const s=this.sourceBuffer[i];return!s||t.type&&t.type!==i||(s.ending=!0,s.ended||(s.ended=!0,S.log(`[buffer-controller]: ${i} sourceBuffer now EOS`))),e&&!(s&&!s.ended)}),!0)&&(S.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers((()=>{this.getSourceBufferTypes().forEach((e=>{const t=this.sourceBuffer[e];t&&(t.ending=!1)}));const{mediaSource:e}=this;e&&"open"===e.readyState?(S.log("[buffer-controller]: Calling mediaSource.endOfStream()"),e.endOfStream()):e&&S.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`)})))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){const{hls:e,details:t,media:i,sourceBuffer:s}=this;if(!i||null===t)return;const r=this.getSourceBufferTypes();if(!r.length)return;const n=t.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if(!p(n)||n<0)return;const a=i.currentTime,o=t.levelTargetDuration,l=Math.max(n,o),c=Math.floor(a/o)*o-l;r.forEach((i=>{const r=s[i];if(r){const s=Ei.getBuffered(r);if(s.length>0&&c>s.start(0)){if(e.trigger(g.BACK_BUFFER_REACHED,{bufferEnd:c}),t.live)e.trigger(g.LIVE_BACK_BUFFER_REACHED,{bufferEnd:c});else if(r.ended&&s.end(s.length-1)-a<2*o)return void S.info(`[buffer-controller]: Cannot flush ${i} back buffer while SourceBuffer is in ended state`);e.trigger(g.BUFFER_FLUSHING,{startOffset:0,endOffset:c,type:i})}}}))}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||"open"!==this.mediaSource.readyState)return;const{details:e,hls:t,media:i,mediaSource:s}=this,r=e.fragments[0].start+e.totalduration,n=i.duration,a=p(s.duration)?s.duration:0;e.live&&t.config.liveDurationInfinity?(S.log("[buffer-controller]: Media Source duration is set to Infinity"),s.duration=1/0,this.updateSeekableRange(e)):(r>a&&r>n||!p(n))&&(S.log(`[buffer-controller]: Updating Media Source duration to ${r.toFixed(3)}`),s.duration=r)}updateSeekableRange(e){const t=this.mediaSource,i=e.fragments;if(i.length&&e.live&&null!=t&&t.setLiveSeekableRange){const s=Math.max(0,i[0].start),r=Math.max(s,s+e.totalduration);t.setLiveSeekableRange(s,r)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:i}=this,s=Object.keys(i).length;if(s&&!e||2===s){this.createSourceBuffers(i),this.pendingTracks={};const e=this.getSourceBufferTypes();if(e.length)this.hls.trigger(g.BUFFER_CREATED,{tracks:this.tracks}),e.forEach((e=>{t.executeNext(e)}));else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:i}=this;if(!i)throw Error("createSourceBuffers called when mediaSource was null");for(const s in e)if(!t[s]){const r=e[s];if(!r)throw Error(`source buffer exists for track ${s}, however track does not`);const n=r.levelCodec||r.codec,a=`${r.container};codecs=${n}`;S.log(`[buffer-controller]: creating sourceBuffer(${a})`);try{const e=t[s]=i.addSourceBuffer(a),o=s;this.addBufferListener(o,"updatestart",this._onSBUpdateStart),this.addBufferListener(o,"updateend",this._onSBUpdateEnd),this.addBufferListener(o,"error",this._onSBUpdateError),this.tracks[s]={buffer:e,codec:n,container:r.container,levelCodec:r.levelCodec,metadata:r.metadata,id:r.id}}catch(bl){S.error(`[buffer-controller]: error while trying to add sourceBuffer: ${bl.message}`),this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:bl,mimeType:a})}}}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){const{operationQueue:t}=this;t.current(e).onComplete(),t.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){const i=new Error(`${e} SourceBuffer error`);S.error(`[buffer-controller]: ${i}`,t),this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_APPENDING_ERROR,error:i,fatal:!1});const s=this.operationQueue.current(e);s&&s.onError(t)}removeExecutor(e,t,i){const{media:s,mediaSource:r,operationQueue:n,sourceBuffer:a}=this,o=a[e];if(!s||!r||!o)return S.warn(`[buffer-controller]: Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void n.shiftAndExecuteNext(e);const l=p(s.duration)?s.duration:1/0,c=p(r.duration)?r.duration:1/0,d=Math.max(0,t),h=Math.min(i,l,c);h>d&&!o.ending?(o.ended=!1,S.log(`[buffer-controller]: Removing [${d},${h}] from the ${e} SourceBuffer`),o.remove(d,h)):n.shiftAndExecuteNext(e)}appendExecutor(e,t){const{operationQueue:i,sourceBuffer:s}=this,r=s[t];if(!r)return S.warn(`[buffer-controller]: Attempting to append to the ${t} SourceBuffer, but it does not exist`),void i.shiftAndExecuteNext(t);r.ended=!1,r.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length)return S.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);const{operationQueue:i}=this,s=t.map((e=>i.appendBlocker(e)));Promise.all(s).then((()=>{e(),t.forEach((e=>{const t=this.sourceBuffer[e];null!=t&&t.updating||i.shiftAndExecuteNext(e)}))}))}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,i){const s=this.sourceBuffer[e];if(!s)return;const r=i.bind(this,e);this.listeners[e].push({event:t,listener:r}),s.addEventListener(t,r)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach((e=>{t.removeEventListener(e.event,e.listener)}))}},capLevelController:tn,errorController:class{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=S.log.bind(S,"[info]:"),this.warn=S.warn.bind(S,"[warning]:"),this.error=S.error.bind(S,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(g.ERROR,this.onError,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(g.ERROR,this.onError,this),e.off(g.ERROR,this.onErrorOut,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){this.playlistError=0}stopLoad(){}getVariantLevelIndex(e){return(null==e?void 0:e.type)===ot?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var i,s;if(t.fatal)return;const r=this.hls,n=t.context;switch(t.details){case v.FRAG_LOAD_ERROR:case v.FRAG_LOAD_TIMEOUT:case v.KEY_LOAD_ERROR:case v.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case v.FRAG_PARSING_ERROR:if(null!=(i=t.frag)&&i.gap)return void(t.errorAction={action:Wt,flags:Xt});case v.FRAG_GAP:case v.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=Yt);case v.LEVEL_EMPTY_ERROR:case v.LEVEL_PARSING_ERROR:{var a,o;const e=t.parent===ot?t.level:r.loadLevel;t.details===v.LEVEL_EMPTY_ERROR&&null!=(a=t.context)&&null!=(o=a.levelDetails)&&o.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case v.LEVEL_LOAD_ERROR:case v.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==n?void 0:n.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.level)));case v.AUDIO_TRACK_LOAD_ERROR:case v.AUDIO_TRACK_LOAD_TIMEOUT:case v.SUBTITLE_LOAD_ERROR:case v.SUBTITLE_TRACK_LOAD_TIMEOUT:if(n){const e=r.levels[r.loadLevel];if(e&&(n.type===nt&&n.groupId===e.audioGroupId||n.type===at&&n.groupId===e.textGroupId))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=Yt,void(t.errorAction.flags=Zt)}return;case v.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const e=r.levels[r.loadLevel],i=null==e?void 0:e.attrs["HDCP-LEVEL"];i&&(t.errorAction={action:Yt,flags:Qt,hdcpLevel:i})}return;case v.BUFFER_ADD_CODEC_ERROR:case v.REMUX_ALLOC_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null!=(s=t.level)?s:r.loadLevel));case v.INTERNAL_EXCEPTION:case v.BUFFER_APPENDING_ERROR:case v.BUFFER_APPEND_ERROR:case v.BUFFER_FULL_ERROR:case v.LEVEL_SWITCH_ERROR:case v.BUFFER_STALLED_ERROR:case v.BUFFER_SEEK_OVER_HOLE:case v.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:Wt,flags:Xt})}if(t.type===m.KEY_SYSTEM_ERROR){const e=this.getVariantLevelIndex(t.frag);return t.levelRetry=!1,void(t.errorAction=this.getLevelSwitchAction(t,e))}}getPlaylistRetryOrSwitchAction(e,t){var i;const s=Ut(this.hls.config.playlistLoadPolicy,e),r=this.playlistError++,n=null==(i=e.response)?void 0:i.code;if(Ht(s,r,Nt(e),n))return{action:zt,flags:Xt,retryConfig:s,retryCount:r};const a=this.getLevelSwitchAction(e,t);return s&&(a.retryConfig=s,a.retryCount=r),a}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),s=t.levels[i],{fragLoadPolicy:r,keyLoadPolicy:n}=t.config,a=Ut(e.details.startsWith("key")?n:r,e),o=t.levels.reduce(((e,t)=>e+t.fragmentError),0);if(s){var l;e.details!==v.FRAG_GAP&&s.fragmentError++;const t=null==(l=e.response)?void 0:l.code;if(Ht(a,o,Nt(e),t))return{action:zt,flags:Xt,retryConfig:a,retryCount:o}}const c=this.getLevelSwitchAction(e,i);return a&&(c.retryConfig=a,c.retryCount=o),c}getLevelSwitchAction(e,t){const i=this.hls;null==t&&(t=i.loadLevel);const s=this.hls.levels[t];if(s&&(s.loadError++,i.autoLevelEnabled)){var r,n;let t=-1;const{levels:a,loadLevel:o,minAutoLevel:l,maxAutoLevel:c}=i,d=null==(r=e.frag)?void 0:r.type,{type:h,groupId:u}=null!=(n=e.context)?n:{};for(let i=a.length;i--;){const r=(i+o)%a.length;if(r!==o&&r>=l&&r<=c&&0===a[r].loadError){const i=a[r];if(e.details===v.FRAG_GAP&&e.frag){const t=a[r].details;if(t){const i=Kt(e.frag,t.fragments,e.frag.start);if(null!=i&&i.gap)continue}}else{if(h===nt&&u===i.audioGroupId||h===at&&u===i.textGroupId)continue;if(d===lt&&s.audioGroupId===i.audioGroupId||d===ct&&s.textGroupId===i.textGroupId)continue}t=r;break}}if(t>-1&&i.loadLevel!==t)return e.levelRetry=!0,this.playlistError=0,{action:Yt,flags:Xt,nextAutoLevel:t}}return{action:Yt,flags:Zt}}onErrorOut(e,t){var i;switch(null==(i=t.errorAction)?void 0:i.action){case Wt:break;case Yt:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===v.FRAG_GAP||(t.fatal=!0)}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:s,hdcpLevel:r,nextAutoLevel:n}=i;switch(s){case Xt:this.switchLevel(e,n);break;case Zt:i.resolved||(i.resolved=this.redundantFailover(e));break;case Qt:r&&(t.maxHdcpLevel=wt[wt.indexOf(r)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`)}i.resolved||this.switchLevel(e,n)}switchLevel(e,t){void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(e){const{hls:t,penalizedRenditions:i}=this,s=e.parent===ot?e.level:t.loadLevel,r=t.levels[s],n=r.url.length,a=e.frag?e.frag.urlId:r.urlId;r.urlId!==a||e.frag&&!r.details||this.penalizeRendition(r,e);for(let o=1;o<n;o++){const l=(a+o)%n,c=i[l];if(!c||Jt(c,e,i[a]))return this.warn(`Switching to Redundant Stream ${l+1}/${n}: "${r.url[l]}" after ${e.details}`),this.playlistError=0,t.levels.forEach((e=>{e.urlId=l})),t.nextLoadLevel=s,!0}return!1}penalizeRendition(e,t){const{penalizedRenditions:i}=this,s=i[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};s.lastErrorPerfMs=performance.now(),s.errors.push(t),s.details=e.details,i[e.urlId]=s}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(g.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(g.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,i){const s=performance.now();if(t){if(this.lastTime){const e=s-this.lastTime,r=i-this.lastDroppedFrames,n=t-this.lastDecodedFrames,a=1e3*r/e,o=this.hls;if(o.trigger(g.FPS_DROP,{currentDropped:r,currentDecoded:n,totalDroppedFrames:i}),a>0&&r>o.config.fpsDroppedMonitoringThreshold*n){let e=o.currentLevel;S.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(g.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Y,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:Sn,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends Ki{constructor(e,t,i){super(e,t,i,"[subtitle-stream-controller]",ct),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.LEVEL_LOADED,this.onLevelLoaded,this),e.on(g.ERROR,this.onError,this),e.on(g.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(g.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(g.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(g.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(g.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.LEVEL_LOADED,this.onLevelLoaded,this),e.off(g.ERROR,this.onError,this),e.off(g.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(g.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(g.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(g.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(g.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=Mi,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:s}=t;if(this.fragPrevious=i,this.state=Mi,!s)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let n;const a=i.start;for(let l=0;l<r.length;l++)if(a>=r[l].start&&a<=r[l].end){n=r[l];break}const o=i.start+i.duration;n?n.end=o:(n={start:a,end:o},r.push(n)),this.fragmentTracker.fragBuffered(i)}onBufferFlushing(e,t){const{startOffset:i,endOffset:s}=t;if(0===i&&s!==Number.POSITIVE_INFINITY){const e=s-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach((t=>{for(let i=0;i<t.length;)if(t[i].end<=e)t.shift();else{if(!(t[i].start<e))break;t[i].start=e,i++}})),this.fragmentTracker.removeFragmentsInRange(i,e,ct)}}onFragBuffered(e,t){var i;this.loadedmetadata||t.frag.type!==ot||null!=(i=this.media)&&i.buffered.length&&(this.loadedmetadata=!0)}onError(e,t){const i=t.frag;(null==i?void 0:i.type)===ct&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Ii&&(this.state=Mi))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){tr(this.levels,t)?this.levels=t.map((e=>new kt(e))):(this.tracksBuffered=[],this.levels=t.map((e=>{const t=new kt(e);return this.tracksBuffered[t.id]=[],t})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ct),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){if(this.currentTrackId=t.id,!this.levels.length||-1===this.currentTrackId)return void this.clearInterval();const i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var i;const{details:s,id:r}=t,{currentTrackId:n,levels:a}=this;if(!a.length)return;const o=a[n];if(r>=a.length||r!==n||!o)return;this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(s.live||null!=(i=o.details)&&i.live){const e=this.mainDetails;if(s.deltaUpdateFailed||!e)return;const t=e.fragments[0];o.details?(l=this.alignPlaylists(s,o.details),0===l&&t&&(l=t.start,xt(s,l))):s.hasProgramDateTime&&e.hasProgramDateTime?(Ai(s,e),l=s.fragments[0].start):t&&(l=t.start,xt(s,l))}if(o.details=s,this.levelLastLoaded=r,this.startFragRequested||!this.mainDetails&&s.live||this.setStartPosition(o.details,l),this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===Mi){Kt(null,s.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,s=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&s&&s.key&&s.iv&&"AES-128"===s.method){const e=performance.now();this.decrypter.decrypt(new Uint8Array(i),s.key.buffer,s.iv.buffer).catch((e=>{throw r.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e})).then((i=>{const s=performance.now();r.trigger(g.FRAG_DECRYPTED,{frag:t,payload:i,stats:{tstart:e,tdecrypt:s}})})).catch((e=>{this.warn(`${e.name}: ${e.message}`),this.state=Mi}))}}doTick(){if(this.media){if(this.state===Mi){const{currentTrackId:e,levels:t}=this,i=t[e];if(!t.length||!i||!i.details)return;const{config:s}=this,r=this.getLoadPosition(),n=Ei.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,s.maxBufferHole),{end:a,len:o}=n,l=this.getFwdBufferInfo(this.media,ot),c=i.details;if(o>this.getMaxBufferLength(null==l?void 0:l.len)+c.levelTargetDuration)return;const d=c.fragments,h=d.length,u=c.edge;let f=null;const p=this.fragPrevious;if(a<u){const e=s.maxFragLookUpTolerance,t=a>u-e?0:e;f=Kt(p,d,Math.max(d[0].start,a),t),!f&&p&&p.start<d[0].start&&(f=d[0])}else f=d[h-1];if(!f)return;if(f=this.mapToInitFragWhenRequired(f),"initSegment"!==f.sn){const e=d[f.sn-c.startSN-1];e&&e.cc===f.cc&&this.fragmentTracker.getState(e)===ni&&(f=e)}this.fragmentTracker.getState(f)===ni&&this.loadFragment(f,i,a)}}else this.state=Mi}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,i){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,i))}get mediaBufferTimeRanges(){return new sr(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends ei{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){const{hls:e}=this;e.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_PARSED,this.onManifestParsed,this),e.on(g.LEVEL_LOADING,this.onLevelLoading,this),e.on(g.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(g.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(g.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_PARSED,this.onManifestParsed,this),e.off(g.LEVEL_LOADING,this.onLevelLoading,this),e.off(g.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(g.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(g.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);rr(this.media.textTracks).forEach((e=>{gt(e)})),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,details:s}=t,{trackId:r}=this,n=this.tracksInGroup[r];if(!n)return void this.warn(`Invalid subtitle track id ${i}`);const a=n.details;n.details=t.details,this.log(`subtitle track ${i} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(null==t||!t.textGroupIds)return;const i=t.textGroupIds[t.urlId],s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==i){const e=this.tracks.filter((e=>!i||e.groupId===i));this.tracksInGroup=e;const t=this.findTrackId(null==s?void 0:s.name)||this.findTrackId();this.groupId=i||null;const r={subtitleTracks:e};this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${i}" group-id`),this.hls.trigger(g.SUBTITLE_TRACKS_UPDATED,r),-1!==t&&this.setSubtitleTrack(t,s)}else this.shouldReloadPlaylist(s)&&this.setSubtitleTrack(this.trackId,s)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const s=t[i];if((!this.selectDefaultTrack||s.default)&&(!e||e===s.name))return s.id}return-1}onError(e,t){!t.fatal&&t.context&&t.context.type===at&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.checkRetry(t)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1;const t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const s=t.id,r=t.groupId;let n=t.url;if(e)try{n=e.addDirectives(n)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}this.log(`Loading subtitle playlist for id ${s}`),this.hls.trigger(g.SUBTITLE_TRACK_LOADING,{url:n,id:s,groupId:r,deliveryDirectives:e||null})}}toggleTrackModes(e){const{media:t,trackId:i}=this;if(!t)return;const s=rr(t.textTracks),r=s.filter((e=>e.groupId===this.groupId));if(-1===e)[].slice.call(s).forEach((e=>{e.mode="disabled"}));else{const e=r[i];e&&(e.mode="disabled")}const n=r[e];n&&(n.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(e,t){var i;const s=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(this.trackId!==e&&this.toggleTrackModes(e),this.trackId===e&&(-1===e||null!=(i=s[e])&&i.details)||e<-1||e>=s.length)return;this.clearTimer();const r=s[e];if(this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:"")),this.trackId=e,r){const{id:e,groupId:i="",name:s,type:n,url:a}=r;this.hls.trigger(g.SUBTITLE_TRACK_SWITCH,{id:e,groupId:i,name:s,type:n,url:a});const o=this.switchParams(r.url,null==t?void 0:t.details);this.loadPlaylist(o)}else this.hls.trigger(g.SUBTITLE_TRACK_SWITCH,{id:e})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=-1;const t=rr(this.media.textTracks);for(let i=0;i<t.length;i++)if("hidden"===t[i].mode)e=i;else if("showing"===t[i].mode){e=i;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},timelineController:class{constructor(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){const e=new Rr(this,"textTrack1"),t=new Rr(this,"textTrack2"),i=new Rr(this,"textTrack3"),s=new Rr(this,"textTrack4");this.cea608Parser1=new _r(1,e,t),this.cea608Parser2=new _r(3,i,s)}e.on(g.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(g.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(g.FRAG_LOADING,this.onFragLoading,this),e.on(g.FRAG_LOADED,this.onFragLoaded,this),e.on(g.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(g.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(g.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(g.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(g.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(g.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(g.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(g.FRAG_LOADING,this.onFragLoading,this),e.off(g.FRAG_LOADED,this.onFragLoaded,this),e.off(g.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(g.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(g.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(g.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(g.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(e,t,i,s,r){let n=!1;for(let d=r.length;d--;){const e=r[d],s=(a=e[0],o=e[1],l=t,c=i,Math.min(o,c)-Math.max(a,l));if(s>=0&&(e[0]=Math.min(e[0],t),e[1]=Math.max(e[1],i),n=!0,s/(i-t)>.5))return}var a,o,l,c;if(n||r.push([t,i]),this.config.renderTextTracksNatively){const r=this.captionsTracks[e];this.Cues.newCue(r,t,i,s)}else{const r=this.Cues.newCue(null,t,i,s);this.hls.trigger(g.CUES_PARSED,{type:"captions",cues:r,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:s,timescale:r}){const{unparsedVttFrags:n}=this;"main"===i&&(this.initPTS[t.cc]={baseTime:s,timescale:r}),n.length&&(this.unparsedVttFrags=[],n.forEach((e=>{this.onFragLoaded(g.FRAG_LOADED,e)})))}getExistingTrack(e){const{media:t}=this;if(t)for(let i=0;i<t.textTracks.length;i++){const s=t.textTracks[i];if(s[e])return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:s}=this,{label:r,languageCode:n}=t[e],a=this.getExistingTrack(e);if(a)i[e]=a,gt(i[e]),ft(i[e],s);else{const t=this.createTextTrack("captions",r,n);t&&(t[e]=!0,i[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(g.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,i){const s=this.media;if(s)return s.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach((t=>{gt(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)gt(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],s=i.some((e=>e.textCodec===Vr));if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(tr(this.tracks,i))return void(this.tracks=i);if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const e=this.media?this.media.textTracks:null;this.tracks.forEach(((t,i)=>{let s;if(e&&i<e.length){let i=null;for(let s=0;s<e.length;s++)if(en(e[s],t)){i=e[s];break}i&&(s=i)}if(s)gt(s);else{const e=this._captionsOrSubtitlesFromCharacteristics(t);s=this.createTextTrack(e,t.name,t.lang),s&&(s.mode="disabled")}s&&(s.groupId=t.groupId,this.textTracks.push(s))}))}else if(this.tracks.length){const e=this.tracks.map((e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e})));this.hls.trigger(g.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}_captionsOrSubtitlesFromCharacteristics(e){if(e.attrs.CHARACTERISTICS){const t=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),i=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(t&&i)return"captions"}return"subtitles"}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const i=`textTrack${t[1]}`,s=this.captionsProperties[i];s&&(s.label=e.name,e.lang&&(s.languageCode=e.lang),s.media=e)}))}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){const{cea608Parser1:i,cea608Parser2:s,lastSn:r,lastPartIndex:n}=this;if(this.enabled&&i&&s&&t.frag.type===ot){var a,o;const e=t.frag.sn,l=null!=(a=null==t||null==(o=t.part)?void 0:o.index)?a:-1;e===r+1||e===r&&l===n+1||(i.reset(),s.reset()),this.lastSn=e,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:i,payload:s}=t;if(i.type===ct)if(s.byteLength){const e=i.decryptdata,r="stats"in t;if(null==e||!e.encrypted||r){const e=this.tracks[i.level],r=this.vttCCs;r[i.cc]||(r[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),e&&e.textCodec===Vr?this._parseIMSC1(i,s):this._parseVTTs(t)}}else this.hls.trigger(g.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;Wr(t,this.initPTS[e.cc],(t=>{this._appendCues(t,e.level),i.trigger(g.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(t=>{S.log(`Failed to parse IMSC1: ${t}`),i.trigger(g.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))}_parseVTTs(e){var t;const{frag:i,payload:s}=e,{initPTS:r,unparsedVttFrags:n}=this,a=r.length-1;if(!r[i.cc]&&-1===a)return void n.push(e);const o=this.hls;Hr(null!=(t=i.initSegment)&&t.data?Ae(i.initSegment.data,new Uint8Array(s)):s,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,(e=>{this._appendCues(e,i.level),o.trigger(g.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})}),(t=>{const r="Missing initPTS for VTT MPEGTS"===t.message;r?n.push(e):this._fallbackToIMSC1(i,s),S.log(`Failed to parse VTT cue: ${t}`),r&&a>i.cc||o.trigger(g.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:t})}))}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||Wr(t,this.initPTS[e.cc],(()=>{i.textCodec=Vr,this._parseIMSC1(e,t)}),(()=>{i.textCodec="wvtt"}))}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||"disabled"===i.mode)return;e.forEach((e=>pt(i,e)))}else{const s=this.tracks[t];if(!s)return;const r=s.default?"default":"subtitles"+t;i.trigger(g.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===ct&&this.onFragLoaded(g.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){const{cea608Parser1:i,cea608Parser2:s}=this;if(!this.enabled||!i||!s)return;const{frag:r,samples:n}=t;if(r.type!==ot||"NONE"!==this.closedCaptionsForLevel(r))for(let a=0;a<n.length;a++){const e=n[a].bytes;if(e){const t=this.extractCea608Data(e);i.addData(n[a].pts,t[0]),s.addData(n[a].pts,t[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:s,type:r}){const{media:n}=this;if(n&&!(n.currentTime<i)){if(!r||"video"===r){const{captionsTracks:e}=this;Object.keys(e).forEach((s=>mt(e[s],t,i)))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==s){const{textTracks:e}=this;Object.keys(e).forEach((i=>mt(e[i],t,s)))}}}extractCea608Data(e){const t=[[],[]],i=31&e[0];let s=2;for(let r=0;r<i;r++){const i=e[s++],r=127&e[s++],n=127&e[s++];if(0===r&&0===n)continue;if(0!=(4&i)){const e=3&i;0!==e&&1!==e||(t[e].push(r),t[e].push(n))}}return t}},audioStreamController:class extends Ki{constructor(e,t,i){super(e,t,i,"[audio-stream-controller]",lt),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.LEVEL_LOADED,this.onLevelLoaded,this),e.on(g.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(g.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(g.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(g.ERROR,this.onError,this),e.on(g.BUFFER_RESET,this.onBufferReset,this),e.on(g.BUFFER_CREATED,this.onBufferCreated,this),e.on(g.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(g.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(g.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.LEVEL_LOADED,this.onLevelLoaded,this),e.off(g.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(g.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(g.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(g.ERROR,this.onError,this),e.off(g.BUFFER_RESET,this.onBufferReset,this),e.off(g.BUFFER_CREATED,this.onBufferCreated,this),e.off(g.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(g.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(g.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:i,initPTS:s,timescale:r}){if("main"===i){const e=t.cc;this.initPTS[t.cc]={baseTime:s,timescale:r},this.log(`InitPTS for cc: ${e} found from main: ${s}`),this.videoTrackCC=e,this.state===Hi&&this.tick()}}startLoad(e){if(!this.levels)return this.startPosition=e,void(this.state=Ii);const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),t>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=Mi):(this.loadedmetadata=!1,this.state=Bi),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case Mi:this.doTickIdle();break;case Bi:{var e;const{levels:t,trackId:i}=this,s=null==t||null==(e=t[i])?void 0:e.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state=Hi}break}case Fi:{var t;const e=performance.now(),i=this.retryDate;(!i||e>=i||null!=(t=this.media)&&t.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=Mi);break}case Hi:{const e=this.waitingData;if(e){const{frag:t,part:i,cache:s,complete:r}=e;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=xi;const e={frag:t,part:i,payload:s.flush(),networkDetails:null};this._handleFragmentLoadProgress(e),r&&super._handleFragmentLoadComplete(e)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${t.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const e=this.getLoadPosition(),i=Ei.bufferInfo(this.mediaBuffer,e,this.config.maxBufferHole);qt(i.end,this.config.maxFragLookUpTolerance,t)<0&&(this.log(`Waiting fragment cc (${t.cc}) @ ${t.start} cancelled because another fragment at ${i.end} is needed`),this.clearWaitingFragment())}}else this.state=Mi}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Mi)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:i,trackId:s}=this,r=e.config;if(null==t||!t[s])return;if(!i&&(this.startFragRequested||!r.startFragPrefetch))return;const n=t[s],a=n.details;if(!a||a.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(a))return void(this.state=Bi);const o=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&o&&(this.bufferFlushed=!1,this.afterBufferFlushed(o,P,lt));const l=this.getFwdBufferInfo(o,lt);if(null===l)return;const{bufferedTrack:c,switchingTrack:d}=this;if(!d&&this._streamEnded(l,a))return e.trigger(g.BUFFER_EOS,{type:"audio"}),void(this.state=$i);const h=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,ot),u=l.len,f=this.getMaxBufferLength(null==h?void 0:h.len);if(u>=f&&!d)return;const p=a.fragments[0].start;let m=l.end;if(d&&i){const e=this.getLoadPosition();c&&d.attrs!==c.attrs&&(m=e),a.PTSKnown&&e<p&&(l.end>p||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=p+.05)}let v=this.getNextFragment(m,a),y=!1;if(v&&this.isLoopLoading(v,m)&&(y=!!v.gap,v=this.getNextFragmentLoopLoading(v,a,l,ot,f)),!v)return void(this.bufferFlushed=!0);const T=h&&v.start>h.end+a.targetduration;if(T||(null==h||!h.len)&&l.len){const e=this.getAppendedFrag(v.start,ot);if(null===e)return;if(y||(y=!!e.gap||!!T&&0===h.len),T&&!y||y&&l.nextStart&&l.nextStart<e.end)return}this.loadFragment(v,n,m)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map((e=>new kt(e)))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),i?this.setInterval(100):this.resetTransmuxer(),i?(this.switchingTrack=t,this.state=Mi):(this.switchingTrack=null,this.bufferedTrack=t,this.state=Ii),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(g.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var i;if(null==this.mainDetails)return void(this.cachedTrackLoadedData=t);const{levels:s}=this,{details:r,id:n}=t;if(!s)return void this.warn(`Audio tracks were reset while loading level ${n}`);this.log(`Track ${n} loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const a=s[n];let o=0;if(r.live||null!=(i=a.details)&&i.live){const e=this.mainDetails;if(r.fragments[0]||(r.deltaUpdateFailed=!0),r.deltaUpdateFailed||!e)return;!a.details&&r.hasProgramDateTime&&e.hasProgramDateTime?(Ai(r,e),o=r.fragments[0].start):o=this.alignPlaylists(r,a.details)}a.details=r,this.levelLastLoaded=n,this.startFragRequested||!this.mainDetails&&r.live||this.setStartPosition(a.details,o),this.state!==Bi||this.waitForCdnTuneIn(r)||(this.state=Mi),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:i,part:s,payload:r}=e,{config:n,trackId:a,levels:o}=this;if(!o)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);const l=o[a];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const c=l.details;if(!c)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(i.start);const d=n.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new zs(this.hls,lt,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const u=this.initPTS[i.cc],f=null==(t=i.initSegment)?void 0:t.data;if(void 0!==u){const e=!1,t=s?s.index:-1,n=-1!==t,a=new bi(i.level,i.sn,i.stats.chunkCount,r.byteLength,t,n);h.push(r,f,d,"",i,s,c.totalduration,e,a,u)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${c.startSN} ,${c.endSN}],track ${a}`);const{cache:e}=this.waitingData=this.waitingData||{frag:i,part:s,cache:new er,complete:!1};e.push(new Uint8Array(r)),this.waitingVideoCC=this.videoTrackCC,this.state=Hi}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:i,part:s}=t;if(i.type===lt)if(this.fragContextChanged(i))this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if("initSegment"!==i.sn){this.fragPrevious=i;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(g.AUDIO_TRACK_SWITCHED,h({},e)))}this.fragBufferedComplete(i,s)}else if(!this.loadedmetadata&&i.type===ot){const e=this.videoBuffer||this.media;if(e){Ei.getBuffered(e).length&&(this.loadedmetadata=!0)}}}onError(e,t){var i;if(t.fatal)this.state=Gi;else switch(t.details){case v.FRAG_GAP:case v.FRAG_PARSING_ERROR:case v.FRAG_DECRYPT_ERROR:case v.FRAG_LOAD_ERROR:case v.FRAG_LOAD_TIMEOUT:case v.KEY_LOAD_ERROR:case v.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(lt,t);break;case v.AUDIO_TRACK_LOAD_ERROR:case v.AUDIO_TRACK_LOAD_TIMEOUT:case v.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Bi||(null==(i=t.context)?void 0:i.type)!==nt||(this.state=Mi);break;case v.BUFFER_FULL_ERROR:if(!t.parent||"audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case v.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushed(e,{type:t}){t===P&&(this.bufferFlushed=!0,this.state===$i&&(this.state=Mi))}_handleTransmuxComplete(e){var t;const i="audio",{hls:s}=this,{remuxResult:r,chunkMeta:n}=e,a=this.getCurrentContext(n);if(!a)return void this.resetWhenMissingContext(n);const{frag:o,part:l,level:c}=a,{details:d}=c,{audio:h,text:u,id3:p,initSegment:m}=r;if(!this.fragContextChanged(o)&&d){if(this.state=Ni,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),null!=m&&m.tracks){const e=o.initSegment||o;this._bufferInitSegment(m.tracks,e,n),s.trigger(g.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:i,tracks:m.tracks})}if(h){const{startPTS:e,endPTS:t,startDTS:i,endDTS:s}=h;l&&(l.elementaryStreams[P]={startPTS:e,endPTS:t,startDTS:i,endDTS:s}),o.setElementaryStreamInfo(P,e,t,i,s),this.bufferFragmentData(h,o,l,n)}if(null!=p&&null!=(t=p.samples)&&t.length){const e=f({id:i,frag:o,details:d},p);s.trigger(g.FRAG_PARSING_METADATA,e)}if(u){const e=f({id:i,frag:o,details:d},u);s.trigger(g.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(e,t,i){if(this.state!==Ni)return;e.video&&delete e.video;const s=e.audio;if(!s)return;s.levelCodec=s.codec,s.id="audio",this.log(`Init audio buffer, container:${s.container}, codecs[parsed]=[${s.codec}]`),this.hls.trigger(g.BUFFER_CODECS,e);const r=s.initSegment;if(null!=r&&r.byteLength){const e={type:"audio",frag:t,part:null,chunkMeta:i,parent:t.type,data:r};this.hls.trigger(g.BUFFER_APPENDING,e)}this.tick()}loadFragment(e,t,i){const s=this.fragmentTracker.getState(e);var r;(this.fragCurrent=e,this.switchingTrack||s===ni||s===oi)?"initSegment"===e.sn?this._loadInitSegment(e,t):null!=(r=t.details)&&r.live&&!this.initPTS[e.cc]?(this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Hi):(this.startFragRequested=!0,super.loadFragment(e,t,i)):this.clearTrackerIfNeeded(e)}completeAudioSwitch(e){const{hls:t,media:i,bufferedTrack:s}=this,r=null==s?void 0:s.attrs,n=e.attrs;i&&r&&(r.CHANNELS!==n.CHANNELS||r.NAME!==n.NAME||r.LANGUAGE!==n.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(g.AUDIO_TRACK_SWITCHED,h({},e))}},audioTrackController:class extends ei{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_PARSED,this.onManifestParsed,this),e.on(g.LEVEL_LOADING,this.onLevelLoading,this),e.on(g.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(g.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(g.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_PARSED,this.onManifestParsed,this),e.off(g.LEVEL_LOADING,this.onLevelLoading,this),e.off(g.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(g.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(g.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:s,details:r}=t,n=this.tracksInGroup[i];if(!n||n.groupId!==s)return void this.warn(`Track with id:${i} and group:${s} not found in active group ${n.groupId}`);const a=n.details;n.details=t.details,this.log(`audio-track ${i} "${n.name}" lang:${n.lang} group:${s} loaded [${r.startSN}-${r.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(null==t||!t.audioGroupIds)return;const i=t.audioGroupIds[t.urlId];if(this.groupId!==i){this.groupId=i||null;const e=this.tracks.filter((e=>!i||e.groupId===i));this.selectDefaultTrack&&!e.some((e=>e.default))&&(this.selectDefaultTrack=!1),this.tracksInGroup=e;const t={audioTracks:e};this.log(`Updating audio tracks, ${e.length} track(s) found in group:${i}`),this.hls.trigger(g.AUDIO_TRACKS_UPDATED,t),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(e,t){!t.fatal&&t.context&&t.context.type===nt&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(t))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn("Invalid id passed to audio-track controller");this.clearTimer();const i=this.currentTrack;t[this.trackId];const s=t[e],{groupId:r,name:n}=s;if(this.log(`Switching to audio-track ${e} "${n}" lang:${s.lang} group:${r}`),this.trackId=e,this.currentTrack=s,this.selectDefaultTrack=!1,this.hls.trigger(g.AUDIO_TRACK_SWITCHING,h({},s)),s.details&&!s.details.live)return;const a=this.switchParams(s.url,null==i?void 0:i.details);this.loadPlaylist(a)}selectInitialTrack(){const e=this.tracksInGroup,t=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(-1!==t)this.setAudioTrack(t);else{const t=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const s=t[i];if(!this.selectDefaultTrack||s.default){if(!e||void 0!==e.attrs["STABLE-RENDITION-ID"]&&e.attrs["STABLE-RENDITION-ID"]===s.attrs["STABLE-RENDITION-ID"])return s.id;if(e.name===s.name&&e.lang===s.lang)return s.id}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const s=t.id,r=t.groupId;let n=t.url;if(e)try{n=e.addDirectives(n)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}this.log(`loading audio-track playlist ${s} "${t.name}" lang:${t.lang} group:${r}`),this.clearTimer(),this.hls.trigger(g.AUDIO_TRACK_LOADING,{url:n,id:s,groupId:r,deliveryDirectives:e||null})}}},emeController:rn,cmcdController:un,contentSteeringController:class{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=S.log.bind(S,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(g.MANIFEST_PARSED,this.onManifestParsed,this),e.on(g.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(g.MANIFEST_PARSED,this.onManifestParsed,this),e.off(g.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){const e=Math.max(1e3*this.timeToLoad-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter((t=>t!==e)))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;null!==i&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if((null==i?void 0:i.action)===Yt&&i.flags===Zt){let e=this.pathwayPriority;const t=this.pathwayId;this.penalizedPathways[t]||(this.penalizedPathways[t]=performance.now()),!e&&this.levels&&(e=this.levels.reduce(((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e)),[])),e&&e.length>1&&(this.updatePathwayPriority(e),i.resolved=this.pathwayId!==t)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter((t=>e===t.pathwayId))}updatePathwayPriority(e){let t;this.pathwayPriority=e;const i=this.penalizedPathways,s=performance.now();Object.keys(i).forEach((e=>{s-i[e]>3e5&&delete i[e]}));for(let r=0;r<e.length;r++){const s=e[r];if(i[s])continue;if(s===this.pathwayId)return;const n=this.hls.nextLoadLevel,a=this.hls.levels[n];if(t=this.getLevelsForPathway(s),t.length>0){this.log(`Setting Pathway to "${s}"`),this.pathwayId=s,this.hls.trigger(g.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[n];a&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==a.bitrate&&this.log(`Unstable Pathways change from bitrate ${a.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=n);break}}}clonePathways(e){const t=this.levels;if(!t)return;const i={},s={};e.forEach((e=>{const{ID:r,"BASE-ID":n,"URI-REPLACEMENT":a}=e;if(t.some((e=>e.pathwayId===r)))return;const o=this.getLevelsForPathway(n).map((e=>{const t=f({},e);t.details=void 0,t.url=pn(e.uri,e.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a);const n=new w(e.attrs);n["PATHWAY-ID"]=r;const o=n.AUDIO&&`${n.AUDIO}_clone_${r}`,l=n.SUBTITLES&&`${n.SUBTITLES}_clone_${r}`;o&&(i[n.AUDIO]=o,n.AUDIO=o),l&&(s[n.SUBTITLES]=l,n.SUBTITLES=l),t.attrs=n;const c=new kt(t);return si(c,"audio",o),si(c,"text",l),c}));t.push(...o),fn(this.audioTracks,i,a,r),fn(this.subtitleTracks,s,a,r)}))}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;let s;this.loader&&this.loader.destroy(),this.loader=new i(t);try{s=new self.URL(e)}catch(c){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==s.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+e)}const r={responseType:"json",url:s.href},n=t.steeringManifestLoadPolicy.default,a=n.errorRetry||n.timeoutRetry||{},o={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(e,t,i,r)=>{this.log(`Loaded steering manifest: "${s}"`);const n=e.data;if(1!==n.VERSION)return void this.log(`Steering VERSION ${n.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=n.TTL;const{"RELOAD-URI":a,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=n;if(a)try{this.uri=new self.URL(a,s).href}catch(c){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${a}`)}this.scheduleRefresh(this.uri||i.url),o&&this.clonePathways(o),l&&this.updatePathwayPriority(l)},onError:(e,t,i,s)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log(`Steering manifest ${t.url} no longer available`);let r=1e3*this.timeToLoad;if(429!==e.code)this.scheduleRefresh(this.uri||t.url,r);else{const e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(r=1e3*parseFloat(t))}this.log(`Steering manifest ${t.url} rate limited`)}},onTimeout:(e,t,i)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(r,o,l)}scheduleRefresh(e,t=1e3*this.timeToLoad){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout((()=>{this.loadSteeringManifest(e)}),t)}}});function _n(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(_n):Object.keys(e).reduce(((t,i)=>(t[i]=_n(e[i]),t)),{}):e}function wn(e){const t=e.loader;if(t!==yn&&t!==mn)S.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{(function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1})()&&(e.loader=yn,e.progressive=!0,e.enableSoftwareAES=!0,S.log("[config]: Progressive streaming enabled, using FetchLoader"))}}class An{static get version(){return"1.4.10"}static isSupported(){return function(){const e=$e();if(!e)return!1;const t=qi(),i=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),s=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!i&&!!s}()}static get Events(){return g}static get ErrorTypes(){return m}static get ErrorDetails(){return v}static get DefaultConfig(){return An.defaultConfig?An.defaultConfig:Ln}static set DefaultConfig(e){An.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Ws,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,function(e,t){if(self.console&&!0===e||"object"==typeof e){b(e,"debug","log","info","warn","error");try{E.log(`Debug logs enabled for "${t}" in hls.js version 1.4.10`)}catch(i){E=T}}else E=T}(e.debug||!1,"Hls instance");const t=this.config=function(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=_n(e),s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((e=>{const r=`${"level"===e?"playlist":e}LoadPolicy`,n=void 0===t[r],a=[];s.forEach((s=>{const o=`${e}Loading${s}`,l=t[o];if(void 0!==l&&n){a.push(o);const e=i[r].default;switch(t[r]={default:e},s){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}})),a.length&&S.warn(`hls.js config: "${a.join('", "')}" setting(s) are deprecated, use "${r}": ${JSON.stringify(t[r])}`)})),h(h({},i),t)}(An.DefaultConfig,e);this.userConfig=e,this._autoLevelCapping=-1,t.progressive&&wn(t);const{abrController:i,bufferController:s,capLevelController:r,errorController:n,fpsController:a}=t,o=new n(this),l=this.abrController=new i(this),c=this.bufferController=new s(this),d=this.capLevelController=new r(this),u=new a(this),f=new ut(this),p=new Lt(this),m=t.contentSteeringController,v=m?new m(this):null,y=this.levelController=new ii(this,v),L=new ci(this),_=new vi(this.config),w=this.streamController=new Zs(this,L,_);d.setStreamController(w),u.setStreamController(w);const A=[f,y,w];v&&A.splice(1,0,v),this.networkControllers=A;const R=[l,c,d,u,p,L];this.audioTrackController=this.createController(t.audioTrackController,A);const C=t.audioStreamController;C&&A.push(new C(this,L,_)),this.subtitleTrackController=this.createController(t.subtitleTrackController,A);const P=t.subtitleStreamController;P&&A.push(new P(this,L,_)),this.createController(t.timelineController,R),_.emeController=this.emeController=this.createController(t.emeController,R),this.cmcdController=this.createController(t.cmcdController,R),this.latencyController=this.createController(_t,R),this.coreComponents=R,A.push(o);const k=o.onErrorOut;"function"==typeof k&&this.on(g.ERROR,k,o)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,s){this._emitter.off(e,t,i,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){S.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),this.trigger(g.ERROR,{type:m.OTHER_ERROR,details:v.INTERNAL_EXCEPTION,fatal:!1,event:e,error:i})}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){S.log("destroy"),this.trigger(g.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((e=>e.destroy())),this.networkControllers.length=0,this.coreComponents.forEach((e=>e.destroy())),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){S.log("attachMedia"),this._media=e,this.trigger(g.MEDIA_ATTACHING,{media:e})}detachMedia(){S.log("detachMedia"),this.trigger(g.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,i=this.url,s=this.url=c.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});S.log(`loadSource:${s}`),t&&i&&(i!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(g.MANIFEST_LOADING,{url:e})}startLoad(e=-1){S.log(`startLoad(${e})`),this.networkControllers.forEach((t=>{t.startLoad(e)}))}stopLoad(){S.log("stopLoad"),this.networkControllers.forEach((e=>{e.stopLoad()}))}swapAudioCodec(){S.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){S.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e,t=0){this.levelController.removeLevel(e,t)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){S.log(`set currentLevel:${e}`),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){S.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){S.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){S.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){return this.levelController.startLevel}set startLevel(e){S.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(S.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){wt.indexOf(e)>-1&&(this._maxHdcpLevel=e)}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let s=0;s<i;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let s;if(s=-1===t&&e&&e.length?e.length-1:t,i)for(let r=s;r--;){const t=e[r].attrs["HDCP-LEVEL"];if(t&&t<=i)return r}return s}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}An.defaultConfig=void 0;var Rn=function(e,t){return Rn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},Rn(e,t)};var Cn,Pn,kn,Dn,In,Mn,On,xn,Fn=function(){return Fn=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Fn.apply(this,arguments)};function Bn(e,t,i,s){return new(i||(i=Promise))((function(r,n){function a(e){try{l(s.next(e))}catch(t){n(t)}}function o(e){try{l(s.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))}function Nn(e,t){var i,s,r,n,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function o(n){return function(o){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(r=2&n[0]?s.return:n[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,n[1])).done)return r;switch(s=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,s=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){a.label=n[1];break}if(6===n[0]&&a.label<r[1]){a.label=r[1],r=n;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(n);break}r[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(o){n=[6,o],s=0}finally{i=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,o])}}}function Un(e,t,i){if(i||2===arguments.length)for(var s,r=0,n=t.length;r<n;r++)!s&&r in t||(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))}function $n(e){return{all:e=e||new Map,on:function(t,i){var s=e.get(t);s?s.push(i):e.set(t,[i])},off:function(t,i){var s=e.get(t);s&&(i?s.splice(s.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var s=e.get(t);s&&s.slice().map((function(e){e(i)})),(s=e.get("*"))&&s.slice().map((function(e){e(t,i)}))}}}!function(e){e.HLS="hls",e.MP4="mp4",e.MP3="mp3"}(Cn||(Cn={})),function(e){e.MEDIA_ATTACH="mediaAttach",e.ERROR="error",e.RECOVER="recover",e.LEVEL_UPDATED="levelUpdated",e.LEVEL_SWITCHING="levelSwitching",e.MANIFEST_PARSED="manifestParsed"}(Pn||(Pn={})),function(e){e.PLAY="play",e.PAUSE="pause",e.DURATION_CHANGE="durationChange",e.LOADING_STATE_CHANGE="loadingStateChange",e.VOLUME_CHANGE="volumeChange",e.TIME_UPDATE="timeUpdate",e.MEDIA_ATTACH="mediaAttach",e.BUFFERED_UPDATE="bufferedUpdate",e.PLAYBACK_RATE_CHANGE="playbackRateChange",e.ENDED="ended",e.ERROR="error",e.RECOVER="recover",e.VIEW_START="viewStart",e.VIEW_FINISH="viewFinish",e.REWIND="rewind",e.LOADED_METADATA="loadedMetadata",e.LEVEL_UPDATED="levelUpdated",e.LEVEL_SWITCHING="levelSwitching",e.MANIFEST_PARSED="manifestParsed"}(kn||(kn={})),function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(Dn||(Dn={})),function(e){e.PAUSE_VIDEO="Pause video",e.END_VIDEO="End video",e.CHANGE_SOURCE="Change source",e.CLOSE_PIP="Close Pip",e.CLOSE_BROWSER_TAB="Close browser tab",e.END_STREAM="End stream",e.DESTROY_COMPONENT="Destroy component"}(In||(In={})),function(e){e.STARTUP_TIME="STARTUP_TIME",e.STALL_COUNT="STALL_COUNT",e.STALL_DURATION="STALL_DURATION",e.STALL_WAIT_RATIO="STALL_WAIT_RATIO",e.STALL_RATE="STALL_RATE",e.ERRORS_COUNT="ERRORS_COUNT",e.VIEW_TIME="VIEW_TIME",e.TIME_WEIGHED_BITRATE="TIME_WEIGHED_BITRATE",e.EWMA_BANDWIDTH="EWMA_BANDWIDTH"}(Mn||(Mn={})),function(e){e.PLAY="player.play"}(On||(On={})),function(e){e.DEFAULT="default",e.NARROW="narrow"}(xn||(xn={}));var Gn=function(){function e(e,t){this._emitter=$n(),this._loop=!1,this._startTime=0,this._waitCanPlayThroughEvent=!1,this._firstCanPlayThroughtEvent=!1,this._currentTimeOnLastTimeUpdate=0,this._onTimeUpdateTimeout=null,this._viewDurationInterval=null,this._seekingFrom=0,this._prevVolume=1,this._rewinding=!1,this._buffered=0,this._levelsSwitched=[],this._perfStallCount=0,this._perfPrevStallDate=null,this._perfStallDuration=0,this._perfStartLoadSourceDate=null,this._perfStartupTime=0,this._perfErrorsCount=0,this._perfViewTime=0,this.tryPlayed=!1,this._videoElementEvents={play:this._onPlay.bind(this),pause:this._onPause.bind(this),durationchange:this._onDurationChange.bind(this),loadedmetadata:this._onLoadedmetadata.bind(this),waiting:this._onWaiting.bind(this),canplaythrough:this._canPlayThrough.bind(this),volumechange:this._onVolumeChange.bind(this),timeupdate:this._onTimeUpdate.bind(this),progress:this._onProgress.bind(this),ratechange:this._onRateChange.bind(this),ended:this._onEnded.bind(this),seeking:this._onSeeking.bind(this),seeked:this._onSeeked.bind(this),error:this._onError.bind(this)},this.videoElement=null,this.playing=!1,this.loading=!1,this.duration=0,this.viewDuration=0,this.videoElement=e,this._startTime=t.startTime||0,this._loop=t.loop||!1,this._configureVideoElement(t),this._addVideoElementEventListeners()}return e.prototype.getTimeWeighedBitrate=function(e,t,i){if(e<=0||t<=0||e>t)return 0;var s=+e/t*+(i/1024/1024).toFixed(2);return!s||isNaN(s)?0:s},Object.defineProperty(e.prototype,"_perfTimeWeighedBitrate",{get:function(){var e,t,i=0,s=this._perfViewTime;if(s>0)for(var r=0;r<this._levelsSwitched.length;r++){var n=this._levelsSwitched[r],a=((null===(t=null===(e=this._levelsSwitched)||void 0===e?void 0:e[r+1])||void 0===t?void 0:t.startWatched)||s)-n.startWatched;a>0&&(i+=this.getTimeWeighedBitrate(a,s,n.bitrate))}return+i.toFixed(2)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_perfBandwidthEstimate",{get:function(){return this._source?this._source.getBandwidthEstimate():-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMediaNative",{get:function(){var e;return null===(e=this._source)||void 0===e?void 0:e.isMediaNative},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this.videoElement.currentTime},set:function(e){this.videoElement.currentTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackRate",{get:function(){return this.videoElement.playbackRate},set:function(e){this.videoElement.playbackRate=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this.videoElement.muted},set:function(e){this.videoElement.muted!==e&&(e?(this._prevVolume=this.videoElement.volume,this.videoElement.volume=0):this.videoElement.volume=this._prevVolume||1,this.videoElement.muted=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this.videoElement.volume},set:function(e){this.videoElement.muted=0===e,this.videoElement.volume=e},enumerable:!1,configurable:!0}),e.prototype._emit=function(e,t){this._emitter.emit(e,t)},e.prototype._clearAllEventListeners=function(){this._emitter.all.clear()},e.prototype._configureVideoElement=function(e){var t=e.initialVolume||1;this.videoElement.muted=e.initialMuted||!1,this.videoElement.controls=e.showNativeControls||!1,this.videoElement.playsInline=!0,this.videoElement.disablePictureInPicture=!0,this.videoElement.muted?(this._prevVolume=t,e.showNativeControls||(this.videoElement.volume=0)):this.videoElement.volume=t},e.prototype._onPlay=function(){this.playing=!0,this._emit(kn.PLAY),this.videoElement.readyState===Dn.HAVE_ENOUGH_DATA?(this._emit(kn.VIEW_START,{number:Math.round(this.currentTime)}),this._startViewDurationInterval()):this._waitCanPlayThroughEvent=!0},e.prototype._onPause=function(){this.playing=!1,this._emit(kn.PAUSE);var e=this.videoElement.ended?In.END_VIDEO:In.PAUSE_VIDEO;this._emit(kn.VIEW_FINISH,{number:Math.round(this.viewDuration),status:e}),this._clearViewDurationInterval()},e.prototype._onEnded=function(){this._emit(kn.ENDED),this._loop&&this.play()},e.prototype._onLoadedmetadata=function(){this._emit(kn.LOADED_METADATA),this.currentTime=this._startTime,this._onDurationChange()},e.prototype._onDurationChange=function(){isNaN(this.videoElement.duration)||(this.duration=this.videoElement.duration,this._emit(kn.DURATION_CHANGE,this.duration))},e.prototype._onSeeking=function(){this._rewinding&&(this._seekingFrom=this._currentTimeOnLastTimeUpdate)},e.prototype._onSeeked=function(){this._rewinding&&(this._emit(kn.REWIND,{videoTimescaleFrom:Math.round(this._seekingFrom),videoTimescaleTo:Math.round(this.currentTime)}),this._seekingFrom=null,this._rewinding=!1)},e.prototype._onVolumeChange=function(){this._emit(kn.VOLUME_CHANGE,{muted:this.muted,volume:this.volume})},e.prototype._onWaiting=function(){!this._firstCanPlayThroughtEvent||this._rewinding||this._perfPrevStallDate||(this._perfStallCount++,this._perfPrevStallDate=Date.now()),this.loading=!0,this._emit(kn.LOADING_STATE_CHANGE,!0)},e.prototype._canPlayThrough=function(){this._firstCanPlayThroughtEvent||(this._firstCanPlayThroughtEvent=!0),this.loading=!1,this._perfPrevStallDate&&(this._perfStallDuration=this._perfStallDuration+(Date.now()-this._perfPrevStallDate)/1e3,this._perfPrevStallDate=null),this._perfStartLoadSourceDate&&(this._perfStartupTime=(Date.now()-this._perfStartLoadSourceDate)/1e3,this._perfStartLoadSourceDate=null),this._emit(kn.LOADING_STATE_CHANGE,!1),this._waitCanPlayThroughEvent&&(this.playing&&(this._emit(kn.VIEW_START,{number:Math.round(this.currentTime)}),this._startViewDurationInterval()),this._waitCanPlayThroughEvent=!1)},e.prototype._onTimeUpdate=function(){var e=this;this._onTimeUpdateTimeout=setTimeout((function(){e.videoElement&&(e._currentTimeOnLastTimeUpdate=e.currentTime)}),50),this._emit(kn.TIME_UPDATE,this.currentTime)},e.prototype._onProgress=function(){try{this.duration>0&&this.videoElement.buffered.length>0&&(this._buffered=this.videoElement.buffered.end(this.videoElement.buffered.length-1),this._emit(kn.BUFFERED_UPDATE,this._buffered))}catch(e){return null}},e.prototype._onError=function(e){this._emit(kn.ERROR,{message:"invalid src",error:e})},e.prototype._onRateChange=function(){this._emit(kn.PLAYBACK_RATE_CHANGE,this.playbackRate)},e.prototype._startViewDurationInterval=function(){var e=this;this.viewDuration=0,this._viewDurationInterval=setInterval((function(){e.loading||(e.viewDuration++,e._perfViewTime++)}),1e3)},e.prototype._clearViewDurationInterval=function(){clearInterval(this._viewDurationInterval),this.viewDuration=0},e.prototype._addEventSourceListeners=function(){var e=this;this._source.on(Pn.MEDIA_ATTACH,(function(){e._perfStartLoadSourceDate=Date.now(),e._emit(kn.MEDIA_ATTACH)})),this._source.on(Pn.MANIFEST_PARSED,(function(t){e._emit(kn.MANIFEST_PARSED,t)})),this._source.on(Pn.ERROR,(function(t){e._perfErrorsCount++,e._emit(kn.ERROR,t)})),this._source.on(Pn.RECOVER,(function(){e._emit(kn.RECOVER)})),this._source.on(Pn.LEVEL_UPDATED,(function(t){e._emit(kn.LEVEL_UPDATED,t)})),this._source.on(Pn.LEVEL_SWITCHING,(function(t){var i={bitrate:t.data.bitrate,startWatched:e._perfViewTime};e._levelsSwitched.push(i),e._emit(kn.LEVEL_SWITCHING,t)}))},e.prototype._addVideoElementEventListeners=function(){var e=this;Object.entries(this._videoElementEvents).forEach((function(t){var i=t[0],s=t[1];e.videoElement.addEventListener(i,s)}))},e.prototype._removeVideoElementListeners=function(){var e=this;Object.entries(this._videoElementEvents).forEach((function(t){var i=t[0],s=t[1];e.videoElement.removeEventListener(i,s)}))},e.prototype._onChangeSource=function(){this.playing&&this._emit(kn.VIEW_FINISH,{number:Math.round(this.viewDuration),status:In.CHANGE_SOURCE})},e.prototype.changeLevel=function(e){this._source.changeLevel(e)},e.prototype._resetPlayerState=function(){this.loading=!1,this.duration=0,this.playing=!1,this._waitCanPlayThroughEvent=!1,this._firstCanPlayThroughtEvent=!1,this._currentTimeOnLastTimeUpdate=0,clearTimeout(this._onTimeUpdateTimeout),this._onTimeUpdateTimeout=null,this._seekingFrom=0,this._prevVolume=1,this._buffered=0,this._rewinding=!1,this._clearViewDurationInterval(),this._perfStallCount=0,this._perfPrevStallDate=null,this._perfStallDuration=0,this._perfStartLoadSourceDate=null,this._perfStartupTime=0,this._perfErrorsCount=0,this._perfViewTime=0,this._levelsSwitched=[],this.tryPlayed=!1},e.prototype._destroySource=function(){this._source&&this._source.destroy()},e.prototype.getPerfomanceInfo=function(){var e;return{metrics:(e={},e[Mn.STARTUP_TIME]=this._perfStartupTime,e[Mn.STALL_COUNT]=this._perfStallCount,e[Mn.STALL_DURATION]=this._perfStallDuration,e[Mn.STALL_WAIT_RATIO]=this._perfStallDuration/this._perfViewTime,e[Mn.STALL_RATE]=this._perfStallCount/this._perfViewTime,e[Mn.ERRORS_COUNT]=this._perfErrorsCount,e[Mn.VIEW_TIME]=this._perfViewTime,e[Mn.TIME_WEIGHED_BITRATE]=this._perfTimeWeighedBitrate,e[Mn.EWMA_BANDWIDTH]=this._perfBandwidthEstimate,e)}},e.prototype.on=function(e,t){this._emitter.on(e,t)},e.prototype.off=function(e,t){this._emitter.off(e,t)},e.prototype.play=function(){return Bn(this,void 0,void 0,(function(){return Nn(this,(function(e){switch(e.label){case 0:return this.tryPlayed=!0,[4,this.videoElement.play().catch((function(e){if("AbortError"!==e.name)throw e}))];case 1:return e.sent(),[2]}}))}))},e.prototype.pause=function(){this.videoElement.pause()},e.prototype.rewind=function(e){this._rewinding=!0,this.currentTime=e},e.prototype.loadSource=function(e){this._source&&this._onChangeSource(),this._destroySource(),this._resetPlayerState(),this._source=e,this._addEventSourceListeners(),this._source.attach(this.videoElement)},e.prototype.resetSource=function(){this._source&&this._onChangeSource(),this._destroySource(),this._resetPlayerState(),this._emit(kn.DURATION_CHANGE,this.duration),this._source=null},e.prototype.recoverSource=function(){this._source.recover()},e.prototype.destroy=function(){this._destroySource(),this._removeVideoElementListeners(),this._clearAllEventListeners(),this._clearViewDurationInterval(),clearTimeout(this._onTimeUpdateTimeout),this.videoElement=null},e}(),Hn=function(){function e(e,t){void 0===t&&(t={}),this._emitter=$n(),this.sourceSettings=null,this.videoElement=null,this.type=Cn.MP4,this.src=null,this.src=e,this.sourceSettings=t}return e.prototype._emit=function(e,t){this._emitter.emit(e,t)},e.prototype._clearAllEventListeners=function(){this._emitter.all.clear()},e.prototype.on=function(e,t){this._emitter.on(e,t)},e.prototype.off=function(e,t){this._emitter.off(e,t)},e.prototype.attach=function(e){var t=this;this.videoElement=e,e.src=this.src,setTimeout((function(){t._emit(Pn.MEDIA_ATTACH)})),this.isMediaNative=!0},e.prototype.recover=function(){},e.prototype.changeLevel=function(e){},e.prototype.getBandwidthEstimate=function(){return NaN},e.prototype.destroy=function(){this._clearAllEventListeners(),this.videoElement.src="",this.videoElement=null},e}(),Vn=function(e){function t(t,i){void 0===i&&(i={});var s=e.call(this,t,i)||this;return s.type=Cn.HLS,s._hls=null,s._currentErrorType=null,s.extraRequestHeadersEntries=[],s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}Rn(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}(t,e),t.prototype._onXhrSetup=function(e){this.extraRequestHeadersEntries.forEach((function(t){var i=t[0],s=t[1];e.setRequestHeader(i,s)}))},t.prototype.attach=function(e){var t,i=this;if(this.videoElement=e,An.isSupported()){var s=this.sourceSettings.hlsOptions||{},r=this.sourceSettings.extraRequestHeaders,n=void 0!==this.sourceSettings.startTime?this.sourceSettings.startTime:-1;this.extraRequestHeadersEntries=Object.entries(r||{});var a=null===(t=navigator.connection)||void 0===t?void 0:t.downlink;this._hls=new An(Fn(Fn(Fn({maxBufferLength:5,maxBufferSize:5e6,backBufferLength:5,startPosition:n,currentLevel:-1},this.extraRequestHeadersEntries.length?{xhrSetup:this._onXhrSetup.bind(this)}:{}),{abrEwmaDefaultEstimate:a?1e6*a:void 0}),s)),this._hls.attachMedia(this.videoElement),this._hls.on(An.Events.MEDIA_ATTACHED,(function(){i._hls.loadSource(i.src),i._emit(Pn.MEDIA_ATTACH)})),this._hls.on(An.Events.LEVEL_UPDATED,(function(e,t){i._emit(Pn.LEVEL_UPDATED,{event:e,data:t})})),this._hls.on(An.Events.MANIFEST_PARSED,(function(e,t){i._emit(Pn.MANIFEST_PARSED,{event:e,data:t})})),this._hls.on(An.Events.ERROR,(function(e,t){t.fatal&&(i._currentErrorType=t.type,i._emit(Pn.ERROR,{event:e,data:t}))})),this._hls.on(An.Events.FRAG_LOADED,(function(){})),this._hls.on(An.Events.LEVEL_SWITCHING,(function(e,t){i._emit(Pn.LEVEL_SWITCHING,{event:e,data:t})})),this.isMediaNative=!1}else{if(!this.videoElement.canPlayType("application/vnd.apple.mpegurl"))throw Error("hls not supported");this.videoElement.src=this.src,setTimeout((function(){i._emit(Pn.MEDIA_ATTACH)})),this.isMediaNative=!0}},t.prototype.recover=function(){if(this._hls)switch(this._currentErrorType){case An.ErrorTypes.NETWORK_ERROR:this._hls.startLoad(),this._currentErrorType=null,this._emit(Pn.RECOVER);break;case An.ErrorTypes.MEDIA_ERROR:this._hls.recoverMediaError(),this._currentErrorType=null,this._emit(Pn.RECOVER);break;default:this._hls.destroy()}},t.prototype.getBandwidthEstimate=function(){var e;return Math.round(null===(e=this._hls)||void 0===e?void 0:e.bandwidthEstimate)},t.prototype.changeLevel=function(e){this._hls.currentLevel=e},t.prototype.destroy=function(){e.prototype.destroy.call(this),this._hls&&(this._hls.detachMedia(),this._hls.destroy(),this._hls=null)},t}(Hn),Kn=function(){function e(e,t){void 0===t&&(t={}),this._emitter=$n(),this.sourceSettings=null,this.audioElement=null,this.type=Cn.MP3,this.src=null,this.src=e,this.sourceSettings=t}return e.prototype._emit=function(e,t){this._emitter.emit(e,t)},e.prototype._clearAllEventListeners=function(){this._emitter.all.clear()},e.prototype.on=function(e,t){this._emitter.on(e,t)},e.prototype.off=function(e,t){this._emitter.off(e,t)},e.prototype.attach=function(e){var t=this;this.audioElement=e,e.src=this.src,setTimeout((function(){t._emit(Pn.MEDIA_ATTACH)}))},e.prototype.recover=function(){},e.prototype.destroy=function(){this._clearAllEventListeners(),this.audioElement.src="",this.audioElement=null},e}(),qn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},jn=qn&&qn.__assign||function(){return jn=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},jn.apply(this,arguments)},Wn=qn&&qn.__rest||function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(i[s[r]]=e[s[r]])}return i},Yn={functional:!0,render:function(e,t){var i=t._c,s=(t._v,t.data),r=t.children,n=void 0===r?[]:r,a=s.class,o=s.staticClass,l=s.style,c=s.staticStyle,d=s.attrs,h=void 0===d?{}:d,u=Wn(s,["class","staticClass","style","staticStyle","attrs"]);return i("svg",jn({class:[a,o],style:[l,c],attrs:Object.assign({width:"40",height:"40",xmlns:"http://www.w3.org/2000/svg"},h)},u),n.concat([i("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[i("path",{attrs:{d:"M0 0h40v40H0z"}}),i("circle",{attrs:{cx:"10",cy:"20",r:"3.3",fill:"currentColor"}},[i("animate",{attrs:{attributeName:"r",begin:"0s",calcMode:"linear",dur:"1.2s",from:"3.3",repeatCount:"indefinite",to:"3.3",values:"3.3;1;3.3;3.3;3.3;3.3;"}}),i("animate",{attrs:{attributeName:"fill-opacity",begin:"0s",calcMode:"linear",dur:"1.2s",from:"1",repeatCount:"indefinite",to:"1",values:"1;.3;1;1;1;1;1"}})]),i("circle",{attrs:{cx:"20",cy:"20",r:"3.3",fill:"currentColor"}},[i("animate",{attrs:{attributeName:"r",begin:"0s",calcMode:"linear",dur:"1.2s",from:"3.3",repeatCount:"indefinite",to:"3.3",values:"3.3;3.3;1;3.3;3.3;3.3;3.3"}}),i("animate",{attrs:{attributeName:"fill-opacity",begin:"0s",calcMode:"linear",dur:"1.2s",from:".5",repeatCount:"indefinite",to:".5",values:"1;1;.3;1;1;1;1"}})]),i("circle",{attrs:{cx:"30",cy:"20",r:"3.3",fill:"currentColor"}},[i("animate",{attrs:{attributeName:"r",begin:"0s",calcMode:"linear",dur:"1.2s",from:"3.3",repeatCount:"indefinite",to:"3.3",values:"3.3;3.3;3.3;1;3.3;3.3;3.3"}}),i("animate",{attrs:{attributeName:"fill-opacity",begin:"0s",calcMode:"linear",dur:"1.2s",from:"1",repeatCount:"indefinite",to:"1",values:"1;1;1;.3;1;1;1"}})])])]))}};function zn(e){return e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):e.webkitEnterFullScreen?e.webkitEnterFullScreen(Element.ALLOW_KEYBOARD_INPUT):Promise.reject()}function Xn(){return document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():Promise.reject()}function Zn(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement}function Qn(){return Qn=Object.assign?Object.assign.bind():function(e){for(var t,i=1;i<arguments.length;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},Qn.apply(this,arguments)}var Jn=["attrs","props","domProps"],ea=["class","style","directives"],ta=["on","nativeOn"],ia=function(e,t){return function(){e&&e.apply(this,arguments),t&&t.apply(this,arguments)}},sa=function(e){return e.reduce((function(e,t){for(var i in t)if(e[i])if(-1!==Jn.indexOf(i))e[i]=Qn({},e[i],t[i]);else if(-1!==ea.indexOf(i)){var s=e[i]instanceof Array?e[i]:[e[i]],r=t[i]instanceof Array?t[i]:[t[i]];e[i]=[].concat(s,r)}else if(-1!==ta.indexOf(i))for(var n in t[i])if(e[i][n]){var a=e[i][n]instanceof Array?e[i][n]:[e[i][n]],o=t[i][n]instanceof Array?t[i][n]:[t[i][n]];e[i][n]=[].concat(a,o)}else e[i][n]=t[i][n];else if("hook"===i)for(var l in t[i])e[i][l]=e[i][l]?ia(e[i][l],t[i][l]):t[i][l];else e[i]=t[i];else e[i]=t[i];return e}),{})};function ra(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function na(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ra(Object(i),!0).forEach((function(t){ca(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ra(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function aa(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oa(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function la(e,t,i){return t&&oa(e.prototype,t),i&&oa(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function ca(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function da(e){return da=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},da(e)}function ha(e,t){return ha=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ha(e,t)}function ua(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,s=da(e);if(t){var r=da(this).constructor;i=Reflect.construct(s,arguments,r)}else i=s.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ua(e)}(this,i)}}function pa(){return pa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var s=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=da(e)););return e}(e,t);if(s){var r=Object.getOwnPropertyDescriptor(s,t);return r.get?r.get.call(arguments.length<3?e:i):r.value}},pa.apply(this,arguments)}function ga(e){return function(e){if(Array.isArray(e))return ma(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return ma(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ma(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ma(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}var va={primary:"primary",empty:"empty",videoControl:"videoControl"},ya={XS:"xs",S:"s",M:"m",L:"l",XL:"xl",XXL:"xxl"};function Ta(e){return e.charAt(0).toUpperCase()+e.slice(1)}var Ea=function(e,t,i){var s,r=e.fill,n=e.fillVertical;return[i,t.root,(s={},ca(s,t.fillWidth,r),ca(s,t.fillHeight,n),s)]},ba=function(e,t){var i,s=e.fillVertical,r=e.theme,n=e.fill;return[t.button,(i={},ca(i,t.fillHeight,s),ca(i,t.fillWidth,n&&r),i)]},Sa=function(e,t){var i,s=e.theme,r=e.size,n=e.fill;return[t.innerButton,t.emptyText,(i={},ca(i,t["theme".concat(Ta(s))],s&&s!==va.primary),ca(i,t["size".concat(Ta(r))],r&&r!==ya.M),ca(i,t.fillWidth,n),i)]},La={name:"Button",functional:!0,props:{size:{type:String,default:ya.M,validator:function(e){return Object.values(ya).includes(e)}},theme:{type:String,default:va.primary,validator:function(e){return Object.values(va).includes(e)}},fill:{type:Boolean,default:!1},fillVertical:{type:Boolean,default:!1},borderRadius:{type:String,default:"6px"},icon:{type:Object,default:function(){return{}}},iconColor:{type:String,default:""},qaId:{type:String,default:""}},render:function(e,t){var i=t.props,s=t.$style,r=t.data,n=t._v,a=t.listeners,o=t.scopedSlots,l=r.ref||null,c=r.attrs||{},d=r.directives||[],h=[];d.forEach((function(e){"qa"!==e.name&&h.push(e)}));var u,f=i.icon,p=(o.content||function(){})(),g="string"==typeof p?[n(p)]:p,m=Object.keys(i.icon).length?[e(f,{class:s.icon,style:{color:i.iconColor}})]:[],v={attrs:na({tabindex:i.disableInteractive?-1:i.tabIndex,disabled:i.disabled||i.disableInteractive,type:i.type,role:"button"},i.ariaLabel?{"aria-label":i.ariaLabel}:{}),class:ba(i,s),on:na(na({},a),{},{click:function(e){a.click&&a.click(e)}})};return e("div",sa([{class:Ea(i,s,r.class),style:r.style,ref:l},{attributes:c},{},{directives:h}]),[e("button",sa([{},v,{attrs:{"qa-id":i.qaId}}]),[e("span",{class:Sa(i,s),style:(u=i,{borderRadius:u.borderRadius})},ga(g||m))])])}};var _a=function(e,t,i,s,r,n,a,o,l,c){"boolean"!=typeof a&&(l=o,o=a,a=!1);var d,h="function"==typeof i?i.options:i;if(e&&e.render&&(h.render=e.render,h.staticRenderFns=e.staticRenderFns,h._compiled=!0,r&&(h.functional=!0)),s&&(h._scopeId=s),n?(d=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,l(e)),e&&e._registeredComponents&&e._registeredComponents.add(n)},h._ssrRegister=d):t&&(d=a?function(){t.call(this,c(this.$root.$options.shadowRoot))}:function(e){t.call(this,o(e))}),d)if(h.functional){var u=h.render;h.render=function(e,t){return d.call(t),u(e,t)}}else{var f=h.beforeCreate;h.beforeCreate=f?[].concat(f,d):[d]}return i},wa="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());var Aa=document.head||document.getElementsByTagName("head")[0],Ra={};var Ca=function(e){return function(e,t){return function(e,t){var i=wa?t.media||"default":e,s=Ra[i]||(Ra[i]={ids:new Set,styles:[]});if(!s.ids.has(e)){s.ids.add(e);var r=t.source;if(t.map&&(r+="\n/*# sourceURL="+t.map.sources[0]+" */",r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t.map))))+" */"),s.element||(s.element=document.createElement("style"),s.element.type="text/css",t.media&&s.element.setAttribute("media",t.media),Aa.appendChild(s.element)),"styleSheet"in s.element)s.styles.push(r),s.element.styleSheet.cssText=s.styles.filter(Boolean).join("\n");else{var n=s.ids.size-1,a=document.createTextNode(r),o=s.element.childNodes;o[n]&&s.element.removeChild(o[n]),o.length?s.element.insertBefore(a,o[n]):s.element.appendChild(a)}}}(e,t)}};const Pa=_a({},(function(e){e&&(e("data-v-47b4f5f2_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{root:"iArfS",auto:"mDLMe",button:"_1Apud",innerButton:"_3dsyP",sizeL:"_3VbMo",sizeXl:"_3to6B",sizeXxl:"_3PWjz",themeVideoControl:"_1MsVB",themeEmpty:"_8xvk7",vertical:"Kff8u",icon:"_-9Er2",emptyText:"_3ETHG",fillHeight:"_29WGe","focus-visible":"_2-e31",fillWidth:"A-mH3",blink:"_1DJXu"}}))}),La,undefined,undefined,undefined,!1,Ca,void 0,void 0);var ka=qn&&qn.__assign||function(){return ka=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},ka.apply(this,arguments)},Da=qn&&qn.__rest||function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(i[s[r]]=e[s[r]])}return i},Ia={functional:!0,render:function(e,t){var i=t._c,s=(t._v,t.data),r=t.children,n=void 0===r?[]:r,a=s.class,o=s.staticClass,l=s.style,c=s.staticStyle,d=s.attrs,h=void 0===d?{}:d,u=Da(s,["class","staticClass","style","staticStyle","attrs"]);return i("svg",ka({class:[a,o],style:[l,c],attrs:Object.assign({width:"16",height:"16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},h)},u),n.concat([i("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M4 1a.5.5 0 00-.5.5v13a.5.5 0 00.5.5h2a.5.5 0 00.5-.5v-13A.5.5 0 006 1H4zm6 0a.5.5 0 00-.5.5v13a.5.5 0 00.5.5h2a.5.5 0 00.5-.5v-13A.5.5 0 0012 1h-2z",fill:"currentColor"}})]))}},Ma=qn&&qn.__assign||function(){return Ma=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Ma.apply(this,arguments)},Oa=qn&&qn.__rest||function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(i[s[r]]=e[s[r]])}return i};function xa(e,t){void 0===t&&(t=!0);var i=Math.floor(e/3600),s=Math.floor(e%3600/60),r=Math.floor(e%60),n=[];return t&&!i||n.push(Fa(i)),n.push(Fa(s),Fa(r)),n.join(":")}function Fa(e){return String(e).padStart(2,"0")}function Ba(e){var t=NaN;return function(i){var s=Math.floor(i);s!==t&&(t=s,e(s))}}var Na={name:"ProgressBar",props:{isMobile:{type:Boolean,default:!1},duration:{type:Number,default:0},buffered:{type:Number,default:0},currentTime:{type:Number,default:0},disableInteractive:{type:Boolean,default:!1},disableForwardRewind:{type:Boolean,default:!1},qaId:{type:String,default:""}},data:function(){return{rootOffsetLeft:0,rootClientWidth:0,pointerMoveXPosition:0,pointerMoveProgressPercent:0,pointerMoveCurrentTime:0,isPointerActive:!1,isMouseEnter:!1,pointerUpProgressPercent:0,pointerUpPositionEnabled:!1}},computed:{progressPercent:function(){return this.duration?this.currentTime/this.duration*100:0},bufferedScale:function(){return this.duration?this.buffered/this.duration:0},thumbLeftPosition:function(){var e=this.progressPercent;return this.isPointerActive&&(e=this.pointerMoveProgressPercent),this.pointerUpPositionEnabled&&(e=this.pointerUpProgressPercent),"calc(".concat(e,"% - ").concat(this.$style.exThumbSize/2,"px)")},isDisableCurrentForwardRewind:function(){return this.disableForwardRewind&&this.pointerMoveCurrentTime>this.currentTime}},watch:{currentTime:function(){this.pointerUpPositionEnabled&&(this.pointerUpPositionEnabled=!1,this.pointerUpProgressPercent=0),this.isMouseEnter||this.isPointerActive||this.resetPointerMoveState()}},methods:{onRootTouchStart:function(e){this.disableInteractive||(this.isPointerActive=!0,this.setRootMetrics(),this.setPointerPosition(e))},onRootTouchEnd:function(e){this.disableInteractive||(this.setPointerPosition(e),this.pointerUpProgressPercent=this.pointerMoveProgressPercent,this.pointerUpPositionEnabled=!0,this.isPointerActive=!1,this.isDisableCurrentForwardRewind||this.$emit("changeProgress",this.pointerMoveCurrentTime))},onRootTouchMove:function(e){e.stopPropagation(),this.disableInteractive||this.setPointerPosition(e)},onRootMouseEnter:function(){this.isMouseEnter=!0,this.setRootMetrics()},onRootMouseLeave:function(){this.isMouseEnter=!1,this.isPointerActive||this.activeMousePosition||this.resetPointerMoveState()},onRootMouseMove:function(e){this.isPointerActive||this.disableInteractive||this.setPointerPosition(e)},onRootMouseDown:function(){this.disableInteractive||(this.isPointerActive=!0,document.addEventListener("mousemove",this.onDocumentMouseMove),document.addEventListener("mouseup",this.onDocumentMouseUp),this.$emit("mouseDown"))},onDocumentMouseMove:function(e){this.setPointerPosition(e)},onDocumentMouseUp:function(e){document.removeEventListener("mousemove",this.onDocumentMouseMove),document.removeEventListener("mouseup",this.onDocumentMouseUp),this.setPointerPosition(e),this.pointerUpProgressPercent=this.pointerMoveProgressPercent,this.$emit("mouseUp"),this.pointerUpPositionEnabled=!0,this.isPointerActive=!1,this.isDisableCurrentForwardRewind||this.$emit("changeProgress",this.pointerMoveCurrentTime)},formatTime:function(e){return xa(e)},setPointerPosition:function(e){var t,i,s,r,n=e.clientX||(null===(i=null===(t=e.touches)||void 0===t?void 0:t[0])||void 0===i?void 0:i.clientX)||(null===(r=null===(s=e.changedTouches)||void 0===s?void 0:s[0])||void 0===r?void 0:r.clientX)||0;n<this.rootOffsetLeft&&(n=this.rootOffsetLeft-1),n>this.rootOffsetLeft+this.rootClientWidth&&(n=this.rootOffsetLeft+this.rootClientWidth-1),this.pointerMoveXPosition=n-this.rootOffsetLeft+1,this.pointerMoveProgressPercent=this.pointerMoveXPosition/this.rootClientWidth*100,this.pointerMoveCurrentTime=this.pointerMoveProgressPercent*this.duration/100},resetPointerMoveState:function(){this.rootOffsetLeft=0,this.rootClientWidth=0,this.pointerMoveXPosition=0,this.pointerMoveProgressPercent=0,this.pointerMoveCurrentTime=0},setRootMetrics:function(){var e=this.$refs.root.getBoundingClientRect(),t=e.left,i=e.width;this.rootOffsetLeft=t,this.rootClientWidth=i}}};const Ua=_a({render:function(){var e,t=this,i=t.$createElement,s=t._self._c||i;return s("div",t._g({class:[t.$style.bottomBar,(e={},e[t.$style.mobile]=t.isMobile,e)],attrs:{"qa-id":t.qaId}},t.isMobile?{touchstart:t.onRootTouchStart}:null),[s("Button",{attrs:{theme:"empty","qa-id":t.qaId+".play-pause-btn"},on:{click:t.onTogglePlayPause}},[s("div",t._g({class:t.$style.playPauseIcon,attrs:{slot:"content"},slot:"content"},t.isMobile?{touchend:t.onTogglePlayPause}:null),[t.playing?s("PauseIcon"):s("PlayIcon")],1)]),t._v(" "),s("div",{class:[t.$style.time,t.$style.currentTime],attrs:{"qa-id":t.qaId+".current-time"}},[t._v(t._s(t.formatTime(t.currentTime)))]),t._v(" "),s("ProgressBar",{class:t.$style.progressBar,attrs:{"is-mobile":t.isMobile,duration:t.duration,"current-time":t.currentTime,buffered:t.buffered,"disable-interactive":t.progressBarDisableInteractive,"disable-forward-rewind":t.progressBarDisableForwardRewind,"qa-id":t.qaId+".progress-bar"},on:{changeProgress:t.onChangeProgress,mouseDown:t.onMouseDownProgress,mouseUp:t.onMouseUpProgress}}),t._v(" "),s("div",{class:[t.$style.time,t.$style.totalTime],attrs:{"qa-id":t.qaId+".total-time"}},[t._v(t._s(t.formatTime(t.duration)))]),t._v(" "),t.showSettings?s("select",{ref:"rateSelect",class:t.$style.rateSelect,attrs:{"qa-id":t.qaId+".playback-rate"},domProps:{value:t.playbackRate},on:{change:t.onChangePlayBackRate}},t._l(t.playBackRateOptions,(function(e){return s("option",{key:e.value,domProps:{value:e.value}},[t._v("\n      "+t._s(e.label)+"\n    ")])})),0):t._e()],1)},staticRenderFns:[]},(function(e){e&&(e("data-v-c022ae7e_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{bottomBar:"_2Q9OF",playPauseIcon:"_2EJVy",progressBar:"_2IrVn",time:"_26zWu",currentTime:"_3jL1G",totalTime:"_2pRkK",rateSelect:"_30F-x",mobile:"nYsMb"}}))}),{name:"BottomBar",components:{Button:Pa,PauseIcon:Ia,PlayIcon:{functional:!0,render:function(e,t){var i=t._c,s=(t._v,t.data),r=t.children,n=void 0===r?[]:r,a=s.class,o=s.staticClass,l=s.style,c=s.staticStyle,d=s.attrs,h=void 0===d?{}:d,u=Oa(s,["class","staticClass","style","staticStyle","attrs"]);return i("svg",Ma({class:[a,o],style:[l,c],attrs:Object.assign({width:"16",height:"16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},h)},u),n.concat([i("path",{attrs:{d:"M14.595 7.158L4.155 1.117A.804.804 0 003.746 1a.738.738 0 00-.742.73H3v12.54h.004c0 .402.333.73.742.73a.875.875 0 00.42-.124l10.429-6.034c.247-.2.405-.503.405-.842 0-.34-.158-.638-.405-.842z",fill:"currentColor"}})]))}},ProgressBar:_a({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",e._g({ref:"root",class:e.$style.progressBar,attrs:{"qa-id":"progress-bar"}},e.isMobile?{touchstart:e.onRootTouchStart,touchend:e.onRootTouchEnd,touchmove:e.onRootTouchMove}:{mouseenter:e.onRootMouseEnter,mouseleave:e.onRootMouseLeave,mousemove:e.onRootMouseMove,mousedown:e.onRootMouseDown}),[i("div",{class:e.$style.bar}),e._v(" "),i("div",{class:e.$style.buffered,style:{transform:"scaleX("+e.bufferedScale+")"},attrs:{"qa-id":e.qaId+".buffered"}}),e._v(" "),i("div",{class:e.$style.progress,style:{width:e.progressPercent+"%"},attrs:{"qa-id":e.qaId+".progress"}}),e._v(" "),i("div",{class:e.$style.mouseProgress,style:{width:e.pointerMoveProgressPercent+"%"}}),e._v(" "),i("div",{class:e.$style.thumb,style:{left:e.thumbLeftPosition},attrs:{"qa-id":e.qaId+".thumb"}}),e._v(" "),e.isMouseEnter||e.isPointerActive?i("div",{class:e.$style.currentTime,style:{left:e.pointerMoveXPosition+"px"},attrs:{"qa-id":e.qaId+".current-time"}},[e._v("\n    "+e._s(e.formatTime(e.pointerMoveCurrentTime))+"\n  ")]):e._e()])},staticRenderFns:[]},(function(e){e&&(e("data-v-036d5184_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{exThumbSize:"12",progressBar:"_4ARmo",bar:"Gw6ke",buffered:"_18pLA",progress:"dUJY9",mouseProgress:"_8CTSQ",thumb:"_2k_RM",currentTime:"_1vxow"}}))}),Na,undefined,false,undefined,!1,Ca,void 0,void 0)},props:{isMobile:{type:Boolean,default:!1},playing:{type:Boolean,default:!1},duration:{type:Number,default:0},currentTime:{type:Number,default:0},buffered:{type:Number,default:0},progressBarDisableInteractive:{type:Boolean,default:!1},progressBarDisableForwardRewind:{type:Boolean,default:!1},showSettings:{type:Boolean,default:!1},playbackRate:{type:Number,default:1},qaId:{type:String,default:""}},data:function(){return{playBackRateOptions:[{value:.25,label:"0.25"},{value:.5,label:"0.5"},{value:.75,label:"0.75"},{value:1,label:"Обычная"},{value:1.25,label:"1.25"},{value:1.5,label:"1.5"},{value:2,label:"2"}]}},methods:{onRootTouchStart:function(e){e&&e.target&&e.target!==this.$refs.rateSelect&&e.preventDefault()},formatTime:function(e){return xa(e)},onTogglePlayPause:function(){this.$emit("togglePlayPause")},onChangeProgress:function(e){this.$emit("changeProgress",e)},onMouseDownProgress:function(){this.$emit("mouseDownProgress")},onMouseUpProgress:function(){this.$emit("mouseUpProgress")},onChangePlayBackRate:function(e){var t=parseFloat(e.target.value);this.$emit("changePlaybackRate",t)}}},undefined,false,undefined,!1,Ca,void 0,void 0);var $a=qn&&qn.__assign||function(){return $a=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},$a.apply(this,arguments)},Ga=qn&&qn.__rest||function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(i[s[r]]=e[s[r]])}return i},Ha={functional:!0,render:function(e,t){var i=t._c,s=(t._v,t.data),r=t.children,n=void 0===r?[]:r,a=s.class,o=s.staticClass,l=s.style,c=s.staticStyle,d=s.attrs,h=void 0===d?{}:d,u=Ga(s,["class","staticClass","style","staticStyle","attrs"]);return i("svg",$a({class:[a,o],style:[l,c],attrs:Object.assign({xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24"},h)},u),n.concat([i("path",{attrs:{d:"M20 4h-5.5V2H22v7.5h-2V4zm0 16v-5.5h2V22h-7.5v-2H20zM4 20h5.5v2H2v-7.5h2V20zM4 4v5.5H2V2h7.5v2H4z",fill:"currentColor","fill-rule":"nonzero"}})]))}},Va=qn&&qn.__assign||function(){return Va=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Va.apply(this,arguments)},Ka=qn&&qn.__rest||function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(i[s[r]]=e[s[r]])}return i},qa={functional:!0,render:function(e,t){var i=t._c,s=(t._v,t.data),r=t.children,n=void 0===r?[]:r,a=s.class,o=s.staticClass,l=s.style,c=s.staticStyle,d=s.attrs,h=void 0===d?{}:d,u=Ka(s,["class","staticClass","style","staticStyle","attrs"]);return i("svg",Va({class:[a,o],style:[l,c],attrs:Object.assign({xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24"},h)},u),n.concat([i("path",{attrs:{d:"M16.5 7.5H22v2h-7.5V2h2v5.5zm0 9V22h-2v-7.5H22v2h-5.5zm-9 0H2v-2h7.5V22h-2v-5.5zm0-9V2h2v7.5H2v-2h5.5z",fill:"currentColor","fill-rule":"nonzero"}})]))}},ja=qn&&qn.__assign||function(){return ja=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},ja.apply(this,arguments)},Wa=qn&&qn.__rest||function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(i[s[r]]=e[s[r]])}return i},Ya={functional:!0,render:function(e,t){var i=t._c,s=(t._v,t.data),r=t.children,n=void 0===r?[]:r,a=s.class,o=s.staticClass,l=s.style,c=s.staticStyle,d=s.attrs,h=void 0===d?{}:d,u=Wa(s,["class","staticClass","style","staticStyle","attrs"]);return i("svg",ja({class:[a,o],style:[l,c],attrs:Object.assign({width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},h)},u),n.concat([i("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M2 5a3 3 0 013-3h12a3 3 0 013 3v9a2 2 0 012 2v4a2 2 0 01-2 2h-4a2 2 0 01-2-2H5a3 3 0 01-3-3V5zm16 9h-2a2 2 0 00-2 2v2H5a1 1 0 01-1-1V5a1 1 0 011-1h12a1 1 0 011 1v9zm-5.617-1.076a.996.996 0 00.318-.21l.013-.014a.997.997 0 00.286-.697V7a1 1 0 10-2 0v2.586L7.707 6.293a1 1 0 00-1.414 1.414L9.586 11H7a1 1 0 100 2h5.003a.996.996 0 00.38-.076z",fill:"currentColor"}})]))}},za=qn&&qn.__assign||function(){return za=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},za.apply(this,arguments)},Xa=qn&&qn.__rest||function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(i[s[r]]=e[s[r]])}return i},Za={functional:!0,render:function(e,t){var i=t._c,s=(t._v,t.data),r=t.children,n=void 0===r?[]:r,a=s.class,o=s.staticClass,l=s.style,c=s.staticStyle,d=s.attrs,h=void 0===d?{}:d,u=Xa(s,["class","staticClass","style","staticStyle","attrs"]);return i("svg",za({class:[a,o],style:[l,c],attrs:Object.assign({width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},h)},u),n.concat([i("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M2 5a3 3 0 013-3h12a3 3 0 013 3v9a2 2 0 012 2v4a2 2 0 01-2 2h-4a2 2 0 01-2-2H5a3 3 0 01-3-3V5zm16 9h-2a2 2 0 00-2 2v2H5a1 1 0 01-1-1V5a1 1 0 011-1h12a1 1 0 011 1v9zM6.076 6.617A.997.997 0 006 7v5a1 1 0 102 0V9.414l3.293 3.293a1 1 0 001.414-1.414L9.414 8H12a1 1 0 100-2H7a.997.997 0 00-.703.289l-.008.008a.997.997 0 00-.213.32z",fill:"currentColor"}})]))}},Qa=qn&&qn.__assign||function(){return Qa=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Qa.apply(this,arguments)},Ja=qn&&qn.__rest||function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(i[s[r]]=e[s[r]])}return i},eo={functional:!0,render:function(e,t){var i=t._c,s=(t._v,t.data),r=t.children,n=void 0===r?[]:r,a=s.class,o=s.staticClass,l=s.style,c=s.staticStyle,d=s.attrs,h=void 0===d?{}:d,u=Ja(s,["class","staticClass","style","staticStyle","attrs"]);return i("svg",Qa({class:[a,o],style:[l,c],attrs:Object.assign({width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},h)},u),n.concat([i("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M13.5 20.869V3.13L6.197 8H3.5a2 2 0 00-2 2v4a2 2 0 002 2h2.697l7.303 4.869zM5.5 14v-4h-2v4h2zm2 .464V9.535l4-2.667v10.263l-4-2.667zm11.355-9.78a1 1 0 00-1.158 1.631 6.989 6.989 0 012.952 5.712 6.984 6.984 0 01-2.668 5.498 1 1 0 101.239 1.57 8.984 8.984 0 003.429-7.068 8.988 8.988 0 00-3.794-7.342zm-2.31 3.266a1 1 0 00-1.16 1.63 2.995 2.995 0 011.264 2.447c0 .909-.406 1.75-1.095 2.317a1 1 0 101.272 1.543 4.991 4.991 0 001.823-3.86 4.994 4.994 0 00-2.105-4.077z",fill:"currentColor"}})]))}},to=qn&&qn.__assign||function(){return to=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},to.apply(this,arguments)},io=qn&&qn.__rest||function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(i[s[r]]=e[s[r]])}return i},so={functional:!0,render:function(e,t){var i=t._c,s=(t._v,t.data),r=t.children,n=void 0===r?[]:r,a=s.class,o=s.staticClass,l=s.style,c=s.staticStyle,d=s.attrs,h=void 0===d?{}:d,u=io(s,["class","staticClass","style","staticStyle","attrs"]);return i("svg",to({class:[a,o],style:[l,c],attrs:Object.assign({xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24"},h)},u),n.concat([i("path",{attrs:{d:"M13.5 3.131V20.87L6.197 16H3.5a2.001 2.001 0 01-1.995-1.85L1.5 14v-4a2 2 0 012-2h2.698L13.5 3.13zm-2 3.737l-4 2.667v4.929l4 2.667V6.868zm6.056 2.767l1.39 1.39 1.39-1.39a1 1 0 011.414 0l.048.05a.998.998 0 010 1.413l-1.39 1.39 1.39 1.39a1 1 0 010 1.414l-.048.049a1 1 0 01-1.414 0l-1.39-1.39-1.39 1.39a1 1 0 01-1.414 0l-.05-.049a1 1 0 010-1.414l1.39-1.39-1.389-1.39a1 1 0 010-1.414l.049-.049a1 1 0 011.414 0zM5.5 10h-2v4h2v-4z",fill:"currentColor","fill-rule":"nonzero"}})]))}};const ro=_a({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.$style.audioControl,on:{mouseleave:e.onRootMouseLeave}},[e.rangeVisible?i("div",{class:e.$style.dropdown},[i("div",{ref:"range",class:e.$style.range},[i("input",{class:e.$style.input,attrs:{type:"range",step:"0.1",orient:"vertical",max:1,min:0},domProps:{value:e.volume},on:{input:e.onRangeInput}}),e._v(" "),i("div",{class:e.$style.bar}),e._v(" "),i("div",{class:e.$style.progress,style:{height:e.progressHeight}}),e._v(" "),i("div",{class:e.$style.thumb,style:{bottom:e.percent+"%"}})])]):e._e(),e._v(" "),i("div",{class:e.$style.buttonWrapper},[i("Button",{attrs:{theme:"empty",fill:"","fill-vertical":"",icon:e.isAudioDisabled?e.VolumeMuteIcon:e.VolumeIcon,"icon-color":e.$style.exOzBGSecondary,"qa-id":e.qaId},on:{click:e.onButtonClick,mouseenter:e.onMouseEnter}})],1)])},staticRenderFns:[]},(function(e){e&&(e("data-v-e036dcd8_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{exRangeHeight:"80",exThumbSize:"12",exOzBGSecondary:"#fff",audioControl:"_28XSD",buttonWrapper:"_3Wg_e",dropdown:"_3Sk5B",range:"_3Jwl0",input:"_3X2lc",bar:"_3enFX",progress:"_13m-H",thumb:"_2bdis"}}))}),{name:"AudioControl",components:{Button:Pa},props:{isMobile:{type:Boolean,default:!1},volume:{type:Number,default:1},muted:{type:Boolean,default:!1},qaId:{type:String,default:""}},data:function(){return{rangeVisible:!1,VolumeIcon:eo,VolumeMuteIcon:so}},computed:{isAudioDisabled:function(){return this.muted||0===this.volume},percent:function(){return 100*this.volume*((this.$style.exRangeHeight-this.$style.exThumbSize)/this.$style.exRangeHeight)},progressHeight:function(){return"calc(".concat(this.percent,"% + ").concat(this.$style.exThumbSize/2,"px)")}},methods:{onMouseEnter:function(){this.rangeVisible=!0},onRootMouseLeave:function(){this.rangeVisible=!1},onRangeInput:function(e){this.$emit("changeVolume",parseFloat(e.target.value))},onButtonClick:function(){this.$emit("toggleMuted",!this.muted)}}},undefined,false,undefined,!1,Ca,void 0,void 0);const no=_a({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.$style.controls},e._l(e.controls,(function(t,s){return i("div",{key:s,class:e.$style.control},[i(t.component,e._g(e._b({tag:"component"},"component",t.props,!1),t.listeners))],1)})),0)},staticRenderFns:[]},(function(e){e&&(e("data-v-05bd55ba_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{controls:"_12rlm",control:"oCsDc"}}))}),{name:"Controls",props:{isMobile:{type:Boolean,default:!1},showAudioControl:{type:Boolean,default:!0},onlyToggleAudioControl:{type:Boolean,default:!1},showFullscreenControl:{type:Boolean,default:!0},fullscreenActive:{type:Boolean,default:!1},showExpandControl:{type:Boolean,default:!1},showPipControl:{type:Boolean,default:!1},muted:{type:Boolean,default:!1},volume:{type:Number,default:0},qaId:{type:String,default:""}},computed:{controls:function(){var e=this,t={theme:"videoControl"};return Un(Un(Un(Un([],this.showExpandControl?[{component:Pa,props:Fn(Fn({},t),{icon:Za,qaId:"to-default"}),listeners:{click:function(){e.$emit("expandVideo")}}}]:[],!0),this.showFullscreenControl?[{component:Pa,props:Fn(Fn({},t),{icon:this.fullscreenActive?qa:Ha,qaId:"to-fullscreen"}),listeners:{click:function(){e.$emit("toggleFullscreen")}}}]:[],!0),this.showPipControl?[{component:Pa,props:Fn(Fn({},t),{icon:Ya,qaId:"to-pip"}),listeners:{click:function(){e.$emit("enterPip")}}}]:[],!0),this.showAudioControl?[this.onlyToggleAudioControl?{component:Pa,props:Fn(Fn({},t),{icon:this.muted?so:eo,qaId:this.muted?"turn-on-audio":"turn-off-audio"}),listeners:{click:function(){e.$emit("toggleMuted",!e.muted)}}}:{component:ro,props:{isMobile:this.isMobile,muted:this.muted,volume:this.volume,qaId:this.muted?"turn-on-audio":"turn-off-audio"},listeners:{changeVolume:function(t){return e.$emit("changeVolume",t)},toggleMuted:function(t){return e.$emit("toggleMuted",t)}}}]:[],!0)}}},undefined,false,undefined,!1,Ca,void 0,void 0);var ao=qn&&qn.__assign||function(){return ao=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},ao.apply(this,arguments)},oo=qn&&qn.__rest||function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(i[s[r]]=e[s[r]])}return i};const lo=_a({render:function(){var e,t=this,i=t.$createElement,s=t._self._c||i;return s("Button",{attrs:{theme:"videoControl",size:"xxl","border-radius":"50%","qa-id":t.qaId},on:{click:function(e){return t.$emit("click")}}},[s("div",{class:[t.$style.playButtonContent,(e={},e[t.$style.mobile]=t.isMobile,e)],attrs:{slot:"content"},slot:"content"},[s("PlayLargeIcon")],1)])},staticRenderFns:[]},(function(e){e&&(e("data-v-557e35c8_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{playButtonContent:"be3Iq",mobile:"_3C-eT"}}))}),{components:{Button:Pa,PlayLargeIcon:{functional:!0,render:function(e,t){var i=t._c,s=(t._v,t.data),r=t.children,n=void 0===r?[]:r,a=s.class,o=s.staticClass,l=s.style,c=s.staticStyle,d=s.attrs,h=void 0===d?{}:d,u=oo(s,["class","staticClass","style","staticStyle","attrs"]);return i("svg",ao({class:[a,o],style:[l,c],attrs:Object.assign({xmlns:"http://www.w3.org/2000/svg",width:"40",height:"40"},h)},u),n.concat([i("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[i("path",{attrs:{d:"M0 0h40v40H0z"}}),i("path",{attrs:{fill:"currentColor","fill-rule":"nonzero",d:"M37.92 17.714L10.08 1.317C9.74 1.119 9.39 1 8.99 1c-1.09 0-1.98.89-1.98 1.98H7v34.04h.01c0 1.09.89 1.98 1.98 1.98.41 0 .75-.139 1.12-.336l27.81-16.378A2.955 2.955 0 0039 20c0-.92-.42-1.732-1.08-2.286z"}})])]))}}},props:{isMobile:{type:Boolean,default:!1},qaId:{type:String,default:""}}},undefined,false,undefined,!1,Ca,void 0,void 0);var co;!function(e){e.BOTTOM_LEFT="bottomLeft",e.BOTTOM_RIGHT="bottomRight",e.TOP_LEFT="topLeft",e.TOP_RIGHT="topRight"}(co||(co={}));var ho=.1,uo=10,fo=[{title:"0,25x",value:.25},{title:"0,5x",value:.5},{title:"0,75x",value:.75},{title:"1x",value:1},{title:"1,25x",value:1.25},{title:"1,5x",value:1.5},{title:"2,0x",value:2}],po=[{title:"1x",value:1},{title:"1,5x",value:1.5},{title:"2,0x",value:2}],go=/\.m3u8/,mo=/.(mp4|m4s|m4v|m4a)$/i,vo=/.(mp3)$/i;const yo=_a({render:function(){var e,t,i=this,s=i.$createElement,r=i._self._c||s;return r("div",i._g({ref:"player",class:[i.$style.player,(e={},e[i.$style.isMobile]=i.isMobile,e[i.$style.fullScreenActive]=i.fullScreenActive,e[i.$style.fitToContainer]=i.fitToContainer,e[i.$style.bottomBarOverVideo]=i.showBottomBar&&i.bottomBarOverVideo,e[i.$style.bottomBarHidden]=!i.showBottomBar,e)],attrs:{tabindex:"-1","qa-id":"video-player"}},i.isMobile?{}:{mouseenter:i.onRootMouseEnter,mouseleave:i.onRootMouseLeave,keydown:i.onKeydown}),[r("div",{class:i.$style.videoWrapper,style:{backgroundColor:i.backgroundColor}},[i.$slots.cover?r("div",{class:i.$style.cover},[i._t("cover")],2):i._e(),i._v(" "),r("div",i._g({ref:"videoContainer",class:[i.$style.videoContainer,i.videoContainerClass,(t={},t[i.$style.videoObjectFitCover]=i.videoObjectFitCover,t)]},{click:i.onVideoClick,dblclick:i.toggleFullScreen}),[i.pipModeEnabled?i._e():r("video",{ref:"video",attrs:{"qa-id":"video-player.video-element"}}),i._v(" "),i.$slots.overlay?r("div",{class:i.$style.overlay},[i._t("overlay")],2):i._e()]),i._v(" "),i.loading?r("Loader",{class:i.$style.loader,attrs:{"qa-id":"video-player.loader"}}):i._e(),i._v(" "),i.showLargePlayButton?r("PlayButton",{class:[i.$style.largePlayButton,i.playButtonClass],attrs:{"is-mobile":i.isMobile,"qa-id":"play"},on:{click:i.togglePlayPause}}):i._e()],1),i._v(" "),i.showNativeControls?i._e():r("Controls",{directives:[{name:"show",rawName:"v-show",value:!i.showControlsOnlyOnHover||i.hovered,expression:"!showControlsOnlyOnHover || hovered"}],class:[i.$style.controls,i.$style[i.controlsPosition],i.controlsClass],attrs:{"is-mobile":i.isMobile,muted:i.muted,volume:i.volume,"fullscreen-active":i.fullScreenActive,"show-audio-control":i.showAudioControl,"only-toggle-audio-control":i.onlyToggleAudioControl,"show-pip-control":i.pipModeEnabled,"show-expand-control":i.showExpandControl,"show-fullscreen-control":i.showFullscreenControl,"qa-id":"video-player"},on:{toggleFullscreen:i.toggleFullScreen,toggleMuted:i.onToggleMuted,changeVolume:i.onChangeVolume,enterPip:function(e){return i.$emit("enterPip")},expandVideo:function(e){return i.$emit("expandVideo")}}}),i._v(" "),!i.showNativeControls&&i.showBottomBar?r("BottomBar",{directives:[{name:"show",rawName:"v-show",value:!i.showBottomBarOnlyOnHover||i.hovered||i.touched,expression:"!showBottomBarOnlyOnHover || (hovered || touched)"}],class:i.$style.bottomBar,attrs:{"is-mobile":i.isMobile,playing:i.playing,duration:i.duration,"current-time":i.currentTime,buffered:i.buffered,"show-settings":i.showSettings,"playback-rate":i.playbackRate,"progress-bar-disable-interactive":i.progressBarDisableInteractive,"progress-bar-disable-forward-rewind":i.progressBarDisableForwardRewind,"qa-id":"video-player.bottom-bar"},on:{togglePlayPause:i.togglePlayPause,changeProgress:i.onChangeProgress,mouseUpProgress:i.onMouseUpProgress,mouseDownProgress:i.onMouseDownProgress,changePlaybackRate:i.onChangePlaybackRate}}):i._e()],1)},staticRenderFns:[]},(function(e){e&&(e("data-v-6c6db37b_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{player:"_7EtuA",videoWrapper:"_2khBr",videoContainer:"_1ae1G",videoObjectFitCover:"_1BLsM",overlay:"MNODj",cover:"_13EqJ",controls:"_3BhwX",bottomLeft:"_1IbGA",bottomRight:"_1P5Qd",topRight:"_4AsTs",topLeft:"_2-_HO",bottomBar:"_2dgtV",loader:"_3WrUr",largePlayButton:"_1ymz3",fullScreenActive:"_3YTPM",fitToContainer:"_3ZGfH",bottomBarOverVideo:"_2wUIw",bottomBarHidden:"_3hr8j"}}))}),{name:"BasePlayer",components:{PlayButton:lo,Loader:Yn,Controls:no,BottomBar:Ua},props:{src:{type:String,required:!0},fitToContainer:{type:Boolean,default:!1},isMobile:{type:Boolean,default:!1},backgroundColor:{type:String,default:"transparent"},startTime:{type:Number,default:0},tryAutoplay:{type:Boolean,default:!1},initialMuted:{type:Boolean,default:!1},initialVolume:{type:Number,default:1},loop:{type:Boolean,default:!1},playButtonClass:{type:String,default:void 0},playPauseOnClickVideo:{type:Boolean,default:!0},videoObjectFitCover:{type:Boolean,default:!1},videoContainerClass:{type:String,default:void 0},controlsPosition:{type:String,default:co.BOTTOM_LEFT},controlsClass:{type:String,default:void 0},showControlsOnlyOnHover:{type:Boolean,default:!0},showBottomBar:{type:Boolean,default:!0},bottomBarOverVideo:{type:Boolean,default:!1},showBottomBarOnlyOnHover:{type:Boolean,default:!0},showAudioControl:{type:Boolean,default:!0},onlyToggleAudioControl:{type:Boolean,default:!1},showExpandControl:{type:Boolean,default:!1},showFullscreenControl:{type:Boolean,default:!0},fullscreenElementClassName:{type:String,default:""},progressBarDisableInteractive:{type:Boolean,default:!1},progressBarDisableForwardRewind:{type:Boolean,default:!1},showSettings:{type:Boolean,default:!1},showLargePlayButtonOnPause:{type:Boolean,default:!1},showLargePlayButtonOnEnd:{type:Boolean,default:!1},pipModeEnabled:{type:Boolean,default:!1},showNativeControls:{type:Boolean,default:!1},hotkeysEnabled:{type:Boolean,default:!0}},data:function(){return{isPlayerObjectAttached:!1,volume:this.initialVolume,muted:this.initialMuted,playing:!1,loading:!1,duration:0,currentTime:0,buffered:0,playbackRate:1,touched:!1,hovered:!1,prevPlayingState:!1,fullScreenActive:!1,showLargePlayButton:!1,isMounted:!1,fullScreenEvents:["fullscreenchange","webkitfullscreenchange","webkitendfullscreen"]}},computed:{fullscreenElement:function(){return this.isMounted&&this.isMobile&&this.isPlayerObjectAttached?this.player.videoElement:this.fullscreenElementClassName&&document.querySelector(".".concat(this.fullscreenElementClassName))||this.$refs.player}},watch:{isPlayerObjectAttached:function(e){e&&(this.setPlayerState(),this.addPlayerEventListeners(),this.addFullScreenEventsListeners(),this.playing&&(this.showLargePlayButton=!1))}},created:function(){this.tryAutoplay||(this.showLargePlayButton=!0)},mounted:function(){this.isMounted=!0},beforeDestroy:function(){this.removeFullScreenEventsListeners()},methods:{createPlayer:function(){this.player=new Gn(this.$refs.video,{showNativeControls:this.showNativeControls,initialMuted:this.initialMuted,initialVolume:this.initialVolume,startTime:this.startTime,loop:this.loop}),this.isPlayerObjectAttached=!0},play:function(){return Bn(this,void 0,void 0,(function(){return Nn(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.player.play()];case 1:return e.sent(),[3,3];case 2:return e.sent(),this.showLargePlayButton=!0,[3,3];case 3:return[2]}}))}))},onRootMouseEnter:function(){this.hovered=!0},onRootMouseLeave:function(){this.hovered=!1},setPlayerState:function(){this.muted=this.player.muted,this.volume=this.player.volume,this.playing=this.player.playing,this.duration=this.player.duration,this.loading=this.player.loading,this.playbackRate=this.player.playbackRate,this.buffered=this.player.buffered,this.currentTime=this.player.currentTime},addFullScreenEventsListeners:function(){var e=this;this.fullscreenElement&&this.fullScreenEvents.forEach((function(t){e.fullscreenElement.addEventListener(t,e.onFullScreenStateChange)}))},removeFullScreenEventsListeners:function(){var e=this;this.fullscreenElement&&this.fullScreenEvents.forEach((function(t){e.fullscreenElement.removeEventListener(t,e.onFullScreenStateChange)}))},addPlayerEventListeners:function(){var e,t=this,i=((e={})[kn.MEDIA_ATTACH]=function(){t.tryAutoplay&&t.play()},e[kn.PLAY]=function(){t.showLargePlayButton&&(t.showLargePlayButton=!1),t.playing=!0},e[kn.PAUSE]=function(){t.showLargePlayButtonOnPause&&(t.showLargePlayButton=!0),t.playing=!1},e[kn.DURATION_CHANGE]=function(e){t.duration=e},e[kn.LOADING_STATE_CHANGE]=function(e){t.loading=e},e[kn.VOLUME_CHANGE]=function(e){var i=e.volume,s=e.muted;t.muted=s,t.volume=i},e[kn.TIME_UPDATE]=function(e){t.currentTime=e},e[kn.BUFFERED_UPDATE]=function(e){t.buffered=e},e[kn.PLAYBACK_RATE_CHANGE]=function(e){t.playbackRate=e},e[kn.ENDED]=function(){t.showLargePlayButtonOnEnd&&(t.showLargePlayButton=!0)},e[kn.REWIND]=null,e[kn.ERROR]=null,e[kn.RECOVER]=null,e[kn.VIEW_START]=null,e[kn.VIEW_FINISH]=null,e[kn.LOADED_METADATA]=null,e);Object.entries(i).forEach((function(e){var i=e[0],s=e[1];t.player.on(i,(function(e){s&&s(e),i===kn.TIME_UPDATE?t.$emit(i,{currentTime:e,progress:e/t.duration*100}):t.$emit(i,e)}))}))},togglePlayPause:function(){var e;null===(e=this.$refs.player)||void 0===e||e.focus(),this.playing?this.player.pause():this.player.play()},onFullScreenStateChange:function(){var e=Zn();this.fullScreenActive=!!e,this.$emit("fullScreenStateChange",this.fullScreenActive)},onChangeProgress:function(e){this.player.rewind(e)},onMouseDownProgress:function(){this.playing&&(this.prevPlayingState=!0,this.player.pause())},onMouseUpProgress:function(){this.prevPlayingState&&this.player.play(),this.prevPlayingState=!1},onChangePlaybackRate:function(e){this.player.playbackRate=e},onToggleMuted:function(e){this.player.muted=e},onChangeVolume:function(e){this.player.volume=e},onVideoClick:function(){if(!this.playPauseOnClickVideo)return this.onVideoTap();this.isMobile&&this.onVideoTap(),this.togglePlayPause()},onVideoTap:function(){this.touched=!this.touched,this.$emit("videoTap")},onKeydown:function(e){if(this.hotkeysEnabled)switch(e.preventDefault(),e.stopPropagation(),e.code){case"KeyF":this.toggleFullScreen();break;case"KeyM":this.onToggleMuted(!this.muted);break;case"Space":case"Enter":this.togglePlayPause();break;case"ArrowUp":this.onChangeVolume(this.volume+ho>1?1:this.volume+ho);break;case"ArrowDown":this.onChangeVolume(this.volume-ho<0?0:this.volume-ho);break;case"ArrowLeft":this.player.currentTime=this.currentTime-uo<0?0:this.currentTime-uo;break;case"ArrowRight":this.player.currentTime=this.currentTime+uo>this.duration?this.duration:this.currentTime+uo;break;case"Digit0":case"Digit1":case"Digit2":case"Digit3":case"Digit4":case"Digit5":case"Digit6":case"Digit7":case"Digit8":case"Digit9":this.player.currentTime=this.duration*Number(e.code.split("Digit")[1])/10}},toggleFullScreen:function(){return Bn(this,void 0,void 0,(function(){return Nn(this,(function(e){switch(e.label){case 0:return this.fullScreenActive?(Xn(),[3,4]):[3,1];case 1:return e.trys.push([1,3,,4]),[4,zn(this.fullscreenElement)];case 2:case 3:return e.sent(),[3,4];case 4:return this.fullScreenActive=!this.fullScreenActive,[2]}}))}))}}},undefined,false,undefined,!1,Ca,void 0,void 0);const To=_a({},undefined,{extends:yo,props:{extraRequestHeaders:{type:Object,default:function(){return{}}},hlsOptions:{type:Object,default:function(){return{}}}},mounted:function(){this.createPlayer(),this.loadSource(this.src)},beforeDestroy:function(){this.player&&this.player.destroy()},methods:{loadSource:function(e){this.player.loadSource(new Vn(e,{startTime:this.startTime,extraRequestHeaders:this.extraRequestHeaders,hlsOptions:this.hlsOptions}))}}},undefined,undefined,undefined,!1,void 0,void 0,void 0);const Eo=_a({},undefined,{extends:yo,mounted:function(){this.createPlayer(),this.loadSource(this.src)},beforeDestroy:function(){this.player&&this.player.destroy()},methods:{loadSource:function(e){this.player.loadSource(new Hn(e))}}},undefined,undefined,undefined,!1,void 0,void 0,void 0),bo={functional:!0,name:"icMArrowLeft",meta:{width:24,height:24,viewBox:"0 0 24 24"},render(e,t){const{attrs:i,...s}=t.data;return e("svg",{...s,attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",...i},domProps:{innerHTML:'<path fill="currentColor" d="M11.707 5.293a1 1 0 0 1 0 1.414L7.414 11H20a1 1 0 1 1 0 2H7.414l4.293 4.293a1 1 0 0 1-1.414 1.414l-6-6a1 1 0 0 1 0-1.414l6-6a1 1 0 0 1 1.414 0Z"/>'}})}},So={functional:!0,name:"icMCheck",meta:{width:24,height:24,viewBox:"0 0 24 24"},render(e,t){const{attrs:i,...s}=t.data;return e("svg",{...s,attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",...i},domProps:{innerHTML:'<path fill="currentColor" d="M18.707 7.293a1 1 0 0 1 0 1.414l-8 8a1 1 0 0 1-1.414 0l-4-4a1 1 0 1 1 1.414-1.414L10 14.586l7.293-7.293a1 1 0 0 1 1.414 0Z"/>'}})}},Lo={functional:!0,name:"icMFullScreen",meta:{width:24,height:24,viewBox:"0 0 24 24"},render(e,t){const{attrs:i,...s}=t.data;return e("svg",{...s,attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",...i},domProps:{innerHTML:'<path fill="currentColor" d="M3 4a1 1 0 0 1 1-1h5a1 1 0 1 1 0 2H5v4a1 1 0 1 1-2 0V4Zm17-1a1 1 0 0 1 1 1v5a1 1 0 1 1-2 0V5h-4a1 1 0 1 1 0-2h5ZM3 15v5a1 1 0 0 0 1 1h5a1 1 0 1 0 0-2H5v-4a1 1 0 1 0-2 0Zm16 0v4h-4a1 1 0 1 0 0 2h5a1 1 0 0 0 1-1v-5a1 1 0 1 0-2 0Z"/>'}})}},_o={functional:!0,name:"icMFullScreenExit",meta:{width:24,height:24,viewBox:"0 0 24 24"},render(e,t){const{attrs:i,...s}=t.data;return e("svg",{...s,attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",...i},domProps:{innerHTML:'<path fill="currentColor" d="M10 9a1 1 0 0 1-1 1H4a1 1 0 1 1 0-2h4V4a1 1 0 1 1 2 0v5Zm5 1a1 1 0 0 1-1-1V4a1 1 0 1 1 2 0v4h4a1 1 0 1 1 0 2h-5Zm-5 10v-5a1 1 0 0 0-1-1H4a1 1 0 1 0 0 2h4v4a1 1 0 1 0 2 0Zm6 0v-4h4a1 1 0 1 0 0-2h-5a1 1 0 0 0-1 1v5a1 1 0 1 0 2 0Z"/>'}})}},wo={functional:!0,name:"icMPauseSignFilled",meta:{width:24,height:24,viewBox:"0 0 24 24"},render(e,t){const{attrs:i,...s}=t.data;return e("svg",{...s,attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",...i},domProps:{innerHTML:'<path fill="currentColor" d="M4 12c0-7 .618-8 3.5-8S11 5 11 12s-.618 8-3.5 8S4 19 4 12Zm9 0c0-7 .618-8 3.5-8S20 5 20 12s-.618 8-3.5 8-3.5-1-3.5-8Z"/>'}})}},Ao={functional:!0,name:"icMPlaySignFilled",meta:{width:24,height:24,viewBox:"0 0 24 24"},render(e,t){const{attrs:i,...s}=t.data;return e("svg",{...s,attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",...i},domProps:{innerHTML:'<path fill="currentColor" d="M8.039 4C7 4 7 8 7 12s0 8 1.039 8C9.5 20 21 14 21 12S9.5 4 8.039 4Z"/>'}})}},Ro={functional:!0,name:"icMRotateLeft",meta:{width:24,height:24,viewBox:"0 0 24 24"},render(e,t){const{attrs:i,...s}=t.data;return e("svg",{...s,attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",...i},domProps:{innerHTML:'<path fill="currentColor" d="M8.293 1.293a1 1 0 0 1 1.414 1.414L8.414 4H12c4.902.07 9 4.041 9 9a9 9 0 1 1-18 0 1 1 0 1 1 2 0 7 7 0 1 0 14 0c-.064-3.812-3.136-7-7-7H8.414l1.293 1.293a1 1 0 0 1-1.414 1.414l-3-3a1 1 0 0 1 0-1.414l3-3Z"/>'}})}},Co={functional:!0,name:"icMSettingsFilled",meta:{width:24,height:24,viewBox:"0 0 24 24"},render(e,t){const{attrs:i,...s}=t.data;return e("svg",{...s,attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",...i},domProps:{innerHTML:'<path fill="currentColor" d="M8.78 6.422c-.392-.121-.785-.234-1.179-.348-1.755-.507-2.204-.637-3.395 1.426-1.191 2.063-.854 2.387.463 3.653.295.284.59.569.89.847-.3.278-.595.563-.89.847-1.317 1.265-1.654 1.59-.463 3.653 1.19 2.063 1.64 1.933 3.395 1.426.393-.114.789-.227 1.179-.348.09.399.19.797.288 1.195C9.506 20.546 9.618 21 12 21c2.382 0 2.495-.454 2.932-2.227.099-.398.198-.796.288-1.195.39.121.783.233 1.176.347 1.755.507 2.207.638 3.398-1.425 1.191-2.063.854-2.387-.463-3.653-.295-.284-.59-.569-.89-.847.3-.278.595-.563.89-.847 1.317-1.266 1.654-1.59.463-3.653-1.19-2.063-1.64-1.933-3.395-1.426-.394.114-.787.227-1.179.348-.09-.4-.19-.797-.288-1.195C14.494 3.454 14.382 3 12 3c-2.382 0-2.495.455-2.933 2.229-.098.397-.197.794-.287 1.193ZM12 15a3 3 0 1 1 0-6 3 3 0 0 1 0 6Z"/>'}})}},Po={functional:!0,name:"icMSocialFilled",meta:{width:24,height:24,viewBox:"0 0 24 24"},render(e,t){const{attrs:i,...s}=t.data;return e("svg",{...s,attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",...i},domProps:{innerHTML:'<path fill="currentColor" d="M8.681 4c-.786 0-1.278.584-1.55 1.053-.29.502-.502 1.16-.66 1.862C6.153 8.335 6 10.184 6 12c0 1.816.152 3.665.472 5.085.157.703.369 1.36.66 1.862.27.47.763 1.053 1.55 1.053 1.054 0 2.34-.391 3.605-.932 1.29-.55 2.654-1.297 3.897-2.096 1.242-.798 2.39-1.663 3.24-2.46.423-.398.793-.797 1.064-1.18.247-.35.512-.82.512-1.332 0-.512-.265-.983-.512-1.332-.271-.383-.641-.782-1.064-1.18-.85-.797-1.998-1.662-3.24-2.46-1.243-.799-2.607-1.546-3.897-2.096C11.021 4.39 9.737 4 8.681 4Z"/>'}})}},ko={functional:!0,name:"icMVolumeFilled",meta:{width:24,height:24,viewBox:"0 0 24 24"},render(e,t){const{attrs:i,...s}=t.data;return e("svg",{...s,attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",...i},domProps:{innerHTML:'<path fill="currentColor" d="M9.379 4.621 6.62 7.38c-.397.397-1.057.62-1.619.62C3 8 3 10.396 3 12c0 1.603 0 4 2 4 .563 0 1.223.224 1.621.621L9.38 19.38c.398.397.937.621 1.5.621C13 20 13 15 13 12s0-8-2.121-8a2.12 2.12 0 0 0-1.5.621Zm5.914 3.672a1.004 1.004 0 0 1 1.417.003c.09.09.17.19.246.291.126.168.284.406.438.716.312.622.606 1.524.606 2.697s-.294 2.075-.606 2.697a4.7 4.7 0 0 1-.438.716 2.83 2.83 0 0 1-.246.291 1 1 0 0 1-1.427-1.401c.132-.148.235-.324.323-.5.188-.378.394-.976.394-1.803s-.206-1.425-.394-1.803a2.341 2.341 0 0 0-.323-.5 1 1 0 0 1 .01-1.404Z"/><path fill="currentColor" d="M19.714 5.3a1.008 1.008 0 0 0-1.421-.007 1 1 0 0 0-.005 1.41c.34.357.599.806.818 1.244.438.878.894 2.226.894 4.053s-.456 3.175-.894 4.053a6.39 6.39 0 0 1-.594.972 3.09 3.09 0 0 1-.224.273 1 1 0 0 0 1.42 1.408c.148-.15.28-.314.405-.481a8.38 8.38 0 0 0 .781-1.278C21.456 15.825 22 14.173 22 12s-.544-3.825-1.106-4.947a8.387 8.387 0 0 0-.781-1.278 4.739 4.739 0 0 0-.399-.475Z"/>'}})}},Do={functional:!0,name:"icMVolumeNoFilled",meta:{width:24,height:24,viewBox:"0 0 24 24"},render(e,t){const{attrs:i,...s}=t.data;return e("svg",{...s,attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",...i},domProps:{innerHTML:'<path fill="currentColor" d="M6.621 7.379 9.38 4.62a2.121 2.121 0 0 1 1.5-.621C13 4 13 9 13 12s0 8-2.121 8a2.121 2.121 0 0 1-1.5-.621L6.62 16.62c-.397-.396-1.057-.62-1.619-.62C3 16 3 13.603 3 12c0-1.603 0-4 2-4 .563 0 1.223-.223 1.621-.621Zm10.086 1.914a1 1 0 1 0-1.414 1.414L16.586 12l-1.293 1.293a1 1 0 0 0 1.414 1.414L18 13.414l1.293 1.293a1 1 0 0 0 1.414-1.414L19.414 12l1.293-1.293a1 1 0 0 0-1.414-1.414L18 10.586l-1.293-1.293Z"/>'}})}},Io={functional:!0,name:"icSCirclePause",meta:{width:16,height:16,viewBox:"0 0 16 16"},render(e,t){const{attrs:i,...s}=t.data;return e("svg",{...s,attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",...i},domProps:{innerHTML:'<path fill="currentColor" d="M6 5a1 1 0 0 1 1 1v4a1 1 0 1 1-2 0V6a1 1 0 0 1 1-1Zm4 0a1 1 0 0 1 1 1v4a1 1 0 1 1-2 0V6a1 1 0 0 1 1-1Z"/><path fill="currentColor" d="M8 2a6 6 0 1 0 0 12A6 6 0 0 0 8 2ZM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Z"/>'}})}},Mo={functional:!0,name:"icSCirclePlay",meta:{width:16,height:16,viewBox:"0 0 16 16"},render(e,t){const{attrs:i,...s}=t.data;return e("svg",{...s,attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",...i},domProps:{innerHTML:'<path fill="currentColor" d="M6.528 5.118a1 1 0 0 1 1.027.05l3 2a1 1 0 0 1 0 1.664l-3 2A1 1 0 0 1 6 10V6a1 1 0 0 1 .528-.882Z"/><path fill="currentColor" d="M8 2a6 6 0 1 0 0 12A6 6 0 0 0 8 2ZM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Z"/>'}})}},Oo={functional:!0,name:"icSDisclosure",meta:{width:16,height:16,viewBox:"0 0 16 16"},render(e,t){const{attrs:i,...s}=t.data;return e("svg",{...s,attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",...i},domProps:{innerHTML:'<path fill="currentColor" d="M5.293 12.293a1 1 0 1 0 1.414 1.414l5-5a1 1 0 0 0 0-1.414l-5-5a1 1 0 0 0-1.414 1.414L9.586 8l-4.293 4.293Z"/>'}})}},xo={functional:!0,name:"icSFullScreen",meta:{width:16,height:16,viewBox:"0 0 16 16"},render(e,t){const{attrs:i,...s}=t.data;return e("svg",{...s,attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",...i},domProps:{innerHTML:'<path fill="currentColor" fill-rule="evenodd" d="M1 2a1 1 0 0 1 1-1h4a1 1 0 0 1 0 2H3v3a1 1 0 0 1-2 0V2Zm8 0a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v4a1 1 0 1 1-2 0V3h-3a1 1 0 0 1-1-1ZM2 9a1 1 0 0 1 1 1v3h3a1 1 0 1 1 0 2H2a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1Zm12 0a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1h-4a1 1 0 1 1 0-2h3v-3a1 1 0 0 1 1-1Z" clip-rule="evenodd"/>'}})}},Fo={functional:!0,name:"icSFullScreenExit",meta:{width:16,height:16,viewBox:"0 0 16 16"},render(e,t){const{attrs:i,...s}=t.data;return e("svg",{...s,attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",...i},domProps:{innerHTML:'<path fill="currentColor" d="M6 1a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1 0-2h3V2a1 1 0 0 1 1-1Zm4 0a1 1 0 0 1 1 1v3h3a1 1 0 1 1 0 2h-4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1Zm-9 9a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v4a1 1 0 1 1-2 0v-3H2a1 1 0 0 1-1-1Zm8 0a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2h-3v3a1 1 0 1 1-2 0v-4Z"/>'}})}};var Bo=function(e){var t=e.barRelativePointerMoveX,i=e.barOffsetLeft,s=e.playerOffsetLeft,r=e.playerWidth,n=e.previewWidth,a=s+12,o=r-24,l=t-n/2+i;return l<a?l=a:l+n>=a+o&&(l=a+o-n),l-i};const No=_a({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"root",class:e.$style.root,attrs:{"qa-id":e.qaId}},[e._l(e.cuepointsPositions,(function(t){var s;return i("div",{key:t.id,attrs:{"data-cuepoint-id":t.id,"qa-id":e.qaId+".cuepoint-"+t.id},on:{touchstart:e.onHoverStartCuepoint,touchend:e.onHoverEndCuepoint,mouseenter:e.onHoverStartCuepoint,mouseleave:e.onHoverEndCuepoint,mouseup:e.onHoverEndCuepoint,click:e.onClickCuepoint}},[i("ExclamationIcon",{class:[e.$style.cuepointIcon,(s={},s[e.$style.cuepointIconActive]=e.activeCuepoint&&e.activeCuepoint.id===t.id,s)],style:{left:t.leftPercent+"%"}}),e._v(" "),i("div",{class:[e.$style.cuepointMark],style:{left:t.leftPercent+"%"},attrs:{"qa-id":e.qaId+".cuepoint-"+t.id+".mark"}})],1)})),e._v(" "),e.activeCuepoint?i("div",{class:e.$style.cuepointTooltip,style:{left:e.activeCuepointTooltipX+"px"},attrs:{"qa-id":e.qaId+".active-cuepoint-tooltip"}},[i("div",{attrs:{"qa-id":e.qaId+".active-tooltip.text"}},[e._v(e._s(e.activeCuepoint.text))]),e._v(" "),e._l(e.activeCuepoint.collapsed,(function(t){return i("div",{key:t.id},[e._v(e._s(t.text))])})),e._v(" "),i("div",{attrs:{"qa-id":e.qaId+".active-tooltip.time"}},[e._v(e._s(e.formatTime(e.activeCuepoint.time)))])],2):e._e()],2)},staticRenderFns:[]},(function(e){e&&(e("data-v-12a5d982_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{exCuepointTooltipWidth:"250",root:"_3_c5v",cuepointMark:"_3kL9D",cuepointIcon:"_2UWme",cuepointIconActive:"_1Z3G1",cuepointTooltip:"GGjT1"}}))}),{name:"Cuepoints",components:{ExclamationIcon:{functional:!0,name:"icSExclamationFilledCompact",meta:{width:16,height:16,viewBox:"0 0 16 16"},render(e,t){const{attrs:i,...s}=t.data;return e("svg",{...s,attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",...i},domProps:{innerHTML:'<path fill="currentColor" d="M8 14c3.723 0 6-2.277 6-6s-2.277-6-6-6-6 2.277-6 6 2.277 6 6 6Zm1-6a1 1 0 1 1-2 0V5a1 1 0 0 1 2 0v3Zm-1 4a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/>'}})}}},props:{visible:{type:Boolean},duration:{type:Number,default:0},fullscreen:{type:Boolean,default:!1},cuepoints:{type:Array,default:function(){return[]}},cuepointsCollapseThreshold:{type:Number,default:5},currentCuepoint:{type:Object,default:null},qaId:{type:String,default:"cuepoints"}},inject:{playerRect:{default:{offsetLeft:0,width:0}}},data:function(){return{hoveredCuepoint:null,isMounted:!1}},computed:{cuepointsPositions:function(){var e=this;if(!this.duration||this.duration===1/0||!this.isMounted||!this.visible)return[];var t=this.getRootClientRect().width,i=this.cuepoints.map((function(i){var s=100*i.time/e.duration,r=s*t/100;return Fn(Fn({},i),{x:r,leftPercent:s})}));return this.cuepointsCollapseThreshold>=0&&(i=i.reduce((function(t,i){if(t.length>0){var s=t[t.length-1];if(i.x-s.x<=e.cuepointsCollapseThreshold)return s.collapsed.push(i),t}return t.push(Fn(Fn({},i),{collapsed:[]})),t}),[])),i},activeCuepoint:function(){return this.fullscreen?this.hoveredCuepoint:this.hoveredCuepoint||this.currentCuepoint},activeCuepointTooltipX:function(){var e=100*this.activeCuepoint.time/this.duration,t=this.getRootClientRect(),i=t.left,s=t.width;return Bo({barRelativePointerMoveX:e*s/100,barOffsetLeft:i,playerOffsetLeft:this.playerRect.offsetLeft,playerWidth:this.playerRect.width,previewWidth:parseInt(this.$style.exCuepointTooltipWidth)})}},mounted:function(){this.isMounted=!0},methods:{onHoverStartCuepoint:function(e){e.stopPropagation();var t=parseInt(e.currentTarget.dataset.cuepointId);this.hoveredCuepoint=this.cuepointsPositions.find((function(e){return e.id===t}))},onHoverEndCuepoint:function(){this.hoveredCuepoint=null},onClickCuepoint:function(e){var t=parseInt(e.currentTarget.dataset.cuepointId),i=this.cuepointsPositions.find((function(e){return e.id===t}));this.$emit("clickCuepoint",i)},formatTime:function(e){return xa(e)},getRootClientRect:function(){return this.$refs.root.getBoundingClientRect()}}},undefined,false,undefined,!1,Ca,void 0,void 0);var Uo=function(e,t){if(t<=0)return[];for(var i=[],s=0;s<e.length;s+=t){var r=e.slice(s,s+t);i.push(r)}return i};function $o(e,t){for(var i=-1,s=-1,r=0;r<e.length;r++){for(var n=e[r],a=0;a<n.length;a++)if(n[a]>=t){i=r,s=a;break}if(i>=0)break}return[i,s]}const Go=_a({render:function(){var e,t=this,i=t.$createElement,s=t._self._c||i;return s("div",{ref:"preview",class:[t.$style.preview,(e={},e[t.$style.audio]=t.isAudio,e)]},[t.landscapes.length>0&&t.activePreview?s("div",{class:t.$style.wrapper,style:{width:t.width+"px",height:t.height+"px"}},[s("div",{class:t.$style.image,style:t.activePreview})]):t._e(),t._v(" "),t.title?s("div",{class:t.$style.previewTitle},[t._v(t._s(t.title))]):t._e(),t._v(" "),s("div",{class:t.$style.time},[t._v(t._s(t.formatTime(t.time)))])])},staticRenderFns:[]},(function(e){e&&(e("data-v-419f28d6_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{wrapper:"_3K5NY",preview:"_1RFCS",audio:"_1nZna",previewTitle:"_8cj9J",time:"_3M0Qv",image:"_3_Ie1"}}))}),{name:"Preview",props:{time:{type:Number,default:-1},title:{type:String,default:null},landscapes:{type:Array,default:function(){return[]}},isAudio:{type:Boolean,default:!1}},data:function(){return{width:160,height:90,previews:{},activePreview:{},activePreviewUrl:"",imageWidth:0,imageHeight:0,landscapesReverse:[],urlParams:"",isVertical:!1}},watch:{time:function(e){var t=this;this.changePreview(e),setTimeout((function(){return t.handleChangeWidth()}),200)},landscapes:function(){this.landscapesReverse=Un([],this.landscapes,!0).sort((function(e,t){return e.ts[0]-t.ts[0]}))}},mounted:function(){var e=this;this.landscapesReverse=Un([],this.landscapes,!0).sort((function(e,t){return e.ts[0]-t.ts[0]})),setTimeout((function(){return e.handleChangeWidth()}),200)},methods:{checkImageSize:function(e){var t=this,i=this.landscapesReverse[0];if(i){var s=i.url,r=new Image;r.onload=function(){r.naturalWidth<r.naturalHeight&&(t.width=90,t.height=160),t.imageWidth=t.width,t.imageHeight=t.height,e()},r.src=s}},changePreview:function(e){var t=this;this.imageWidth>0?this.fetchPreview(e):this.checkImageSize((function(){return t.fetchPreview(e)}))},fetchPreview:function(e){for(var t=1e3*Math.floor(e),i=0,s=this.landscapesReverse;i<s.length;i++){var r=s[i],n=r.url,a=r.items_per_x,o=r.items_per_y,l=r.ts;if(t>=l[0]&&t<=l[l.length-1]){var c=$o(Uo(l,a),t),d=c[0],h=c[1];if(d>=0){var u=n.lastIndexOf("/"),f=n.slice(u),p="".concat(n.replace(f,""),"/w").concat(this.width*a).concat(f),g="".concat(-this.width*d,"px ").concat(-this.height*h,"px"),m="".concat(this.width*a,"px ").concat(this.height*o,"px");this.activePreview={background:"url(".concat(p,") ").concat(g," / ").concat(m)}}break}}},formatTime:function(e){return xa(e)},handleChangeWidth:function(){this.$emit("changeWidth",this.$refs.preview?this.$refs.preview.clientWidth:0)}}},undefined,false,undefined,!1,Ca,void 0,void 0);const Ho=_a({render:function(){var e,t,i=this,s=i.$createElement,r=i._self._c||s;return r("div",{class:[i.$style.wrapper,(e={},e[i.$style.live]=i.actualLive,e[i.$style.audio]=i.isAudio,e)],attrs:{"qa-id":i.qaId}},[i.live?r("div",{class:i.$style.badge,attrs:{"qa-id":i.qaId+".backToLive"},on:{click:function(e){return i.$emit("backToLive",i.duration)}}},[i._v("\n    Live\n  ")]):i._e(),i._v(" "),r("div",{ref:"root",class:i.$style.progressBarContainer},[r("div",i._g({class:[i.$style.progressBar,(t={},t[i.$style.disable]=i.isDisableInteractive,t[i.$style[i.bottomBarTheme]]=i.bottomBarTheme!==i.BOTTOM_BAR_THEME.DEFAULT,t)],attrs:{"qa-id":i.qaId+".bar-wrapper"}},i.isMobile?{touchstart:i.onRootTouchStart,touchend:i.onRootTouchEnd,touchmove:i.onRootTouchMove}:{mouseenter:i.onRootMouseEnter,mouseleave:i.onRootMouseLeave,mousemove:i.onRootMouseMove,mousedown:i.onRootMouseDown}),[r("div",{class:i.$style.bar,attrs:{"qa-id":i.qaId+".bar"}}),i._v(" "),r("div",{class:i.$style.buffered,style:{transform:"scaleX("+i.bufferedScale+")"},attrs:{"qa-id":i.qaId+".buffered"}}),i._v(" "),r("div",{class:i.$style.progress,style:{width:i.progressPercent+"%"},attrs:{"qa-id":i.qaId+".progress"}}),i._v(" "),r("div",{class:i.$style.mouseProgress,style:{width:i.pointerMoveProgressPercent+"%"}}),i._v(" "),i.isDisableInteractive?i._e():r("div",{class:[i.$style.thumb],style:{left:i.thumbLeftPosition},attrs:{"qa-id":i.qaId+".thumb"}}),i._v(" "),!i.isMouseEnter&&!i.isPointerActive||i.isDisableInteractive?i._e():r("div",{class:i.$style.currentTime,style:{transform:"translateX("+i.previewX+"px)",opacity:i.previewWidth>0?1:0},attrs:{"qa-id":i.qaId+".current-time"}},[r("Preview",{attrs:{landscapes:i.landscapes,time:i.pointerMoveCurrentTime,"is-audio":i.isAudio},on:{changeWidth:i.handleChangePreviewWidth}})],1)]),i._v(" "),i.shouldRenderCuepoints?r("Cuepoints",{attrs:{visible:i.visible,duration:i.duration,fullscreen:i.fullscreen,cuepoints:i.cuepoints,"cuepoints-collapse-threshold":i.cuepointsCollapseThreshold,"current-cuepoint":i.currentCuepoint,"qa-id":i.qaId+".cuepoints"},on:{clickCuepoint:i.onClickCuepoint}}):i._e()],1)])},staticRenderFns:[]},(function(e){e&&(e("data-v-41dc2e0a_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{exThumbSize:"12",exThumbSizeNarrow:"4",wrapper:"_2AOUL",badge:"_1SdqQ",live:"_2aKf-",progressBarContainer:"_9zKrp",progressBar:"_1Nqry",disable:"_1ogxb",bar:"NgsJo",buffered:"_3F5ZF",progress:"_2u9f_",mouseProgress:"_21FzZ",audio:"_1Nfp8",thumb:"_3hGwo",narrow:"_2S0WP",currentTime:"_2dSql"}}))}),{name:"ProgressBar",components:{Cuepoints:No,Preview:Go},props:{visible:{type:Boolean},isMobile:{type:Boolean,default:!1},duration:{type:Number,default:0},buffered:{type:Number,default:0},currentTime:{type:Number,default:0},disableInteractive:{type:Boolean,default:!1},disableForwardRewind:{type:Boolean,default:!1},live:{type:Boolean,default:!1},actualLive:{type:Boolean,default:!1},seeked:{type:Boolean,default:!1},fullscreen:{type:Boolean,default:!1},cuepoints:{type:Array,default:function(){return[]}},cuepointsCollapseThreshold:{type:Number,default:5},currentCuepoint:{type:Object,default:null},isAudio:{type:Boolean,default:!1},qaId:{type:String,default:"progress-bar"},landscapes:{type:Array,default:function(){return[]}},bottomBarTheme:{type:String,default:xn.DEFAULT}},inject:{playerRect:{default:{offsetLeft:0,width:0}}},data:function(){return{rootOffsetLeft:0,rootClientWidth:0,pointerMoveXPosition:0,pointerMoveProgressPercent:0,pointerMoveCurrentTime:0,isPointerActive:!1,isMouseEnter:!1,pointerUpProgressPercent:0,pointerUpPositionEnabled:!1,previewWidth:0,BOTTOM_BAR_THEME:xn}},computed:{isDisableInteractive:function(){return this.disableInteractive||this.duration===1/0},previewX:function(){return Bo({barRelativePointerMoveX:this.pointerMoveXPosition,barOffsetLeft:this.rootOffsetLeft,playerOffsetLeft:this.playerRect.offsetLeft,playerWidth:this.playerRect.width,previewWidth:this.previewWidth})},progressPercent:function(){return this.actualLive||this.duration===1/0?100:this.duration?this.currentTime/this.duration*100:0},bufferedScale:function(){return this.duration&&this.duration!==1/0?this.buffered/this.duration:0},thumbLeftPosition:function(){var e=this.progressPercent;switch(this.isPointerActive&&(e=this.pointerMoveProgressPercent),this.pointerUpPositionEnabled&&(e=this.pointerUpProgressPercent),this.bottomBarTheme){case xn.DEFAULT:return"calc(".concat(e,"% - ").concat(this.$style.exThumbSize/2,"px)");case xn.NARROW:return"calc(".concat(e,"% - ").concat(this.$style.exThumbSizeNarrow/2,"px)")}},isDisableCurrentForwardRewind:function(){return this.disableForwardRewind&&this.pointerMoveCurrentTime>this.currentTime},shouldRenderCuepoints:function(){return this.cuepoints.length>0}},watch:{currentTime:function(){this.pointerUpPositionEnabled&&(this.pointerUpPositionEnabled=!1,this.pointerUpProgressPercent=0),this.isMouseEnter||this.isPointerActive||this.resetPointerMoveState()},isMouseEnter:function(e){e||(this.previewWidth=0)}},methods:{handleChangePreviewWidth:function(e){this.previewWidth=e},onRootTouchStart:function(e){this.isDisableInteractive||(this.isPointerActive=!0,this.setRootMetrics(),this.setPointerPosition(e))},onRootTouchEnd:function(e){this.isDisableInteractive||(this.setPointerPosition(e),this.pointerUpProgressPercent=this.pointerMoveProgressPercent,this.pointerUpPositionEnabled=!0,this.isPointerActive=!1,this.isDisableCurrentForwardRewind||this.$emit("changeProgress",this.pointerMoveCurrentTime))},onRootTouchMove:function(e){e.stopPropagation(),this.isDisableInteractive||this.setPointerPosition(e)},onRootMouseEnter:function(){this.isMouseEnter=!0,this.setRootMetrics()},onRootMouseLeave:function(){this.isMouseEnter=!1,this.isPointerActive||this.activeMousePosition||this.resetPointerMoveState()},onRootMouseMove:function(e){this.isPointerActive||this.isDisableInteractive||this.setPointerPosition(e)},onRootMouseDown:function(){this.isDisableInteractive||(this.isPointerActive=!0,document.addEventListener("mousemove",this.onDocumentMouseMove),document.addEventListener("mouseup",this.onDocumentMouseUp),this.$emit("mouseDown"))},onDocumentMouseMove:function(e){this.setPointerPosition(e)},onDocumentMouseUp:function(e){document.removeEventListener("mousemove",this.onDocumentMouseMove),document.removeEventListener("mouseup",this.onDocumentMouseUp),this.setPointerPosition(e),this.pointerUpProgressPercent=this.pointerMoveProgressPercent,this.$emit("mouseUp"),this.pointerUpPositionEnabled=!0,this.isPointerActive=!1,this.isDisableCurrentForwardRewind||this.$emit("changeProgress",this.pointerMoveCurrentTime)},formatTime:function(e){return xa(e)},setPointerPosition:function(e){var t,i,s,r,n=e.clientX||(null===(i=null===(t=e.touches)||void 0===t?void 0:t[0])||void 0===i?void 0:i.clientX)||(null===(r=null===(s=e.changedTouches)||void 0===s?void 0:s[0])||void 0===r?void 0:r.clientX)||0;n<this.rootOffsetLeft&&(n=this.rootOffsetLeft-1),n>this.rootOffsetLeft+this.rootClientWidth&&(n=this.rootOffsetLeft+this.rootClientWidth-1),this.pointerMoveXPosition=n-this.rootOffsetLeft+1,this.pointerMoveProgressPercent=this.pointerMoveXPosition/this.rootClientWidth*100,this.pointerMoveCurrentTime=this.pointerMoveProgressPercent*this.duration/100},resetPointerMoveState:function(){this.rootOffsetLeft=0,this.rootClientWidth=0,this.pointerMoveXPosition=0,this.pointerMoveProgressPercent=0,this.pointerMoveCurrentTime=0},setRootMetrics:function(){var e=this.getRootClientRect(),t=e.left,i=e.width;this.rootOffsetLeft=t,this.rootClientWidth=i},getRootClientRect:function(){return this.$refs.root.getBoundingClientRect()},onClickCuepoint:function(e){this.$emit("changeProgress",e.time),this.$emit("clickCuepoint",e)}}},undefined,false,undefined,!1,Ca,void 0,void 0);var Vo=function(e){e.cancelable&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation())};const Ko=_a({render:function(){var e,t,i=this,s=i.$createElement,r=i._self._c||s;return r("Button",{attrs:{theme:"empty","qa-id":i.qaId},on:{click:i.onToggleContent}},[r("div",{attrs:{slot:"content"},slot:"content"},[r("div",{class:[i.$style.control,(e={},e[i.$style.audio]=i.isAudio,e[i.$style[i.bottomBarTheme]]=i.bottomBarTheme!==i.BOTTOM_BAR_THEME.DEFAULT,e)],on:{mouseenter:i.onShowTooltip,mouseleave:i.onHiddenTooltip,click:function(e){return i.$emit("controlClick")}}},[i._t("default")],2),i._v(" "),i.showContent?i._t("content"):i._e(),i._v(" "),r("div",{ref:"tooltipRef",class:[i.$style.tooltip,(t={},t[i.$style.showTooltip]=i.showTooltip,t)],style:i.tooltipStyle||i.defaultTooltipStyle},[i._v(i._s(i.tooltip))])],2)])},staticRenderFns:[]},(function(e){e&&(e("data-v-6628a7d0_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{control:"_1z9oZ",narrow:"m0raB",audio:"_2FlMA",tooltip:"OQOP9",showTooltip:"_3TmS8"}}))}),{name:"Control",components:{Button:Pa},props:{isMobile:{type:Boolean,default:!1},tooltip:{type:String,default:""},defaultTooltipStyle:{type:Object,default:function(){return{left:"50%",right:"unset",transform:"translateX(-50%)"}}},isAudio:{type:Boolean,default:!1},qaId:{type:String,default:""},bottomBarTheme:{type:String,default:xn.DEFAULT}},inject:{playerId:{default:0}},data:function(){return{isShowTooltip:!1,showContent:!1,tooltipLeft:"translateX(-50%)",tooltipStyle:void 0,BOTTOM_BAR_THEME:xn}},computed:{showTooltip:function(){return!!this.tooltip&&!this.showContent&&this.isShowTooltip},tooltipRef:function(){return this.$refs.tooltipRef}},watch:{isShowTooltip:function(){if(this.tooltipRef){var e=document.querySelector('[data-player-id="'.concat(this.playerId,'"]')).getBoundingClientRect(),t=e.left,i=e.right,s=this.tooltipRef.getBoundingClientRect(),r=s.left,n=s.right;this.tooltipStyle=n>=i?{left:"unset",right:"-50%",transform:"unset"}:r<=t?{left:"-50%",right:"unset",transform:"unset"}:this.defaultTooltipStyle}}},mounted:function(){var e=this;window.addEventListener("click",(function(){e.onHiddenContent()}))},methods:{onShowTooltip:function(){this.isShowTooltip=!0},onHiddenTooltip:function(){this.isShowTooltip=!1},onToggleContent:function(e){Vo(e),this.$slots.content&&(this.showContent=!this.showContent,this.$emit("show",this.showContent))},onHiddenContent:function(){this.showContent=!1,this.$emit("show",this.showContent)}}},undefined,false,undefined,!1,Ca,void 0,void 0);const qo=_a({render:function(){var e,t,i,s=this,r=s.$createElement,n=s._self._c||r;return n("div",{class:[s.$style.audioControl,(e={},e[s.$style.audio]=s.isAudio,e)],attrs:{"qa-id":s.qaId},on:{mouseenter:s.onMouseEnter,mouseleave:s.onRootMouseLeave}},[n("Control",{attrs:{"is-mobile":s.isMobile,tooltip:s.enableControlTooltips&&s.visibleBarWrapper?s.muted?"Включить звук":"Выключить звук":null,"default-tooltip-style":{left:"-50%",right:"unset",transform:"none"},"is-audio":s.isAudio,"qa-id":s.qaId+".volume-btn"},on:{controlClick:s.onButtonClick}},[s.muted?s._e():n("VolumeIcon"),s._v(" "),s.muted?n("MutedIcon"):s._e()],1),s._v(" "),s.showWithoutBar?s._e():n("div",{ref:"range",class:[s.$style.range,(t={},t[s.$style.visible]=s.rangeVisible,t)]},[n("input",{class:s.$style.input,attrs:{type:"range",step:"0.1",max:1,min:0,"qa-id":s.qaId+".volume-bar"},domProps:{value:s.volume},on:{input:s.onRangeInput}}),s._v(" "),n("div",{class:[s.$style.barWrapper,(i={},i[s.$style.visibleBarWrapper]=s.visibleBarWrapper,i)]},[n("div",{class:s.$style.bar}),s._v(" "),s.visibleBarWrapper?n("div",{class:s.$style.progress,style:{width:s.progressWidth}}):s._e(),s._v(" "),s.visibleBarWrapper?n("div",{class:s.$style.thumb,style:{left:s.percent+"%"},attrs:{"qa-id":s.qaId+".volume-bar.thumb"}}):s._e()])])],1)},staticRenderFns:[]},(function(e){e&&(e("data-v-9e5fc096_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{exRangeWidth:"56",exThumbSize:"8",exOzBGSecondary:"#fff",audioControl:"_1CxHI",range:"_2Q9vF",visible:"VM0sn",barWrapper:"_2zWaN",visibleBarWrapper:"EdDdJ",input:"_377E2",bar:"xqv0T",audio:"_2srzr",progress:"_2rQGe",thumb:"_2YNX_"}}))}),{name:"AudioControl",components:{VolumeIcon:ko,MutedIcon:Do,Control:Ko},props:{isMobile:{type:Boolean,default:!1},volume:{type:Number,default:1},muted:{type:Boolean,default:!1},showWithoutBar:{type:Boolean,default:!1},isAudio:{type:Boolean,default:!1},qaId:{type:String,default:""},enableControlTooltips:{type:Boolean,default:!0}},data:function(){return{rangeVisible:!1,visibleBarWrapper:!1,timeout:null}},computed:{isAudioDisabled:function(){return this.muted||0===this.volume},percent:function(){return 100*this.volume*((this.$style.exRangeWidth-this.$style.exThumbSize)/this.$style.exRangeWidth)},progressWidth:function(){return"calc(".concat(this.percent,"% + ").concat(this.$style.exThumbSize/2,"px)")}},methods:{onMouseEnter:function(){var e=this;this.isMobile||(this.rangeVisible=!0,clearTimeout(this.timeout),this.timeout=setTimeout((function(){clearTimeout(e.timeout),e.visibleBarWrapper=!0}),200))},onRootMouseLeave:function(){var e=this;this.visibleBarWrapper=!1,clearTimeout(this.timeout),this.timeout=setTimeout((function(){clearTimeout(e.timeout),e.rangeVisible=!1}),200)},onRangeInput:function(e){this.$emit("changeVolume",parseFloat(e.target.value))},onButtonClick:function(){this.$emit("toggleMuted",!this.muted)}}},undefined,false,undefined,!1,Ca,void 0,void 0);const jo=_a({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.$style.root},[e.cuepoint?i("div",{class:e.$style.clickableContainer,attrs:{"qa-id":e.qaId},on:{click:e.onClickCuepoint}},[i("div",{class:e.$style.text},[e._v(e._s(e.cuepoint&&e.cuepoint.text))]),e._v(" "),i("DisclosureIcon")],1):i("div",{class:e.$style.noCuepoint},[e._v("\n    "+e._s(e.noCuepointText)+"\n  ")])])},staticRenderFns:[]},(function(e){e&&(e("data-v-64ba050a_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{root:"_23rYw",clickableContainer:"_1_4E8",text:"kG6b-",noCuepoint:"_2zleA"}}))}),{name:"ActiveInlineCuepoint",components:{DisclosureIcon:Oo},props:{cuepoint:{type:Object,default:null},noCuepointText:{type:String,default:""},qaId:{type:String,default:""}},methods:{onClickCuepoint:function(){this.cuepoint&&this.$emit("clickCuepoint",this.cuepoint)}}},undefined,false,undefined,!1,Ca,void 0,void 0);function Wo(e,t){return Yo(e,t,0,e.length)}function Yo(e,t,i,s){if(s-i==1)return e[i];var r=Math.floor((i+s)/2),n=e[r];return n>t?Yo(e,t,i,r):n<t?Yo(e,t,r,s):n}const zo=_a({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"root",class:e.$style.root},[i("div",{class:e.$style.progressBar,attrs:{"qa-id":e.qaId},on:{mouseenter:e.onRootMouseEnter,mouseleave:e.onRootMouseLeave,mousemove:e.onRootMouseMove,mousedown:e.onRootMouseDown,touchstart:e.onRootTouchStart,touchend:e.onRootTouchEnd,touchmove:e.onRootTouchMove}},[i("div",{class:[e.$style.thumb],style:{left:e.thumbLeftPercents+"%"},attrs:{"qa-id":e.qaId+".thumb"}}),e._v(" "),e._l(e.episodesPositions,(function(t){return i("div",{key:t.id,class:e.$style.episode,style:{width:t.durationPercents+"%"},attrs:{"qa-id":e.qaId+".episode-"+t.id}},[i("div",{class:e.$style.episodeFill},[i("div",{class:e.$style.buffered,style:{transform:"scaleX("+e.calcEpisodeBufferedScale(t)+")"},attrs:{"qa-id":e.qaId+".episode-"+t.id+".buffered"}}),e._v(" "),i("div",{class:e.$style.progress,style:{transform:"scaleX("+e.calcEpisodeProgressScale(t)+")"},attrs:{"qa-id":e.qaId+".episode-"+t.id+".progress"}}),e._v(" "),i("div",{class:e.$style.mouseProgress,style:{transform:"scaleX("+e.calcEpisodePointerMoveScale(t)+")"}})])])}))],2),e._v(" "),e.isMouseEnter||e.isPointerActive?i("div",{style:{transform:"translateX("+e.previewX+"px)",opacity:e.previewWidth>0?1:0,width:0},attrs:{"qa-id":e.qaId+".hovered-episode-tooltip"}},[i("Preview",{attrs:{landscapes:e.landscapes,time:e.pointerMoveCurrentTime,title:e.hoveredEpisode.text},on:{changeWidth:e.handleChangePreviewWidth}})],1):e._e()])},staticRenderFns:[]},(function(e){e&&(e("data-v-db2913bc_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{root:"_3askF",progressBar:"_1XqiE",episode:"qlMoJ",episodeFill:"_22v9E",buffered:"xLQAa",progress:"X9JTH",mouseProgress:"_3ra39",thumb:"_263Ls"}}))}),{name:"EpisodesProgressBar",components:{Preview:Go},props:{visible:{type:Boolean},duration:{type:Number,default:0},buffered:{type:Number,default:0},currentTime:{type:Number,default:0},disableInteractive:{type:Boolean,default:!1},disableForwardRewind:{type:Boolean,default:!1},fullscreen:{type:Boolean,default:!1},episodes:{type:Array,default:function(){return[]}},episodesCollapseThreshold:{type:Number,default:5},qaId:{type:String,default:"progress-bar"},landscapes:{type:Array,default:function(){return[]}}},inject:{playerRect:{default:{offsetLeft:0,width:0}}},data:function(){return{rootOffsetLeft:0,rootClientWidth:0,pointerMoveXPosition:0,pointerMoveProgressPercent:0,pointerMoveCurrentTime:0,isPointerActive:!1,isMouseEnter:!1,pointerUpProgressPercent:0,pointerUpPositionEnabled:!1,isMounted:!1,previewWidth:0}},computed:{bufferedPercents:function(){return 100*this.buffered/this.duration},progressPercents:function(){return this.duration?this.currentTime/this.duration*100:0},thumbLeftPercents:function(){return this.isPointerActive?this.pointerMoveProgressPercent:this.pointerUpPositionEnabled?this.pointerUpProgressPercent:this.progressPercents},episodesPositions:function(){var e=this;if(!this.duration||!this.isMounted||!this.visible)return[];var t=this.getRootClientRect().width,i=this.episodes.map((function(i,s,r){var n=100*i.time/e.duration,a=s<r.length-1?r[s+1].time-i.time:e.duration-i.time,o=100*a/e.duration,l=o*t/100;return Fn(Fn({},i),{offsetPercents:n,duration:a,durationPercents:o,width:l})}));return this.episodesCollapseThreshold>0&&(i=i.reduce((function(t,i){if(t.length>0){var s=t[t.length-1];if(i.width<=e.episodesCollapseThreshold||s.width<=e.episodesCollapseThreshold)return s.collapsed.push(i),s.duration+=i.duration,s.durationPercents+=i.durationPercents,s.width+=i.width,t}return t.push(Fn(Fn({},i),{collapsed:[]})),t}),[])),i},episodesTimes:function(){return this.episodes.map((function(e){return e.time}))},episodesTimesMap:function(){return this.episodes.reduce((function(e,t){return e.set(t.time,t),e}),new Map)},hoveredEpisode:function(){var e=Wo(this.episodesTimes,this.pointerMoveCurrentTime);return this.episodesTimesMap.get(e)},previewX:function(){var e=this.rootClientWidth>375?300:160;return Bo({barRelativePointerMoveX:this.pointerMoveXPosition,barOffsetLeft:this.rootOffsetLeft,playerOffsetLeft:this.playerRect.offsetLeft,playerWidth:this.playerRect.width,previewWidth:this.previewWidth||e})},isDisableCurrentForwardRewind:function(){return this.disableForwardRewind&&this.pointerMoveCurrentTime>this.currentTime}},watch:{currentTime:function(){this.pointerUpPositionEnabled&&(this.pointerUpPositionEnabled=!1,this.pointerUpProgressPercent=0),this.isMouseEnter||this.isPointerActive||this.resetPointerMoveState()},isMouseEnter:function(e){e||(this.previewWidth=0)}},mounted:function(){this.isMounted=!0},methods:{handleChangePreviewWidth:function(e){this.previewWidth=e},onRootTouchStart:function(e){this.disableInteractive||(this.isPointerActive=!0,this.setRootMetrics(),this.setPointerPosition(e))},onRootTouchMove:function(e){e.stopPropagation(),this.disableInteractive||this.setPointerPosition(e)},onRootTouchEnd:function(e){this.disableInteractive||(this.setPointerPosition(e),this.pointerUpProgressPercent=this.pointerMoveProgressPercent,this.pointerUpPositionEnabled=!0,this.isPointerActive=!1,this.isDisableCurrentForwardRewind||this.$emit("changeProgress",this.pointerMoveCurrentTime))},onRootMouseEnter:function(){this.isMouseEnter=!0,this.setRootMetrics()},onRootMouseMove:function(e){this.isPointerActive||this.disableInteractive||this.setPointerPosition(e)},onRootMouseLeave:function(){this.isMouseEnter=!1,this.isPointerActive||this.activeMousePosition||this.resetPointerMoveState()},onRootMouseDown:function(){this.disableInteractive||(this.isPointerActive=!0,document.addEventListener("mousemove",this.onDocumentMouseMove),document.addEventListener("mouseup",this.onDocumentMouseUp),this.$emit("mouseDown"))},onDocumentMouseMove:function(e){this.setPointerPosition(e)},onDocumentMouseUp:function(e){document.removeEventListener("mousemove",this.onDocumentMouseMove),document.removeEventListener("mouseup",this.onDocumentMouseUp),this.setPointerPosition(e),this.pointerUpProgressPercent=this.pointerMoveProgressPercent,this.$emit("mouseUp"),this.pointerUpPositionEnabled=!0,this.isPointerActive=!1,this.isDisableCurrentForwardRewind||this.$emit("changeProgress",this.pointerMoveCurrentTime)},setRootMetrics:function(){var e=this.getRootClientRect(),t=e.left,i=e.width;this.rootOffsetLeft=t,this.rootClientWidth=i},setPointerPosition:function(e){var t,i,s,r,n=(e.clientX||(null===(i=null===(t=e.touches)||void 0===t?void 0:t[0])||void 0===i?void 0:i.clientX)||(null===(r=null===(s=e.changedTouches)||void 0===s?void 0:s[0])||void 0===r?void 0:r.clientX)||0)-this.rootOffsetLeft;n<0&&(n=0),n>=this.rootClientWidth&&(n=this.rootClientWidth-1),this.pointerMoveXPosition=n,this.pointerMoveProgressPercent=this.pointerMoveXPosition/this.rootClientWidth*100,this.pointerMoveCurrentTime=this.pointerMoveProgressPercent*this.duration/100},resetPointerMoveState:function(){this.rootOffsetLeft=0,this.rootClientWidth=0,this.pointerMoveXPosition=0,this.pointerMoveProgressPercent=0,this.pointerMoveCurrentTime=0},calcEpisodeBufferedScale:function(e){if(this.bufferedPercents>=e.offsetPercents+e.durationPercents)return 1;var t=this.bufferedPercents-e.offsetPercents;return this.duration/e.duration*t/100},calcEpisodeProgressScale:function(e){if(this.progressPercents>=e.offsetPercents+e.durationPercents)return 1;var t=this.progressPercents-e.offsetPercents;return this.duration/e.duration*t/100},calcEpisodePointerMoveScale:function(e){if(this.pointerMoveProgressPercent>=e.offsetPercents+e.durationPercents)return 1;var t=this.pointerMoveProgressPercent-e.offsetPercents;return this.duration/e.duration*t/100},formatTime:function(e){return xa(e)},getRootClientRect:function(){var e;return null===(e=this.$refs.root)||void 0===e?void 0:e.getBoundingClientRect()}}},undefined,false,undefined,!1,Ca,void 0,void 0);const Xo=_a({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.$style.root,attrs:{"qa-id":e.qaId}},[i("div",{class:e.$style.text},[i("span",{class:e.$style.dot},[e._v("•")]),e._v(e._s(e.episode&&e.episode.text))])])},staticRenderFns:[]},(function(e){e&&(e("data-v-56334ba3_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{root:"_268zp",dot:"_2O-Rn",text:"_1SmIR"}}))}),{name:"ActiveInlineEpisode",components:{},props:{episode:{type:Object,default:null},qaId:{type:String,default:""}},methods:{}},undefined,false,undefined,!1,Ca,void 0,void 0);var Zo;!function(e){e[e.OnlyTimeLeft=0]="OnlyTimeLeft",e[e.OnlyTimePassed=1]="OnlyTimePassed",e[e.OnlyTotal=2]="OnlyTotal",e[e.Full=3]="Full"}(Zo||(Zo={}));const Qo=_a({render:function(){var e,t,i=this,s=i.$createElement,r=i._self._c||s;return r("div",{class:[i.$style.time,(e={},e[i.$style[i.bottomBarTheme]]=i.bottomBarTheme!==i.BOTTOM_BAR_THEME.DEFAULT,e)],style:{cursor:i.showOnlyTimePassed||i.showOnlyTimeLeft?"pointer":"default"},on:{click:i.onClick,mouseenter:i.onMouseEnter,mouseleave:i.onMouseLeave}},[i.showOnlyTimeLeft&&!i.hideCurrentTime?r("div",{class:i.$style.currentTime,attrs:{"qa-id":i.qaId+".left-time"}},[i._v("\n    -"+i._s(i.formatTime(i.totalTime-i.currentTime))+"\n  ")]):i._e(),i._v(" "),!i.showFull&&!i.showOnlyTimePassed||i.hideCurrentTime?i._e():r("div",{class:i.$style.currentTime,attrs:{"qa-id":i.qaId+".current-time"}},[i._v("\n    "+i._s(i.formatTime(i.currentTime))+"\n  ")]),i._v(" "),!i.showFull||i.hideCurrentTime||i.hideDuration?i._e():r("div",{class:i.$style.separatorTime},[i._v("/")]),i._v(" "),!i.showFull&&!i.showOnlyTotal||i.hideDuration?i._e():r("div",{class:i.$style.totalTime,attrs:{"qa-id":i.qaId+".total-time"}},[i._v("\n    "+i._s(i.formatTime(i.totalTime))+"\n  ")]),i._v(" "),r("div",{class:[i.$style.tooltip,(t={},t[i.$style.tooltipHidden]=!i.showTooltip,t)]},[i.showOnlyTimeLeft?r("span",[i._v("Осталось времени")]):i._e(),i._v(" "),i.showOnlyTimePassed?r("span",[i._v("Прошло времени")]):i._e()])])},staticRenderFns:[]},(function(e){e&&(e("data-v-5bfd99f4_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{time:"HbiQs",narrow:"_1JzuN",currentTime:"_1LIdv",separatorTime:"_1wknl",totalTime:"_1G_QR",tooltip:"_2ajF6",tooltipHidden:"_2pg1f"}}))}),{name:"Time",components:{},props:{currentTime:{type:Number,default:0},totalTime:{type:Number,default:0},isActualLive:{type:Boolean,default:!1},videoWidth:{type:Number,default:0},qaId:{type:String,default:""},hideCurrentTime:{type:Boolean,default:!1},hideDuration:{type:Boolean,default:!1},enableControlTooltips:{type:Boolean,default:!0},bottomBarTheme:{type:String,default:xn.DEFAULT}},inject:{playerRect:{default:{offsetLeft:0,width:0}}},data:function(){return{mode:this.getDefaultMode(this.isActualLive,this.playerRect.width),showTooltip:!1,BOTTOM_BAR_THEME:xn}},computed:{showOnlyTimeLeft:function(){return this.mode===Zo.OnlyTimeLeft},showOnlyTimePassed:function(){return this.mode===Zo.OnlyTimePassed},showOnlyTotal:function(){return this.mode===Zo.OnlyTotal},showFull:function(){return this.mode===Zo.Full}},watch:{"playerRect.width":function(e){this.mode=this.getDefaultMode(this.isActualLive,e)},isActualLive:function(e){this.mode=this.getDefaultMode(e,this.playerRect.width)}},methods:{getDefaultMode:function(e,t){return e?Zo.OnlyTotal:t<420&&this.bottomBarTheme!==xn.NARROW?Zo.OnlyTimeLeft:Zo.Full},onClick:function(){[Zo.OnlyTimeLeft,Zo.OnlyTimePassed].includes(this.mode)&&(this.mode=this.mode===Zo.OnlyTimeLeft?Zo.OnlyTimePassed:Zo.OnlyTimeLeft)},onMouseEnter:function(){this.enableControlTooltips&&[Zo.OnlyTimeLeft,Zo.OnlyTimePassed].includes(this.mode)&&(this.showTooltip=!0)},onMouseLeave:function(){this.showTooltip=!1},formatTime:function(e){return xa(e)}}},undefined,false,undefined,!1,Ca,void 0,void 0);var Jo={name:"RateControl",components:{CheckIcon:So},props:{isMobile:{type:Boolean,default:!1},rates:{type:Array,default:function(){return fo}},activeRate:{type:Number,default:1}},inject:{playerId:{default:0}},data:function(){return{maxHeight:0}},mounted:function(){var e=document.querySelector('[data-player-id="'.concat(this.playerId,'"]'));e&&(this.maxHeight="".concat(e.clientHeight-100,"px"))},methods:{onChangeRate:function(e,t){e.preventDefault(),e.stopPropagation(),this.$emit("changeRate",t.value)}}};var el={name:"LevelControl",components:{CheckIcon:So},props:{levels:{type:Array,default:function(){return[]}},activeLevel:{type:Number,default:-1},auto:{type:Boolean,default:!0},isMobile:{type:Boolean,default:!1}},methods:{onChangeLevel:function(e,t){Vo(e),this.$emit("changeLevel",t)},onToggleAuto:function(e){Vo(e),this.$emit("toggleAuto")}}};var tl="settings",il="levels",sl="rates";const rl=_a({render:function(){var e,t=this,i=t.$createElement,s=t._self._c||i;return s("div",{class:[t.$style.bottomBar,(e={},e[t.$style.bottomBarOneLine]=t.oneLineControls,e[t.$style[t.bottomBarTheme]]=t.bottomBarTheme!==t.BOTTOM_BAR_THEME.DEFAULT,e)],attrs:{"qa-id":t.qaId}},[!t.showProgressbar||t.oneLineControls||t.shouldRenderEpisodes?t._e():s("ProgressBar",{attrs:{visible:t.visible,"is-mobile":t.isMobile,duration:t.duration,"current-time":t.currentTime,buffered:t.buffered,"disable-interactive":t.progressBarDisableInteractive,"disable-forward-rewind":t.progressBarDisableForwardRewind,live:t.live,"actual-live":t.actualLive,fullscreen:t.fullscreenActive,cuepoints:t.cuepoints,"cuepoints-collapse-threshold":t.cuepointsCollapseThreshold,"current-cuepoint":t.currentCuepoint,landscapes:t.showPreviewForVideoType?t.landscapes:[],"qa-id":t.qaId+".progress-bar","bottom-bar-theme":t.bottomBarTheme},on:{changeProgress:t.onChangeProgress,backToLive:t.onBackToLive,mouseDown:t.onMouseDownProgress,mouseUp:t.onMouseUpProgress,clickCuepoint:t.onClickCuepoint}}),t._v(" "),t.showProgressbar&&!t.oneLineControls&&t.shouldRenderEpisodes?s("EpisodesProgressBar",{attrs:{visible:t.visible,duration:t.duration,"current-time":t.currentTime,buffered:t.buffered,"disable-interactive":t.progressBarDisableInteractive,"disable-forward-rewind":t.progressBarDisableForwardRewind,fullscreen:t.fullscreenActive,episodes:t.episodes,"episodes-collapse-threshold":t.episodesCollapseThreshold,landscapes:t.showPreviewForVideoType?t.landscapes:[],"qa-id":t.qaId+".progress-bar"},on:{changeProgress:t.onChangeProgress,mouseDown:t.onMouseDownProgress,mouseUp:t.onMouseUpProgress}}):t._e(),t._v(" "),s("div",{class:t.$style.actions},[t.showMiniPlayButton||t.showAudioControl?s("div",{class:t.$style.leftActions},[t.showMiniPlayButton?s("Control",{attrs:{"is-mobile":t.isMobile,tooltip:t.enableControlTooltips?t.playing?"Пауза":"Смотреть":null,"qa-id":t.qaId+".play-pause-btn","bottom-bar-theme":t.bottomBarTheme},on:{controlClick:t.onTogglePlayPause}},[t.bottomBarTheme===t.BOTTOM_BAR_THEME.DEFAULT?s("div",[t.playing?s("PauseIcon"):s("PlayIcon")],1):t._e(),t._v(" "),t.bottomBarTheme===t.BOTTOM_BAR_THEME.NARROW?s("div",[t.playing?s("PauseIconNarrow"):s("PlayIconNarrow")],1):t._e()]):t._e(),t._v(" "),t.showAudioControl?s("AudioControl",{attrs:{"is-mobile":t.isMobile,volume:t.volume,muted:t.muted,"show-without-bar":t.onlyToggleAudioControl,"qa-id":t.qaId+".volume","enable-control-tooltips":t.enableControlTooltips},on:{toggleMuted:t.onToggleMuted,changeVolume:t.onChangeVolume}}):t._e(),t._v(" "),t.oneLineControls||t.duration===1/0?t._e():s("Time",{attrs:{"bottom-bar-theme":t.bottomBarTheme,"current-time":t.currentTime,"total-time":t.duration,"is-actual-live":t.actualLive,"hide-current-time":t.hideCurrentTime,"hide-duration":t.hideDuration,"enable-control-tooltips":t.enableControlTooltips,"qa-id":t.qaId}})],1):t._e(),t._v(" "),t.oneLineControls||t.bottomBarTheme!==t.BOTTOM_BAR_THEME.DEFAULT?t._e():s("div",{class:t.$style.middleActions},[t.shouldRenderActiveCuepoint?s("ActiveInlineCuepoint",{attrs:{cuepoint:t.currentCuepoint,"no-cuepoint-text":t.noCuepointText,"qa-id":t.qaId+".active-cuepoint"},on:{clickCuepoint:t.onClickCuepoint}}):t._e(),t._v(" "),t.shouldRenderEpisodes?s("ActiveInlineEpisode",{attrs:{episode:t.currentEpisode,"qa-id":t.qaId+".active-episode"}}):t._e()],1),t._v(" "),t.showProgressbar&&t.oneLineControls?s("div",{class:t.$style.oneLineProgressBarWrapper},[t.live||t.hideCurrentTime?t._e():s("div",{class:t.$style.currentTime,attrs:{"qa-id":t.qaId+".current-time"}},[t._v("\n        "+t._s(t.formatTime(t.currentTime))+"\n      ")]),t._v(" "),s("div",{class:t.$style.oneLineProgressBar},[t.showProgressbar&&!t.shouldRenderEpisodes?s("ProgressBar",{attrs:{visible:t.visible,"is-mobile":t.isMobile,duration:t.duration,"current-time":t.currentTime,buffered:t.buffered,"disable-interactive":t.progressBarDisableInteractive,"disable-forward-rewind":t.progressBarDisableForwardRewind,live:t.live,"actual-live":t.actualLive,fullscreen:t.fullscreenActive,cuepoints:t.cuepoints,"cuepoints-collapse-threshold":t.cuepointsCollapseThreshold,"current-cuepoint":t.currentCuepoint,"bottom-bar-theme":t.bottomBarTheme,landscapes:t.showPreviewForVideoType?t.landscapes:[],"qa-id":t.qaId+".progress-bar"},on:{changeProgress:t.onChangeProgress,backToLive:t.onBackToLive,mouseDown:t.onMouseDownProgress,mouseUp:t.onMouseUpProgress,clickCuepoint:t.onClickCuepoint}}):t._e(),t._v(" "),t.showProgressbar&&t.shouldRenderEpisodes?s("EpisodesProgressBar",{attrs:{visible:t.visible,duration:t.duration,"current-time":t.currentTime,buffered:t.buffered,"disable-interactive":t.progressBarDisableInteractive,"disable-forward-rewind":t.progressBarDisableForwardRewind,fullscreen:t.fullscreenActive,episodes:t.episodes,"episodes-collapse-threshold":t.episodesCollapseThreshold,landscapes:t.showPreviewForVideoType?t.landscapes:[],"qa-id":t.qaId+".progress-bar"},on:{changeProgress:t.onChangeProgress,mouseDown:t.onMouseDownProgress,mouseUp:t.onMouseUpProgress}}):t._e()],1),t._v(" "),t.hideDuration?t._e():s("div",{class:t.$style.totalTime,attrs:{"qa-id":t.qaId+".total-time"}},[t._v("\n        "+t._s(t.formatTime(t.duration))+"\n      ")])]):t._e(),t._v(" "),t.showSettings||t.showFullscreenControl?s("div",{class:t.$style.rightActions},[t.showSettings&&(t.showLevelSettings||t.showRateSettings)?s("Control",{attrs:{"is-mobile":t.isMobile,tooltip:t.enableControlTooltips?"Настройки":null,"qa-id":t.qaId+".settings-btn"},on:{show:function(e){return t.$emit("showsettings",e)}},scopedSlots:t._u([{key:"default",fn:function(){return[s("SettingsIcon")]},proxy:!0},{key:"content",fn:function(){return[s("Settings",{attrs:{"is-mobile":t.isMobile,"active-rate":t.playbackRate,levels:t.levels,"active-level":t.activeLevel,"auto-level":t.autoLevel,"show-level-settings":t.showLevelSettings,"show-rate-settings":t.showRateSettings},on:{changeRate:t.onChangePlayBackRate,changeLevel:function(e){return t.$emit("changeLevel",e)},toggleAutoLevel:function(e){return t.$emit("toggleAutoLevel")}}})]},proxy:!0}],null,!1,3525690499)}):t._e(),t._v(" "),t.showFullscreenControl?s("Control",{attrs:{"is-mobile":t.isMobile,tooltip:t.enableControlTooltips?t.fullscreenActive?"Выход из полноэкранного режима":"На весь экран":null,"qa-id":t.qaId+".fullscreen-btn","bottom-bar-theme":t.bottomBarTheme},on:{controlClick:t.onToggleFullScreen}},[t.bottomBarTheme===t.BOTTOM_BAR_THEME.DEFAULT?s("div",[t.fullscreenActive?t._e():s("FullScreenIcon"),t._v(" "),t.fullscreenActive?s("FullScreenExitIcon"):t._e()],1):t.bottomBarTheme===t.BOTTOM_BAR_THEME.NARROW?s("div",[t.fullscreenActive?t._e():s("FullScreenIconNarrow"),t._v(" "),t.fullscreenActive?s("FullScreenExitIconNarrow"):t._e()],1):t._e()]):t._e()],1):t._e()])],1)},staticRenderFns:[]},(function(e){e&&(e("data-v-327eb2ef_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{bottomBar:"_3LCx_",narrow:"_1c4iE",bottomBarOneLine:"_1mAqF",actions:"_1Y9RN",middleActions:"_3MgXO",rightActions:"Xc99G",leftActions:"_2T8Ab",currentTime:"_1fSHC",totalTime:"_2c9TK",oneLineProgressBarWrapper:"OJAPm",oneLineProgressBar:"_32Nw3"}}))}),{name:"BottomBar",components:{Settings:_a({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.$style.wrapper,style:{maxHeight:e.maxHeight}},[e.title?i("div",{class:e.$style.title},[e.allowBack?i("ArrowLeftIcon",{on:{click:function(t){return e.handleBackClick(t)}}}):e._e(),e._v("\n    "+e._s(e.title)+"\n  ")],1):e._e(),e._v(" "),e.showSettings?i("div",{class:e.$style.items},[i("div",{class:e.$style.item,on:{click:function(t){return e.handleOpenChangeLevel(t)}}},[e._v("\n      Качество\n      "),i("div",{class:e.$style.value},[e._v("\n        "+e._s(e.levelValue)+"\n      ")])]),e._v(" "),i("div",{class:e.$style.item,on:{click:function(t){return e.handleOpenChangeRate(t)}}},[e._v("\n      Скорость\n      "),i("div",{class:e.$style.value},[e._v("\n        "+e._s(e.rateValue)+"\n      ")])])]):e._e(),e._v(" "),e.showRates?i("RateControl",{attrs:{rates:e.rates,"active-rate":e.activeRate,"is-mobile":e.isMobile},on:{changeRate:e.onChangeRate}}):e._e(),e._v(" "),e.showLevels?i("LevelControl",{attrs:{levels:e.levels,"active-level":e.activeLevel,"is-mobile":e.isMobile,auto:e.autoLevel},on:{changeLevel:e.onChangeLevel,toggleAuto:e.onToggleAutoLevel}}):e._e()],1)},staticRenderFns:[]},(function(e){e&&(e("data-v-545acce2_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{wrapper:"_1inbH",items:"x-1ia",item:"_1pqGU",value:"zI-T5",title:"_2G0Vr"}}))}),{name:"Settings",components:{RateControl:_a({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.$style.wrapper},e._l(e.rates,(function(t){return i("div",{key:t.value,class:e.$style.rate,on:{click:function(i){return e.onChangeRate(i,t)}}},[e._v("\n    "+e._s("1x"===t.title?"Обычная":t.title)+"\n    "),t.value===e.activeRate?i("CheckIcon"):e._e()],1)})),0)},staticRenderFns:[]},(function(e){e&&(e("data-v-ae6180ec_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{wrapper:"_3kVHE",rate:"_2EKBm"}}))}),Jo,undefined,false,undefined,!1,Ca,void 0,void 0),LevelControl:_a({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.$style.wrapper},[e._l(e.levels,(function(t){return i("div",{key:t.height,class:e.$style.level,on:{click:function(i){return e.onChangeLevel(i,t)}}},[e._v("\n    "+e._s(t.height+"p")+"\n    "),e.auto||t.realIndex!==e.activeLevel?e._e():i("CheckIcon")],1)})),e._v(" "),i("div",{class:e.$style.level,on:{click:function(t){return e.onToggleAuto(t)}}},[e._v("\n    Автонастройка\n    "),e.auto?i("CheckIcon"):e._e()],1)],2)},staticRenderFns:[]},(function(e){e&&(e("data-v-2c52916c_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{wrapper:"_2KJ66",level:"_25uVD"}}))}),el,undefined,false,undefined,!1,Ca,void 0,void 0),ArrowLeftIcon:bo},props:{isMobile:{type:Boolean,default:!1},isShow:{type:Boolean,default:!1},rates:{type:Array,default:function(){return fo}},activeRate:{type:Number,default:1},levels:{type:Array,default:function(){return[]}},activeLevel:{type:Number,default:-1},autoLevel:{type:Boolean,default:!0},showLevelSettings:{type:Boolean,default:!1},showRateSettings:{type:Boolean,default:!1}},inject:{playerId:{default:0}},data:function(){return{maxHeight:0,step:tl}},computed:{title:function(){return this.step===sl?"Скорость":this.step===il?"Качество":null},showSettings:function(){return this.step===tl},showLevels:function(){return this.step===il},showRates:function(){return this.step===sl},allowBack:function(){return this.defaultStep===tl},rateValue:function(){return 1===this.activeRate?"Обычная":"".concat(this.activeRate,"x")},levelValue:function(){var e=this,t=this.levels.find((function(t){return t.realIndex===e.activeLevel}));return t?this.autoLevel?"Автонастройка (".concat(t.height,"p)"):"".concat(t.height,"p"):null},defaultStep:function(){return this.showLevelSettings&&!this.showRateSettings?il:!this.showLevelSettings&&this.showRateSettings?sl:tl}},mounted:function(){this.step=this.defaultStep;var e=document.querySelector('[data-player-id="'.concat(this.playerId,'"]'));e&&(this.maxHeight="".concat(e.clientHeight-100,"px"))},methods:{onChangeRate:function(e){this.$emit("changeRate",e),this.step=this.defaultStep},onChangeLevel:function(e){this.$emit("changeLevel",e.realIndex),this.step=this.defaultStep},onToggleAutoLevel:function(){this.$emit("toggleAutoLevel"),this.step=this.defaultStep},handleOpenChangeLevel:function(e){Vo(e),this.step=il},handleOpenChangeRate:function(e){Vo(e),this.step=sl},handleBackClick:function(e){Vo(e),this.step=this.defaultStep}}},undefined,false,undefined,!1,Ca,void 0,void 0),ActiveInlineCuepoint:jo,ActiveInlineEpisode:Xo,AudioControl:qo,PauseIcon:wo,PlayIcon:Ao,PauseIconNarrow:Io,PlayIconNarrow:Mo,ProgressBar:Ho,EpisodesProgressBar:zo,FullScreenIcon:Lo,FullScreenExitIcon:_o,FullScreenIconNarrow:xo,FullScreenExitIconNarrow:Fo,SettingsIcon:Co,Control:Ko,Time:Qo},props:{visible:{type:Boolean},src:{type:String,default:""},isMobile:{type:Boolean,default:!1},playing:{type:Boolean,default:!1},duration:{type:Number,default:0},currentTime:{type:Number,default:0},buffered:{type:Number,default:0},progressBarDisableInteractive:{type:Boolean,default:!1},progressBarDisableForwardRewind:{type:Boolean,default:!1},showSettings:{type:Boolean,default:!1},playbackRate:{type:Number,default:1},showAudioControl:{type:Boolean,default:!0},onlyToggleAudioControl:{type:Boolean,default:!1},showFullscreenControl:{type:Boolean,default:!0},fullscreenActive:{type:Boolean,default:!1},muted:{type:Boolean,default:!1},volume:{type:Number,default:0},live:{type:Boolean,default:!1},showProgressbar:{type:Boolean,default:!0},oneLineControls:{type:Boolean,default:!1},showMiniPlayButton:{type:Boolean,default:!0},cuepoints:{type:Array,default:function(){return[]}},cuepointsCollapseThreshold:{type:Number,default:5},currentCuepoint:{type:Object,default:null},noCuepointText:{type:String,default:""},episodes:{type:Array,default:function(){return[]}},episodesCollapseThreshold:{type:Number,default:5},currentEpisode:{type:Object,default:null},qaId:{type:String,default:"bottom-bar"},showPreviewForVideoType:{type:String,default:null},hideCurrentTime:{type:Boolean,default:!1},hideDuration:{type:Boolean,default:!1},enableControlTooltips:{type:Boolean,default:!0},levels:{type:Array,default:function(){return[]}},activeLevel:{type:Number,default:0},autoLevel:{type:Boolean,default:!0},showLevelSettings:{type:Boolean,default:!1},showRateSettings:{type:Boolean,default:!1},bottomBarTheme:{type:String,default:xn.DEFAULT}},data:function(){return{isSeeked:!1,landscapes:[],BOTTOM_BAR_THEME:xn}},computed:{actualLive:function(){return!this.isSeeked&&this.live},shouldRenderActiveCuepoint:function(){return this.fullscreenActive&&this.cuepoints.length>0},shouldRenderEpisodes:function(){return this.episodes.length>0&&0===this.cuepoints.length&&!this.live}},watch:{showPreviewForVideoType:function(){this.fetchLandscapes()}},mounted:function(){this.fetchLandscapes()},methods:{fetchLandscapes:function(){return Bn(this,void 0,void 0,(function(){var e,t,i,s,r,n,a,o;return Nn(this,(function(l){switch(l.label){case 0:if(!this.showPreviewForVideoType)return this.landscapes=[],[2];l.label=1;case 1:if(l.trys.push([1,3,,4]),e=/^https:\/\/([^\\/]+)\/(vod|stream)\/(.+)/,!(t=this.src.match(e)))throw new Error("Video url ".concat(this.src," does not match pattern"));return i=t[1],s=t[2],r=t[3],n="https://".concat(i.replace(/^s\./,"v."),"/player_meta/")+"".concat("vod"===s?"vod":"live","/")+"".concat(r,"?")+"video_type=".concat(this.showPreviewForVideoType,"&")+"entities=timeline",[4,fetch(n).then((function(e){return e.json()}))];case 2:return a=l.sent(),this.landscapes=a.timeline.timeline_index,[3,4];case 3:return o=l.sent(),this.landscapes=[],console.error("Failed to fetch previews",o),[3,4];case 4:return[2]}}))}))},formatTime:function(e){return xa(e)},onTogglePlayPause:function(){this.$emit("togglePlayPause")},onToggleFullScreen:function(){this.$emit("toggleFullscreen")},onToggleMuted:function(e){this.$emit("toggleMuted",e)},onChangeVolume:function(e){this.$emit("changeVolume",e)},onChangeProgress:function(e){this.isSeeked=this.duration-e>10,this.$emit("changeProgress",e)},onMouseDownProgress:function(){this.$emit("mouseDownProgress")},onMouseUpProgress:function(){this.$emit("mouseUpProgress")},onChangePlayBackRate:function(e){this.$emit("changePlaybackRate",e)},onClickCuepoint:function(e){this.$emit("clickCuepoint",e)},onBackToLive:function(e){this.$emit("backToLive"),this.onChangeProgress(e)}}},undefined,false,undefined,!1,Ca,void 0,void 0);const nl=_a({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("button",{class:e.$style.playBtn,attrs:{"qa-id":e.qaId},on:{click:function(t){return e.$emit("click")}}},[e.playing||e.ended?e.playing&&!e.ended?i("PauseLargeIcon",{class:e.$style.pauseIcon}):i("EndedIcon",{class:e.$style.endedIcon}):i("PlayLargeIcon",{class:e.$style.playIcon})],1)},staticRenderFns:[]},(function(e){e&&(e("data-v-4b0265b2_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{playBtn:"fzbMp",playIcon:"_3Qj3L",pauseIcon:"_3sGYz",endedIcon:"SSzGZ"}}))}),{components:{PlayLargeIcon:Po,PauseLargeIcon:wo,EndedIcon:Ro},props:{playing:{type:Boolean,default:!1},ended:{type:Boolean,default:!1},qaId:{type:String,default:""},bottomBarTheme:{type:String,default:xn.DEFAULT}}},undefined,false,undefined,!1,Ca,void 0,void 0);var al;!function(e){e.fatal="fatal",e.error="error",e.warning="warning",e.log="log",e.info="info",e.debug="debug",e.critical="critical"}(al||(al={}));var ol=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+))?@)([\w.-]+)(?::(\d+))?\/(.+)/;function ll(e){return(e&&e.message||"No error message").split("\n").filter((function(e){return!!e}))[0]}function cl(e,t){return"[object RegExp]"===Object.prototype.toString.call(t)?t.test(e):"string"==typeof t&&-1!==e.indexOf(t)}var dl=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ha(e,t)}(i,e);var t=fa(i);function i(e){var s;aa(this,i),(s=t.call(this,e)).options=e,s.destroyed=!1,s._state={};var r=s.options||{},n=r.plugins,a=void 0===n?[]:n,o=r.beforeSend,l=void 0===o?function(e){return e}:o,c=r.beforeBreadcrumb,d=void 0===c?function(e){return e}:c,h=r.blacklistUrls,u=void 0===h?[]:h,f=r.ignoreErrors,p=void 0===f?[]:f,g=r.release,m=void 0===g?void 0:g;return s.plugins=a.map((function(e){return new e(ua(s))})),s.beforeSend=l,s.beforeBreadcrumb=d,s.blacklistUrls=u,s.ignoreErrors=p,s.release=m,s}return la(i,[{key:"state",get:function(){return this._state}},{key:"clearState",value:function(){this._state={}}},{key:"setTags",value:function(e){return this.setKeyState("tags",na({},e)),this}},{key:"setTag",value:function(e,t){return this.extendState({tags:ca({},e,t)}),this}},{key:"setExtra",value:function(e,t){return this.extendState({extra:ca({},e,t)}),this}},{key:"setExtras",value:function(e){return this.setKeyState("extra",na({},e)),this}},{key:"setUser",value:function(e){return this.setKeyState("user",na({},e)),this}},{key:"clone",value:function(){var e=new i(na(na({},this.options),{},{plugins:[]}));return e.extendState(this.state),e}},{key:"withScope",value:function(e){var t=this.clone();e(t),t.destroy(),this.setBreadcrumbs(void 0)}},{key:"addBreadcrumb",value:function(e){this.extendState({breadcrumbs:[na({timestamp:Date.now()/1e3},this.beforeBreadcrumb(e))]})}},{key:"setBreadcrumbs",value:function(e){this.setKeyState("breadcrumbs",e)}},{key:"captureMessage",value:function(e,t){this.send(na(na({},this.getRequestBlank()),{},{message:e,level:t}))}},{key:"destroy",value:function(){this.destroyed=!0,this.plugins.forEach((function(e){e.destroy&&e.destroy()}))}},{key:"isIgnoredError",value:function(e){var t=this;return!!this.ignoreErrors.length&&this.getPossibleEventMessages(e).some((function(e){return t.ignoreErrors.some((function(t){return cl(e,t)}))}))}},{key:"getRequestBlank",value:function(){return na(na({request:{url:window.location.toString(),headers:{"User-Agent":window.navigator.userAgent}}},pa(da(i.prototype),"getRequestBlank",this).call(this)),this.state)}},{key:"send",value:function(e){this.destroyed||this.isDeniedUrl(e)||this.isIgnoredError(e)||(pa(da(i.prototype),"send",this).call(this,this.beforeSend(na({release:this.release},e))),this.setBreadcrumbs(void 0))}},{key:"getPossibleEventMessages",value:function(e){if(e.message)return[e.message];if(e.exception)try{var t=e.exception.values&&e.exception.values[0]||{},i=t.type,s=void 0===i?"":i,r=t.value,n=void 0===r?"":r;return["".concat(n),"".concat(s,": ").concat(n)]}catch(a){return[]}return[]}},{key:"isDeniedUrl",value:function(e){if(!this.blacklistUrls.length)return!1;var t=this.getEventFilterUrl(e);return!!t&&this.blacklistUrls.some((function(e){return cl(t,e)}))}},{key:"getEventFilterUrl",value:function(e){try{if(e.exception){var t=e.exception.values&&e.exception.values[0].stacktrace&&e.exception.values[0].stacktrace.frames;return t&&t[t.length-1].filename||null}return null}catch(i){return null}}},{key:"extendState",value:function(e){var t=this;this._state=Object.keys(e).reduce((function(i,s){var r=t.state[s],n=Array.isArray(r)?r:null,a=e[s],o=Array.isArray(a)?a:null;return na(na({},i),{},ca({},s,n||o?[].concat(ga(n||[]),ga(o||[])):na(na({},"string"!=typeof r?r:{}),"string"!=typeof a?a:{})))}),{})}},{key:"setKeyState",value:function(e,t){this._state[e]=t}}]),i}(function(){function e(t){if(aa(this,e),t&&t.dsn){var i=ol.exec(t.dsn),s=i?i.slice(1):[],r=s[5].split("/"),n=r.slice(0,-1).join("/");this.apiUrl=s[0]+"://"+s[3]+(s[4]?":"+s[4]:"")+(n?"/"+n:"")+"/api/"+r.pop()+"/store/",this.authHeader="Sentry sentry_version=7,sentry_key="+s[1]+(s[2]?",sentry_secret="+s[2]:"")}this.environment=t&&t.environment}return la(e,[{key:"prepare",value:function(e){return na(na({},this.getRequestBlank()),{},{exception:{values:[(t=e,{value:ll(t),type:t&&t.name,url:"2222"})]}});var t}},{key:"report",value:function(e){this.send(this.prepare(e))}},{key:"send",value:function(e){this.apiUrl&&e&&this.createRequest(e)}},{key:"createRequest",value:function(e){var t=new XMLHttpRequest;t.open("POST",this.apiUrl,!0),t.setRequestHeader("Content-type","application/json"),t.setRequestHeader("X-Sentry-Auth",this.authHeader||""),t.send(JSON.stringify(e))}},{key:"getRequestBlank",value:function(){return{platform:"javascript",sdk:{name:"player-sentry-sdk",version:"0.0.0"},timestamp:Date.now()/1e3,environment:this.environment}}}]),e}()),hl=new dl({dsn:"https://44b4056e3577437fa3d12c912b618ef0@sentry.ozon.ru/674"}),ul={showNativeControls:{type:Boolean,default:!1,description:"Отображать ли нативные контролы"},initialMuted:{type:Boolean,default:!1,description:"Начальное значение muted"},initialVolume:{type:Number,default:1,description:"Начальный уровень громкости"},startTime:{type:Number,default:void 0,description:"Номер секунды начала воспроизведения"},loop:{type:Boolean,default:!1,description:"Воспроизводить с начала при завершении или нет"},tryAutoplay:{type:Boolean,default:!1,description:"В значении true плеер попробует воспроизвести видео/аудио в соответствии с Autoplay Policy"},singlePlayingInstance:{type:Boolean,default:!1,description:"Если включено, воспроизведение останавливается, когда другой плеер на странице начал воспроизведение"},hotkeysEnabled:{type:Boolean,default:!0,description:"В значении true включает возможность управлять плеером с клавиатуры"},sendSentryEvent:{type:Boolean,default:!1,description:"Отправлять в Sentry ивенты или нет"},sentryMetaData:{type:Object,default:function(){return{}},description:"Отправлять в Sentry дополнительную информацию, например userId"},isTesting:{type:Boolean,default:!1,description:"В значении true включает тестовые фичи"}};const fl=_a({},undefined,{name:"BasePlayer",provide:function(){return{playerId:this.id}},data:function(){return{isPlayerObjectAttached:!1,volume:this.initialVolume,muted:this.initialMuted,playing:!1,loading:!1,duration:0,currentTime:0,buffered:0,playbackRate:1,ended:!1,prevPlayingState:!1,isMounted:!1,isLive:!1,isFetchedLevelInfo:!1,id:Math.random(),mountTime:null,levels:[],activeLevel:0,autoLevel:!0,isShowSettings:!1}},watch:{isPlayerObjectAttached:function(e){e&&(this.setPlayerState(),this.addPlayerEventListeners(),this.addGlobalPlayerBusEventListeners())}},mounted:function(){this.isMounted=!0},beforeDestroy:function(){if(this.sendSentryEvent&&this.currentTime<=0&&this.mountTime&&(this.player.tryPlayed||this.tryAutoplay)){var e=Date.now()-this.mountTime;hl.addBreadcrumb({category:"playback_attempt_time",level:"error",data:Fn({src:this.src,time:e,domain:window.origin},this.sentryMetaData||{})}),hl.setTag("playback_attempt_time",e),hl.setTag("src",this.src),hl.setTag("domain",window.origin),hl.report({message:this.src,name:"PlaybackAttemptTime"})}this.removeGlobalPlayerBusEventListeners()},methods:{createPlayer:function(){this.mountTime=Date.now(),this.player=new Gn(this.$refs.media,{showNativeControls:this.showNativeControls,initialMuted:this.initialMuted,initialVolume:this.initialVolume,startTime:this.startTime,loop:this.loop}),this.isPlayerObjectAttached=!0,this.$emit("playerInstance",this.player),this.isTesting&&(window.__player__=this.player)},play:function(){return Bn(this,void 0,void 0,(function(){return Nn(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.player.play()];case 1:return e.sent(),[3,3];case 2:return e.sent(),this.showLargePlayButton=!0,[3,3];case 3:return[2]}}))}))},setPlayerState:function(){this.muted=this.player.muted,this.volume=this.player.volume,this.playing=this.player.playing,this.duration=this.player.duration,this.loading=this.player.loading,this.playbackRate=this.player.playbackRate,this.buffered=this.player.buffered,this.currentTime=this.player.currentTime,this.isFetchedLevelInfo=this.player.isMediaNative},onEnded:function(){},addPlayerEventListeners:function(){var e,t=this,i=((e={})[kn.MEDIA_ATTACH]=function(){t.tryAutoplay&&t.play()},e[kn.PLAY]=function(){t.playing=!0,t.ended=!1,t.$refs.media.dispatchEvent(new CustomEvent(On.PLAY,{bubbles:!0,detail:{id:t.id}}))},e[kn.PAUSE]=function(){t.playing=!1},e[kn.DURATION_CHANGE]=function(e){t.duration=e,e===1/0&&(t.isLive=!0)},e[kn.LOADING_STATE_CHANGE]=function(e){t.loading=e},e[kn.VOLUME_CHANGE]=function(e){var i=e.volume,s=e.muted;s!==t.muted&&t.$emit("toggleVolume",{enabled:!s}),t.muted=s,t.volume=i},e[kn.TIME_UPDATE]=function(e){t.currentTime=e},e[kn.BUFFERED_UPDATE]=function(e){t.buffered=e},e[kn.PLAYBACK_RATE_CHANGE]=function(e){t.playbackRate=e},e[kn.ENDED]=function(){t.ended=!0,t.onEnded()},e[kn.REWIND]=null,e[kn.ERROR]=null,e[kn.RECOVER]=null,e[kn.VIEW_START]=null,e[kn.VIEW_FINISH]=null,e[kn.MANIFEST_PARSED]=function(e){var i=e.data.levels;t.levels=i.map((function(e,t){return Fn(Fn({},e),{realIndex:t})})).sort((function(e,t){return e.height-t.height}))},e[kn.LEVEL_UPDATED]=function(e){var i=(e||{}).data,s=(void 0===i?{}:i).details,r=(void 0===s?{}:s).live;t.isLive=!!r,t.isFetchedLevelInfo=!0},e[kn.LEVEL_SWITCHING]=function(e){var i=(e||{}).data,s=void 0===i?{}:i;t.activeLevel=s.level},e);Object.entries(i).forEach((function(e){var i=e[0],s=e[1];t.player.on(i,(function(e){s&&s(e),i===kn.TIME_UPDATE?t.$emit(i,{currentTime:e,progress:e/t.duration*100}):t.$emit(i,e)}))}))},addGlobalPlayerBusEventListeners:function(){this.singlePlayingInstance&&document.addEventListener(On.PLAY,this.onPlayerBusPlay)},removeGlobalPlayerBusEventListeners:function(){document.removeEventListener(On.PLAY,this.onPlayerBusPlay)},onPlayerBusPlay:function(e){e.detail.id!==this.id&&this.player.pause()},togglePlayPause:function(){var e;null===(e=this.$refs.player)||void 0===e||e.focus(),this.playing?this.player.pause():this.player.play()},onChangeProgress:function(e){this.player.rewind(e)},onMouseDownProgress:function(){this.playing&&(this.prevPlayingState=!0,this.player.pause())},onMouseUpProgress:function(){this.prevPlayingState&&this.player.play(),this.prevPlayingState=!1},onChangePlaybackRate:function(e){this.player.playbackRate=e},onToggleMuted:function(e){e!==this.muted&&this.$emit("toggleVolume",{enabled:!e}),this.player.muted=e,this.muted=e},onChangeVolume:function(e){e!==this.volume&&this.$emit("changeVolume",{value:e}),this.player.volume=e,this.volume=e},onKeydown:function(e){if(this.hotkeysEnabled&&("KeyR"!==e.code||!e.metaKey))switch(e.preventDefault(),e.stopPropagation(),e.code){case"KeyF":this.toggleFullScreen();break;case"KeyM":this.onToggleMuted(!this.muted);break;case"Space":case"Enter":this.togglePlayPause();break;case"ArrowUp":this.onChangeVolume(this.volume+ho>1?1:this.volume+ho);break;case"ArrowDown":this.onChangeVolume(this.volume-ho<0?0:this.volume-ho);break;case"ArrowLeft":this.player.currentTime=this.currentTime-uo<0?0:this.currentTime-uo;break;case"ArrowRight":this.player.currentTime=this.currentTime+uo>this.duration?this.duration:this.currentTime+uo;break;case"Digit0":case"Digit1":case"Digit2":case"Digit3":case"Digit4":case"Digit5":case"Digit6":case"Digit7":case"Digit8":case"Digit9":this.player.currentTime=this.duration*Number(e.code.split("Digit")[1])/10}}}},undefined,undefined,undefined,!1,void 0,void 0,void 0);var pl={200:{width:16,height:16,transform:"rotate(-90 8 8)",circle:{cx:8,cy:8,r:6,width:2,dasharray:37.7,dashoffset:8.89}},300:{width:24,height:24,transform:"rotate(-90 12 12)",circle:{cx:12,cy:12,r:8,width:2,dasharray:50.27,dashoffset:11.85}},400:{width:32,height:32,transform:"rotate(-90 16 16)",circle:{cx:16,cy:16,r:11.5,width:3,dasharray:72.26,dashoffset:17.03}},500:{width:44,height:44,transform:"rotate(-90 22 22)",circle:{cx:22,cy:22,r:16,width:4,dasharray:100.53,dashoffset:23.69}},600:{width:56,height:56,transform:"rotate(-90 28 28)",circle:{cx:28,cy:28,r:21.75,width:5,dasharray:136.66,dashoffset:32.21}},630:{width:60,height:60,transform:"rotate(-90 30 30)",circle:{cx:30,cy:30,r:23.67,width:5.33,dasharray:148.7,dashoffset:35.05}}};const gl=_a({},undefined,{name:"DsLoader",functional:!0,props:{size:{type:Number,default:630,validator:function(e){return e in pl}},color:{type:String,default:"#fff"},qaId:{type:String,default:"loader"}},render:function(e,t){var i=t.props,s=t.data,r=pl[i.size];return e("svg",{class:s.class,attrs:{"qa-id":i.qaId,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(r.width," ").concat(r.height),"shape-rendering":"geometricPrecision",width:"".concat(r.width),height:"".concat(r.height),version:"1.1"}},[e("g",{attrs:{id:"loader",transform:"".concat(r.transform)}},[e("g",{attrs:{id:"cycle-1"}},[e("circle",{attrs:{id:"cycle-1-inc",cx:"".concat(r.circle.cx),cy:"".concat(r.circle.cy),r:"".concat(r.circle.r),fill:"none",stroke:i.color,"stroke-width":"".concat(r.circle.width),"stroke-linecap":"round","stroke-dasharray":"".concat(r.circle.dasharray),"stroke-dashoffset":"".concat(r.circle.dashoffset),opacity:"0"}},[e("animate",{attrs:{attributeName:"opacity",values:"100; 0; 100",dur:"5.6s",calcMode:"discrete",keyTimes:"0; 0.125; 1",repeatCount:"indefinite"}}),e("animate",{attrs:{attributeName:"stroke-dashoffset",values:"".concat(r.circle.dasharray,"; ").concat(r.circle.dashoffset,"; ").concat(r.circle.dashoffset),dur:"5.6s",calcMode:"spline",repeatCount:"indefinite",keyTimes:"0; 0.125; 1",keySplines:"0.73 0 0.45 1; 0.73 0 0.45 1"}})]),e("circle",{attrs:{id:"cycle-1-dec",cx:"".concat(r.circle.cx),cy:"".concat(r.circle.cy),r:"".concat(r.circle.r),fill:"none",stroke:i.color,"stroke-width":"".concat(r.circle.width),"stroke-linecap":"round","stroke-dasharray":"".concat(r.circle.dasharray),"stroke-dashoffset":"".concat(r.circle.dashoffset),opacity:"0"}},[e("animate",{attrs:{attributeName:"opacity",values:"0; 100; 0; 0",dur:"5.6s",calcMode:"discrete",repeatCount:"indefinite",keyTimes:"0; 0.125; 0.25; 1"}}),e("animate",{attrs:{attributeName:"stroke-dashoffset",values:"".concat(r.circle.dasharray,"; ").concat(r.circle.dashoffset,"; ").concat(r.circle.dasharray,"; ").concat(r.circle.dasharray),dur:"5.6s",calcMode:"spline",repeatCount:"indefinite",keyTimes:"0; 0.125; 0.25; 1",keySplines:"0 0 0 1; 0.73 0 0.45 1; 0 0 0 1"}}),e("animateTransform",{attrs:{attributeName:"transform",attributeType:"XML",type:"rotate",values:"0 ".concat(r.circle.cx," ").concat(r.circle.cy,"; 0 ").concat(r.circle.cx," ").concat(r.circle.cy,"; 360 ").concat(r.circle.cx," ").concat(r.circle.cy,"; 360 ").concat(r.circle.cx," ").concat(r.circle.cy),dur:"5.6s",calcMode:"spline",repeatCount:"indefinite",keyTimes:"0; 0.125; 0.25; 1",keySplines:"0 0 0 1; 0.73 0 0.45 1; 0 0 0 1"}})]),e("animateTransform",{attrs:{attributeName:"transform",attributeType:"XML",type:"rotate",values:"0 ".concat(r.circle.cx," ").concat(r.circle.cy,"; 270 ").concat(r.circle.cx," ").concat(r.circle.cy,"; 270 ").concat(r.circle.cx," ").concat(r.circle.cy),dur:"5.6s",calcMode:"spline",repeatCount:"indefinite",keyTimes:"0; 0.25; 1",keySplines:"0.73 0 0.45 1; 0 0 0 1"}})]),e("g",{attrs:{id:"cycle-2"}},[e("circle",{attrs:{id:"cycle-2-inc",cx:"".concat(r.circle.cx),cy:"".concat(r.circle.cy),r:"".concat(r.circle.r),fill:"none",stroke:i.color,"stroke-width":"".concat(r.circle.width),"stroke-linecap":"round","stroke-dasharray":"".concat(r.circle.dasharray),"stroke-dashoffset":"".concat(r.circle.dashoffset),opacity:"0"}},[e("animate",{attrs:{attributeName:"opacity",values:"0; 100; 0; 0",dur:"5.6s",calcMode:"discrete",keyTimes:"0; 0.25; 0.375; 1",repeatCount:"indefinite"}}),e("animate",{attrs:{attributeName:"stroke-dashoffset",values:"".concat(r.circle.dasharray,"; ").concat(r.circle.dasharray,"; ").concat(r.circle.dashoffset,"; ").concat(r.circle.dashoffset),dur:"5.6s",calcMode:"spline",repeatCount:"indefinite",keyTimes:"0; 0.25; 0.375; 1",keySplines:"0 0 0 1; 0.73 0 0.45 1; 0 0 0 1"}})]),e("circle",{attrs:{id:"cycle-2-dec",cx:"".concat(r.circle.cx),cy:"".concat(r.circle.cy),r:"".concat(r.circle.r),fill:"none",stroke:i.color,"stroke-width":"".concat(r.circle.width),"stroke-linecap":"round","stroke-dasharray":"".concat(r.circle.dasharray),"stroke-dashoffset":"".concat(r.circle.dashoffset),opacity:"0"}},[e("animate",{attrs:{attributeName:"opacity",values:"0; 100; 0; 0",dur:"5.6s",calcMode:"discrete",repeatCount:"indefinite",keyTimes:"0; 0.375; 0.5; 1"}}),e("animate",{attrs:{attributeName:"stroke-dashoffset",values:"".concat(r.circle.dashoffset,"; ").concat(r.circle.dashoffset,"; ").concat(r.circle.dasharray,"; ").concat(r.circle.dasharray),dur:"5.6s",calcMode:"spline",repeatCount:"indefinite",keyTimes:"0; 0.375; 0.5; 1",keySplines:"0 0 0 1; 0.73 0 0.45 1; 0 0 0 1"}}),e("animateTransform",{attrs:{attributeName:"transform",attributeType:"XML",type:"rotate",values:"0 ".concat(r.circle.cx," ").concat(r.circle.cy,"; 0 ").concat(r.circle.cx," ").concat(r.circle.cy,"; 360 ").concat(r.circle.cx," ").concat(r.circle.cy,"; 360 ").concat(r.circle.cx," ").concat(r.circle.cy),dur:"5.6s",calcMode:"spline",repeatCount:"indefinite",keyTimes:"0; 0.375; 0.5; 1",keySplines:"0 0 0 1; 0.73 0 0.45 1; 0 0 0 1"}})]),e("animateTransform",{attrs:{attributeName:"transform",attributeType:"XML",type:"rotate",values:"-90 ".concat(r.circle.cx," ").concat(r.circle.cy,"; -90 ").concat(r.circle.cx," ").concat(r.circle.cy,"; 180 ").concat(r.circle.cx," ").concat(r.circle.cy,"; 180 ").concat(r.circle.cx," ").concat(r.circle.cy),dur:"5.6s",calcMode:"spline",repeatCount:"indefinite",keyTimes:"0; 0.25; 0.5; 1",keySplines:"0 0 0 1; 0.73 0 0.45 1; 0 0 0 1"}})]),e("g",{attrs:{id:"cycle-3"}},[e("circle",{attrs:{id:"cycle-3-inc",cx:"".concat(r.circle.cx),cy:"".concat(r.circle.cy),r:"".concat(r.circle.r),fill:"none",stroke:i.color,"stroke-width":"".concat(r.circle.width),"stroke-linecap":"round","stroke-dasharray":"".concat(r.circle.dasharray),"stroke-dashoffset":"".concat(r.circle.dashoffset),opacity:"0"}},[e("animate",{attrs:{attributeName:"opacity",values:"0; 100; 0; 0",dur:"5.6s",calcMode:"discrete",keyTimes:"0; 0.5; 0.625; 1",repeatCount:"indefinite"}}),e("animate",{attrs:{attributeName:"stroke-dashoffset",values:"".concat(r.circle.dasharray,"; ").concat(r.circle.dasharray,"; ").concat(r.circle.dashoffset,"; ").concat(r.circle.dashoffset),dur:"5.6s",calcMode:"spline",repeatCount:"indefinite",keyTimes:"0; 0.5; 0.625; 1",keySplines:"0 0 0 1; 0.73 0 0.45 1; 0 0 0 1"}})]),e("circle",{attrs:{id:"cycle-3-dec",cx:"".concat(r.circle.cx),cy:"".concat(r.circle.cy),r:"".concat(r.circle.r),fill:"none",stroke:i.color,"stroke-width":"".concat(r.circle.width),"stroke-linecap":"round","stroke-dasharray":"".concat(r.circle.dasharray),"stroke-dashoffset":"".concat(r.circle.dashoffset),opacity:"0"}},[e("animate",{attrs:{attributeName:"opacity",values:"0; 100; 0; 0",dur:"5.6s",calcMode:"discrete",repeatCount:"indefinite",keyTimes:"0; 0.625; 0.75; 1"}}),e("animate",{attrs:{attributeName:"stroke-dashoffset",values:"".concat(r.circle.dashoffset,"; ").concat(r.circle.dashoffset,"; ").concat(r.circle.dasharray,"; ").concat(r.circle.dasharray),dur:"5.6s",calcMode:"spline",repeatCount:"indefinite",keyTimes:"0; 0.625; 0.75; 1",keySplines:"0 0 0 1; 0.73 0 0.45 1; 0 0 0 1"}}),e("animateTransform",{attrs:{attributeName:"transform",attributeType:"XML",type:"rotate",values:"0 ".concat(r.circle.cx," ").concat(r.circle.cy,"; 0 ").concat(r.circle.cx," ").concat(r.circle.cy,"; 360 ").concat(r.circle.cx," ").concat(r.circle.cy,"; 360 ").concat(r.circle.cx," ").concat(r.circle.cy),dur:"5.6s",calcMode:"spline",repeatCount:"indefinite",keyTimes:"0; 0.625; 0.75; 1",keySplines:"0 0 0 1; 0.73 0 0.45 1; 0 0 0 1"}})]),e("animateTransform",{attrs:{attributeName:"transform",attributeType:"XML",type:"rotate",values:"-180 ".concat(r.circle.cx," ").concat(r.circle.cy,"; -180 ").concat(r.circle.cx," ").concat(r.circle.cy,"; 90 ").concat(r.circle.cx," ").concat(r.circle.cy,"; 90 ").concat(r.circle.cx," ").concat(r.circle.cy),dur:"5.6s",calcMode:"spline",repeatCount:"indefinite",keyTimes:"0; 0.5; 0.75; 1",keySplines:"0 0 0 1; 0.73 0 0.45 1; 0 0 0 1"}})]),e("g",{attrs:{id:"cycle-4"}},[e("circle",{attrs:{id:"cycle-4-inc",cx:"".concat(r.circle.cx),cy:"".concat(r.circle.cy),r:"".concat(r.circle.r),fill:"none",stroke:i.color,"stroke-width":"".concat(r.circle.width),"stroke-linecap":"round","stroke-dasharray":"".concat(r.circle.dasharray),"stroke-dashoffset":"".concat(r.circle.dashoffset),opacity:"0"}},[e("animate",{attrs:{attributeName:"opacity",values:"0; 100; 0; 0",dur:"5.6s",calcMode:"discrete",keyTimes:"0; 0.75; 0.875; 1",repeatCount:"indefinite"}}),e("animate",{attrs:{attributeName:"stroke-dashoffset",values:"".concat(r.circle.dasharray,"; ").concat(r.circle.dasharray,"; ").concat(r.circle.dashoffset,"; ").concat(r.circle.dashoffset),dur:"5.6s",calcMode:"spline",repeatCount:"indefinite",keyTimes:"0; 0.75; 0.875; 1",keySplines:"0 0 0 1; 0.73 0 0.45 1; 0 0 0 1"}})]),e("circle",{attrs:{id:"cycle-4-dec",cx:"".concat(r.circle.cx),cy:"".concat(r.circle.cy),r:"".concat(r.circle.r),fill:"none",stroke:i.color,"stroke-width":"".concat(r.circle.width),"stroke-linecap":"round","stroke-dasharray":"".concat(r.circle.dasharray),"stroke-dashoffset":"".concat(r.circle.dashoffset),opacity:"0"}},[e("animate",{attrs:{attributeName:"opacity",values:"0; 100; 0",dur:"5.6s",calcMode:"discrete",repeatCount:"indefinite",keyTimes:"0; 0.875; 1"}}),e("animate",{attrs:{attributeName:"stroke-dashoffset",values:"".concat(r.circle.dashoffset,"; ").concat(r.circle.dashoffset,"; ").concat(r.circle.dasharray),dur:"5.6s",calcMode:"spline",repeatCount:"indefinite",keyTimes:"0; 0.875; 1",keySplines:"0 0 0 1; 0.73 0 0.45 1"}}),e("animateTransform",{attrs:{attributeName:"transform",attributeType:"XML",type:"rotate",values:"0 ".concat(r.circle.cx," ").concat(r.circle.cy,"; 0 ").concat(r.circle.cx," ").concat(r.circle.cy,"; 360 ").concat(r.circle.cx," ").concat(r.circle.cy),dur:"5.6s",calcMode:"spline",repeatCount:"indefinite",keyTimes:"0; 0.875; 1",keySplines:"0 0 0 1; 0.73 0 0.45 1"}})]),e("animateTransform",{attrs:{attributeName:"transform",attributeType:"XML",type:"rotate",values:"-270 ".concat(r.circle.cx," ").concat(r.circle.cy,"; -270 ").concat(r.circle.cx," ").concat(r.circle.cy,"; 0 ").concat(r.circle.cx," ").concat(r.circle.cy),dur:"5.6s",calcMode:"spline",repeatCount:"indefinite",keyTimes:"0; 0.75; 1",keySplines:"0 0 0 1; 0.73 0 0.45 1"}})])])])}},undefined,undefined,undefined,!1,void 0,void 0,void 0);var ml=Fn(Fn({},ul),{src:{type:String,required:!0,description:"Ссылка на исходник видео"},fitToContainer:{type:Boolean,default:!1,description:"Вписывать плеер в контейнер или нет"},isMobile:{type:Boolean,default:!1,description:"Мобильный плеер или нет"},backgroundColor:{type:String,default:"transparent",description:"Цвет фона плеера"},playPauseOnClickVideo:{type:Boolean,default:!0,description:"Выполнять play/pause при нажатии на плеер (не на кнопку плей/пауза)"},videoObjectFitCover:{type:Boolean,default:!1,description:"-"},videoContainerClass:{type:String,default:void 0,description:"-"},bottomBarOverVideo:{type:Boolean,default:!1,description:"-"},showBottomBar:{type:Boolean,default:!0,description:"Отображать нижний бар с котролами или нет"},showAudioControl:{type:Boolean,default:!0,description:"Отображать контрол управления звуком"},onlyToggleAudioControl:{type:Boolean,default:!1,description:"Отображать контрол управления звуком без ползунка"},showFullscreenControl:{type:Boolean,default:!0,description:"Отображать контрол полноэкранного режима"},fullscreenElementClassName:{type:String,default:"",description:"Класс для кастомизации полноэкранного режима"},progressBarDisableInteractive:{type:Boolean,default:!1,description:"В значении true отключает взаимодействие с прогрессбаром"},progressBarDisableForwardRewind:{type:Boolean,default:!1,description:"В значении true запрещает перемотку видео вперед"},showSettings:{type:Boolean,default:!1,description:"Отображать контрол настроек"},showLevelSettings:{type:Boolean,default:!0,description:"Отображать настройки качества"},showRateSettings:{type:Boolean,default:!0,description:"Отображать настройки скорости"},showMiniPlayButton:{type:Boolean,default:!0,description:"Отображать контрол плей"},showProgressBar:{type:Boolean,default:!0,description:"Отображать прогрессбар"},oneLineControls:{type:Boolean,default:!1,description:"Отображать контролы в одну линию"},cuepoints:{type:Array,default:function(){return[]},description:"Массив кьюпоинтов"},cuepointsCollapseThreshold:{type:Number,default:5,description:"-"},cuepointAriseDuration:{type:Number,default:1,description:"-"},noCuepointText:{type:String,default:"",description:"-"},episodes:{type:Array,default:function(){return[]},description:"Массив эпизодов"},episodesCollapseThreshold:{type:Number,default:5,description:"-"},hideUiOnPointerLeave:{type:Boolean,default:!0,description:"Скрывать контролы, когда курсор уведен с видео во время проигрывания"},hideUiWhenIdleSeconds:{type:Number,default:3,description:"Скрывать контролы и курсор после указанного кол-ва секунд бездействия"},showLargePlayButtonSeconds:{type:Number,default:3,description:"Отображать большую кнопку плей поверх видео после старта видео указанное кол-во секунд"},showLargePlayButtonOnPause:{type:Boolean,default:!1,description:"Отображать большую кнопку плей на паузе"},showLargePlayButtonOnEnd:{type:Boolean,default:!1,description:"Отображать отображать большую кнопку плей после завершения видео"},showLargePlayButtonOnHover:{type:Boolean,default:!1,description:"Отображать большую кнопку плей только при наведении"},playButtonClass:{type:String,default:void 0,description:"Класс для кастомизации кнопки плей"},hideCurrentTime:{type:Boolean,default:!1,description:"Срыть текущее время"},hideDuration:{type:Boolean,default:!1,description:"Срыть длительность"},customClassForBottomBar:{type:String,default:null,description:"Пользовательский класс для кастомизации BottomBar"},showPreviewForVideoType:{type:String,default:null,description:"Отображать или нет превью над прогрессбаром, принимает videoType, например lvs, необходимо указать свой проект"},isAdaptive:{type:Boolean,default:!1,description:"Если включено, плеер подстраивается под размер контейнера, (удобно если нужно использовать вертикальное видео)"},adaptiveBackground:{type:String,default:"black",description:"Цвет фона для адаптивного плеера"},enableControlTooltips:{type:Boolean,default:!0,description:"Показывать или нет тултипы контролов"},bottomBarTheme:{type:String,default:xn.DEFAULT,description:"кастомная тема нижней панели"}}),vl={name:"VideoPlayerBase",components:{DsLoader:gl,PlayButton:nl,Loader:Yn,BottomBar:rl},extends:fl,props:ml,provide:function(){return{playerRect:this.playerRect}},data:function(){return{fullScreenActive:!1,fullScreenEvents:["fullscreenchange","webkitfullscreenchange","webkitendfullscreen"],currentCuepoint:null,currentCuepointTimer:null,currentEpisode:null,isUIHidden:!1,hideUITimer:null,showLargePlayButton:!1,showLargePlayButtonTimer:null,playerRect:{offsetLeft:0,width:0},id:Math.random(),isError:!1,BOTTOM_BAR_THEME:xn}},computed:{fullscreenElement:function(){return this.isMounted&&this.isMobile&&this.isPlayerObjectAttached?this.player.videoElement:this.fullscreenElementClassName&&document.querySelector(".".concat(this.fullscreenElementClassName))||this.$refs.player},shouldRenderBar:function(){return!this.showNativeControls&&this.showBottomBar&&this.isFetchedLevelInfo},shouldShowBar:function(){return!this.isUIHidden||null!==this.currentCuepoint},shouldShowProgress:function(){return this.showProgressBar&&!!this.duration},cuepointsMap:function(){return this.cuepoints.reduce((function(e,t){return e.has(t.time)?e.get(t.time).collapsed.push(t):e.set(t.time,Fn(Fn({},t),{collapsed:[]})),e}),new Map)},episodesTimes:function(){return this.episodes.map((function(e){return e.time}))},episodesTimesMap:function(){return this.episodes.reduce((function(e,t){return e.set(t.time,t),e}),new Map)}},watch:{isLive:function(e){var t=this;e&&setTimeout((function(){t.player.currentTime=t.player.duration}),1e3)},isPlayerObjectAttached:function(e){e&&(this.addFullScreenEventsListeners(),this.playing&&(this.hideUIDelayed(),this.hideLargePlayBtnDelayed()))}},created:function(){var e,t,i,s,r;this.tryAutoplay||this.showLargePlayBtn(),this.onResizeThrottled=(e=this.onResize,t=200,r=!1,function n(){if(r)return i=arguments,void(s=this);e.apply(this,arguments),r=!0,setTimeout((function(){r=!1,i&&(n.apply(s,i),i=s=null)}),t)})},mounted:function(){var e=this.$refs.player.getBoundingClientRect(),t=e.left,i=e.width;this.playerRect.offsetLeft=t,this.playerRect.width=i,this.addResizeListener()},beforeDestroy:function(){this.removeFullScreenEventsListeners(),this.removeArisedCuepointTimer(),this.removeResizeListener()},methods:{addPlayerEventListeners:function(){var e,t=this;fl.methods.addPlayerEventListeners.call(this);var i=Ba((function(e){return t.triggerCuepointOnTimeUpdate(e)})),s=Ba((function(e){return t.activateEpisodeOnTimeUpdate(e)})),r=((e={})[kn.TIME_UPDATE]=function(e){i(e),s(e)},e[kn.PLAY]=function(){t.hideUIDelayed(),t.hideLargePlayBtnDelayed()},e[kn.PAUSE]=function(){t.showUI(),t.showLargePlayButtonOnPause&&t.showLargePlayBtn()},e[kn.ENDED]=function(){t.showLargePlayButtonOnEnd&&t.showLargePlayBtn()},e);Object.entries(r).forEach((function(e){var i=e[0],s=e[1];t.player.on(i,s)}))},onRootMouseMove:function(e){if(this.playing&&this.fullScreenActive&&(0===e.clientX||0===e.clientY))return this.isUIHidden=!0,void(this.showLargePlayButton=!1);this.showUI(),this.playing&&this.hideUIDelayed(),this.playing&&this.showLargePlayButtonOnHover&&this.showLargePlayBtn()},onRootMouseLeave:function(){this.playing&&this.hideUiOnPointerLeave&&(this.isUIHidden=!0),this.playing&&this.showLargePlayButtonOnHover&&(this.showLargePlayButton=!1)},onVideoClick:function(){if(!this.playPauseOnClickVideo)return this.onVideoTap();this.isMobile&&this.onVideoTap(),this.togglePlayPause()},onVideoTap:function(){this.$emit("videoTap"),this.showUI(),this.playing&&this.hideUIDelayed()},addFullScreenEventsListeners:function(){var e=this;this.fullscreenElement&&this.fullScreenEvents.forEach((function(t){e.fullscreenElement.addEventListener(t,e.onFullScreenStateChange)}))},removeFullScreenEventsListeners:function(){var e=this;this.fullscreenElement&&this.fullScreenEvents.forEach((function(t){e.fullscreenElement.removeEventListener(t,e.onFullScreenStateChange)}))},onFullScreenStateChange:function(){var e=Zn();this.fullScreenActive=!!e,this.$emit("fullScreenStateChange",this.fullScreenActive)},toggleFullScreen:function(){return Bn(this,void 0,void 0,(function(){return Nn(this,(function(e){switch(e.label){case 0:return this.fullScreenActive?(Xn(),[3,4]):[3,1];case 1:return e.trys.push([1,3,,4]),[4,zn(this.fullscreenElement)];case 2:case 3:return e.sent(),[3,4];case 4:return this.fullScreenActive=!this.fullScreenActive,[2]}}))}))},triggerCuepointOnTimeUpdate:function(e){var t=this,i=this.cuepointsMap.get(e);i&&(this.$emit("cuepointReached",i),i.collapsed.forEach((function(e){t.$emit("cuepointReached",e)})),this.ariseCuepoint(i))},ariseCuepoint:function(e){var t=this;this.cuepointAriseDuration>0&&(this.removeArisedCuepointTimer(),this.currentCuepoint=e,this.currentCuepointTimer=setTimeout((function(){t.currentCuepoint=null,t.removeArisedCuepointTimer()}),1e3*this.cuepointAriseDuration))},removeArisedCuepointTimer:function(){clearTimeout(this.currentCuepointTimer)},onClickCuepoint:function(e){this.$emit("clickCuepoint",e)},onBackToLive:function(){this.$emit("backToLive")},onChangeLevel:function(e){this.activeLevel=e,this.autoLevel=!1,this.player.changeLevel(e)},onToggleAutoLevel:function(){this.autoLevel=!0,this.player.changeLevel(-1)},onShowSettings:function(e){this.isShowSettings=e,this.hideUIDelayed()},activateEpisodeOnTimeUpdate:function(e){if(this.episodesTimes.length>0){var t=Wo(this.episodesTimes,e),i=this.episodesTimesMap.get(t)||null;i!==this.currentEpisode&&(this.currentEpisode=i,this.$emit("episodeReached",this.currentEpisode))}},rewindToEpisode:function(e){var t=this.episodes.find((function(t){return t.id===e}));t&&this.player.rewind(t.time)},hideUIDelayed:function(){var e=this;this.hideUiWhenIdleSeconds>0&&(clearTimeout(this.hideUIDelayedTimer),this.hideUIDelayedTimer=setTimeout((function(){clearTimeout(e.hideUIDelayedTimer),e.isShowSettings?e.hideUIDelayed():e.isUIHidden=!0}),1e3*this.hideUiWhenIdleSeconds))},showUI:function(){clearTimeout(this.hideUIDelayedTimer),this.isUIHidden=!1},hideLargePlayBtnDelayed:function(){var e=this;clearTimeout(this.showLargePlayButtonTimer),this.showLargePlayButtonTimer=setTimeout((function(){clearTimeout(e.showLargePlayButtonTimer),e.showLargePlayButton=!1}),1e3*this.showLargePlayButtonSeconds)},showLargePlayBtn:function(){clearTimeout(this.showLargePlayButtonTimer),this.showLargePlayButton=!0},addResizeListener:function(){window.addEventListener("resize",this.onResizeThrottled),window.addEventListener("scroll",this.onResizeThrottled),this.$on("fullScreenStateChange",this.onResizeThrottled)},removeResizeListener:function(){window.removeEventListener("resize",this.onResizeThrottled),window.removeEventListener("scroll",this.onResizeThrottled),this.$off("fullScreenStateChange",this.onResizeThrottled)},onResize:function(){var e=this.$refs.player.getBoundingClientRect(),t=e.left,i=e.width;this.playerRect.offsetLeft=t,this.playerRect.width=i}}};const yl=_a({},undefined,{extends:_a({render:function(){var e,t,i=this,s=i.$createElement,r=i._self._c||s;return r("div",{ref:"player",class:[i.$style.player,(e={},e[i.$style.fullScreenActive]=i.fullScreenActive,e[i.$style.fitToContainer]=i.fitToContainer,e[i.$style.bottomBarOverVideo]=i.showBottomBar&&i.bottomBarOverVideo,e[i.$style.bottomBarHidden]=!i.showBottomBar,e[i.$style.uiHidden]=i.isUIHidden,e[i.$style.playerWithAdaptive]=i.isAdaptive,e[i.$style.error]=i.isError,e)],style:{backgroundColor:i.isAdaptive&&i.adaptiveBackground?i.adaptiveBackground:void 0},attrs:{tabindex:"-1","data-player-id":i.id,"qa-id":"video-player"},on:{mousemove:i.onRootMouseMove,mouseleave:i.onRootMouseLeave,touchmove:i.onRootMouseMove,keydown:i.onKeydown}},[r("div",{class:i.$style.videoWrapper,style:{backgroundColor:i.backgroundColor}},[i.$slots.cover?r("div",{class:i.$style.cover},[i._t("cover")],2):i._e(),i._v(" "),r("div",i._g({ref:"videoContainer",class:[i.$style.videoContainer,i.videoContainerClass,(t={},t[i.$style.videoObjectFitCover]=i.videoObjectFitCover,t)]},{click:i.onVideoClick,dblclick:i.toggleFullScreen}),[r("video",{ref:"media",attrs:{"qa-id":"video-player.video-element"}}),i._v(" "),i.$slots.overlay?r("div",{class:i.$style.overlay},[i._t("overlay")],2):i._e()]),i._v(" "),i.loading?r("DsLoader",{class:i.$style.loader,attrs:{"qa-id":"video-player.loader"}}):i._e(),i._v(" "),!i.showLargePlayButton||i.bottomBarTheme!==i.BOTTOM_BAR_THEME.DEFAULT&&(i.playing||i.ended)?i._e():r("PlayButton",{class:[i.$style.largePlayButton,i.playButtonClass],attrs:{playing:i.playing,ended:i.ended,"qa-id":"video-player.play-pause-btn","bottom-bar-theme":i.bottomBarTheme},on:{click:i.togglePlayPause}})],1),i._v(" "),i.shouldRenderBar?r("BottomBar",{directives:[{name:"show",rawName:"v-show",value:i.shouldShowBar,expression:"shouldShowBar"}],class:[i.$style.bottomBar,i.customClassForBottomBar],attrs:{"bottom-bar-theme":i.bottomBarTheme,visible:i.shouldShowBar,"is-mobile":i.isMobile,playing:i.playing,duration:i.duration,"current-time":i.currentTime,buffered:i.buffered,"show-settings":i.showSettings,"playback-rate":i.playbackRate,muted:i.muted,volume:i.volume,"fullscreen-active":i.fullScreenActive,"show-audio-control":i.showAudioControl,"only-toggle-audio-control":i.onlyToggleAudioControl,"show-fullscreen-control":i.showFullscreenControl,"progress-bar-disable-interactive":i.progressBarDisableInteractive,"progress-bar-disable-forward-rewind":i.progressBarDisableForwardRewind,"show-progressbar":i.shouldShowProgress,live:i.isLive,"one-line-controls":i.oneLineControls,"show-mini-play-button":i.showMiniPlayButton,cuepoints:i.cuepoints,"cuepoints-collapse-threshold":i.cuepointsCollapseThreshold,"current-cuepoint":i.currentCuepoint,"no-cuepoint-text":i.noCuepointText,episodes:i.episodes,"episodes-collapse-threshold":i.episodesCollapseThreshold,"current-episode":i.currentEpisode,"hide-current-time":i.hideCurrentTime,"hide-duration":i.hideDuration||!i.duration,"enable-control-tooltips":i.enableControlTooltips,levels:i.levels,"active-level":i.activeLevel,"auto-level":i.autoLevel,"show-level-settings":i.showLevelSettings,"show-rate-settings":i.showRateSettings,"show-preview-for-video-type":i.showPreviewForVideoType,src:i.src,"qa-id":"video-player.bottom-bar"},on:{togglePlayPause:i.togglePlayPause,changeProgress:i.onChangeProgress,mouseUpProgress:i.onMouseUpProgress,mouseDownProgress:i.onMouseDownProgress,changePlaybackRate:i.onChangePlaybackRate,toggleFullscreen:i.toggleFullScreen,toggleMuted:i.onToggleMuted,changeVolume:i.onChangeVolume,clickCuepoint:i.onClickCuepoint,backToLive:i.onBackToLive,changeLevel:i.onChangeLevel,toggleAutoLevel:i.onToggleAutoLevel,showsettings:i.onShowSettings}}):i._e()],1)},staticRenderFns:[]},(function(e){e&&(e("data-v-5e5f1764_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{player:"Oiil6",playerWithAdaptive:"_3oq8b",videoWrapper:"_1dxeA",videoContainer:"_15fIu",videoObjectFitCover:"_2GDAI",overlay:"_3xkWM",cover:"_3ED9E",bottomBar:"_12Xnj",loader:"_1ycG_",largePlayButton:"_3WDto",fullScreenActive:"_1HaZJ",fitToContainer:"h03Ea",bottomBarOverVideo:"G1ZNq",bottomBarHidden:"_3NB1O",controls:"_1oVtb",bottomLeft:"_2I7Zo",bottomRight:"_2UesP",uiHidden:"RhkBj",error:"_3zU2T"}}))}),vl,undefined,false,undefined,!1,Ca,void 0,void 0),props:{extraRequestHeaders:{type:Object,default:function(){return{}}},hlsOptions:{type:Object,default:function(){return{}}}},watch:{src:function(e,t){e!==t&&this.loadSource(e)}},mounted:function(){this.createPlayer(),this.loadSource(this.src)},beforeDestroy:function(){this.player&&this.player.destroy()},methods:{getSource:function(e){return this.setPlayerState(),this.isError=!1,this.$emit("change-src"),go.test(e)?new Vn(e,{startTime:this.startTime,extraRequestHeaders:this.extraRequestHeaders,hlsOptions:this.hlsOptions}):mo.test(e)?new Hn(e):(this.isError=!0,this.$emit("error",{message:"invalid src"}),null)},loadSource:function(e){var t=this.getSource(e);t?this.player.loadSource(t):this.player.resetSource()}}},undefined,undefined,undefined,!1,void 0,void 0,void 0);var Tl=Fn(Fn({},ul),{src:{type:String,description:"Ссылка на исходник аудио mp3/hls"},playlist:{type:Array,default:function(){return[]},description:"Массив исходников аудио mp3/hls"},progressBarDisableInteractive:{type:Boolean,default:!1,description:"В значении true отключает взаимодействие с прогрессбаром"},progressBarDisableForwardRewind:{type:Boolean,default:!1,description:"В значении true запрещает перемотку видео вперед"},isMobile:{type:Boolean,default:!1,description:"Мобильный плеер или нет"}});const El=_a({},undefined,{extends:_a({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",e._g({ref:"player",class:[e.$style.player],attrs:{"data-player-id":e.id,tabindex:"-1","qa-id":"audio-player"}},e.isMobile?{}:{keydown:e.onKeydown}),[i("audio",{ref:"media",attrs:{"qa-id":"audio-player.audio-element"}}),e._v(" "),i("ProgressBar",{attrs:{"is-mobile":e.isMobile,duration:e.duration,"current-time":e.currentTime,buffered:e.buffered,"disable-interactive":e.progressBarDisableInteractive,"disable-forward-rewind":e.progressBarDisableForwardRewind,"is-audio":!0,"qa-id":"audio-player.progress-bar"},on:{changeProgress:e.onChangeProgress,mouseDown:e.onMouseDownProgress,mouseUp:e.onMouseUpProgress}}),e._v(" "),i("div",{class:e.$style.controls},[i("div",{class:e.$style.left},[i("Control",{attrs:{"is-mobile":e.isMobile,tooltip:e.playing?"Пауза":"Слушать","is-audio":!0,"qa-id":"audio-player.play-pause-btn"},on:{controlClick:e.togglePlayPause}},[e.playing?i("PauseIcon"):i("PlayIcon")],1),e._v(" "),i("div",{class:e.$style.audioControl},[i("AudioControl",{attrs:{"is-mobile":e.isMobile,volume:e.volume,muted:e.muted,"is-audio":!0,"qa-id":"audio-player.volume"},on:{toggleMuted:e.onToggleMuted,changeVolume:e.onChangeVolume}})],1),e._v(" "),i("div",{class:e.$style.time},[i("div",{class:e.$style.currentTime,attrs:{"qa-id":"audio-player.current-time"}},[e._v(e._s(e.formatTime(e.currentTime)))]),e._v(" "),i("div",{class:e.$style.separatorTime},[e._v("/")]),e._v(" "),i("div",{class:e.$style.totalTime,attrs:{"qa-id":"audio-player.total-time"}},[e._v(e._s(e.formatTime(e.duration)))])])],1),e._v(" "),i("div",{class:e.$style.right},[i("Control",{attrs:{"is-mobile":e.isMobile,tooltip:"Настройки","is-audio":!0,"default-tooltip-style":{left:"unset",right:"-50%",transform:"none"}},on:{controlClick:e.changePlaybackRate}},[i("div",{class:e.$style.playbackRate,attrs:{"qa-id":"audio-player.playback-rate"}},[e._v("\n          "+e._s(e.playbackRate)+"x\n        ")])])],1)])],1)},staticRenderFns:[]},(function(e){e&&(e("data-v-c02fe6d0_0",{source:"",map:void 0,media:void 0}),Object.defineProperty(this,"$style",{value:{player:"_3hUPs",controls:"_1RuFW",right:"_170u7",left:"_3bnGE",time:"_2099s",currentTime:"qYoLQ",separatorTime:"_2FbWA",totalTime:"_1jSBw",playbackRate:"_26W4q",audioControl:"_3Fly-"}}))}),{name:"AudioPlayerBase",components:{PlayIcon:Ao,PauseIcon:wo,Control:Ko,AudioControl:qo,ProgressBar:Ho},extends:fl,props:Tl,data:function(){return{activePlaybackRate:0}},methods:{formatTime:function(e){return xa(e)},changePlaybackRate:function(){this.activePlaybackRate++,this.activePlaybackRate>=po.length&&(this.activePlaybackRate=0),this.onChangePlaybackRate(po[this.activePlaybackRate].value)}}},undefined,false,undefined,!1,Ca,void 0,void 0),props:{extraRequestHeaders:{type:Object,default:function(){return{}}},hlsOptions:{type:Object,default:function(){return{}}}},data:function(){return{isActivePlaylistMedia:0}},watch:{src:function(e,t){e!==t&&this.loadSource(e)}},mounted:function(){!this.src&&this.playlist.length>0&&(this.src=this.playlist[0]),this.createPlayer(),this.loadSource(this.src)},beforeDestroy:function(){this.player&&this.player.destroy()},methods:{getSource:function(e){return go.test(e)?new Vn(e,{startTime:this.startTime,extraRequestHeaders:this.extraRequestHeaders,hlsOptions:this.hlsOptions}):vo.test(e)?new Kn(e):null},loadSource:function(e){var t=this.getSource(e);t&&this.player.loadSource(t)},onEnded:function(){if(this.isActivePlaylistMedia++,this.isActivePlaylistMedia>=this.playlist.length){if(!this.loop)return;this.isActivePlaylistMedia=0}this.loadSource(this.playlist[this.isActivePlaylistMedia]),this.play(),this.ended=!1}}},undefined,undefined,undefined,!1,void 0,void 0,void 0)}(),window.__federation__.deps["@ozon-shared-deps/bx-fe__video-player@3.0.24"]||(window.__federation__.deps["@ozon-shared-deps/bx-fe__video-player@3.0.24"]=Object.defineProperties({},Object.getOwnPropertyDescriptors(t)))}();